/*! For license information please see live2d.js.LICENSE.txt */
(()=>{var t={"./src/lib/Live2DFramework.js":t=>{function e(){this.live2DModel=null,this.modelMatrix=null,this.eyeBlink=null,this.physics=null,this.pose=null,this.debugMode=!1,this.initialized=!1,this.updating=!1,this.alpha=1,this.accAlpha=0,this.lipSync=!1,this.lipSyncValue=0,this.accelX=0,this.accelY=0,this.accelZ=0,this.dragX=0,this.dragY=0,this.startTimeMSec=null,this.mainMotionManager=new u,this.expressionManager=new u,this.motions={},this.expressions={},this.isTexLoaded=!1}var i=0;function r(){AMotion.prototype.constructor.call(this),this.paramList=new Array}function s(){this.id="",this.type=-1,this.value=null}function n(){this.nextBlinkTime=null,this.stateStartTime=null,this.blinkIntervalMsec=null,this.eyeState=o.STATE_FIRST,this.blinkIntervalMsec=4e3,this.closingMotionMsec=100,this.closedMotionMsec=50,this.openingMotionMsec=150,this.closeIfZero=!0,this.eyeID_L="PARAM_EYE_L_OPEN",this.eyeID_R="PARAM_EYE_R_OPEN"}e.prototype.getModelMatrix=function(){return this.modelMatrix},e.prototype.setAlpha=function(t){t>.999&&(t=1),t<.001&&(t=0),this.alpha=t},e.prototype.getAlpha=function(){return this.alpha},e.prototype.isInitialized=function(){return this.initialized},e.prototype.setInitialized=function(t){this.initialized=t},e.prototype.isUpdating=function(){return this.updating},e.prototype.setUpdating=function(t){this.updating=t},e.prototype.getLive2DModel=function(){return this.live2DModel},e.prototype.setLipSync=function(t){this.lipSync=t},e.prototype.setLipSyncValue=function(t){this.lipSyncValue=t},e.prototype.setAccel=function(t,e,i){this.accelX=t,this.accelY=e,this.accelZ=i},e.prototype.setDrag=function(t,e){this.dragX=t,this.dragY=e},e.prototype.getMainMotionManager=function(){return this.mainMotionManager},e.prototype.getExpressionManager=function(){return this.expressionManager},e.prototype.loadModelData=function(t,e){var i=g.getPlatformManager();this.debugMode&&i.log("Load model : "+t);var r=this;i.loadLive2DModel(t,(function(t){r.live2DModel=t,r.live2DModel.saveParam(),0==Live2D.getError()?(r.modelMatrix=new l(r.live2DModel.getCanvasWidth(),r.live2DModel.getCanvasHeight()),r.modelMatrix.setWidth(2),r.modelMatrix.setCenterPosition(0,0),e(r.live2DModel)):console.error("Error : Failed to loadModelData().")}))},e.prototype.loadTexture=function(t,e,r){i++;var s=g.getPlatformManager();this.debugMode&&s.log("Load Texture : "+e);var n=this;s.loadTexture(this.live2DModel,t,e,(function(){0==--i&&(n.isTexLoaded=!0),"function"==typeof r&&r()}))},e.prototype.loadMotion=function(t,e,i){var r=g.getPlatformManager();this.debugMode&&r.log("Load Motion : "+e);var s=null,n=this;r.loadBytes(e).then((e=>{s=Live2DMotion.loadMotion(e),null!=t&&(n.motions[t]=s),i(s)}))},e.prototype.loadExpression=function(t,e,i){var s=g.getPlatformManager();this.debugMode&&s.log("Load Expression : "+e);var n=this;s.loadBytes(e).then((e=>{null!=t&&(n.expressions[t]=r.loadJson(e)),"function"==typeof i&&i()}))},e.prototype.loadPose=function(t,e){var i=g.getPlatformManager();this.debugMode&&i.log("Load Pose : "+t);var r=this;try{i.loadBytes(t).then((t=>{r.pose=c.load(t),"function"==typeof e&&e()}))}catch(t){console.warn(t)}},e.prototype.loadPhysics=function(t){var e=g.getPlatformManager();this.debugMode&&e.log("Load Physics : "+t);var i=this;try{e.loadBytes(t).then((t=>{i.physics=h.load(t)}))}catch(t){console.warn(t)}},e.prototype.hitTestSimple=function(t,e,i){if(null===this.live2DModel)return!1;var r=this.live2DModel.getDrawDataIndex(t);if(r<0)return!1;for(var s=this.live2DModel.getTransformedPoints(r),n=this.live2DModel.getCanvasWidth(),o=0,a=this.live2DModel.getCanvasHeight(),l=0,u=0;u<s.length;u+=2){var h=s[u],c=s[u+1];h<n&&(n=h),h>o&&(o=h),c<a&&(a=c),c>l&&(l=c)}var _=this.modelMatrix.invertTransformX(e),m=this.modelMatrix.invertTransformY(i);return n<=_&&_<=o&&a<=m&&m<=l},e.prototype.hitTestSimpleCustom=function(t,e,i,r){if(null===this.live2DModel)return!1;try{return i>=t[0]&&i<=e[0]&&r<=t[1]&&r>=e[1]}catch(s){return console.log("数据可能还没有准备好 view x:"+t+" y:"+e+" testX:"+i+" testY:"+r+" Error:"+s),!1}},r.prototype=new AMotion,r.EXPRESSION_DEFAULT="DEFAULT",r.TYPE_SET=0,r.TYPE_ADD=1,r.TYPE_MULT=2,r.loadJson=function(t){var e=new r,i=g.getPlatformManager().jsonParseFromBytes(t);if(e.setFadeIn(parseInt(i.fade_in)>0?parseInt(i.fade_in):1e3),e.setFadeOut(parseInt(i.fade_out)>0?parseInt(i.fade_out):1e3),null==i.params)return e;var n=i.params,o=n.length;e.paramList=[];for(var a=0;a<o;a++){var l=n[a],u=l.id.toString(),h=parseFloat(l.val),c=r.TYPE_ADD,_=null!=l.calc?l.calc.toString():"add";if((c="add"===_?r.TYPE_ADD:"mult"===_?r.TYPE_MULT:"set"===_?r.TYPE_SET:r.TYPE_ADD)==r.TYPE_ADD)h-=m=null==l.def?0:parseFloat(l.def);else if(c==r.TYPE_MULT){var m;0==(m=null==l.def?1:parseFloat(l.def))&&(m=1),h/=m}var d=new s;d.id=u,d.type=c,d.value=h,e.paramList.push(d)}return e},r.prototype.updateParamExe=function(t,e,i,s){for(var n=this.paramList.length-1;n>=0;--n){var o=this.paramList[n];o.type==r.TYPE_ADD?t.addToParamFloat(o.id,o.value,i):o.type==r.TYPE_MULT?t.multParamFloat(o.id,o.value,i):o.type==r.TYPE_SET&&t.setParamFloat(o.id,o.value,i)}},n.prototype.calcNextBlink=function(){return UtSystem.getUserTimeMSec()+Math.random()*(2*this.blinkIntervalMsec-1)},n.prototype.setInterval=function(t){this.blinkIntervalMsec=t},n.prototype.setEyeMotion=function(t,e,i){this.closingMotionMsec=t,this.closedMotionMsec=e,this.openingMotionMsec=i},n.prototype.updateParam=function(t){var e,i=UtSystem.getUserTimeMSec(),r=0;switch(this.eyeState){case o.STATE_CLOSING:(r=(i-this.stateStartTime)/this.closingMotionMsec)>=1&&(r=1,this.eyeState=o.STATE_CLOSED,this.stateStartTime=i),e=1-r;break;case o.STATE_CLOSED:(r=(i-this.stateStartTime)/this.closedMotionMsec)>=1&&(this.eyeState=o.STATE_OPENING,this.stateStartTime=i),e=0;break;case o.STATE_OPENING:(r=(i-this.stateStartTime)/this.openingMotionMsec)>=1&&(r=1,this.eyeState=o.STATE_INTERVAL,this.nextBlinkTime=this.calcNextBlink()),e=r;break;case o.STATE_INTERVAL:this.nextBlinkTime<i&&(this.eyeState=o.STATE_CLOSING,this.stateStartTime=i),e=1;break;case o.STATE_FIRST:default:this.eyeState=o.STATE_INTERVAL,this.nextBlinkTime=this.calcNextBlink(),e=1}this.closeIfZero||(e=-e),t.setParamFloat(this.eyeID_L,e),t.setParamFloat(this.eyeID_R,e)};var o=function(){};function a(){this.tr=new Float32Array(16),this.identity()}function l(t,e){a.prototype.constructor.call(this),this.width=t,this.height=e}function u(){MotionQueueManager.prototype.constructor.call(this),this.currentPriority=null,this.reservePriority=null,this.super=MotionQueueManager.prototype}function h(){this.physicsList=new Array,this.startTimeMSec=UtSystem.getUserTimeMSec()}function c(){this.lastTime=0,this.lastModel=null,this.partsGroups=new Array}function _(t){this.paramIndex=-1,this.partsIndex=-1,this.link=null,this.id=t}function m(){this.EPSILON=.01,this.faceTargetX=0,this.faceTargetY=0,this.faceX=0,this.faceY=0,this.faceVX=0,this.faceVY=0,this.lastTimeSec=0}function d(){a.prototype.constructor.call(this),this.screenLeft=null,this.screenRight=null,this.screenTop=null,this.screenBottom=null,this.maxLeft=null,this.maxRight=null,this.maxTop=null,this.maxBottom=null,this.max=Number.MAX_VALUE,this.min=0}function g(){}o.STATE_FIRST="STATE_FIRST",o.STATE_INTERVAL="STATE_INTERVAL",o.STATE_CLOSING="STATE_CLOSING",o.STATE_CLOSED="STATE_CLOSED",o.STATE_OPENING="STATE_OPENING",a.mul=function(t,e,i){var r,s,n,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<4;r++)for(s=0;s<4;s++)for(n=0;n<4;n++)o[r+4*s]+=t[r+4*n]*e[n+4*s];for(r=0;r<16;r++)i[r]=o[r]},a.prototype.identity=function(){for(var t=0;t<16;t++)this.tr[t]=t%5==0?1:0},a.prototype.getArray=function(){return this.tr},a.prototype.getCopyMatrix=function(){return new Float32Array(this.tr)},a.prototype.setMatrix=function(t){if(null!=this.tr&&this.tr.length==this.tr.length)for(var e=0;e<16;e++)this.tr[e]=t[e]},a.prototype.getScaleX=function(){return this.tr[0]},a.prototype.getScaleY=function(){return this.tr[5]},a.prototype.transformX=function(t){return this.tr[0]*t+this.tr[12]},a.prototype.transformY=function(t){return this.tr[5]*t+this.tr[13]},a.prototype.invertTransformX=function(t){return(t-this.tr[12])/this.tr[0]},a.prototype.invertTransformY=function(t){return(t-this.tr[13])/this.tr[5]},a.prototype.multTranslate=function(t,e){var i=[1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1];a.mul(i,this.tr,this.tr)},a.prototype.translate=function(t,e){this.tr[12]=t,this.tr[13]=e},a.prototype.translateX=function(t){this.tr[12]=t},a.prototype.translateY=function(t){this.tr[13]=t},a.prototype.multScale=function(t,e){var i=[t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1];a.mul(i,this.tr,this.tr)},a.prototype.scale=function(t,e){this.tr[0]=t,this.tr[5]=e},l.prototype=new a,l.prototype.setPosition=function(t,e){this.translate(t,e)},l.prototype.setCenterPosition=function(t,e){var i=this.width*this.getScaleX(),r=this.height*this.getScaleY();this.translate(t-i/2,e-r/2)},l.prototype.top=function(t){this.setY(t)},l.prototype.bottom=function(t){var e=this.height*this.getScaleY();this.translateY(t-e)},l.prototype.left=function(t){this.setX(t)},l.prototype.right=function(t){var e=this.width*this.getScaleX();this.translateX(t-e)},l.prototype.centerX=function(t){var e=this.width*this.getScaleX();this.translateX(t-e/2)},l.prototype.centerY=function(t){var e=this.height*this.getScaleY();this.translateY(t-e/2)},l.prototype.setX=function(t){this.translateX(t)},l.prototype.setY=function(t){this.translateY(t)},l.prototype.setHeight=function(t){var e=t/this.height,i=-e;this.scale(e,i)},l.prototype.setWidth=function(t){var e=t/this.width,i=-e;this.scale(e,i)},u.prototype=new MotionQueueManager,u.prototype.getCurrentPriority=function(){return this.currentPriority},u.prototype.getReservePriority=function(){return this.reservePriority},u.prototype.reserveMotion=function(t){return!(this.reservePriority>=t)&&(!(this.currentPriority>=t)&&(this.reservePriority=t,!0))},u.prototype.setReservePriority=function(t){this.reservePriority=t},u.prototype.updateParam=function(t){var e=MotionQueueManager.prototype.updateParam.call(this,t);return this.isFinished()&&(this.currentPriority=0),e},u.prototype.startMotionPrio=function(t,e){return e==this.reservePriority&&(this.reservePriority=0),this.currentPriority=e,this.startMotion(t,!1)},h.load=function(t){for(var e=new h,i=g.getPlatformManager().jsonParseFromBytes(t).physics_hair,r=i.length,s=0;s<r;s++){var n=i[s],o=new PhysicsHair,a=n.setup,l=parseFloat(a.length),u=parseFloat(a.regist),c=parseFloat(a.mass);o.setup(l,u,c);for(var _=n.src,m=_.length,d=0;d<m;d++){var p=_[d],f=p.id,y=PhysicsHair.Src.SRC_TO_X;"x"===(x=p.ptype)?y=PhysicsHair.Src.SRC_TO_X:"y"===x?y=PhysicsHair.Src.SRC_TO_Y:"angle"===x?y=PhysicsHair.Src.SRC_TO_G_ANGLE:UtDebug.error("live2d","Invalid parameter:PhysicsHair.Src");var $=parseFloat(p.scale),b=parseFloat(p.weight);o.addSrcParam(y,f,$,b)}var S=n.targets,v=S.length;for(d=0;d<v;d++){var x,P=S[d];f=P.id,y=PhysicsHair.Target.TARGET_FROM_ANGLE;"angle"===(x=P.ptype)?y=PhysicsHair.Target.TARGET_FROM_ANGLE:"angle_v"===x?y=PhysicsHair.Target.TARGET_FROM_ANGLE_V:UtDebug.error("live2d","Invalid parameter:PhysicsHair.Target");$=parseFloat(P.scale),b=parseFloat(P.weight);o.addTargetParam(y,f,$,b)}e.physicsList.push(o)}return e},h.prototype.updateParam=function(t){for(var e=UtSystem.getUserTimeMSec()-this.startTimeMSec,i=0;i<this.physicsList.length;i++)this.physicsList[i].update(t,e)},c.load=function(t){for(var e=new c,i=g.getPlatformManager().jsonParseFromBytes(t).parts_visible,r=i.length,s=0;s<r;s++){for(var n=i[s].group,o=n.length,a=new Array,l=0;l<o;l++){var u=n[l],h=new _(u.id);if(a[l]=h,null!=u.link){var m=u.link,d=m.length;h.link=new Array;for(var p=0;p<d;p++){var f=new _(m[p]);h.link.push(f)}}}e.partsGroups.push(a)}return e},c.prototype.updateParam=function(t){if(null!=t){t!=this.lastModel&&this.initParam(t),this.lastModel=t;var e=UtSystem.getUserTimeMSec(),i=0==this.lastTime?0:(e-this.lastTime)/1e3;this.lastTime=e,i<0&&(i=0);for(var r=0;r<this.partsGroups.length;r++)this.normalizePartsOpacityGroup(t,this.partsGroups[r],i),this.copyOpacityOtherParts(t,this.partsGroups[r])}},c.prototype.initParam=function(t){if(null!=t)for(var e=0;e<this.partsGroups.length;e++)for(var i=this.partsGroups[e],r=0;r<i.length;r++){i[r].initIndex(t);var s=i[r].partsIndex,n=i[r].paramIndex;if(!(s<0)){var o=0!=t.getParamFloat(n);if(t.setPartsOpacity(s,o?1:0),t.setParamFloat(n,o?1:0),null!=i[r].link)for(var a=0;a<i[r].link.length;a++)i[r].link[a].initIndex(t)}}},c.prototype.normalizePartsOpacityGroup=function(t,e,i){for(var r=-1,s=1,n=.5,o=0;o<e.length;o++){var a=e[o].partsIndex,l=e[o].paramIndex;if(!(a<0)&&0!=t.getParamFloat(l)){if(r>=0)break;r=o,s=t.getPartsOpacity(a),(s+=i/.5)>1&&(s=1)}}r<0&&(r=0,s=1);for(o=0;o<e.length;o++){if(!((a=e[o].partsIndex)<0))if(r==o)t.setPartsOpacity(a,s);else{var u,h=t.getPartsOpacity(a);(1-(u=s<n?-.5*s/n+1:(1-s)*n/.5))*(1-s)>.15&&(u=1-.15/(1-s)),h>u&&(h=u),t.setPartsOpacity(a,h)}}},c.prototype.copyOpacityOtherParts=function(t,e){for(var i=0;i<e.length;i++){var r=e[i];if(null!=r.link&&!(r.partsIndex<0))for(var s=t.getPartsOpacity(r.partsIndex),n=0;n<r.link.length;n++){var o=r.link[n];o.partsIndex<0||t.setPartsOpacity(o.partsIndex,s)}}},_.prototype.initIndex=function(t){this.paramIndex=t.getParamIndex("VISIBLE:"+this.id),this.partsIndex=t.getPartsDataIndex(PartsDataID.getID(this.id)),t.setParamFloat(this.paramIndex,1)},m.FRAME_RATE=30,m.prototype.setPoint=function(t,e){this.faceTargetX=t,this.faceTargetY=e},m.prototype.getX=function(){return this.faceX},m.prototype.getY=function(){return this.faceY},m.prototype.update=function(){var t=40/7.5/m.FRAME_RATE;if(0!=this.lastTimeSec){var e=UtSystem.getUserTimeMSec(),i=(e-this.lastTimeSec)*m.FRAME_RATE/1e3;this.lastTimeSec=e;var r=i*t/(.15*m.FRAME_RATE),s=this.faceTargetX-this.faceX,n=this.faceTargetY-this.faceY;if(!(Math.abs(s)<=this.EPSILON&&Math.abs(n)<=this.EPSILON)){var o=Math.sqrt(s*s+n*n),a=t*n/o,l=t*s/o-this.faceVX,u=a-this.faceVY,h=Math.sqrt(l*l+u*u);(h<-r||h>r)&&(l*=r/h,u*=r/h,h=r),this.faceVX+=l,this.faceVY+=u;var c=.5*(Math.sqrt(r*r+16*r*o-8*r*o)-r),_=Math.sqrt(this.faceVX*this.faceVX+this.faceVY*this.faceVY);_>c&&(this.faceVX*=c/_,this.faceVY*=c/_),this.faceX+=this.faceVX,this.faceY+=this.faceVY}}else this.lastTimeSec=UtSystem.getUserTimeMSec()},d.prototype=new a,d.prototype.getMaxScale=function(){return this.max},d.prototype.getMinScale=function(){return this.min},d.prototype.setMaxScale=function(t){this.max=t},d.prototype.setMinScale=function(t){this.min=t},d.prototype.isMaxScale=function(){return this.getScaleX()==this.max},d.prototype.isMinScale=function(){return this.getScaleX()==this.min},d.prototype.adjustTranslate=function(t,e){this.tr[0]*this.maxLeft+(this.tr[12]+t)>this.screenLeft&&(t=this.screenLeft-this.tr[0]*this.maxLeft-this.tr[12]),this.tr[0]*this.maxRight+(this.tr[12]+t)<this.screenRight&&(t=this.screenRight-this.tr[0]*this.maxRight-this.tr[12]),this.tr[5]*this.maxTop+(this.tr[13]+e)<this.screenTop&&(e=this.screenTop-this.tr[5]*this.maxTop-this.tr[13]),this.tr[5]*this.maxBottom+(this.tr[13]+e)>this.screenBottom&&(e=this.screenBottom-this.tr[5]*this.maxBottom-this.tr[13]);var i=[1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1];a.mul(i,this.tr,this.tr)},d.prototype.adjustScale=function(t,e,i){var r=i*this.tr[0];r<this.min?this.tr[0]>0&&(i=this.min/this.tr[0]):r>this.max&&this.tr[0]>0&&(i=this.max/this.tr[0]);var s=[1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1],n=[i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1],o=[1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1];a.mul(o,this.tr,this.tr),a.mul(n,this.tr,this.tr),a.mul(s,this.tr,this.tr)},d.prototype.setScreenRect=function(t,e,i,r){this.screenLeft=t,this.screenRight=e,this.screenTop=r,this.screenBottom=i},d.prototype.setMaxScreenRect=function(t,e,i,r){this.maxLeft=t,this.maxRight=e,this.maxTop=r,this.maxBottom=i},d.prototype.getScreenLeft=function(){return this.screenLeft},d.prototype.getScreenRight=function(){return this.screenRight},d.prototype.getScreenBottom=function(){return this.screenBottom},d.prototype.getScreenTop=function(){return this.screenTop},d.prototype.getMaxLeft=function(){return this.maxLeft},d.prototype.getMaxRight=function(){return this.maxRight},d.prototype.getMaxBottom=function(){return this.maxBottom},d.prototype.getMaxTop=function(){return this.maxTop},g.platformManager=null,g.getPlatformManager=function(){return g.platformManager},g.setPlatformManager=function(t){g.platformManager=t},t.exports={L2DTargetPoint:m,Live2DFramework:g,L2DViewMatrix:d,L2DPose:c,L2DPartsParam:_,L2DPhysics:h,L2DMotionManager:u,L2DModelMatrix:l,L2DMatrix44:a,EYE_STATE:o,L2DEyeBlink:n,L2DExpressionParam:s,L2DExpressionMotion:r,L2DBaseModel:e}},"./src/lib/live2d.min.js":()=>{!function(){var t=!0;function e(){t||(this._$MT=null,this._$5S=null,this._$NP=0,e._$42++,this._$5S=new U(this))}function i(e){if(!t){this.clipContextList=new Array,this.glcontext=e.gl,this.dp_webgl=e,this.curFrameNo=0,this.firstError_clipInNotUpdate=!0,this.colorBuffer=0,this.isInitGLFBFunc=!1,this.tmpBoundsOnModel=new v,lt.glContext.length>lt.frameBuffers.length&&(this.curFrameNo=this.getMaskRenderTexture()),this.tmpModelToViewMatrix=new B,this.tmpMatrix2=new B,this.tmpMatrixForMask=new B,this.tmpMatrixForDraw=new B,this.CHANNEL_COLORS=new Array;var i=new M;(i=new M).r=0,i.g=0,i.b=0,i.a=1,this.CHANNEL_COLORS.push(i),(i=new M).r=1,i.g=0,i.b=0,i.a=0,this.CHANNEL_COLORS.push(i),(i=new M).r=0,i.g=1,i.b=0,i.a=0,this.CHANNEL_COLORS.push(i),(i=new M).r=0,i.g=0,i.b=1,i.a=0,this.CHANNEL_COLORS.push(i);for(var r=0;r<this.CHANNEL_COLORS.length;r++)this.dp_webgl.setChannelFlagAsColor(r,this.CHANNEL_COLORS[r])}}function r(t,e,i){this.clipIDList=new Array,this.clipIDList=i,this.clippingMaskDrawIndexList=new Array;for(var r=0;r<i.length;r++)this.clippingMaskDrawIndexList.push(e.getDrawDataIndex(i[r]));this.clippedDrawContextList=new Array,this.isUsing=!0,this.layoutChannelNo=0,this.layoutBounds=new v,this.allClippedDrawRect=new v,this.matrixForMask=new Float32Array(16),this.matrixForDraw=new Float32Array(16),this.owner=t}function s(t,e){this._$gP=t,this.drawDataIndex=e}function n(){t||(this.color=null)}function o(){t||(this._$dP=null,this._$eo=null,this._$V0=null,this._$dP=1e3,this._$eo=1e3,this._$V0=1,this._$a0())}function a(){}function l(){this._$r=null,this._$0S=null}function u(){t||(this.x=null,this.y=null,this.width=null,this.height=null)}function h(e){t||rt.prototype.constructor.call(this,e)}function c(e){t||rt.prototype.constructor.call(this,e)}function _(){t||(this._$vo=null,this._$F2=null,this._$ao=400,this._$1S=400,_._$42++)}function d(){t||(this.p1=new g,this.p2=new g,this._$Fo=0,this._$Db=0,this._$L2=0,this._$M2=0,this._$ks=0,this._$9b=0,this._$iP=0,this._$iT=0,this._$lL=new Array,this._$qP=new Array,this.setup(.3,.5,.1))}function g(){this._$p=1,this.x=0,this.y=0,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.fx=0,this.fy=0,this._$s0=0,this._$70=0,this._$7L=0,this._$HL=0}function p(t,e,i){this._$wL=null,this.scale=null,this._$V0=null,this._$wL=t,this.scale=e,this._$V0=i}function f(t,e,i,r){p.prototype.constructor.call(this,e,i,r),this._$tL=null,this._$tL=t}function y(t,e,i){this._$wL=null,this.scale=null,this._$V0=null,this._$wL=t,this.scale=e,this._$V0=i}function $(t,e,i,r){y.prototype.constructor.call(this,e,i,r),this._$YP=null,this._$YP=t}function b(){t||(this._$fL=0,this._$gL=0,this._$B0=1,this._$z0=1,this._$qT=0,this.reflectX=!1,this.reflectY=!1)}e._$0s=1,e._$4s=2,e._$42=0,e._$62=function(t,i){try{if(i instanceof ArrayBuffer&&(i=new DataView(i)),!(i instanceof DataView))throw new ht("_$SS#loadModel(b) / b _$x be DataView or ArrayBuffer");var r,s=new vt(i),n=s._$ST(),o=s._$ST(),l=s._$ST();if(109!=n||111!=o||99!=l)throw new ht("_$gi _$C _$li , _$Q0 _$P0.");if(r=s._$ST(),s._$gr(r),r>N._$T7)throw t._$NP|=e._$4s,new ht("_$gi _$C _$li , _$n0 _$_ version _$li ( SDK : "+N._$T7+" < _$f0 : "+r+" )@_$SS#loadModel()\n");var u=s._$nP();if(r>=N._$s7){var h=s._$9T(),c=s._$9T();if(-30584!=h||-30584!=c)throw t._$NP|=e._$0s,new ht("_$gi _$C _$li , _$0 _$6 _$Ui.")}t._$KS(u);var _=t.getModelContext();_.setDrawParam(t.getDrawParam()),_.init()}catch(t){a._$Rb(t)}},e.prototype._$KS=function(t){this._$MT=t},e.prototype.getModelImpl=function(){return null==this._$MT&&(this._$MT=new _,this._$MT._$zP()),this._$MT},e.prototype.getCanvasWidth=function(){return null==this._$MT?0:this._$MT.getCanvasWidth()},e.prototype.getCanvasHeight=function(){return null==this._$MT?0:this._$MT.getCanvasHeight()},e.prototype.getParamFloat=function(t){return"number"!=typeof t&&(t=this._$5S.getParamIndex(c.getID(t))),this._$5S.getParamFloat(t)},e.prototype.setParamFloat=function(t,e,i){"number"!=typeof t&&(t=this._$5S.getParamIndex(c.getID(t))),arguments.length<3&&(i=1),this._$5S.setParamFloat(t,this._$5S.getParamFloat(t)*(1-i)+e*i)},e.prototype.addToParamFloat=function(t,e,i){"number"!=typeof t&&(t=this._$5S.getParamIndex(c.getID(t))),arguments.length<3&&(i=1),this._$5S.setParamFloat(t,this._$5S.getParamFloat(t)+e*i)},e.prototype.multParamFloat=function(t,e,i){"number"!=typeof t&&(t=this._$5S.getParamIndex(c.getID(t))),arguments.length<3&&(i=1),this._$5S.setParamFloat(t,this._$5S.getParamFloat(t)*(1+(e-1)*i))},e.prototype.getParamIndex=function(t){return this._$5S.getParamIndex(c.getID(t))},e.prototype.loadParam=function(){this._$5S.loadParam()},e.prototype.saveParam=function(){this._$5S.saveParam()},e.prototype.init=function(){this._$5S.init()},e.prototype.update=function(){this._$5S.update()},e.prototype._$Rs=function(){return a._$li("_$60 _$PT _$Rs()"),-1},e.prototype._$Ds=function(t){a._$li("_$60 _$PT _$SS#_$Ds() \n")},e.prototype._$K2=function(){},e.prototype.draw=function(){},e.prototype.getModelContext=function(){return this._$5S},e.prototype._$s2=function(){return this._$NP},e.prototype._$P7=function(t,e,i,r){var s=-1,n=0,o=this,a=.5;if(0!=i)if(1==t.length){d=t[0];var l=0!=o.getParamFloat(d),u=(g=e[0],o.getPartsOpacity(g)),h=i/r;l?(u+=h)>1&&(u=1):(u-=h)<0&&(u=0),o.setPartsOpacity(g,u)}else{for(m=0;m<t.length;m++){d=t[m];if(p=0!=o.getParamFloat(d)){if(s>=0)break;s=m;g=e[m];n=o.getPartsOpacity(g),(n+=i/r)>1&&(n=1)}}s<0&&(console.log("No _$wi _$q0/ _$U default[%s]",t[0]),s=0,n=1,o.loadParam(),o.setParamFloat(t[s],n),o.saveParam());for(m=0;m<t.length;m++){g=e[m];if(s==m)o.setPartsOpacity(g,n);else{var c,_=o.getPartsOpacity(g);(1-(c=n<a?-.5*n/a+1:(1-n)*a/.5))*(1-n)>.15&&(c=1-.15/(1-n)),_>c&&(_=c),o.setPartsOpacity(g,_)}}}else for(var m=0;m<t.length;m++){var d=t[m],g=e[m],p=0!=o.getParamFloat(d);o.setPartsOpacity(g,p?1:0)}},e.prototype.setPartsOpacity=function(t,e){"number"!=typeof t&&(t=this._$5S.getPartsDataIndex(h.getID(t))),this._$5S.setPartsOpacity(t,e)},e.prototype.getPartsDataIndex=function(t){return t instanceof h||(t=h.getID(t)),this._$5S.getPartsDataIndex(t)},e.prototype.getPartsOpacity=function(t){return"number"!=typeof t&&(t=this._$5S.getPartsDataIndex(h.getID(t))),t<0?0:this._$5S.getPartsOpacity(t)},e.prototype.getDrawParam=function(){},e.prototype.getDrawDataIndex=function(t){return this._$5S.getDrawDataIndex(A.getID(t))},e.prototype.getDrawData=function(t){return this._$5S.getDrawData(t)},e.prototype.getTransformedPoints=function(t){var e=this._$5S._$C2(t);return e instanceof _t?e.getTransformedPoints():null},e.prototype.getIndexArray=function(t){if(t<0||t>=this._$5S._$aS.length)return null;var e=this._$5S._$aS[t];return null!=e&&e.getType()==H._$wb&&e instanceof ct?e.getIndexArray():null},i.CHANNEL_COUNT=4,i.RENDER_TEXTURE_USE_MIPMAP=!1,i.NOT_USED_FRAME=-100,i.prototype._$L7=function(){if(this.tmpModelToViewMatrix&&(this.tmpModelToViewMatrix=null),this.tmpMatrix2&&(this.tmpMatrix2=null),this.tmpMatrixForMask&&(this.tmpMatrixForMask=null),this.tmpMatrixForDraw&&(this.tmpMatrixForDraw=null),this.tmpBoundsOnModel&&(this.tmpBoundsOnModel=null),this.CHANNEL_COLORS){for(var t=this.CHANNEL_COLORS.length-1;t>=0;--t)this.CHANNEL_COLORS.splice(t,1);this.CHANNEL_COLORS=[]}this.releaseShader()},i.prototype.releaseShader=function(){for(var t=lt.frameBuffers.length,e=0;e<t;e++)this.gl.deleteFramebuffer(lt.frameBuffers[e].framebuffer);lt.frameBuffers=[],lt.glContext=[]},i.prototype.init=function(t,e,i){for(var s=0;s<e.length;s++){var n=e[s].getClipIDList();if(null!=n){var o=this.findSameClip(n);null==o&&(o=new r(this,t,n),this.clipContextList.push(o));var a=e[s].getDrawDataID(),l=t.getDrawDataIndex(a);o.addClippedDrawData(a,l),i[s].clipBufPre_clipContext=o}}},i.prototype.getMaskRenderTexture=function(){var t;return t=this.dp_webgl.createFramebuffer(),lt.frameBuffers[this.dp_webgl.glno]=t,this.dp_webgl.glno},i.prototype.setupClip=function(t,e){for(var i=0,r=0;r<this.clipContextList.length;r++){var s=this.clipContextList[r];this.calcClippedDrawTotalBounds(t,s),s.isUsing&&i++}if(i>0){var n=e.gl.getParameter(e.gl.FRAMEBUFFER_BINDING),o=new Array(4);o[0]=0,o[1]=0,o[2]=e.gl.canvas.width,o[3]=e.gl.canvas.height,e.gl.viewport(0,0,lt.clippingMaskBufferSize,lt.clippingMaskBufferSize),this.setupLayoutBounds(i),e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,lt.frameBuffers[this.curFrameNo].framebuffer),e.gl.clearColor(0,0,0,0),e.gl.clear(e.gl.COLOR_BUFFER_BIT);for(r=0;r<this.clipContextList.length;r++){var a=(s=this.clipContextList[r]).allClippedDrawRect,l=(s.layoutChannelNo,s.layoutBounds);this.tmpBoundsOnModel._$jL(a),this.tmpBoundsOnModel.expand(.05*a.width,.05*a.height);var u=l.width/this.tmpBoundsOnModel.width,h=l.height/this.tmpBoundsOnModel.height;this.tmpMatrix2.identity(),this.tmpMatrix2.translate(-1,-1,0),this.tmpMatrix2.scale(2,2,1),this.tmpMatrix2.translate(l.x,l.y,0),this.tmpMatrix2.scale(u,h,1),this.tmpMatrix2.translate(-this.tmpBoundsOnModel.x,-this.tmpBoundsOnModel.y,0),this.tmpMatrixForMask.setMatrix(this.tmpMatrix2.m),this.tmpMatrix2.identity(),this.tmpMatrix2.translate(l.x,l.y,0),this.tmpMatrix2.scale(u,h,1),this.tmpMatrix2.translate(-this.tmpBoundsOnModel.x,-this.tmpBoundsOnModel.y,0),this.tmpMatrixForDraw.setMatrix(this.tmpMatrix2.m);for(var c=this.tmpMatrixForMask.getArray(),_=0;_<16;_++)s.matrixForMask[_]=c[_];var m=this.tmpMatrixForDraw.getArray();for(_=0;_<16;_++)s.matrixForDraw[_]=m[_];for(var d=s.clippingMaskDrawIndexList.length,g=0;g<d;g++){var p=s.clippingMaskDrawIndexList[g],f=t.getDrawData(p),y=t._$C2(p);e.setClipBufPre_clipContextForMask(s),f.draw(e,t,y)}}e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,n),e.setClipBufPre_clipContextForMask(null),e.gl.viewport(o[0],o[1],o[2],o[3])}},i.prototype.getColorBuffer=function(){return this.colorBuffer},i.prototype.findSameClip=function(t){for(var e=0;e<this.clipContextList.length;e++){var i=this.clipContextList[e],r=i.clipIDList.length;if(r==t.length){for(var s=0,n=0;n<r;n++)for(var o=i.clipIDList[n],a=0;a<r;a++)if(t[a]==o){s++;break}if(s==r)return i}}return null},i.prototype.calcClippedDrawTotalBounds=function(t,e){for(var i=t._$Ri.getModelImpl().getCanvasWidth(),r=t._$Ri.getModelImpl().getCanvasHeight(),s=i>r?i:r,n=s,o=s,a=0,l=0,u=e.clippedDrawContextList.length,h=0;h<u;h++){var c=e.clippedDrawContextList[h].drawDataIndex,_=t._$C2(c);if(_._$yo()){for(var m=_.getTransformedPoints(),d=m.length,g=[],p=[],f=0,y=O._$i2;y<d;y+=O._$No)g[f]=m[y],p[f]=m[y+1],f++;var $=Math.min.apply(null,g),b=Math.min.apply(null,p),S=Math.max.apply(null,g),v=Math.max.apply(null,p);$<n&&(n=$),b<o&&(o=b),S>a&&(a=S),v>l&&(l=v)}}if(n==s)e.allClippedDrawRect.x=0,e.allClippedDrawRect.y=0,e.allClippedDrawRect.width=0,e.allClippedDrawRect.height=0,e.isUsing=!1;else{var x=a-n,P=l-o;e.allClippedDrawRect.x=n,e.allClippedDrawRect.y=o,e.allClippedDrawRect.width=x,e.allClippedDrawRect.height=P,e.isUsing=!0}},i.prototype.setupLayoutBounds=function(t){var e=t/i.CHANNEL_COUNT,r=t%i.CHANNEL_COUNT;e=~~e,r=~~r;for(var s=0,n=0;n<i.CHANNEL_COUNT;n++){var o=e+(n<r?1:0);if(0==o);else if(1==o)(c=this.clipContextList[s++]).layoutChannelNo=n,c.layoutBounds.x=0,c.layoutBounds.y=0,c.layoutBounds.width=1,c.layoutBounds.height=1;else if(2==o)for(var l=0;l<o;l++){var u=0;h=~~(h=l%2),(c=this.clipContextList[s++]).layoutChannelNo=n,c.layoutBounds.x=.5*h,c.layoutBounds.y=0,c.layoutBounds.width=.5,c.layoutBounds.height=1}else if(o<=4)for(l=0;l<o;l++){h=~~(h=l%2),u=~~(u=l/2),(c=this.clipContextList[s++]).layoutChannelNo=n,c.layoutBounds.x=.5*h,c.layoutBounds.y=.5*u,c.layoutBounds.width=.5,c.layoutBounds.height=.5}else if(o<=9)for(l=0;l<o;l++){var h,c;h=~~(h=l%3),u=~~(u=l/3),(c=this.clipContextList[s++]).layoutChannelNo=n,c.layoutBounds.x=h/3,c.layoutBounds.y=u/3,c.layoutBounds.width=1/3,c.layoutBounds.height=1/3}else a._$li("_$6 _$0P mask count : %d",o)}},r.prototype.addClippedDrawData=function(t,e){var i=new s(t,e);this.clippedDrawContextList.push(i)},o._$JT=function(t,e,i){var r=t/e,s=i/e,n=1/3,o=2/3,a=1-(1-s)*(1-s),l=1-(1-s)*(1-s),u=(1-s)*n*a+(s*o+(1-s)*n)*(1-a),h=(s+(1-s)*o)*l+(s*n+(1-s)*o)*(1-l);if(r<=0)return 0;if(r>=1)return 1;var c=r*r;return(1-3*h+3*u-0)*(r*c)+(3*h-6*u+0)*c+(3*u-0)*r+0},o.prototype._$a0=function(){},o.prototype.setFadeIn=function(t){this._$dP=t},o.prototype.setFadeOut=function(t){this._$eo=t},o.prototype._$pT=function(t){this._$V0=t},o.prototype.getFadeOut=function(){return this._$eo},o.prototype._$4T=function(){return this._$eo},o.prototype._$mT=function(){return this._$V0},o.prototype.getDurationMSec=function(){return-1},o.prototype.getLoopDurationMSec=function(){return-1},o.prototype.updateParam=function(t,e){if(e._$AT&&!e._$9L){var i=L.getUserTimeMSec();if(e._$z2<0){e._$z2=i,e._$bs=i;var r=this.getDurationMSec();e._$Do<0&&(e._$Do=r<=0?-1:e._$z2+r)}var s=this._$V0;0<=(s=s*(0==this._$dP?1:ut._$r2((i-e._$bs)/this._$dP))*(0==this._$eo||e._$Do<0?1:ut._$r2((e._$Do-i)/this._$eo)))&&s<=1||console.log("### assert!! ### "),this.updateParamExe(t,i,s,e),e._$Do>0&&e._$Do<i&&(e._$9L=!0)}},o.prototype.updateParamExe=function(t,e,i,r){},a._$8s=0,a._$fT=new Object,a.start=function(t){var e=a._$fT[t];null==e&&((e=new l)._$r=t,a._$fT[t]=e),e._$0S=L.getSystemTimeMSec()},a.dump=function(t){var e=a._$fT[t];if(null!=e){var i=L.getSystemTimeMSec()-e._$0S;return console.log(t+" : "+i+"ms"),i}return-1},a.end=function(t){var e=a._$fT[t];return null!=e?L.getSystemTimeMSec()-e._$0S:-1},a._$li=function(t,e){console.log("_$li : "+t+"\n",e)},a._$Ji=function(t,e){console.log(t,e)},a._$dL=function(t,e){console.log(t,e),console.log("\n")},a._$KL=function(t,e){for(var i=0;i<e;i++)i%16==0&&i>0?console.log("\n"):i%8==0&&i>0&&console.log("  "),console.log("%02X ",255&t[i]);console.log("\n")},a._$nr=function(t,e,i){console.log("%s\n",t);for(var r=e.length,s=0;s<r;++s)console.log("%5d",e[s]),console.log("%s\n",i),console.log(",");console.log("\n")},a._$Rb=function(t){console.log("dump exception : "+t),console.log("stack :: "+t.stack)},u.prototype._$8P=function(){return.5*(this.x+this.x+this.width)},u.prototype._$6P=function(){return.5*(this.y+this.y+this.height)},u.prototype._$EL=function(){return this.x+this.width},u.prototype._$5T=function(){return this.y+this.height},u.prototype._$jL=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r},u.prototype._$jL=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},h.prototype=new rt,h._$tP=new Object,h._$27=function(){h._$tP.clear()},h.getID=function(t){var e=h._$tP[t];return null==e&&(e=new h(t),h._$tP[t]=e),e},h.prototype._$3s=function(){return new h},c.prototype=new rt,c._$tP=new Object,c._$27=function(){c._$tP.clear()},c.getID=function(t){var e=c._$tP[t];return null==e&&(e=new c(t),c._$tP[t]=e),e},c.prototype._$3s=function(){return new c},_._$42=0,_.prototype._$zP=function(){null==this._$vo&&(this._$vo=new st),null==this._$F2&&(this._$F2=new Array)},_.prototype.getCanvasWidth=function(){return this._$ao},_.prototype.getCanvasHeight=function(){return this._$1S},_.prototype._$F0=function(t){this._$vo=t._$nP(),this._$F2=t._$nP(),this._$ao=t._$6L(),this._$1S=t._$6L()},_.prototype._$6S=function(t){this._$F2.push(t)},_.prototype._$Xr=function(){return this._$F2},_.prototype._$E2=function(){return this._$vo},d.prototype.setup=function(t,e,i){this._$ks=this._$Yb(),this.p2._$xT(),3==arguments.length&&(this._$Fo=t,this._$L2=e,this.p1._$p=i,this.p2._$p=i,this.p2.y=t,this.setup())},d.prototype.getPhysicsPoint1=function(){return this.p1},d.prototype.getPhysicsPoint2=function(){return this.p2},d.prototype._$qr=function(){return this._$Db},d.prototype._$pr=function(t){this._$Db=t},d.prototype._$5r=function(){return this._$M2},d.prototype._$Cs=function(){return this._$9b},d.prototype._$Yb=function(){return-180*Math.atan2(this.p1.x-this.p2.x,-(this.p1.y-this.p2.y))/Math.PI},d.prototype.addSrcParam=function(t,e,i,r){var s=new f(t,e,i,r);this._$lL.push(s)},d.prototype.addTargetParam=function(t,e,i,r){var s=new $(t,e,i,r);this._$qP.push(s)},d.prototype.update=function(t,e){if(0==this._$iP)return this._$iP=this._$iT=e,void(this._$Fo=Math.sqrt((this.p1.x-this.p2.x)*(this.p1.x-this.p2.x)+(this.p1.y-this.p2.y)*(this.p1.y-this.p2.y)));var i=(e-this._$iT)/1e3;if(0!=i){for(var r=this._$lL.length-1;r>=0;--r){this._$lL[r]._$oP(t,this)}this._$oo(t,i),this._$M2=this._$Yb(),this._$9b=(this._$M2-this._$ks)/i,this._$ks=this._$M2}for(r=this._$qP.length-1;r>=0;--r){this._$qP[r]._$YS(t,this)}this._$iT=e},d.prototype._$oo=function(t,e){e<.033&&(e=.033);var i=1/e;this.p1.vx=(this.p1.x-this.p1._$s0)*i,this.p1.vy=(this.p1.y-this.p1._$70)*i,this.p1.ax=(this.p1.vx-this.p1._$7L)*i,this.p1.ay=(this.p1.vy-this.p1._$HL)*i,this.p1.fx=this.p1.ax*this.p1._$p,this.p1.fy=this.p1.ay*this.p1._$p,this.p1._$xT();var r,s,n=-Math.atan2(this.p1.y-this.p2.y,this.p1.x-this.p2.x),o=Math.cos(n),a=Math.sin(n),l=9.8*this.p2._$p,u=this._$Db*Pt._$bS,h=l*Math.cos(n-u);r=h*a,s=h*o;var c=-this.p1.fx*a*a,_=-this.p1.fy*a*o,m=-this.p2.vx*this._$L2,d=-this.p2.vy*this._$L2;this.p2.fx=r+c+m,this.p2.fy=s+_+d,this.p2.ax=this.p2.fx/this.p2._$p,this.p2.ay=this.p2.fy/this.p2._$p,this.p2.vx+=this.p2.ax*e,this.p2.vy+=this.p2.ay*e,this.p2.x+=this.p2.vx*e,this.p2.y+=this.p2.vy*e;var g=Math.sqrt((this.p1.x-this.p2.x)*(this.p1.x-this.p2.x)+(this.p1.y-this.p2.y)*(this.p1.y-this.p2.y));this.p2.x=this.p1.x+this._$Fo*(this.p2.x-this.p1.x)/g,this.p2.y=this.p1.y+this._$Fo*(this.p2.y-this.p1.y)/g,this.p2.vx=(this.p2.x-this.p2._$s0)*i,this.p2.vy=(this.p2.y-this.p2._$70)*i,this.p2._$xT()},g.prototype._$xT=function(){this._$s0=this.x,this._$70=this.y,this._$7L=this.vx,this._$HL=this.vy},p.prototype._$oP=function(t,e){},f.prototype=new p,f.prototype._$oP=function(t,e){var i=this.scale*t.getParamFloat(this._$wL),r=e.getPhysicsPoint1();switch(this._$tL){default:case d.Src.SRC_TO_X:r.x=r.x+(i-r.x)*this._$V0;break;case d.Src.SRC_TO_Y:r.y=r.y+(i-r.y)*this._$V0;break;case d.Src.SRC_TO_G_ANGLE:var s=e._$qr();s+=(i-s)*this._$V0,e._$pr(s)}},y.prototype._$YS=function(t,e){},$.prototype=new y,$.prototype._$YS=function(t,e){switch(this._$YP){default:case d.Target.TARGET_FROM_ANGLE:t.setParamFloat(this._$wL,this.scale*e._$5r(),this._$V0);break;case d.Target.TARGET_FROM_ANGLE_V:t.setParamFloat(this._$wL,this.scale*e._$Cs(),this._$V0)}},d.Src=function(){},d.Src.SRC_TO_X="SRC_TO_X",d.Src.SRC_TO_Y="SRC_TO_Y",d.Src.SRC_TO_G_ANGLE="SRC_TO_G_ANGLE",d.Target=function(){},d.Target.TARGET_FROM_ANGLE="TARGET_FROM_ANGLE",d.Target.TARGET_FROM_ANGLE_V="TARGET_FROM_ANGLE_V",b.prototype.init=function(t){this._$fL=t._$fL,this._$gL=t._$gL,this._$B0=t._$B0,this._$z0=t._$z0,this._$qT=t._$qT,this.reflectX=t.reflectX,this.reflectY=t.reflectY},b.prototype._$F0=function(t){this._$fL=t._$_T(),this._$gL=t._$_T(),this._$B0=t._$_T(),this._$z0=t._$_T(),this._$qT=t._$_T(),t.getFormatVersion()>=N.LIVE2D_FORMAT_VERSION_V2_10_SDK2&&(this.reflectX=t._$po(),this.reflectY=t._$po())},b.prototype._$e=function(){};var S=function(){};function v(){t||(this.x=null,this.y=null,this.width=null,this.height=null)}function x(){}function P(){t||(this.x=null,this.y=null)}function C(){t||(this._$gP=null,this._$dr=null,this._$GS=null,this._$qb=null,this._$Lb=null,this._$mS=null,this.clipID=null,this.clipIDList=new Array)}function w(){t||(this._$Eb=w._$ps,this._$lT=1,this._$C0=1,this._$tT=1,this._$WL=1,this.culling=!1,this.matrix4x4=new Float32Array(16),this.premultipliedAlpha=!1,this.anisotropy=0,this.clippingProcess=w.CLIPPING_PROCESS_NONE,this.clipBufPre_clipContextMask=null,this.clipBufPre_clipContextDraw=null,this.CHANNEL_COLORS=new Array)}function M(){t||(this.a=1,this.r=1,this.g=1,this.b=1,this.scale=1,this._$ho=1,this.blendMode=lt.L2D_COLOR_BLEND_MODE_MULT)}function T(){t||(this._$kP=null,this._$dr=null,this._$Ai=!0,this._$mS=null)}function L(){}function I(){t||(this._$VP=0,this._$wL=null,this._$GP=null,this._$8o=I._$ds,this._$2r=-1,this._$O2=0,this._$ri=0)}function E(){}function F(){t||(this._$Ob=null)}function B(){this.m=new Float32Array(16),this.identity()}function A(e){t||rt.prototype.constructor.call(this,e)}function D(){t||(this._$7=1,this._$f=0,this._$H=0,this._$g=1,this._$k=0,this._$w=0,this._$hi=STATE_IDENTITY,this._$Z=_$pS)}function R(){t||(o.prototype.constructor.call(this),this.motions=new Array,this._$7r=null,this._$7r=R._$Co++,this._$D0=30,this._$yT=0,this._$E=!0,this.loopFadeIn=!0,this._$AS=-1,_$a0())}function k(){this._$P=new Float32Array(100),this.size=0}function V(){this._$4P=null,this._$I0=null,this._$RP=null}function O(){}function N(){}function U(e){t||(this._$QT=!0,this._$co=-1,this._$qo=0,this._$pb=new Array(U._$is),this._$_2=new Float32Array(U._$is),this._$vr=new Float32Array(U._$is),this._$Rr=new Float32Array(U._$is),this._$Or=new Float32Array(U._$is),this._$fs=new Float32Array(U._$is),this._$Js=new Array(U._$is),this._$3S=new Array,this._$aS=new Array,this._$Bo=null,this._$F2=new Array,this._$db=new Array,this._$8b=new Array,this._$Hr=new Array,this._$Ws=null,this._$Vs=null,this._$Er=null,this._$Es=new Int16Array(O._$Qb),this._$ZP=new Float32Array(2*O._$1r),this._$Ri=e,this._$b0=U._$HP++,this.clipManager=null,this.dp_webgl=null)}function z(){}function Y(){t||(this._$12=null,this._$bb=null,this._$_L=null,this._$jo=null,this._$iL=null,this._$0L=null,this._$Br=null,this._$Dr=null,this._$Cb=null,this._$mr=null,this._$_L=j.STATE_FIRST,this._$Br=4e3,this._$Dr=100,this._$Cb=50,this._$mr=150,this._$jo=!0,this._$iL="PARAM_EYE_L_OPEN",this._$0L="PARAM_EYE_R_OPEN")}S._$ni=function(t,e,i,r,s,n,o,a,l){var u=o*n-a*s;if(0==u)return null;var h,c=((t-i)*n-(e-r)*s)/u;return h=0!=s?(t-i-c*o)/s:(e-r-c*a)/n,isNaN(h)&&(h=(t-i-c*o)/s,isNaN(h)&&(h=(e-r-c*a)/n),isNaN(h)&&(console.log("a is NaN @UtVector#_$ni() "),console.log("v1x : "+s),console.log("v1x != 0 ? "+(0!=s)))),null==l?new Array(h,c):(l[0]=h,l[1]=c,l)},v.prototype._$8P=function(){return this.x+.5*this.width},v.prototype._$6P=function(){return this.y+.5*this.height},v.prototype._$EL=function(){return this.x+this.width},v.prototype._$5T=function(){return this.y+this.height},v.prototype._$jL=function(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r},v.prototype._$jL=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},v.prototype.contains=function(t,e){return this.x<=this.x&&this.y<=this.y&&this.x<=this.x+this.width&&this.y<=this.y+this.height},v.prototype.expand=function(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e},x._$Z2=function(t,e,i,r){var s=e._$Q2(t,i),n=t._$vs(),o=t._$Tr();if(e._$zr(n,o,s),s<=0)return r[n[0]];if(1==s)return(a=r[n[0]])+((l=r[n[1]])-a)*($=o[0])|0;if(2==s){var a=r[n[0]],l=r[n[1]],u=r[n[2]],h=r[n[3]];return(v=a+(l-a)*($=o[0])|0)+((u+(h-u)*$|0)-v)*(b=o[1])|0}if(3==s){var c=r[n[0]],_=r[n[1]],m=r[n[2]],d=r[n[3]],g=r[n[4]],p=r[n[5]],f=r[n[6]],y=r[n[7]];return(v=(a=c+(_-c)*($=o[0])|0)+((l=m+(d-m)*$|0)-a)*(b=o[1])|0)+(((u=g+(p-g)*$|0)+((h=f+(y-f)*$|0)-u)*b|0)-v)*(S=o[2])|0}if(4==s){var $,b,S,v,x=r[n[0]],P=r[n[1]],C=r[n[2]],w=r[n[3]],M=r[n[4]],T=r[n[5]],L=r[n[6]],I=r[n[7]],E=r[n[8]],F=r[n[9]],B=r[n[10]],A=r[n[11]],D=r[n[12]],R=r[n[13]],k=r[n[14]],V=r[n[15]];return(v=(a=(c=x+(P-x)*($=o[0])|0)+((_=C+(w-C)*$|0)-c)*(b=o[1])|0)+((l=(m=M+(T-M)*$|0)+((d=L+(I-L)*$|0)-m)*b|0)-a)*(S=o[2])|0)+(((u=(g=E+(F-E)*$|0)+((p=B+(A-B)*$|0)-g)*b|0)+((h=(f=D+(R-D)*$|0)+((y=k+(V-k)*$|0)-f)*b|0)-u)*S|0)-v)*o[3]|0}for(var O=1<<s,N=new Float32Array(O),U=0;U<O;U++){for(var z=U,Y=1,j=0;j<s;j++)Y*=z%2==0?1-o[j]:o[j],z/=2;N[U]=Y}for(var G=new Float32Array(O),X=0;X<O;X++)G[X]=r[n[X]];var q=0;for(X=0;X<O;X++)q+=N[X]*G[X];return q+.5|0},x._$br=function(t,e,i,r){var s=e._$Q2(t,i),n=t._$vs(),o=t._$Tr();if(e._$zr(n,o,s),s<=0)return r[n[0]];if(1==s)return(a=r[n[0]])+((l=r[n[1]])-a)*(c=o[0]);if(2==s){var a=r[n[0]],l=r[n[1]],u=r[n[2]],h=r[n[3]],c=o[0];return(1-(b=o[1]))*(a+(l-a)*c)+b*(u+(h-u)*c)}if(3==s){var _=r[n[0]],m=r[n[1]],d=r[n[2]],g=r[n[3]],p=r[n[4]],f=r[n[5]],y=r[n[6]],$=r[n[7]],b=(c=o[0],o[1]);return(1-(k=o[2]))*((1-b)*(_+(m-_)*c)+b*(d+(g-d)*c))+k*((1-b)*(p+(f-p)*c)+b*(y+($-y)*c))}if(4==s){var S=r[n[0]],v=r[n[1]],x=r[n[2]],P=r[n[3]],C=r[n[4]],w=r[n[5]],M=r[n[6]],T=r[n[7]],L=r[n[8]],I=r[n[9]],E=r[n[10]],F=r[n[11]],B=r[n[12]],A=r[n[13]],D=r[n[14]],R=r[n[15]],k=(c=o[0],b=o[1],o[2]),V=o[3];return(1-V)*((1-k)*((1-b)*(S+(v-S)*c)+b*(x+(P-x)*c))+k*((1-b)*(C+(w-C)*c)+b*(M+(T-M)*c)))+V*((1-k)*((1-b)*(L+(I-L)*c)+b*(E+(F-E)*c))+k*((1-b)*(B+(A-B)*c)+b*(D+(R-D)*c)))}for(var O=1<<s,N=new Float32Array(O),U=0;U<O;U++){for(var z=U,Y=1,j=0;j<s;j++)Y*=z%2==0?1-o[j]:o[j],z/=2;N[U]=Y}for(var G=new Float32Array(O),X=0;X<O;X++)G[X]=r[n[X]];var q=0;for(X=0;X<O;X++)q+=N[X]*G[X];return q},x._$Vr=function(t,e,i,r,s,n,o,a){var l=e._$Q2(t,i),u=t._$vs(),h=t._$Tr();e._$zr(u,h,l);var c=2*r,_=o;if(l<=0){var m=s[u[0]];if(2==a&&0==o)L._$jT(m,0,n,0,c);else for(var d=0;d<c;)n[_]=m[d++],n[_+1]=m[d++],_+=a}else if(1==l){m=s[u[0]];var g=s[u[1]],p=1-($=h[0]);for(d=0;d<c;)n[_]=m[d]*p+g[d]*$,++d,n[_+1]=m[d]*p+g[d]*$,++d,_+=a}else if(2==l){m=s[u[0]],g=s[u[1]];var f=s[u[2]],y=s[u[3]],$=h[0],b=(z=1-(B=h[1]))*(p=1-$),S=z*$,v=B*p,x=B*$;for(d=0;d<c;)n[_]=b*m[d]+S*g[d]+v*f[d]+x*y[d],++d,n[_+1]=b*m[d]+S*g[d]+v*f[d]+x*y[d],++d,_+=a}else if(3==l){var P=s[u[0]],C=s[u[1]],w=s[u[2]],M=s[u[3]],T=s[u[4]],I=s[u[5]],E=s[u[6]],F=s[u[7]],B=($=h[0],h[1]),A=(Y=1-(ot=h[2]))*(z=1-B)*(p=1-$),D=Y*z*$,R=Y*B*p,k=Y*B*$,V=ot*z*p,O=ot*z*$,N=ot*B*p,U=ot*B*$;for(d=0;d<c;)n[_]=A*P[d]+D*C[d]+R*w[d]+k*M[d]+V*T[d]+O*I[d]+N*E[d]+U*F[d],++d,n[_+1]=A*P[d]+D*C[d]+R*w[d]+k*M[d]+V*T[d]+O*I[d]+N*E[d]+U*F[d],++d,_+=a}else if(4==l){var z,Y,j=s[u[0]],G=s[u[1]],X=s[u[2]],q=s[u[3]],H=s[u[4]],W=s[u[5]],K=s[u[6]],J=s[u[7]],Q=s[u[8]],Z=s[u[9]],tt=s[u[10]],et=s[u[11]],it=s[u[12]],rt=s[u[13]],st=s[u[14]],nt=s[u[15]],ot=($=h[0],B=h[1],h[2]),at=h[3],lt=1-at,ut=lt*(Y=1-ot)*(z=1-B)*(p=1-$),ht=lt*Y*z*$,ct=lt*Y*B*p,_t=lt*Y*B*$,mt=lt*ot*z*p,dt=lt*ot*z*$,gt=lt*ot*B*p,pt=lt*ot*B*$,ft=at*Y*z*p,yt=at*Y*z*$,$t=at*Y*B*p,bt=at*Y*B*$,St=at*ot*z*p,vt=at*ot*z*$,xt=at*ot*B*p,Pt=at*ot*B*$;for(d=0;d<c;)n[_]=ut*j[d]+ht*G[d]+ct*X[d]+_t*q[d]+mt*H[d]+dt*W[d]+gt*K[d]+pt*J[d]+ft*Q[d]+yt*Z[d]+$t*tt[d]+bt*et[d]+St*it[d]+vt*rt[d]+xt*st[d]+Pt*nt[d],++d,n[_+1]=ut*j[d]+ht*G[d]+ct*X[d]+_t*q[d]+mt*H[d]+dt*W[d]+gt*K[d]+pt*J[d]+ft*Q[d]+yt*Z[d]+$t*tt[d]+bt*et[d]+St*it[d]+vt*rt[d]+xt*st[d]+Pt*nt[d],++d,_+=a}else{for(var Ct=1<<l,wt=new Float32Array(Ct),Mt=0;Mt<Ct;Mt++){for(var Tt=Mt,Lt=1,It=0;It<l;It++)Lt*=Tt%2==0?1-h[It]:h[It],Tt/=2;wt[Mt]=Lt}for(var Et=new Float32Array(Ct),Ft=0;Ft<Ct;Ft++)Et[Ft]=s[u[Ft]];for(d=0;d<c;){var Bt=0,At=0,Dt=d+1;for(Ft=0;Ft<Ct;Ft++)Bt+=wt[Ft]*Et[Ft][d],At+=wt[Ft]*Et[Ft][Dt];d+=2,n[_]=Bt,n[_+1]=At,_+=a}}},P.prototype._$HT=function(t,e){this.x=t,this.y=e},P.prototype._$HT=function(t){this.x=t.x,this.y=t.y},C._$ur=-2,C._$ES=500,C._$wb=2,C._$8S=3,C._$52=C._$ES,C._$R2=C._$ES,C._$or=function(){return C._$52},C._$Pr=function(){return C._$R2},C.prototype.convertClipIDForV2_11=function(t){var e=[];return null==t||0==t.length?null:/,/.test(t)?e=t.id.split(","):(e.push(t.id),e)},C.prototype._$F0=function(t){this._$gP=t._$nP(),this._$dr=t._$nP(),this._$GS=t._$nP(),this._$qb=t._$6L(),this._$Lb=t._$cS(),this._$mS=t._$Tb(),t.getFormatVersion()>=N._$T7?(this.clipID=t._$nP(),this.clipIDList=this.convertClipIDForV2_11(this.clipID)):this.clipIDList=[],this._$MS(this._$Lb)},C.prototype.getClipIDList=function(){return this.clipIDList},C.prototype.init=function(t){},C.prototype._$Nr=function(t,e){if(e._$IS[0]=!1,e._$Us=x._$Z2(t,this._$GS,e._$IS,this._$Lb),lt._$Zs);else if(e._$IS[0])return;e._$7s=x._$br(t,this._$GS,e._$IS,this._$mS)},C.prototype._$2b=function(t,e){},C.prototype.getDrawDataID=function(){return this._$gP},C.prototype._$j2=function(t){this._$gP=t},C.prototype.getOpacity=function(t,e){return e._$7s},C.prototype._$zS=function(t,e){return e._$Us},C.prototype._$MS=function(t){for(var e=t.length-1;e>=0;--e){var i=t[e];i<C._$52?C._$52=i:i>C._$R2&&(C._$R2=i)}},C.prototype.getTargetBaseDataID=function(){return this._$dr},C.prototype._$gs=function(t){this._$dr=t},C.prototype._$32=function(){return null!=this._$dr&&this._$dr!=yt._$2o()},C.prototype.preDraw=function(t,e,i){},C.prototype.draw=function(t,e,i){},C.prototype.getType=function(){},C.prototype._$B2=function(t,e,i){},w._$ps=32,w.CLIPPING_PROCESS_NONE=0,w.CLIPPING_PROCESS_OVERWRITE_ALPHA=1,w.CLIPPING_PROCESS_MULTIPLY_ALPHA=2,w.CLIPPING_PROCESS_DRAW=3,w.CLIPPING_PROCESS_CLEAR_ALPHA=4,w.prototype.setChannelFlagAsColor=function(t,e){this.CHANNEL_COLORS[t]=e},w.prototype.getChannelFlagAsColor=function(t){return this.CHANNEL_COLORS[t]},w.prototype._$ZT=function(){},w.prototype._$Uo=function(t,e,i,r,s,n,o){},w.prototype._$Rs=function(){return-1},w.prototype._$Ds=function(t){},w.prototype.setBaseColor=function(t,e,i,r){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),r<0?r=0:r>1&&(r=1),this._$lT=t,this._$C0=e,this._$tT=i,this._$WL=r},w.prototype._$WP=function(t){this.culling=t},w.prototype.setMatrix=function(t){for(var e=0;e<16;e++)this.matrix4x4[e]=t[e]},w.prototype._$IT=function(){return this.matrix4x4},w.prototype.setPremultipliedAlpha=function(t){this.premultipliedAlpha=t},w.prototype.isPremultipliedAlpha=function(){return this.premultipliedAlpha},w.prototype.setAnisotropy=function(t){this.anisotropy=t},w.prototype.getAnisotropy=function(){return this.anisotropy},w.prototype.getClippingProcess=function(){return this.clippingProcess},w.prototype.setClippingProcess=function(t){this.clippingProcess=t},w.prototype.setClipBufPre_clipContextForMask=function(t){this.clipBufPre_clipContextMask=t},w.prototype.getClipBufPre_clipContextMask=function(){return this.clipBufPre_clipContextMask},w.prototype.setClipBufPre_clipContextForDraw=function(t){this.clipBufPre_clipContextDraw=t},w.prototype.getClipBufPre_clipContextDraw=function(){return this.clipBufPre_clipContextDraw},T._$ur=-2,T._$c2=1,T._$_b=2,T.prototype._$F0=function(t){this._$kP=t._$nP(),this._$dr=t._$nP()},T.prototype.readV2_opacity=function(t){t.getFormatVersion()>=N.LIVE2D_FORMAT_VERSION_V2_10_SDK2&&(this._$mS=t._$Tb())},T.prototype.init=function(t){},T.prototype._$Nr=function(t,e){},T.prototype.interpolateOpacity=function(t,e,i,r){null==this._$mS?i.setInterpolatedOpacity(1):i.setInterpolatedOpacity(x._$br(t,e,r,this._$mS))},T.prototype._$2b=function(t,e){},T.prototype._$nb=function(t,e,i,r,s,n,o){},T.prototype.getType=function(){},T.prototype._$gs=function(t){this._$dr=t},T.prototype._$a2=function(t){this._$kP=t},T.prototype.getTargetBaseDataID=function(){return this._$dr},T.prototype.getBaseDataID=function(){return this._$kP},T.prototype._$32=function(){return null!=this._$dr&&this._$dr!=yt._$2o()},L._$W2=0,L._$CS=L._$W2,L._$Mo=function(){return!0},L._$XP=function(t){try{for(var e=getTimeMSec();getTimeMSec()-e<t;);}catch(t){t._$Rb()}},L.getUserTimeMSec=function(){return L._$CS==L._$W2?L.getSystemTimeMSec():L._$CS},L.setUserTimeMSec=function(t){L._$CS=t},L.updateUserTimeMSec=function(){return L._$CS=L.getSystemTimeMSec()},L.getTimeMSec=function(){return(new Date).getTime()},L.getSystemTimeMSec=function(){return(new Date).getTime()},L._$Q=function(t){},L._$jT=function(t,e,i,r,s){for(var n=0;n<s;n++)i[r+n]=t[e+n]},I._$ds=-2,I.prototype._$F0=function(t){this._$wL=t._$nP(),this._$VP=t._$6L(),this._$GP=t._$nP()},I.prototype.getParamIndex=function(t){return this._$2r!=t&&(this._$8o=I._$ds),this._$8o},I.prototype._$Pb=function(t,e){this._$8o=t,this._$2r=e},I.prototype.getParamID=function(){return this._$wL},I.prototype._$yP=function(t){this._$wL=t},I.prototype._$N2=function(){return this._$VP},I.prototype._$d2=function(){return this._$GP},I.prototype._$t2=function(t,e){this._$VP=t,this._$GP=e},I.prototype._$Lr=function(){return this._$O2},I.prototype._$wr=function(t){this._$O2=t},I.prototype._$SL=function(){return this._$ri},I.prototype._$AL=function(t){this._$ri=t},E.startsWith=function(t,e,i){var r=e+i.length;if(r>=t.length)return!1;for(var s=e;s<r;s++)if(E.getChar(t,s)!=i.charAt(s-e))return!1;return!0},E.getChar=function(t,e){return String.fromCharCode(t.getUint8(e))},E.createString=function(t,e,i){for(var r=new ArrayBuffer(2*i),s=new Uint16Array(r),n=0;n<i;n++)s[n]=t.getUint8(e+n);return String.fromCharCode.apply(null,s)},E._$LS=function(t,e,i,r){t instanceof ArrayBuffer&&(t=new DataView(t));var s=i,n=!1,o=!1,a=0,l=E.getChar(t,s);"-"==l&&(n=!0,s++);for(var u=!1;s<e;s++){switch(l=E.getChar(t,s)){case"0":a*=10;break;case"1":a=10*a+1;break;case"2":a=10*a+2;break;case"3":a=10*a+3;break;case"4":a=10*a+4;break;case"5":a=10*a+5;break;case"6":a=10*a+6;break;case"7":a=10*a+7;break;case"8":a=10*a+8;break;case"9":a=10*a+9;break;case".":o=!0,s++,u=!0;break;default:u=!0}if(u)break}if(o)for(var h=.1,c=!1;s<e;s++){switch(l=E.getChar(t,s)){case"0":break;case"1":a+=1*h;break;case"2":a+=2*h;break;case"3":a+=3*h;break;case"4":a+=4*h;break;case"5":a+=5*h;break;case"6":a+=6*h;break;case"7":a+=7*h;break;case"8":a+=8*h;break;case"9":a+=9*h;break;default:c=!0}if(h*=.1,c)break}return n&&(a=-a),r[0]=s,a},F.prototype._$zP=function(){this._$Ob=new Array},F.prototype._$F0=function(t){this._$Ob=t._$nP()},F.prototype._$Ur=function(t){if(t._$WS())return!0;for(var e=t._$v2(),i=this._$Ob.length-1;i>=0;--i){var r=this._$Ob[i].getParamIndex(e);if(r==I._$ds&&(r=t.getParamIndex(this._$Ob[i].getParamID())),t._$Xb(r))return!0}return!1},F.prototype._$Q2=function(t,e){for(var i,r,s=this._$Ob.length,n=t._$v2(),o=0,a=0;a<s;a++){var l=this._$Ob[a];if((i=l.getParamIndex(n))==I._$ds&&(i=t.getParamIndex(l.getParamID()),l._$Pb(i,n)),i<0)throw new Exception("err 23242 : "+l.getParamID());var u=i<0?0:t.getParamFloat(i);r=l._$N2();var h,c,_=l._$d2(),m=-1,d=0;if(r<1);else if(1==r)(h=_[0])-O._$J<u&&u<h+O._$J?(m=0,d=0):(m=0,e[0]=!0);else if(u<(h=_[0])-O._$J)m=0,e[0]=!0;else if(u<h+O._$J)m=0;else{for(var g=!1,p=1;p<r;++p){if(u<(c=_[p])+O._$J){c-O._$J<u?m=p:(m=p-1,d=(u-h)/(c-h),o++),g=!0;break}h=c}g||(m=r-1,d=0,e[0]=!0)}l._$wr(m),l._$AL(d)}return o},F.prototype._$zr=function(t,e,i){var r=1<<i;r+1>O._$Qb&&console.log("err 23245\n");for(var s=this._$Ob.length,n=1,o=1,a=0,l=0;l<r;++l)t[l]=0;for(var u=0;u<s;++u){var h=this._$Ob[u];if(0==h._$SL()){if((c=h._$Lr()*n)<0&&lt._$3T)throw new Exception("err 23246");for(l=0;l<r;++l)t[l]+=c}else{var c=n*h._$Lr(),_=n*(h._$Lr()+1);for(l=0;l<r;++l)t[l]+=(l/o|0)%2==0?c:_;e[a++]=h._$SL(),o*=2}n*=h._$N2()}t[r]=65535,e[a]=-1},F.prototype._$h2=function(t,e,i){for(var r=new Float32Array(e),s=0;s<e;++s)r[s]=i[s];var n=new I;n._$yP(t),n._$t2(e,r),this._$Ob.push(n)},F.prototype._$J2=function(t){for(var e=t,i=this._$Ob.length,r=0;r<i;++r){var s=this._$Ob[r],n=s._$N2(),o=e%s._$N2(),a=s._$d2()[o];console.log("%s[%d]=%7.2f / ",s.getParamID(),o,a),e/=n}console.log("\n")},F.prototype.getParamCount=function(){return this._$Ob.length},F.prototype._$zs=function(){return this._$Ob},B.prototype.identity=function(){for(var t=0;t<16;t++)this.m[t]=t%5==0?1:0},B.prototype.getArray=function(){return this.m},B.prototype.getCopyMatrix=function(){return new Float32Array(this.m)},B.prototype.setMatrix=function(t){if(null!=t&&16==t.length)for(var e=0;e<16;e++)this.m[e]=t[e]},B.prototype.mult=function(t,e,i){return null==e?null:(this==e?this.mult_safe(this.m,t.m,e.m,i):this.mult_fast(this.m,t.m,e.m,i),e)},B.prototype.mult_safe=function(t,e,i,r){if(t==i){var s=new Array(16);this.mult_fast(t,e,s,r);for(var n=15;n>=0;--n)i[n]=s[n]}else this.mult_fast(t,e,i,r)},B.prototype.mult_fast=function(t,e,i,r){r?(i[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2],i[4]=t[0]*e[4]+t[4]*e[5]+t[8]*e[6],i[8]=t[0]*e[8]+t[4]*e[9]+t[8]*e[10],i[12]=t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12],i[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2],i[5]=t[1]*e[4]+t[5]*e[5]+t[9]*e[6],i[9]=t[1]*e[8]+t[5]*e[9]+t[9]*e[10],i[13]=t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13],i[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2],i[6]=t[2]*e[4]+t[6]*e[5]+t[10]*e[6],i[10]=t[2]*e[8]+t[6]*e[9]+t[10]*e[10],i[14]=t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14],i[3]=i[7]=i[11]=0,i[15]=1):(i[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],i[4]=t[0]*e[4]+t[4]*e[5]+t[8]*e[6]+t[12]*e[7],i[8]=t[0]*e[8]+t[4]*e[9]+t[8]*e[10]+t[12]*e[11],i[12]=t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12]*e[15],i[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],i[5]=t[1]*e[4]+t[5]*e[5]+t[9]*e[6]+t[13]*e[7],i[9]=t[1]*e[8]+t[5]*e[9]+t[9]*e[10]+t[13]*e[11],i[13]=t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13]*e[15],i[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],i[6]=t[2]*e[4]+t[6]*e[5]+t[10]*e[6]+t[14]*e[7],i[10]=t[2]*e[8]+t[6]*e[9]+t[10]*e[10]+t[14]*e[11],i[14]=t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14]*e[15],i[3]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],i[7]=t[3]*e[4]+t[7]*e[5]+t[11]*e[6]+t[15]*e[7],i[11]=t[3]*e[8]+t[7]*e[9]+t[11]*e[10]+t[15]*e[11],i[15]=t[3]*e[12]+t[7]*e[13]+t[11]*e[14]+t[15]*e[15])},B.prototype.translate=function(t,e,i){this.m[12]=this.m[0]*t+this.m[4]*e+this.m[8]*i+this.m[12],this.m[13]=this.m[1]*t+this.m[5]*e+this.m[9]*i+this.m[13],this.m[14]=this.m[2]*t+this.m[6]*e+this.m[10]*i+this.m[14],this.m[15]=this.m[3]*t+this.m[7]*e+this.m[11]*i+this.m[15]},B.prototype.scale=function(t,e,i){this.m[0]*=t,this.m[4]*=e,this.m[8]*=i,this.m[1]*=t,this.m[5]*=e,this.m[9]*=i,this.m[2]*=t,this.m[6]*=e,this.m[10]*=i,this.m[3]*=t,this.m[7]*=e,this.m[11]*=i},B.prototype.rotateX=function(t){var e=Pt.fcos(t),i=Pt._$9(t),r=this.m[4];this.m[4]=r*e+this.m[8]*i,this.m[8]=r*-i+this.m[8]*e,r=this.m[5],this.m[5]=r*e+this.m[9]*i,this.m[9]=r*-i+this.m[9]*e,r=this.m[6],this.m[6]=r*e+this.m[10]*i,this.m[10]=r*-i+this.m[10]*e,r=this.m[7],this.m[7]=r*e+this.m[11]*i,this.m[11]=r*-i+this.m[11]*e},B.prototype.rotateY=function(t){var e=Pt.fcos(t),i=Pt._$9(t),r=this.m[0];this.m[0]=r*e+this.m[8]*-i,this.m[8]=r*i+this.m[8]*e,r=this.m[1],this.m[1]=r*e+this.m[9]*-i,this.m[9]=r*i+this.m[9]*e,r=m[2],this.m[2]=r*e+this.m[10]*-i,this.m[10]=r*i+this.m[10]*e,r=m[3],this.m[3]=r*e+this.m[11]*-i,this.m[11]=r*i+this.m[11]*e},B.prototype.rotateZ=function(t){var e=Pt.fcos(t),i=Pt._$9(t),r=this.m[0];this.m[0]=r*e+this.m[4]*i,this.m[4]=r*-i+this.m[4]*e,r=this.m[1],this.m[1]=r*e+this.m[5]*i,this.m[5]=r*-i+this.m[5]*e,r=this.m[2],this.m[2]=r*e+this.m[6]*i,this.m[6]=r*-i+this.m[6]*e,r=this.m[3],this.m[3]=r*e+this.m[7]*i,this.m[7]=r*-i+this.m[7]*e},A.prototype=new rt,A._$tP=new Object,A._$27=function(){A._$tP.clear()},A.getID=function(t){var e=A._$tP[t];return null==e&&(e=new A(t),A._$tP[t]=e),e},A.prototype._$3s=function(){return new A},D._$kS=-1,D._$pS=0,D._$hb=1,D.STATE_IDENTITY=0,D._$gb=1,D._$fo=2,D._$go=4,D.prototype.transform=function(t,e,i){var r,s,n,o,a,l,u=0,h=0;switch(this._$hi){default:return;case D._$go|D._$fo|D._$gb:for(r=this._$7,s=this._$H,n=this._$k,o=this._$f,a=this._$g,l=this._$w;--i>=0;){var c=t[u++],_=t[u++];e[h++]=r*c+s*_+n,e[h++]=o*c+a*_+l}return;case D._$go|D._$fo:for(r=this._$7,s=this._$H,o=this._$f,a=this._$g;--i>=0;){c=t[u++],_=t[u++];e[h++]=r*c+s*_,e[h++]=o*c+a*_}return;case D._$go|D._$gb:for(s=this._$H,n=this._$k,o=this._$f,l=this._$w;--i>=0;){c=t[u++];e[h++]=s*t[u++]+n,e[h++]=o*c+l}return;case D._$go:for(s=this._$H,o=this._$f;--i>=0;){c=t[u++];e[h++]=s*t[u++],e[h++]=o*c}return;case D._$fo|D._$gb:for(r=this._$7,n=this._$k,a=this._$g,l=this._$w;--i>=0;)e[h++]=r*t[u++]+n,e[h++]=a*t[u++]+l;return;case D._$fo:for(r=this._$7,a=this._$g;--i>=0;)e[h++]=r*t[u++],e[h++]=a*t[u++];return;case D._$gb:for(n=this._$k,l=this._$w;--i>=0;)e[h++]=t[u++]+n,e[h++]=t[u++]+l;return;case D.STATE_IDENTITY:return void(t==e&&u==h||L._$jT(t,u,e,h,2*i))}},D.prototype.update=function(){0==this._$H&&0==this._$f?1==this._$7&&1==this._$g?0==this._$k&&0==this._$w?(this._$hi=D.STATE_IDENTITY,this._$Z=D._$pS):(this._$hi=D._$gb,this._$Z=D._$hb):0==this._$k&&0==this._$w?(this._$hi=D._$fo,this._$Z=D._$kS):(this._$hi=D._$fo|D._$gb,this._$Z=D._$kS):0==this._$7&&0==this._$g?0==this._$k&&0==this._$w?(this._$hi=D._$go,this._$Z=D._$kS):(this._$hi=D._$go|D._$gb,this._$Z=D._$kS):0==this._$k&&0==this._$w?(this._$hi=D._$go|D._$fo,this._$Z=D._$kS):(this._$hi=D._$go|D._$fo|D._$gb,this._$Z=D._$kS)},D.prototype._$RT=function(t){this._$IT(t);var e=t[0],i=t[2],r=t[1],s=t[3],n=Math.sqrt(e*e+r*r),o=e*s-i*r;0==n?lt._$so&&console.log("affine._$RT() / rt==0"):(t[0]=n,t[1]=o/n,t[2]=(r*s+e*i)/o,t[3]=Math.atan2(r,e))},D.prototype._$ho=function(t,e,i,r){var s=new Float32Array(6),n=new Float32Array(6);t._$RT(s),e._$RT(n);var o=new Float32Array(6);o[0]=s[0]+(n[0]-s[0])*i,o[1]=s[1]+(n[1]-s[1])*i,o[2]=s[2]+(n[2]-s[2])*i,o[3]=s[3]+(n[3]-s[3])*i,o[4]=s[4]+(n[4]-s[4])*i,o[5]=s[5]+(n[5]-s[5])*i,r._$CT(o)},D.prototype._$CT=function(t){var e=Math.cos(t[3]),i=Math.sin(t[3]);this._$7=t[0]*e,this._$f=t[0]*i,this._$H=t[1]*(t[2]*e-i),this._$g=t[1]*(t[2]*i+e),this._$k=t[4],this._$w=t[5],this.update()},D.prototype._$IT=function(t){t[0]=this._$7,t[1]=this._$f,t[2]=this._$H,t[3]=this._$g,t[4]=this._$k,t[5]=this._$w},R.prototype=new o,R._$cs="VISIBLE:",R._$ar="LAYOUT:",R._$Co=0,R._$D2=[],R._$1T=1,R.loadMotion=function(t){var e=new R,i=[0],r=t.length;e._$yT=0;for(var s=0;s<r;++s){var n=255&t[s];if("\n"!=n&&"\r"!=n)if("#"!=n)if("$"!=n){if("a"<=n&&n<="z"||"A"<=n&&n<="Z"||"_"==n){for(u=s,h=-1;s<r&&("\r"!=(n=255&t[s])&&"\n"!=n);++s)if("="==n){h=s;break}if(h>=0){var o=new V;E.startsWith(t,u,R._$cs)?(o._$RP=V._$hs,o._$4P=new String(t,u,h-u)):E.startsWith(t,u,R._$ar)?(o._$4P=new String(t,u+7,h-u-7),E.startsWith(t,u+7,"ANCHOR_X")?o._$RP=V._$xs:E.startsWith(t,u+7,"ANCHOR_Y")?o._$RP=V._$us:E.startsWith(t,u+7,"SCALE_X")?o._$RP=V._$qs:E.startsWith(t,u+7,"SCALE_Y")?o._$RP=V._$Ys:E.startsWith(t,u+7,"X")?o._$RP=V._$ws:E.startsWith(t,u+7,"Y")&&(o._$RP=V._$Ns)):(o._$RP=V._$Fr,o._$4P=new String(t,u,h-u)),e.motions.push(o);var a=0;for(R._$D2.clear(),s=h+1;s<r&&("\r"!=(n=255&t[s])&&"\n"!=n);++s)if(","!=n&&" "!=n&&"\t"!=n){_=E._$LS(t,r,s,i);if(i[0]>0){R._$D2.push(_),a++;var l=i[0];if(l<s){console.log("_$n0 _$hi . @Live2DMotion loadMotion()\n");break}s=l}}o._$I0=R._$D2._$BL(),a>e._$yT&&(e._$yT=a)}}}else{for(var u=s,h=-1;s<r&&("\r"!=(n=255&t[s])&&"\n"!=n);++s)if("="==n){h=s;break}var c=!1;if(h>=0)for(h==u+4&&"f"==t[u+1]&&"p"==t[u+2]&&"s"==t[u+3]&&(c=!0),s=h+1;s<r&&("\r"!=(n=255&t[s])&&"\n"!=n);++s)if(","!=n&&" "!=n&&"\t"!=n){var _=E._$LS(t,r,s,i);i[0]>0&&c&&5<_&&_<121&&(e._$D0=_),s=i[0]}for(;s<r&&("\n"!=t[s]&&"\r"!=t[s]);++s);}else for(;s<r&&("\n"!=t[s]&&"\r"!=t[s]);++s);}return e._$AS=1e3*e._$yT/e._$D0|0,e},R.prototype.getDurationMSec=function(){return this._$AS},R.prototype.dump=function(){for(var t=0;t<this.motions.length;t++){var e=this.motions[t];console.log("_$wL[%s] [%d]. ",e._$4P,e._$I0.length);for(var i=0;i<e._$I0.length&&i<10;i++)console.log("%5.2f ,",e._$I0[i]);console.log("\n")}},R.prototype.updateParamExe=function(t,e,i,r){for(var s=(e-r._$z2)*this._$D0/1e3,n=0|s,o=s-n,a=0;a<this.motions.length;a++){var l=this.motions[a],u=l._$I0.length,h=l._$4P;if(l._$RP==V._$hs){var c=l._$I0[n>=u?u-1:n];t.setParamFloat(h,c)}else if(V._$ws<=l._$RP&&l._$RP<=V._$Ys);else{var _=t.getParamFloat(h),m=l._$I0[n>=u?u-1:n],d=_+(m+(l._$I0[n+1>=u?u-1:n+1]-m)*o-_)*i;t.setParamFloat(h,d)}}n>=this._$yT&&(this._$E?(r._$z2=e,this.loopFadeIn&&(r._$bs=e)):r._$9L=!0)},R.prototype._$r0=function(){return this._$E},R.prototype._$aL=function(t){this._$E=t},R.prototype.isLoopFadeIn=function(){return this.loopFadeIn},R.prototype.setLoopFadeIn=function(t){this.loopFadeIn=t},k.prototype.clear=function(){this.size=0},k.prototype.add=function(t){if(this._$P.length<=this.size){var e=new Float32Array(2*this.size);L._$jT(this._$P,0,e,0,this.size),this._$P=e}this._$P[this.size++]=t},k.prototype._$BL=function(){var t=new Float32Array(this.size);return L._$jT(this._$P,0,t,0,this.size),t},V._$Fr=0,V._$hs=1,V._$ws=100,V._$Ns=101,V._$xs=102,V._$us=103,V._$qs=104,V._$Ys=105,O._$Ms=1,O._$Qs=2,O._$i2=0,O._$No=2,O._$do=O._$Ms,O._$Ls=!0,O._$1r=5,O._$Qb=65,O._$J=1e-4,O._$FT=.001,O._$Ss=3,N._$o7=6,N._$S7=7,N._$s7=8,N._$77=9,N.LIVE2D_FORMAT_VERSION_V2_10_SDK2=10,N.LIVE2D_FORMAT_VERSION_V2_11_SDK2_1=11,N._$T7=N.LIVE2D_FORMAT_VERSION_V2_11_SDK2_1,N._$Is=-2004318072,N._$h0=0,N._$4L=23,N._$7P=33,N._$uT=function(t){console.log("_$bo :: _$6 _$mo _$E0 : %d\n",t)},N._$9o=function(t){if(t<40)return N._$uT(t),null;if(t<50)return N._$uT(t),null;if(t<60)return N._$uT(t),null;if(t<100)switch(t){case 65:return new Z;case 66:return new F;case 67:return new I;case 68:return new X;case 69:return new b;case 70:return new ct;default:return N._$uT(t),null}else if(t<150)switch(t){case 131:return new ot;case 133:return new et;case 136:return new _;case 137:return new st;case 142:return new W}return N._$uT(t),null},U._$HP=0,U._$_0=!0,U._$V2=-1,U._$W0=-1,U._$jr=!1,U._$ZS=!0,U._$tr=-1e6,U._$lr=1e6,U._$is=32,U._$e=!1,U.prototype.getDrawDataIndex=function(t){for(var e=this._$aS.length-1;e>=0;--e)if(null!=this._$aS[e]&&this._$aS[e].getDrawDataID()==t)return e;return-1},U.prototype.getDrawData=function(t){if(t instanceof A){if(null==this._$Bo){this._$Bo=new Object;for(var e=this._$aS.length,i=0;i<e;i++){var r=this._$aS[i],s=r.getDrawDataID();null!=s&&(this._$Bo[s]=r)}}return this._$Bo[id]}return t<this._$aS.length?this._$aS[t]:null},U.prototype.release=function(){this._$3S.clear(),this._$aS.clear(),this._$F2.clear(),null!=this._$Bo&&this._$Bo.clear(),this._$db.clear(),this._$8b.clear(),this._$Hr.clear()},U.prototype.init=function(){this._$co++,this._$F2.length>0&&this.release();for(var t=this._$Ri.getModelImpl(),e=t._$Xr(),r=e.length,s=new Array,n=new Array,o=0;o<r;++o){var a=e[o];this._$F2.push(a),this._$Hr.push(a.init(this));for(var l=a.getBaseData(),u=l.length,h=0;h<u;++h)s.push(l[h]);for(h=0;h<u;++h){var c=l[h].init(this);c._$l2(o),n.push(c)}var _=a.getDrawData(),m=_.length;for(h=0;h<m;++h){var d=_[h],g=d.init(this);g._$IP=o,this._$aS.push(d),this._$8b.push(g)}}for(var p=s.length,f=yt._$2o();;){var y=!1;for(o=0;o<p;++o){var $=s[o];if(null!=$){var b=$.getTargetBaseDataID();(null==b||b==f||this.getBaseDataIndex(b)>=0)&&(this._$3S.push($),this._$db.push(n[o]),s[o]=null,y=!0)}}if(!y)break}var S=t._$E2();if(null!=S){var v=S._$1s();if(null!=v){var x=v.length;for(o=0;o<x;++o){var P=v[o];null!=P&&this._$02(P.getParamID(),P.getDefaultValue(),P.getMinValue(),P.getMaxValue())}}}this.clipManager=new i(this.dp_webgl),this.clipManager.init(this,this._$aS,this._$8b),this._$QT=!0},U.prototype.update=function(){U._$e&&a.start("_$zL");for(var t=this._$_2.length,e=0;e<t;e++)this._$_2[e]!=this._$vr[e]&&(this._$Js[e]=U._$ZS,this._$vr[e]=this._$_2[e]);var i=this._$3S.length,r=this._$aS.length,s=H._$or(),n=H._$Pr()-s+1;(null==this._$Ws||this._$Ws.length<n)&&(this._$Ws=new Int16Array(n),this._$Vs=new Int16Array(n));for(e=0;e<n;e++)this._$Ws[e]=U._$V2,this._$Vs[e]=U._$V2;(null==this._$Er||this._$Er.length<r)&&(this._$Er=new Int16Array(r));for(e=0;e<r;e++)this._$Er[e]=U._$W0;U._$e&&a.dump("_$zL"),U._$e&&a.start("_$UL");for(var o=null,l=0;l<i;++l){var u=this._$3S[l],h=this._$db[l];try{u._$Nr(this,h),u._$2b(this,h)}catch(t){null==o&&(o=t)}}null!=o&&U._$_0&&a._$Rb(o),U._$e&&a.dump("_$UL"),U._$e&&a.start("_$DL");for(var c=null,_=0;_<r;++_){var m=this._$aS[_],d=this._$8b[_];try{if(m._$Nr(this,d),d._$u2())continue;m._$2b(this,d);var g,p=Math.floor(m._$zS(this,d)-s);try{g=this._$Vs[p]}catch(t){console.log("_$li :: %s / %s \t\t\t\t@@_$fS\n",t.toString(),m.getDrawDataID().toString()),p=Math.floor(m._$zS(this,d)-s);continue}g==U._$V2?this._$Ws[p]=_:this._$Er[g]=_,this._$Vs[p]=_}catch(t){null==c&&(c=t,lt._$sT(lt._$H7))}}null!=c&&U._$_0&&a._$Rb(c),U._$e&&a.dump("_$DL"),U._$e&&a.start("_$eL");for(e=this._$Js.length-1;e>=0;e--)this._$Js[e]=U._$jr;return this._$QT=!1,U._$e&&a.dump("_$eL"),!1},U.prototype.preDraw=function(t){null!=this.clipManager&&(t._$ZT(),this.clipManager.setupClip(this,t))},U.prototype.draw=function(t){if(null!=this._$Ws){var e=this._$Ws.length;t._$ZT();for(var i=0;i<e;++i){var r=this._$Ws[i];if(r!=U._$V2)for(;;){var s=this._$aS[r],n=this._$8b[r];if(n._$yo()){var o=n._$IP,l=this._$Hr[o];n._$VS=l.getPartsOpacity(),s.draw(t,this,n)}var u=this._$Er[r];if(u<=r||u==U._$W0)break;r=u}}}else a._$li("call _$Ri.update() before _$Ri.draw() ")},U.prototype.getParamIndex=function(t){for(var e=this._$pb.length-1;e>=0;--e)if(this._$pb[e]==t)return e;return this._$02(t,0,U._$tr,U._$lr)},U.prototype._$BS=function(t){return this.getBaseDataIndex(t)},U.prototype.getBaseDataIndex=function(t){for(var e=this._$3S.length-1;e>=0;--e)if(null!=this._$3S[e]&&this._$3S[e].getBaseDataID()==t)return e;return-1},U.prototype._$UT=function(t,e){var i=new Float32Array(e);return L._$jT(t,0,i,0,t.length),i},U.prototype._$02=function(t,e,i,r){if(this._$qo>=this._$pb.length){var s=this._$pb.length,n=new Array(2*s);L._$jT(this._$pb,0,n,0,s),this._$pb=n,this._$_2=this._$UT(this._$_2,2*s),this._$vr=this._$UT(this._$vr,2*s),this._$Rr=this._$UT(this._$Rr,2*s),this._$Or=this._$UT(this._$Or,2*s);var o=new Array;L._$jT(this._$Js,0,o,0,s),this._$Js=o}return this._$pb[this._$qo]=t,this._$_2[this._$qo]=e,this._$vr[this._$qo]=e,this._$Rr[this._$qo]=i,this._$Or[this._$qo]=r,this._$Js[this._$qo]=U._$ZS,this._$qo++},U.prototype._$Zo=function(t,e){this._$3S[t]=e},U.prototype.setParamFloat=function(t,e){e<this._$Rr[t]&&(e=this._$Rr[t]),e>this._$Or[t]&&(e=this._$Or[t]),this._$_2[t]=e},U.prototype.loadParam=function(){var t=this._$_2.length;t>this._$fs.length&&(t=this._$fs.length),L._$jT(this._$fs,0,this._$_2,0,t)},U.prototype.saveParam=function(){var t=this._$_2.length;t>this._$fs.length&&(this._$fs=new Float32Array(t)),L._$jT(this._$_2,0,this._$fs,0,t)},U.prototype._$v2=function(){return this._$co},U.prototype._$WS=function(){return this._$QT},U.prototype._$Xb=function(t){return this._$Js[t]==U._$ZS},U.prototype._$vs=function(){return this._$Es},U.prototype._$Tr=function(){return this._$ZP},U.prototype.getBaseData=function(t){return this._$3S[t]},U.prototype.getParamFloat=function(t){return this._$_2[t]},U.prototype.getParamMax=function(t){return this._$Or[t]},U.prototype.getParamMin=function(t){return this._$Rr[t]},U.prototype.setPartsOpacity=function(t,e){this._$Hr[t].setPartsOpacity(e)},U.prototype.getPartsOpacity=function(t){return this._$Hr[t].getPartsOpacity()},U.prototype.getPartsDataIndex=function(t){for(var e=this._$F2.length-1;e>=0;--e)if(null!=this._$F2[e]&&this._$F2[e]._$p2()==t)return e;return-1},U.prototype._$q2=function(t){return this._$db[t]},U.prototype._$C2=function(t){return this._$8b[t]},U.prototype._$Bb=function(t){return this._$Hr[t]},U.prototype._$5s=function(t,e){for(var i=this._$Ws.length,r=t,s=0;s<i;++s){var n=this._$Ws[s];if(n!=U._$V2)for(;;){var o=this._$8b[n];o._$yo()&&(o._$GT()._$B2(this,o,r),r+=e);var a=this._$Er[n];if(a<=n||a==U._$W0)break;n=a}}},U.prototype.setDrawParam=function(t){this.dp_webgl=t},U.prototype.getDrawParam=function(){return this.dp_webgl},z._$0T=function(t){return z._$0T(new _$5(t))},z._$0T=function(t){if(!t.exists())throw new _$ls(t._$3b());for(var e,i=t.length(),r=new Int8Array(i),s=new _$Xs(new _$kb(t),8192),n=0;(e=s.read(r,n,i-n))>0;)n+=e;return r},z._$C=function(t){var e=null,i=null;try{e=t instanceof Array?t:new _$Xs(t,8192),i=new _$js;for(var r,s=new Int8Array(1e3);(r=e.read(s))>0;)i.write(s,0,r);return i._$TS()}finally{null!=t&&t.close(),null!=i&&(i.flush(),i.close())}},Y.prototype._$T2=function(){return L.getUserTimeMSec()+Math._$10()*(2*this._$Br-1)},Y.prototype._$uo=function(t){this._$Br=t},Y.prototype._$QS=function(t,e,i){this._$Dr=t,this._$Cb=e,this._$mr=i},Y.prototype._$7T=function(t){var e,i=L.getUserTimeMSec(),r=0;switch(this._$_L){case STATE_CLOSING:(r=(i-this._$bb)/this._$Dr)>=1&&(r=1,this._$_L=j.STATE_CLOSED,this._$bb=i),e=1-r;break;case STATE_CLOSED:(r=(i-this._$bb)/this._$Cb)>=1&&(this._$_L=j.STATE_OPENING,this._$bb=i),e=0;break;case STATE_OPENING:(r=(i-this._$bb)/this._$mr)>=1&&(r=1,this._$_L=j.STATE_INTERVAL,this._$12=this._$T2()),e=r;break;case STATE_INTERVAL:this._$12<i&&(this._$_L=j.STATE_CLOSING,this._$bb=i),e=1;break;case STATE_FIRST:default:this._$_L=j.STATE_INTERVAL,this._$12=this._$T2(),e=1}this._$jo||(e=-e),t.setParamFloat(this._$iL,e),t.setParamFloat(this._$0L,e)};var j=function(){};function G(){t||(w.prototype.constructor.call(this),this._$sb=new Int32Array(G._$As),this._$U2=new Array,this.transform=null,this.gl=null,null==G._$NT&&(G._$NT=G._$9r(256),G._$vS=G._$9r(256),G._$no=G._$vb(256)))}function X(){t||(T.prototype.constructor.call(this),this._$GS=null,this._$Y0=null)}function q(t){at.prototype.constructor.call(this,t),this._$8r=T._$ur,this._$Yr=null,this._$Wr=null}function H(){t||(C.prototype.constructor.call(this),this._$gP=null,this._$dr=null,this._$GS=null,this._$qb=null,this._$Lb=null,this._$mS=null)}function W(){t||(this._$NL=null,this._$3S=null,this._$aS=null,W._$42++)}function K(){t||(e.prototype.constructor.call(this),this._$zo=new G)}function J(){t||(o.prototype.constructor.call(this),this.motions=new Array,this._$o2=null,this._$7r=J._$Co++,this._$D0=30,this._$yT=0,this._$E=!1,this.loopFadeIn=!0,this._$rr=-1,this._$eP=0)}function Q(t,e){return String.fromCharCode(t.getUint8(e))}function k(){this._$P=new Float32Array(100),this.size=0}function V(){this._$4P=null,this._$I0=null,this._$RP=null}function Z(){t||(T.prototype.constructor.call(this),this._$o=0,this._$A=0,this._$GS=null,this._$Eo=null)}function tt(t){at.prototype.constructor.call(this,t),this._$8r=T._$ur,this._$Cr=null,this._$hr=null}function et(){t||(this.visible=!0,this._$g0=!1,this._$NL=null,this._$3S=null,this._$aS=null,et._$42++)}function it(t){this._$VS=null,this._$e0=null,this._$e0=t}function rt(e){t||(this.id=e)}function st(){t||(this._$4S=null)}function nt(t,e){this.canvas=t,this.context=e,this.viewport=new Array(0,0,t.width,t.height),this._$6r=1,this._$xP=0,this._$3r=1,this._$uP=0,this._$Qo=-1,this.cacheImages={}}function ot(){t||(this._$TT=null,this._$LT=null,this._$FS=null,this._$wL=null)}function at(e){t||(this._$e0=null,this._$IP=null,this._$JS=!1,this._$AT=!0,this._$e0=e,this.totalScale=1,this._$7s=1,this.totalOpacity=1)}function lt(){}function ut(){}function ht(e){t||(this._$ib=e)}function ct(){t||(H.prototype.constructor.call(this),this._$LP=-1,this._$d0=0,this._$Yo=0,this._$JP=null,this._$5P=null,this._$BP=null,this._$Eo=null,this._$Qi=null,this._$6s=ct._$ms,this.culling=!0,this.gl_cacheImage=null,this.instanceNo=ct._$42++)}function _t(t){Ct.prototype.constructor.call(this,t),this._$8r=H._$ur,this._$Cr=null,this._$hr=null}function mt(){t||(this.x=null,this.y=null)}function dt(i){t||(e.prototype.constructor.call(this),this.drawParamWebGL=new $t(i),this.drawParamWebGL.setGL(lt.getGL(i)))}function gt(){t||(this.motions=null,this._$eb=!1,this.motions=new Array)}function pt(){this._$w0=null,this._$AT=!0,this._$9L=!1,this._$z2=-1,this._$bs=-1,this._$Do=-1,this._$sr=null,this._$sr=pt._$Gs++}function ft(){this.m=new Array(1,0,0,0,1,0,0,0,1)}function yt(e){t||rt.prototype.constructor.call(this,e)}function $t(e){t||(w.prototype.constructor.call(this),this.textures=new Array,this.transform=null,this.gl=null,this.glno=e,this.firstDraw=!0,this.anisotropyExt=null,this.maxAnisotropy=0,this._$As=32,this._$Gr=!1,this._$NT=null,this._$vS=null,this._$no=null,this.vertShader=null,this.fragShader=null,this.vertShaderOff=null,this.fragShaderOff=null)}function bt(t,e,i){return null==e&&(e=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,i,t.DYNAMIC_DRAW),e}function St(t,e,i){return null==e&&(e=t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.DYNAMIC_DRAW),e}function vt(e){t||(this._$P=new Int8Array(8),this._$R0=new DataView(this._$P.buffer),this._$3i=new Int8Array(1e3),this._$hL=0,this._$v0=0,this._$S2=0,this._$Ko=new Array,this._$T=e,this._$F=0)}j.STATE_FIRST="STATE_FIRST",j.STATE_INTERVAL="STATE_INTERVAL",j.STATE_CLOSING="STATE_CLOSING",j.STATE_CLOSED="STATE_CLOSED",j.STATE_OPENING="STATE_OPENING",G.prototype=new w,G._$As=32,G._$Gr=!1,G._$NT=null,G._$vS=null,G._$no=null,G._$9r=function(t){return new Float32Array(t)},G._$vb=function(t){return new Int16Array(t)},G._$cr=function(t,e){return null==t||t._$yL()<e.length?((t=G._$9r(2*e.length)).put(e),t._$oT(0)):(t.clear(),t.put(e),t._$oT(0)),t},G._$mb=function(t,e){return null==t||t._$yL()<e.length?((t=G._$vb(2*e.length)).put(e),t._$oT(0)):(t.clear(),t.put(e),t._$oT(0)),t},G._$Hs=function(){return G._$Gr},G._$as=function(t){G._$Gr=t},G.prototype.setGL=function(t){this.gl=t},G.prototype.setTransform=function(t){this.transform=t},G.prototype._$ZT=function(){},G.prototype._$Uo=function(t,e,i,r,s,n,o,a){if(!(n<.01)){var l=this._$U2[t],u=n>.9?lt.EXPAND_W:0;this.gl.drawElements(l,i,r,s,n,u,this.transform,a)}},G.prototype._$Rs=function(){throw new Error("_$Rs")},G.prototype._$Ds=function(t){throw new Error("_$Ds")},G.prototype._$K2=function(){for(var t=0;t<this._$sb.length;t++){0!=this._$sb[t]&&(this.gl._$Sr(1,this._$sb,t),this._$sb[t]=0)}},G.prototype.setTexture=function(t,e){this._$sb.length<t+1&&this._$nS(t),this._$sb[t]=e},G.prototype.setTexture=function(t,e){this._$sb.length<t+1&&this._$nS(t),this._$U2[t]=e},G.prototype._$nS=function(t){var e=Math.max(2*this._$sb.length,t+1+10),i=new Int32Array(e);L._$jT(this._$sb,0,i,0,this._$sb.length),this._$sb=i;var r=new Array;L._$jT(this._$U2,0,r,0,this._$U2.length),this._$U2=r},X.prototype=new T,X._$Xo=new Float32Array(2),X._$io=new Float32Array(2),X._$0o=new Float32Array(2),X._$Lo=new Float32Array(2),X._$To=new Float32Array(2),X._$Po=new Float32Array(2),X._$gT=new Array,X.prototype._$zP=function(){this._$GS=new F,this._$GS._$zP(),this._$Y0=new Array},X.prototype.getType=function(){return T._$c2},X.prototype._$F0=function(t){T.prototype._$F0.call(this,t),this._$GS=t._$nP(),this._$Y0=t._$nP(),T.prototype.readV2_opacity.call(this,t)},X.prototype.init=function(t){var e=new q(this);return e._$Yr=new b,this._$32()&&(e._$Wr=new b),e},X.prototype._$Nr=function(t,e){this!=e._$GT()&&console.log("### assert!! ### ");var i=e;if(this._$GS._$Ur(t)){var r=X._$gT;r[0]=!1;var s=this._$GS._$Q2(t,r);e._$Ib(r[0]),this.interpolateOpacity(t,this._$GS,e,r);var n=t._$vs(),o=t._$Tr();if(this._$GS._$zr(n,o,s),s<=0){var a=this._$Y0[n[0]];i._$Yr.init(a)}else if(1==s){a=this._$Y0[n[0]];var l=this._$Y0[n[1]],u=o[0];i._$Yr._$fL=a._$fL+(l._$fL-a._$fL)*u,i._$Yr._$gL=a._$gL+(l._$gL-a._$gL)*u,i._$Yr._$B0=a._$B0+(l._$B0-a._$B0)*u,i._$Yr._$z0=a._$z0+(l._$z0-a._$z0)*u,i._$Yr._$qT=a._$qT+(l._$qT-a._$qT)*u}else if(2==s){a=this._$Y0[n[0]],l=this._$Y0[n[1]];var h=this._$Y0[n[2]],c=this._$Y0[n[3]],_=(u=o[0],o[1]),m=a._$fL+(l._$fL-a._$fL)*u,d=h._$fL+(c._$fL-h._$fL)*u;i._$Yr._$fL=m+(d-m)*_,m=a._$gL+(l._$gL-a._$gL)*u,d=h._$gL+(c._$gL-h._$gL)*u,i._$Yr._$gL=m+(d-m)*_,m=a._$B0+(l._$B0-a._$B0)*u,d=h._$B0+(c._$B0-h._$B0)*u,i._$Yr._$B0=m+(d-m)*_,m=a._$z0+(l._$z0-a._$z0)*u,d=h._$z0+(c._$z0-h._$z0)*u,i._$Yr._$z0=m+(d-m)*_,m=a._$qT+(l._$qT-a._$qT)*u,d=h._$qT+(c._$qT-h._$qT)*u,i._$Yr._$qT=m+(d-m)*_}else if(3==s){var g=this._$Y0[n[0]],p=this._$Y0[n[1]],f=this._$Y0[n[2]],y=this._$Y0[n[3]],$=this._$Y0[n[4]],b=this._$Y0[n[5]],S=this._$Y0[n[6]],v=this._$Y0[n[7]],x=(u=o[0],_=o[1],o[2]),P=(m=g._$fL+(p._$fL-g._$fL)*u,d=f._$fL+(y._$fL-f._$fL)*u,$._$fL+(b._$fL-$._$fL)*u),C=S._$fL+(v._$fL-S._$fL)*u;i._$Yr._$fL=(1-x)*(m+(d-m)*_)+x*(P+(C-P)*_),m=g._$gL+(p._$gL-g._$gL)*u,d=f._$gL+(y._$gL-f._$gL)*u,P=$._$gL+(b._$gL-$._$gL)*u,C=S._$gL+(v._$gL-S._$gL)*u,i._$Yr._$gL=(1-x)*(m+(d-m)*_)+x*(P+(C-P)*_),m=g._$B0+(p._$B0-g._$B0)*u,d=f._$B0+(y._$B0-f._$B0)*u,P=$._$B0+(b._$B0-$._$B0)*u,C=S._$B0+(v._$B0-S._$B0)*u,i._$Yr._$B0=(1-x)*(m+(d-m)*_)+x*(P+(C-P)*_),m=g._$z0+(p._$z0-g._$z0)*u,d=f._$z0+(y._$z0-f._$z0)*u,P=$._$z0+(b._$z0-$._$z0)*u,C=S._$z0+(v._$z0-S._$z0)*u,i._$Yr._$z0=(1-x)*(m+(d-m)*_)+x*(P+(C-P)*_),m=g._$qT+(p._$qT-g._$qT)*u,d=f._$qT+(y._$qT-f._$qT)*u,P=$._$qT+(b._$qT-$._$qT)*u,C=S._$qT+(v._$qT-S._$qT)*u,i._$Yr._$qT=(1-x)*(m+(d-m)*_)+x*(P+(C-P)*_)}else if(4==s){var w=this._$Y0[n[0]],M=this._$Y0[n[1]],T=this._$Y0[n[2]],L=this._$Y0[n[3]],I=this._$Y0[n[4]],E=this._$Y0[n[5]],F=this._$Y0[n[6]],B=this._$Y0[n[7]],A=this._$Y0[n[8]],D=this._$Y0[n[9]],R=this._$Y0[n[10]],k=this._$Y0[n[11]],V=this._$Y0[n[12]],O=this._$Y0[n[13]],N=this._$Y0[n[14]],U=this._$Y0[n[15]],z=(u=o[0],_=o[1],x=o[2],o[3]),Y=(m=w._$fL+(M._$fL-w._$fL)*u,d=T._$fL+(L._$fL-T._$fL)*u,P=I._$fL+(E._$fL-I._$fL)*u,C=F._$fL+(B._$fL-F._$fL)*u,A._$fL+(D._$fL-A._$fL)*u),j=R._$fL+(k._$fL-R._$fL)*u,G=V._$fL+(O._$fL-V._$fL)*u,q=N._$fL+(U._$fL-N._$fL)*u;i._$Yr._$fL=(1-z)*((1-x)*(m+(d-m)*_)+x*(P+(C-P)*_))+z*((1-x)*(Y+(j-Y)*_)+x*(G+(q-G)*_)),m=w._$gL+(M._$gL-w._$gL)*u,d=T._$gL+(L._$gL-T._$gL)*u,P=I._$gL+(E._$gL-I._$gL)*u,C=F._$gL+(B._$gL-F._$gL)*u,Y=A._$gL+(D._$gL-A._$gL)*u,j=R._$gL+(k._$gL-R._$gL)*u,G=V._$gL+(O._$gL-V._$gL)*u,q=N._$gL+(U._$gL-N._$gL)*u,i._$Yr._$gL=(1-z)*((1-x)*(m+(d-m)*_)+x*(P+(C-P)*_))+z*((1-x)*(Y+(j-Y)*_)+x*(G+(q-G)*_)),m=w._$B0+(M._$B0-w._$B0)*u,d=T._$B0+(L._$B0-T._$B0)*u,P=I._$B0+(E._$B0-I._$B0)*u,C=F._$B0+(B._$B0-F._$B0)*u,Y=A._$B0+(D._$B0-A._$B0)*u,j=R._$B0+(k._$B0-R._$B0)*u,G=V._$B0+(O._$B0-V._$B0)*u,q=N._$B0+(U._$B0-N._$B0)*u,i._$Yr._$B0=(1-z)*((1-x)*(m+(d-m)*_)+x*(P+(C-P)*_))+z*((1-x)*(Y+(j-Y)*_)+x*(G+(q-G)*_)),m=w._$z0+(M._$z0-w._$z0)*u,d=T._$z0+(L._$z0-T._$z0)*u,P=I._$z0+(E._$z0-I._$z0)*u,C=F._$z0+(B._$z0-F._$z0)*u,Y=A._$z0+(D._$z0-A._$z0)*u,j=R._$z0+(k._$z0-R._$z0)*u,G=V._$z0+(O._$z0-V._$z0)*u,q=N._$z0+(U._$z0-N._$z0)*u,i._$Yr._$z0=(1-z)*((1-x)*(m+(d-m)*_)+x*(P+(C-P)*_))+z*((1-x)*(Y+(j-Y)*_)+x*(G+(q-G)*_)),m=w._$qT+(M._$qT-w._$qT)*u,d=T._$qT+(L._$qT-T._$qT)*u,P=I._$qT+(E._$qT-I._$qT)*u,C=F._$qT+(B._$qT-F._$qT)*u,Y=A._$qT+(D._$qT-A._$qT)*u,j=R._$qT+(k._$qT-R._$qT)*u,G=V._$qT+(O._$qT-V._$qT)*u,q=N._$qT+(U._$qT-N._$qT)*u,i._$Yr._$qT=(1-z)*((1-x)*(m+(d-m)*_)+x*(P+(C-P)*_))+z*((1-x)*(Y+(j-Y)*_)+x*(G+(q-G)*_))}else{for(var H=0|Math.pow(2,s),W=new Float32Array(H),K=0;K<H;K++){for(var J=K,Q=1,Z=0;Z<s;Z++)Q*=J%2==0?1-o[Z]:o[Z],J/=2;W[K]=Q}for(var tt=new Array,et=0;et<H;et++)tt[et]=this._$Y0[n[et]];var it=0,rt=0,st=0,nt=0,ot=0;for(et=0;et<H;et++)it+=W[et]*tt[et]._$fL,rt+=W[et]*tt[et]._$gL,st+=W[et]*tt[et]._$B0,nt+=W[et]*tt[et]._$z0,ot+=W[et]*tt[et]._$qT;i._$Yr._$fL=it,i._$Yr._$gL=rt,i._$Yr._$B0=st,i._$Yr._$z0=nt,i._$Yr._$qT=ot}a=this._$Y0[n[0]];i._$Yr.reflectX=a.reflectX,i._$Yr.reflectY=a.reflectY}},X.prototype._$2b=function(t,e){this!=e._$GT()&&console.log("### assert!! ### ");var i=e;if(i._$hS(!0),this._$32()){var r=this.getTargetBaseDataID();if(i._$8r==T._$ur&&(i._$8r=t.getBaseDataIndex(r)),i._$8r<0)lt._$so&&a._$li("_$L _$0P _$G :: %s",r),i._$hS(!1);else{var s=t.getBaseData(i._$8r);if(null!=s){var n=t._$q2(i._$8r),o=X._$Xo;o[0]=i._$Yr._$fL,o[1]=i._$Yr._$gL;var l=X._$io;l[0]=0,l[1]=-.1,n._$GT().getType()==T._$c2?l[1]=-10:l[1]=-.1;var u=X._$0o;this._$Jr(t,s,n,o,l,u);var h=Pt._$92(l,u);s._$nb(t,n,o,o,1,0,2),i._$Wr._$fL=o[0],i._$Wr._$gL=o[1],i._$Wr._$B0=i._$Yr._$B0,i._$Wr._$z0=i._$Yr._$z0,i._$Wr._$qT=i._$Yr._$qT-h*Pt._$NS;var c=n.getTotalScale();i.setTotalScale_notForClient(c*i._$Wr._$B0);var _=n.getTotalOpacity();i.setTotalOpacity(_*i.getInterpolatedOpacity()),i._$Wr.reflectX=i._$Yr.reflectX,i._$Wr.reflectY=i._$Yr.reflectY,i._$hS(n._$yo())}else i._$hS(!1)}}else i.setTotalScale_notForClient(i._$Yr._$B0),i.setTotalOpacity(i.getInterpolatedOpacity())},X.prototype._$nb=function(t,e,i,r,s,n,o){this!=e._$GT()&&console.log("### assert!! ### ");for(var a,l,u=e,h=null!=u._$Wr?u._$Wr:u._$Yr,c=Math.sin(Pt._$bS*h._$qT),_=Math.cos(Pt._$bS*h._$qT),m=u.getTotalScale(),d=h.reflectX?-1:1,g=h.reflectY?-1:1,p=_*m*d,f=-c*m*g,y=c*m*d,$=_*m*g,b=h._$fL,S=h._$gL,v=s*o,x=n;x<v;x+=o)a=i[x],l=i[x+1],r[x]=p*a+f*l+b,r[x+1]=y*a+$*l+S},X.prototype._$Jr=function(t,e,i,r,s,n){e!=i._$GT()&&console.log("### assert!! ### ");var o=X._$Lo;X._$Lo[0]=r[0],X._$Lo[1]=r[1],e._$nb(t,i,o,o,1,0,2);for(var a=X._$To,l=X._$Po,u=1,h=0;h<10;h++){if(l[0]=r[0]+u*s[0],l[1]=r[1]+u*s[1],e._$nb(t,i,l,a,1,0,2),a[0]-=o[0],a[1]-=o[1],0!=a[0]||0!=a[1])return n[0]=a[0],void(n[1]=a[1]);if(l[0]=r[0]-u*s[0],l[1]=r[1]-u*s[1],e._$nb(t,i,l,a,1,0,2),a[0]-=o[0],a[1]-=o[1],0!=a[0]||0!=a[1])return a[0]=-a[0],a[0]=-a[0],n[0]=a[0],void(n[1]=a[1]);u*=.1}lt._$so&&console.log("_$L0 to transform _$SP\n")},q.prototype=new at,H.prototype=new C,H._$ur=-2,H._$ES=500,H._$wb=2,H._$8S=3,H._$os=4,H._$52=H._$ES,H._$R2=H._$ES,H._$Sb=function(t){for(var e=t.length-1;e>=0;--e){var i=t[e];i<H._$52?H._$52=i:i>H._$R2&&(H._$R2=i)}},H._$or=function(){return H._$52},H._$Pr=function(){return H._$R2},H.prototype._$F0=function(t){this._$gP=t._$nP(),this._$dr=t._$nP(),this._$GS=t._$nP(),this._$qb=t._$6L(),this._$Lb=t._$cS(),this._$mS=t._$Tb(),t.getFormatVersion()>=N._$T7?(this.clipID=t._$nP(),this.clipIDList=this.convertClipIDForV2_11(this.clipID)):this.clipIDList=null,H._$Sb(this._$Lb)},H.prototype.getClipIDList=function(){return this.clipIDList},H.prototype._$Nr=function(t,e){if(e._$IS[0]=!1,e._$Us=x._$Z2(t,this._$GS,e._$IS,this._$Lb),lt._$Zs);else if(e._$IS[0])return;e._$7s=x._$br(t,this._$GS,e._$IS,this._$mS)},H.prototype._$2b=function(t){},H.prototype.getDrawDataID=function(){return this._$gP},H.prototype._$j2=function(t){this._$gP=t},H.prototype.getOpacity=function(t,e){return e._$7s},H.prototype._$zS=function(t,e){return e._$Us},H.prototype.getTargetBaseDataID=function(){return this._$dr},H.prototype._$gs=function(t){this._$dr=t},H.prototype._$32=function(){return null!=this._$dr&&this._$dr!=yt._$2o()},H.prototype.getType=function(){},W._$42=0,W.prototype._$1b=function(){return this._$3S},W.prototype.getDrawDataList=function(){return this._$aS},W.prototype._$F0=function(t){this._$NL=t._$nP(),this._$aS=t._$nP(),this._$3S=t._$nP()},W.prototype._$kr=function(t){t._$Zo(this._$3S),t._$xo(this._$aS),this._$3S=null,this._$aS=null},K.prototype=new e,K.loadModel=function(t){var i=new K;return e._$62(i,t),i},K.loadModel=function(t){var i=new K;return e._$62(i,t),i},K._$to=function(){return new K},K._$er=function(t){var e=new _$5("../_$_r/_$t0/_$Ri/_$_P._$d");if(0==e.exists())throw new _$ls("_$t0 _$_ _$6 _$Ui :: "+e._$PL());for(var i=["../_$_r/_$t0/_$Ri/_$_P.512/_$CP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$vP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$EP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$pP._$1"],r=K.loadModel(e._$3b()),s=0;s<i.length;s++){var n=new _$5(i[s]);if(0==n.exists())throw new _$ls("_$t0 _$_ _$6 _$Ui :: "+n._$PL());r.setTexture(s,_$nL._$_o(t,n._$3b()))}return r},K.prototype.setGL=function(t){this._$zo.setGL(t)},K.prototype.setTransform=function(t){this._$zo.setTransform(t)},K.prototype.draw=function(){this._$5S.draw(this._$zo)},K.prototype._$K2=function(){this._$zo._$K2()},K.prototype.setTexture=function(t,e){null==this._$zo&&a._$li("_$Yi for QT _$ki / _$XS() is _$6 _$ui!!"),this._$zo.setTexture(t,e)},K.prototype.setTexture=function(t,e){null==this._$zo&&a._$li("_$Yi for QT _$ki / _$XS() is _$6 _$ui!!"),this._$zo.setTexture(t,e)},K.prototype._$Rs=function(){return this._$zo._$Rs()},K.prototype._$Ds=function(t){this._$zo._$Ds(t)},K.prototype.getDrawParam=function(){return this._$zo},J.prototype=new o,J._$cs="VISIBLE:",J._$ar="LAYOUT:",J.MTN_PREFIX_FADEIN="FADEIN:",J.MTN_PREFIX_FADEOUT="FADEOUT:",J._$Co=0,J._$1T=1,J.loadMotion=function(t){var e=z._$C(t);return J.loadMotion(e)},J.loadMotion=function(t){t instanceof ArrayBuffer&&(t=new DataView(t));var e=new J,i=[0],r=t.byteLength;e._$yT=0;for(var s=0;s<r;++s){var n=Q(t,s),o=n.charCodeAt(0);if("\n"!=n&&"\r"!=n)if("#"!=n)if("$"!=n){if(97<=o&&o<=122||65<=o&&o<=90||"_"==n){for(c=s,_=-1;s<r&&("\r"!=(n=Q(t,s))&&"\n"!=n);++s)if("="==n){_=s;break}if(_>=0){var a=new V;E.startsWith(t,c,J._$cs)?(a._$RP=V._$hs,a._$4P=E.createString(t,c,_-c)):E.startsWith(t,c,J._$ar)?(a._$4P=E.createString(t,c+7,_-c-7),E.startsWith(t,c+7,"ANCHOR_X")?a._$RP=V._$xs:E.startsWith(t,c+7,"ANCHOR_Y")?a._$RP=V._$us:E.startsWith(t,c+7,"SCALE_X")?a._$RP=V._$qs:E.startsWith(t,c+7,"SCALE_Y")?a._$RP=V._$Ys:E.startsWith(t,c+7,"X")?a._$RP=V._$ws:E.startsWith(t,c+7,"Y")&&(a._$RP=V._$Ns)):(a._$RP=V._$Fr,a._$4P=E.createString(t,c,_-c)),e.motions.push(a);var l=0,u=[];for(s=_+1;s<r&&("\r"!=(n=Q(t,s))&&"\n"!=n);++s)if(","!=n&&" "!=n&&"\t"!=n){d=E._$LS(t,r,s,i);if(i[0]>0){u.push(d),l++;var h=i[0];if(h<s){console.log("_$n0 _$hi . @Live2DMotion loadMotion()\n");break}s=h-1}}a._$I0=new Float32Array(u),l>e._$yT&&(e._$yT=l)}}}else{for(var c=s,_=-1;s<r&&("\r"!=(n=Q(t,s))&&"\n"!=n);++s)if("="==n){_=s;break}var m=!1;if(_>=0)for(_==c+4&&"f"==Q(t,c+1)&&"p"==Q(t,c+2)&&"s"==Q(t,c+3)&&(m=!0),s=_+1;s<r&&("\r"!=(n=Q(t,s))&&"\n"!=n);++s)if(","!=n&&" "!=n&&"\t"!=n){var d=E._$LS(t,r,s,i);i[0]>0&&m&&5<d&&d<121&&(e._$D0=d),s=i[0]}for(;s<r&&("\n"!=Q(t,s)&&"\r"!=Q(t,s));++s);}else for(;s<r&&("\n"!=Q(t,s)&&"\r"!=Q(t,s));++s);}return e._$rr=1e3*e._$yT/e._$D0|0,e},J.prototype.getDurationMSec=function(){return this._$E?-1:this._$rr},J.prototype.getLoopDurationMSec=function(){return this._$rr},J.prototype.dump=function(){for(var t=0;t<this.motions.length;t++){var e=this.motions[t];console.log("_$wL[%s] [%d]. ",e._$4P,e._$I0.length);for(var i=0;i<e._$I0.length&&i<10;i++)console.log("%5.2f ,",e._$I0[i]);console.log("\n")}},J.prototype.updateParamExe=function(t,e,i,r){for(var s=(e-r._$z2)*this._$D0/1e3,n=0|s,o=s-n,a=0;a<this.motions.length;a++){var l=this.motions[a],u=l._$I0.length,h=l._$4P;if(l._$RP==V._$hs){var c=l._$I0[n>=u?u-1:n];t.setParamFloat(h,c)}else if(V._$ws<=l._$RP&&l._$RP<=V._$Ys);else{var _=t.getParamIndex(h),m=t.getModelContext(),d=.4*(m.getParamMax(_)-m.getParamMin(_)),g=m.getParamFloat(_),p=l._$I0[n>=u?u-1:n],f=l._$I0[n+1>=u?u-1:n+1],y=g+((p<f&&f-p>d||p>f&&p-f>d?p:p+(f-p)*o)-g)*i;t.setParamFloat(h,y)}}n>=this._$yT&&(this._$E?(r._$z2=e,this.loopFadeIn&&(r._$bs=e)):r._$9L=!0),this._$eP=i},J.prototype._$r0=function(){return this._$E},J.prototype._$aL=function(t){this._$E=t},J.prototype._$S0=function(){return this._$D0},J.prototype._$U0=function(t){this._$D0=t},J.prototype.isLoopFadeIn=function(){return this.loopFadeIn},J.prototype.setLoopFadeIn=function(t){this.loopFadeIn=t},k.prototype.clear=function(){this.size=0},k.prototype.add=function(t){if(this._$P.length<=this.size){var e=new Float32Array(2*this.size);L._$jT(this._$P,0,e,0,this.size),this._$P=e}this._$P[this.size++]=t},k.prototype._$BL=function(){var t=new Float32Array(this.size);return L._$jT(this._$P,0,t,0,this.size),t},V._$Fr=0,V._$hs=1,V._$ws=100,V._$Ns=101,V._$xs=102,V._$us=103,V._$qs=104,V._$Ys=105,Z.prototype=new T,Z._$gT=new Array,Z.prototype._$zP=function(){this._$GS=new F,this._$GS._$zP()},Z.prototype._$F0=function(t){T.prototype._$F0.call(this,t),this._$A=t._$6L(),this._$o=t._$6L(),this._$GS=t._$nP(),this._$Eo=t._$nP(),T.prototype.readV2_opacity.call(this,t)},Z.prototype.init=function(t){var e=new tt(this),i=(this._$o+1)*(this._$A+1);return null!=e._$Cr&&(e._$Cr=null),e._$Cr=new Float32Array(2*i),null!=e._$hr&&(e._$hr=null),this._$32()?e._$hr=new Float32Array(2*i):e._$hr=null,e},Z.prototype._$Nr=function(t,e){var i=e;if(this._$GS._$Ur(t)){var r=this._$VT(),s=Z._$gT;s[0]=!1,x._$Vr(t,this._$GS,s,r,this._$Eo,i._$Cr,0,2),e._$Ib(s[0]),this.interpolateOpacity(t,this._$GS,e,s)}},Z.prototype._$2b=function(t,e){var i=e;if(i._$hS(!0),this._$32()){var r=this.getTargetBaseDataID();if(i._$8r==T._$ur&&(i._$8r=t.getBaseDataIndex(r)),i._$8r<0)lt._$so&&a._$li("_$L _$0P _$G :: %s",r),i._$hS(!1);else{var s=t.getBaseData(i._$8r),n=t._$q2(i._$8r);if(null!=s&&n._$yo()){var o=n.getTotalScale();i.setTotalScale_notForClient(o);var l=n.getTotalOpacity();i.setTotalOpacity(l*i.getInterpolatedOpacity()),s._$nb(t,n,i._$Cr,i._$hr,this._$VT(),0,2),i._$hS(!0)}else i._$hS(!1)}}else i.setTotalOpacity(i.getInterpolatedOpacity())},Z.prototype._$nb=function(t,e,i,r,s,n,o){var a=e,l=null!=a._$hr?a._$hr:a._$Cr;Z.transformPoints_sdk2(i,r,s,n,o,l,this._$o,this._$A)},Z.transformPoints_sdk2=function(t,e,i,r,s,n,o,a){for(var l,u,h,c=i*s,_=0,m=0,d=0,g=0,p=0,f=0,y=!1,$=r;$<c;$+=s){var b,S,v,x;if(v=t[$],S=(x=t[$+1])*a,(b=v*o)<0||S<0||o<=b||a<=S){var P=o+1;if(!y){y=!0,_=.25*(n[2*(0+0*P)]+n[2*(o+0*P)]+n[2*(0+a*P)]+n[2*(o+a*P)]),m=.25*(n[2*(0+0*P)+1]+n[2*(o+0*P)+1]+n[2*(0+a*P)+1]+n[2*(o+a*P)+1]);var C=n[2*(o+a*P)]-n[2*(0+0*P)],w=n[2*(o+a*P)+1]-n[2*(0+0*P)+1],M=n[2*(o+0*P)]-n[2*(0+a*P)],T=n[2*(o+0*P)+1]-n[2*(0+a*P)+1];_-=.5*((d=.5*(C+M))+(p=.5*(C-M))),m-=.5*((g=.5*(w+T))+(f=.5*(w-T)))}if(-2<v&&v<3&&-2<x&&x<3)if(v<=0)if(x<=0){var L=n[2*(0+0*P)],I=n[2*(0+0*P)+1],E=_-2*d,F=m-2*g,B=_-2*p,A=m-2*f,D=_-2*d-2*p,R=m-2*g-2*f;(k=.5*(v- -2))+(V=.5*(x- -2))<=1?(e[$]=D+(B-D)*k+(E-D)*V,e[$+1]=R+(A-R)*k+(F-R)*V):(e[$]=L+(E-L)*(1-k)+(B-L)*(1-V),e[$+1]=I+(F-I)*(1-k)+(A-I)*(1-V))}else if(x>=1){B=n[2*(0+a*P)],A=n[2*(0+a*P)+1],D=_-2*d+1*p,R=m-2*g+1*f,L=_+3*p,I=m+3*f,E=_-2*d+3*p,F=m-2*g+3*f;(k=.5*(v- -2))+(V=.5*(x-1))<=1?(e[$]=D+(B-D)*k+(E-D)*V,e[$+1]=R+(A-R)*k+(F-R)*V):(e[$]=L+(E-L)*(1-k)+(B-L)*(1-V),e[$+1]=I+(F-I)*(1-k)+(A-I)*(1-V))}else{(U=0|S)==a&&(U=a-1);var k=.5*(v- -2),V=S-U,O=U/a,N=(U+1)/a;B=n[2*(0+U*P)],A=n[2*(0+U*P)+1],L=n[2*(0+(U+1)*P)],I=n[2*(0+(U+1)*P)+1],D=_-2*d+O*p,R=m-2*g+O*f,E=_-2*d+N*p,F=m-2*g+N*f;k+V<=1?(e[$]=D+(B-D)*k+(E-D)*V,e[$+1]=R+(A-R)*k+(F-R)*V):(e[$]=L+(E-L)*(1-k)+(B-L)*(1-V),e[$+1]=I+(F-I)*(1-k)+(A-I)*(1-V))}else if(1<=v)if(x<=0){E=n[2*(o+0*P)],F=n[2*(o+0*P)+1],L=_+3*d,I=m+3*g,D=_+1*d-2*p,R=m+1*g-2*f,B=_+3*d-2*p,A=m+3*g-2*f;(k=.5*(v-1))+(V=.5*(x- -2))<=1?(e[$]=D+(B-D)*k+(E-D)*V,e[$+1]=R+(A-R)*k+(F-R)*V):(e[$]=L+(E-L)*(1-k)+(B-L)*(1-V),e[$+1]=I+(F-I)*(1-k)+(A-I)*(1-V))}else if(x>=1){D=n[2*(o+a*P)],R=n[2*(o+a*P)+1],B=_+3*d+1*p,A=m+3*g+1*f,E=_+1*d+3*p,F=m+1*g+3*f,L=_+3*d+3*p,I=m+3*g+3*f;(k=.5*(v-1))+(V=.5*(x-1))<=1?(e[$]=D+(B-D)*k+(E-D)*V,e[$+1]=R+(A-R)*k+(F-R)*V):(e[$]=L+(E-L)*(1-k)+(B-L)*(1-V),e[$+1]=I+(F-I)*(1-k)+(A-I)*(1-V))}else{var U;(U=0|S)==a&&(U=a-1);k=.5*(v-1),V=S-U,O=U/a,N=(U+1)/a,D=n[2*(o+U*P)],R=n[2*(o+U*P)+1],E=n[2*(o+(U+1)*P)],F=n[2*(o+(U+1)*P)+1],B=_+3*d+O*p,A=m+3*g+O*f,L=_+3*d+N*p,I=m+3*g+N*f;k+V<=1?(e[$]=D+(B-D)*k+(E-D)*V,e[$+1]=R+(A-R)*k+(F-R)*V):(e[$]=L+(E-L)*(1-k)+(B-L)*(1-V),e[$+1]=I+(F-I)*(1-k)+(A-I)*(1-V))}else if(x<=0){(j=0|b)==o&&(j=o-1);k=b-j,V=.5*(x- -2);var z=j/o,Y=(j+1)/o;E=n[2*(j+0*P)],F=n[2*(j+0*P)+1],L=n[2*(j+1+0*P)],I=n[2*(j+1+0*P)+1],D=_+z*d-2*p,R=m+z*g-2*f,B=_+Y*d-2*p,A=m+Y*g-2*f;k+V<=1?(e[$]=D+(B-D)*k+(E-D)*V,e[$+1]=R+(A-R)*k+(F-R)*V):(e[$]=L+(E-L)*(1-k)+(B-L)*(1-V),e[$+1]=I+(F-I)*(1-k)+(A-I)*(1-V))}else if(x>=1){var j;(j=0|b)==o&&(j=o-1);k=b-j,V=.5*(x-1),z=j/o,Y=(j+1)/o,D=n[2*(j+a*P)],R=n[2*(j+a*P)+1],B=n[2*(j+1+a*P)],A=n[2*(j+1+a*P)+1],E=_+z*d+3*p,F=m+z*g+3*f,L=_+Y*d+3*p,I=m+Y*g+3*f;k+V<=1?(e[$]=D+(B-D)*k+(E-D)*V,e[$+1]=R+(A-R)*k+(F-R)*V):(e[$]=L+(E-L)*(1-k)+(B-L)*(1-V),e[$+1]=I+(F-I)*(1-k)+(A-I)*(1-V))}else System.err.printf("_$li calc : %.4f , %.4f\t\t\t\t\t@@BDBoxGrid\n",v,x);else e[$]=_+v*d+x*p,e[$+1]=m+v*g+x*f}else l=2*((0|b)+(0|S)*(o+1)),(u=b-(0|b))+(h=S-(0|S))<1?(e[$]=n[l]*(1-u-h)+n[l+2]*u+n[l+2*(o+1)]*h,e[$+1]=n[l+1]*(1-u-h)+n[l+3]*u+n[l+2*(o+1)+1]*h):(e[$]=n[l+2*(o+1)+2]*(u-1+h)+n[l+2*(o+1)]*(1-u)+n[l+2]*(1-h),e[$+1]=n[l+2*(o+1)+3]*(u-1+h)+n[l+2*(o+1)+1]*(1-u)+n[l+3]*(1-h))}},Z.prototype.transformPoints_sdk1=function(t,e,i,r,s,n,o){for(var a,l,u,h,c,_,m,d=e,g=this._$o,p=this._$A,f=s*o,y=null!=d._$hr?d._$hr:d._$Cr,$=n;$<f;$+=o)lt._$ts?((a=i[$])<0?a=0:a>1&&(a=1),(l=i[$+1])<0?l=0:l>1&&(l=1),(u=0|(a*=g))>g-1&&(u=g-1),(h=0|(l*=p))>p-1&&(h=p-1),_=a-u,m=l-h,c=2*(u+h*(g+1))):(_=(a=i[$]*g)-(0|a),m=(l=i[$+1]*p)-(0|l),c=2*((0|a)+(0|l)*(g+1))),_+m<1?(r[$]=y[c]*(1-_-m)+y[c+2]*_+y[c+2*(g+1)]*m,r[$+1]=y[c+1]*(1-_-m)+y[c+3]*_+y[c+2*(g+1)+1]*m):(r[$]=y[c+2*(g+1)+2]*(_-1+m)+y[c+2*(g+1)]*(1-_)+y[c+2]*(1-m),r[$+1]=y[c+2*(g+1)+3]*(_-1+m)+y[c+2*(g+1)+1]*(1-_)+y[c+3]*(1-m))},Z.prototype._$VT=function(){return(this._$o+1)*(this._$A+1)},Z.prototype.getType=function(){return T._$_b},tt.prototype=new at,et._$42=0,et.prototype._$zP=function(){this._$3S=new Array,this._$aS=new Array},et.prototype._$F0=function(t){this._$g0=t._$8L(),this.visible=t._$8L(),this._$NL=t._$nP(),this._$3S=t._$nP(),this._$aS=t._$nP()},et.prototype.init=function(t){var e=new it(this);return e.setPartsOpacity(this.isVisible()?1:0),e},et.prototype._$6o=function(t){if(null==this._$3S)throw new Error("_$3S _$6 _$Wo@_$6o");this._$3S.push(t)},et.prototype._$3o=function(t){if(null==this._$aS)throw new Error("_$aS _$6 _$Wo@_$3o");this._$aS.push(t)},et.prototype._$Zo=function(t){this._$3S=t},et.prototype._$xo=function(t){this._$aS=t},et.prototype.isVisible=function(){return this.visible},et.prototype._$uL=function(){return this._$g0},et.prototype._$KP=function(t){this.visible=t},et.prototype._$ET=function(t){this._$g0=t},et.prototype.getBaseData=function(){return this._$3S},et.prototype.getDrawData=function(){return this._$aS},et.prototype._$p2=function(){return this._$NL},et.prototype._$ob=function(t){this._$NL=t},et.prototype.getPartsID=function(){return this._$NL},et.prototype._$MP=function(t){this._$NL=t},it.prototype=new function(){},it.prototype.getPartsOpacity=function(){return this._$VS},it.prototype.setPartsOpacity=function(t){this._$VS=t},rt._$L7=function(){c._$27(),yt._$27(),A._$27(),h._$27()},rt.prototype.toString=function(){return this.id},st.prototype._$1s=function(){return this._$4S},st.prototype._$zP=function(){this._$4S=new Array},st.prototype._$F0=function(t){this._$4S=t._$nP()},st.prototype._$Ks=function(t){this._$4S.push(t)},nt.tr=new ft,nt._$50=new ft,nt._$Ti=new Array(0,0),nt._$Pi=new Array(0,0),nt._$B=new Array(0,0),nt.prototype._$lP=function(t,e,i,r){this.viewport=new Array(t,e,i,r)},nt.prototype._$bL=function(){this.context.save();var t=this.viewport;null!=t&&(this.context.beginPath(),this.context._$Li(t[0],t[1],t[2],t[3]),this.context.clip())},nt.prototype._$ei=function(){this.context.restore()},nt.prototype.drawElements=function(t,e,i,r,s,n,o,l){try{s!=this._$Qo&&(this._$Qo=s,this.context.globalAlpha=s);for(var u=e.length,h=t.width,c=t.height,_=this.context,m=this._$xP,d=this._$uP,g=this._$6r,p=this._$3r,f=nt.tr,y=nt._$Ti,$=nt._$Pi,b=nt._$B,v=0;v<u;v+=3){_.save();var x=e[v],P=e[v+1],C=e[v+2],w=m+g*i[2*x],M=d+p*i[2*x+1],T=m+g*i[2*P],L=d+p*i[2*P+1],I=m+g*i[2*C],E=d+p*i[2*C+1];o&&(o._$PS(w,M,b),w=b[0],M=b[1],o._$PS(T,L,b),T=b[0],L=b[1],o._$PS(I,E,b),I=b[0],E=b[1]);var F=h*r[2*x],B=c-c*r[2*x+1],A=h*r[2*P],D=c-c*r[2*P+1],R=h*r[2*C],k=c-c*r[2*C+1],V=Math.atan2(D-B,A-F),O=Math.atan2(L-M,T-w),N=T-w,U=L-M,z=Math.sqrt(N*N+U*U),Y=A-F,j=D-B,G=z/Math.sqrt(Y*Y+j*j);S._$ni(R,k,F,B,A-F,D-B,-(D-B),A-F,y),S._$ni(I,E,w,M,T-w,L-M,-(L-M),T-w,$);var X=($[0]-y[0])/y[1],q=Math.min(F,A,R),H=Math.max(F,A,R),W=Math.min(B,D,k),K=Math.max(B,D,k),J=Math.floor(q),Q=Math.floor(W),Z=Math.ceil(H),tt=Math.ceil(K);f.identity(),f.translate(w,M),f.rotate(O),f.scale(1,$[1]/y[1]),f.shear(X,0),f.scale(G,G),f.rotate(-V),f.translate(-F,-B),f.setContext(_);if(n||(n=1.2),lt.IGNORE_EXPAND&&(n=0),lt.USE_CACHED_POLYGON_IMAGE){var et=l._$e0;if(et.gl_cacheImage=et.gl_cacheImage||{},!et.gl_cacheImage[v]){var it=nt.createCanvas(Z-J,tt-Q);lt.DEBUG_DATA.LDGL_CANVAS_MB=lt.DEBUG_DATA.LDGL_CANVAS_MB||0,lt.DEBUG_DATA.LDGL_CANVAS_MB+=(Z-J)*(tt-Q)*4;var rt=it.getContext("2d");rt.translate(-J,-Q),nt.clip(rt,f,n,z,F,B,A,D,R,k,w,M,T,L,I,E),rt.drawImage(t,0,0),et.gl_cacheImage[v]={cacheCanvas:it,cacheContext:rt}}_.drawImage(et.gl_cacheImage[v].cacheCanvas,J,Q)}else lt.IGNORE_CLIP||nt.clip(_,f,n,z,F,B,A,D,R,k,w,M,T,L,I,E),lt.USE_ADJUST_TRANSLATION&&(q=0,H=h,W=0,K=c),_.drawImage(t,q,W,H-q,K-W,q,W,H-q,K-W);_.restore()}}catch(t){a._$Rb(t)}},nt.clip=function(t,e,i,r,s,n,o,a,l,u,h,c,_,m,d,g){i>.02?nt.expandClip(t,e,i,r,h,c,_,m,d,g):nt.clipWithTransform(t,null,s,n,o,a,l,u)},nt.expandClip=function(t,e,i,r,s,n,o,a,l,u){var h=o-s,c=a-n,_=l-s,m=u-n,d=h*m-c*_>0?i:-i,g=-c,p=h,f=l-o,y=u-a,$=-y,b=f,S=Math.sqrt(f*f+y*y),v=-m,x=_,P=Math.sqrt(_*_+m*m),C=s-d*g/r,w=n-d*p/r,M=o-d*g/r,T=a-d*p/r,L=o-d*$/S,I=a-d*b/S,E=l-d*$/S,F=u-d*b/S,B=s+d*v/P,A=n+d*x/P,D=l+d*v/P,R=u+d*x/P,k=nt._$50;return null!=e._$P2(k)&&(nt.clipWithTransform(t,k,C,w,M,T,L,I,E,F,D,R,B,A),!0)},nt.clipWithTransform=function(t,e,i,r,s,n,o,l){if(arguments.length<7)a._$li("err : @LDGL.clip()");else if(arguments[1]instanceof ft){var u=nt._$B,h=e,c=arguments;if(t.beginPath(),h){h._$PS(c[2],c[3],u),t.moveTo(u[0],u[1]);for(var _=4;_<c.length;_+=2)h._$PS(c[_],c[_+1],u),t.lineTo(u[0],u[1])}else{t.moveTo(c[2],c[3]);for(_=4;_<c.length;_+=2)t.lineTo(c[_],c[_+1])}t.clip()}else a._$li("err : a[0] is _$6 LDTransform @LDGL.clip()")},nt.createCanvas=function(t,e){var i=document.createElement("canvas");return i.setAttribute("width",t),i.setAttribute("height",e),i||a._$li("err : "+i),i},nt.dumpValues=function(){for(var t="",e=0;e<arguments.length;e++)t+="["+e+"]= "+arguments[e].toFixed(3)+" , ";console.log(t)},ot.prototype._$F0=function(t){this._$TT=t._$_T(),this._$LT=t._$_T(),this._$FS=t._$_T(),this._$wL=t._$nP()},ot.prototype.getMinValue=function(){return this._$TT},ot.prototype.getMaxValue=function(){return this._$LT},ot.prototype.getDefaultValue=function(){return this._$FS},ot.prototype.getParamID=function(){return this._$wL},at.prototype._$yo=function(){return this._$AT&&!this._$JS},at.prototype._$hS=function(t){this._$AT=t},at.prototype._$GT=function(){return this._$e0},at.prototype._$l2=function(t){this._$IP=t},at.prototype.getPartsIndex=function(){return this._$IP},at.prototype._$x2=function(){return this._$JS},at.prototype._$Ib=function(t){this._$JS=t},at.prototype.getTotalScale=function(){return this.totalScale},at.prototype.setTotalScale_notForClient=function(t){this.totalScale=t},at.prototype.getInterpolatedOpacity=function(){return this._$7s},at.prototype.setInterpolatedOpacity=function(t){this._$7s=t},at.prototype.getTotalOpacity=function(t){return this.totalOpacity},at.prototype.setTotalOpacity=function(t){this.totalOpacity=t},lt._$2s="2.1.00_1",lt._$Kr=201001e3,lt._$sP=!0,lt._$so=!0,lt._$cb=!1,lt._$3T=!0,lt._$Ts=!0,lt._$fb=!0,lt._$ts=!0,lt.L2D_DEFORMER_EXTEND=!0,lt._$Wb=!1,lt._$yr=!1,lt._$Zs=!1,lt.L2D_NO_ERROR=0,lt._$i7=1e3,lt._$9s=1001,lt._$es=1100,lt._$r7=2e3,lt._$07=2001,lt._$b7=2002,lt._$H7=4e3,lt.L2D_COLOR_BLEND_MODE_MULT=0,lt.L2D_COLOR_BLEND_MODE_ADD=1,lt.L2D_COLOR_BLEND_MODE_INTERPOLATE=2,lt._$6b=!0,lt._$cT=0,lt.clippingMaskBufferSize=256,lt.glContext=new Array,lt.frameBuffers=new Array,lt.fTexture=new Array,lt.IGNORE_CLIP=!1,lt.IGNORE_EXPAND=!1,lt.EXPAND_W=2,lt.USE_ADJUST_TRANSLATION=!0,lt.USE_CANVAS_TRANSFORM=!0,lt.USE_CACHED_POLYGON_IMAGE=!1,lt.DEBUG_DATA={},lt.PROFILE_IOS_SPEED={PROFILE_NAME:"iOS Speed",USE_ADJUST_TRANSLATION:!0,USE_CACHED_POLYGON_IMAGE:!0,EXPAND_W:4},lt.PROFILE_IOS_QUALITY={PROFILE_NAME:"iOS HiQ",USE_ADJUST_TRANSLATION:!0,USE_CACHED_POLYGON_IMAGE:!1,EXPAND_W:2},lt.PROFILE_IOS_DEFAULT=lt.PROFILE_IOS_QUALITY,lt.PROFILE_ANDROID={PROFILE_NAME:"Android",USE_ADJUST_TRANSLATION:!1,USE_CACHED_POLYGON_IMAGE:!1,EXPAND_W:2},lt.PROFILE_DESKTOP={PROFILE_NAME:"Desktop",USE_ADJUST_TRANSLATION:!1,USE_CACHED_POLYGON_IMAGE:!1,EXPAND_W:2},lt.initProfile=function(){wt.isIOS()?lt.setupProfile(lt.PROFILE_IOS_DEFAULT):wt.isAndroid()?lt.setupProfile(lt.PROFILE_ANDROID):lt.setupProfile(lt.PROFILE_DESKTOP)},lt.setupProfile=function(t,e){if("number"==typeof t)switch(t){case 9901:t=lt.PROFILE_IOS_SPEED;break;case 9902:t=lt.PROFILE_IOS_QUALITY;break;case 9903:t=lt.PROFILE_IOS_DEFAULT;break;case 9904:t=lt.PROFILE_ANDROID;break;case 9905:t=lt.PROFILE_DESKTOP;break;default:alert("profile _$6 _$Ui : "+t)}for(var i in arguments.length<2&&(e=!0),e&&console.log("profile : "+t.PROFILE_NAME),t)lt[i]=t[i],e&&console.log("  ["+i+"] = "+t[i])},lt.init=function(){if(lt._$6b){console.log("Live2D %s",lt._$2s),lt._$6b=!1;!0,lt.initProfile()}},lt.getVersionStr=function(){return lt._$2s},lt.getVersionNo=function(){return lt._$Kr},lt._$sT=function(t){lt._$cT=t},lt.getError=function(){var t=lt._$cT;return lt._$cT=0,t},lt.dispose=function(){lt.glContext=[],lt.frameBuffers=[],lt.fTexture=[]},lt.setGL=function(t,e){var i=e||0;lt.glContext[i]=t},lt.getGL=function(t){return lt.glContext[t]},lt.setClippingMaskBufferSize=function(t){lt.clippingMaskBufferSize=t},lt.getClippingMaskBufferSize=function(){return lt.clippingMaskBufferSize},lt.deleteBuffer=function(t){lt.getGL(t).deleteFramebuffer(lt.frameBuffers[t].framebuffer),delete lt.frameBuffers[t],delete lt.glContext[t]},ut._$r2=function(t){return t<0?0:t>1?1:.5-.5*Math.cos(t*Pt.PI_F)},ht._$fr=-1,ht.prototype.toString=function(){return this._$ib},ct.prototype=new H,ct._$42=0,ct._$Os=30,ct._$ms=0,ct._$ns=1,ct._$_s=2,ct._$gT=new Array,ct.prototype._$_S=function(t){this._$LP=t},ct.prototype.getTextureNo=function(){return this._$LP},ct.prototype._$ZL=function(){return this._$Qi},ct.prototype._$H2=function(){return this._$JP},ct.prototype.getNumPoints=function(){return this._$d0},ct.prototype.getType=function(){return H._$wb},ct.prototype._$B2=function(t,e,i){var r=e,s=null!=r._$hr?r._$hr:r._$Cr;switch(O._$do){default:case O._$Ms:throw new Error("_$L _$ro ");case O._$Qs:for(var n=this._$d0-1;n>=0;--n){s[n*O._$No+4]=i}}},ct.prototype._$zP=function(){this._$GS=new F,this._$GS._$zP()},ct.prototype._$F0=function(t){H.prototype._$F0.call(this,t),this._$LP=t._$6L(),this._$d0=t._$6L(),this._$Yo=t._$6L();var e=t._$nP();this._$BP=new Int16Array(3*this._$Yo);for(var i=3*this._$Yo-1;i>=0;--i)this._$BP[i]=e[i];if(this._$Eo=t._$nP(),this._$Qi=t._$nP(),t.getFormatVersion()>=N._$s7){if(this._$JP=t._$6L(),0!=this._$JP){if(0!=(1&this._$JP)){var r=t._$6L();null==this._$5P&&(this._$5P=new Object),this._$5P._$Hb=parseInt(r)}0!=(this._$JP&ct._$Os)?this._$6s=(this._$JP&ct._$Os)>>1:this._$6s=ct._$ms,0!=(32&this._$JP)&&(this.culling=!1)}}else this._$JP=0},ct.prototype.init=function(t){var e=new _t(this),i=this._$d0*O._$No,r=this._$32();switch(null!=e._$Cr&&(e._$Cr=null),e._$Cr=new Float32Array(i),null!=e._$hr&&(e._$hr=null),e._$hr=r?new Float32Array(i):null,O._$do){default:case O._$Ms:if(O._$Ls)for(var s=this._$d0-1;s>=0;--s){var n=s<<1;this._$Qi[n+1]=1-this._$Qi[n+1]}break;case O._$Qs:for(s=this._$d0-1;s>=0;--s){n=s<<1;var o=s*O._$No,a=this._$Qi[n],l=this._$Qi[n+1];e._$Cr[o]=a,e._$Cr[o+1]=l,e._$Cr[o+4]=0,r&&(e._$hr[o]=a,e._$hr[o+1]=l,e._$hr[o+4]=0)}}return e},ct.prototype._$Nr=function(t,e){var i=e;if(this!=i._$GT()&&console.log("### assert!! ### "),this._$GS._$Ur(t)&&(H.prototype._$Nr.call(this,t,i),!i._$IS[0])){var r=ct._$gT;r[0]=!1,x._$Vr(t,this._$GS,r,this._$d0,this._$Eo,i._$Cr,O._$i2,O._$No)}},ct.prototype._$2b=function(t,e){try{this!=e._$GT()&&console.log("### assert!! ### ");var i=!1;e._$IS[0]&&(i=!0);var r=e;if(!i&&(H.prototype._$2b.call(this,t),this._$32())){var s=this.getTargetBaseDataID();if(r._$8r==H._$ur&&(r._$8r=t.getBaseDataIndex(s)),r._$8r<0)lt._$so&&a._$li("_$L _$0P _$G :: %s",s);else{var n=t.getBaseData(r._$8r),o=t._$q2(r._$8r);null==n||o._$x2()?r._$AT=!1:(n._$nb(t,o,r._$Cr,r._$hr,this._$d0,O._$i2,O._$No),r._$AT=!0),r.baseOpacity=o.getTotalOpacity()}}}catch(t){throw t}},ct.prototype.draw=function(t,e,i){if(this!=i._$GT()&&console.log("### assert!! ### "),!i._$IS[0]){var r=i,s=this._$LP;s<0&&(s=1);var n=this.getOpacity(e,r)*i._$VS*i.baseOpacity,o=null!=r._$hr?r._$hr:r._$Cr;t.setClipBufPre_clipContextForDraw(i.clipBufPre_clipContext),t._$WP(this.culling),t._$Uo(s,3*this._$Yo,this._$BP,o,this._$Qi,n,this._$6s,r)}},ct.prototype.dump=function(){console.log("  _$yi( %d ) , _$d0( %d ) , _$Yo( %d ) \n",this._$LP,this._$d0,this._$Yo),console.log("  _$Oi _$di = { ");for(var t=0;t<this._$BP.length;t++)console.log("%5d ,",this._$BP[t]);console.log("\n  _$5i _$30");for(t=0;t<this._$Eo.length;t++){console.log("\n    _$30[%d] = ",t);for(var e=this._$Eo[t],i=0;i<e.length;i++)console.log("%6.2f, ",e[i])}console.log("\n")},ct.prototype._$72=function(t){return null==this._$5P?null:this._$5P[t]},ct.prototype.getIndexArray=function(){return this._$BP},_t.prototype=new Ct,_t.prototype.getTransformedPoints=function(){return null!=this._$hr?this._$hr:this._$Cr},mt.prototype._$HT=function(t){this.x=t.x,this.y=t.y},mt.prototype._$HT=function(t,e){this.x=t,this.y=e},dt.prototype=new e,dt.loadModel=function(t){var i=new dt;return e._$62(i,t),i},dt.loadModel=function(t,i){var r=new dt(i||0);return e._$62(r,t),r},dt._$to=function(){return new dt},dt._$er=function(t){var e=new _$5("../_$_r/_$t0/_$Ri/_$_P._$d");if(0==e.exists())throw new _$ls("_$t0 _$_ _$6 _$Ui :: "+e._$PL());for(var i=["../_$_r/_$t0/_$Ri/_$_P.512/_$CP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$vP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$EP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$pP._$1"],r=dt.loadModel(e._$3b()),s=0;s<i.length;s++){var n=new _$5(i[s]);if(0==n.exists())throw new _$ls("_$t0 _$_ _$6 _$Ui :: "+n._$PL());r.setTexture(s,_$nL._$_o(t,n._$3b()))}return r},dt.prototype.setGL=function(t){lt.setGL(t)},dt.prototype.setTransform=function(t){this.drawParamWebGL.setTransform(t)},dt.prototype.update=function(){this._$5S.update(),this._$5S.preDraw(this.drawParamWebGL)},dt.prototype.draw=function(){this._$5S.draw(this.drawParamWebGL)},dt.prototype._$K2=function(){this.drawParamWebGL._$K2()},dt.prototype.setTexture=function(t,e){null==this.drawParamWebGL&&a._$li("_$Yi for QT _$ki / _$XS() is _$6 _$ui!!"),this.drawParamWebGL.setTexture(t,e)},dt.prototype.setTexture=function(t,e){null==this.drawParamWebGL&&a._$li("_$Yi for QT _$ki / _$XS() is _$6 _$ui!!"),this.drawParamWebGL.setTexture(t,e)},dt.prototype._$Rs=function(){return this.drawParamWebGL._$Rs()},dt.prototype._$Ds=function(t){this.drawParamWebGL._$Ds(t)},dt.prototype.getDrawParam=function(){return this.drawParamWebGL},dt.prototype.setMatrix=function(t){this.drawParamWebGL.setMatrix(t)},dt.prototype.setPremultipliedAlpha=function(t){this.drawParamWebGL.setPremultipliedAlpha(t)},dt.prototype.isPremultipliedAlpha=function(){return this.drawParamWebGL.isPremultipliedAlpha()},dt.prototype.setAnisotropy=function(t){this.drawParamWebGL.setAnisotropy(t)},dt.prototype.getAnisotropy=function(){return this.drawParamWebGL.getAnisotropy()},gt.prototype._$tb=function(){return this.motions},gt.prototype.startMotion=function(t,e){for(var i=null,r=this.motions.length,s=0;s<r;++s)null!=(i=this.motions[s])&&(i._$qS(i._$w0.getFadeOut()),this._$eb&&a._$Ji("MotionQueueManager[size:%2d]->startMotion() / start _$K _$3 (m%d)\n",r,i._$sr));if(null==t)return-1;(i=new pt)._$w0=t,this.motions.push(i);var n=i._$sr;return this._$eb&&a._$Ji("MotionQueueManager[size:%2d]->startMotion() / new _$w0 (m%d)\n",r,n),n},gt.prototype.updateParam=function(t){try{for(var e=!1,i=0;i<this.motions.length;i++){var r=this.motions[i];if(null!=r){var s=r._$w0;null!=s?(s.updateParam(t,r),e=!0,r.isFinished()&&(this._$eb&&a._$Ji("MotionQueueManager[size:%2d]->updateParam() / _$T0 _$w0 (m%d)\n",this.motions.length-1,r._$sr),this.motions.splice(i,1),i--)):(this.motions=this.motions.splice(i,1),i--)}else this.motions.splice(i,1),i--}return e}catch(t){return a._$li(t),!0}},gt.prototype.isFinished=function(t){if(arguments.length>=1){for(var e=0;e<this.motions.length;e++){if(null!=(i=this.motions[e])&&(i._$sr==t&&!i.isFinished()))return!1}return!0}for(e=0;e<this.motions.length;e++){var i;if(null!=(i=this.motions[e])){var r=i._$w0;if(null!=r){if(!i.isFinished())return!1}else this.motions.splice(e,1),e--}else this.motions.splice(e,1),e--}return!0},gt.prototype.stopAllMotions=function(){for(var t=0;t<this.motions.length;t++){var e=this.motions[t];if(null!=e){e._$w0;this.motions.splice(t,1),t--}else this.motions.splice(t,1),t--}},gt.prototype._$Zr=function(t){this._$eb=t},gt.prototype._$e=function(){console.log("-- _$R --\n");for(var t=0;t<this.motions.length;t++){var e=this.motions[t]._$w0;console.log("MotionQueueEnt[%d] :: %s\n",this.motions.length,e.toString())}},pt._$Gs=0,pt.prototype.isFinished=function(){return this._$9L},pt.prototype._$qS=function(t){var e=L.getUserTimeMSec()+t;(this._$Do<0||e<this._$Do)&&(this._$Do=e)},pt.prototype._$Bs=function(){return this._$sr},ft.prototype.setContext=function(t){var e=this.m;t.transform(e[0],e[1],e[3],e[4],e[6],e[7])},ft.prototype.toString=function(){for(var t="LDTransform { ",e=0;e<9;e++)t+=this.m[e].toFixed(2)+" ,";return t+=" }"},ft.prototype.identity=function(){var t=this.m;t[0]=t[4]=t[8]=1,t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0},ft.prototype._$PS=function(t,e,i){null==i&&(i=new Array(0,0));var r=this.m;return i[0]=r[0]*t+r[3]*e+r[6],i[1]=r[1]*t+r[4]*e+r[7],i},ft.prototype._$P2=function(t){t||(t=new ft);var e=this.m,i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],u=e[7],h=e[8],c=i*o*h+r*a*l+s*n*u-i*a*u-s*o*l-r*n*h;if(0==c)return null;var _=1/c;return t.m[0]=_*(o*h-u*a),t.m[1]=_*(u*s-r*h),t.m[2]=_*(r*a-o*s),t.m[3]=_*(l*a-n*h),t.m[4]=_*(i*h-l*s),t.m[5]=_*(n*s-i*a),t.m[6]=_*(n*u-l*o),t.m[7]=_*(l*r-i*u),t.m[8]=_*(i*o-n*r),t},ft.prototype.transform=function(t,e,i){null==i&&(i=new Array(0,0));var r=this.m;return i[0]=r[0]*t+r[3]*e+r[6],i[1]=r[1]*t+r[4]*e+r[7],i},ft.prototype.translate=function(t,e){var i=this.m;i[6]=i[0]*t+i[3]*e+i[6],i[7]=i[1]*t+i[4]*e+i[7],i[8]=i[2]*t+i[5]*e+i[8]},ft.prototype.scale=function(t,e){var i=this.m;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=e,i[4]*=e,i[5]*=e},ft.prototype.shear=function(t,e){var i=this.m,r=i[0]+i[3]*e,s=i[1]+i[4]*e,n=i[2]+i[5]*e;i[3]=i[0]*t+i[3],i[4]=i[1]*t+i[4],i[5]=i[2]*t+i[5],i[0]=r,i[1]=s,i[2]=n},ft.prototype.rotate=function(t){var e=this.m,i=Math.cos(t),r=Math.sin(t),s=e[0]*i+e[3]*r,n=e[1]*i+e[4]*r,o=e[2]*i+e[5]*r;e[3]=-e[0]*r+e[3]*i,e[4]=-e[1]*r+e[4]*i,e[5]=-e[2]*r+e[5]*i,e[0]=s,e[1]=n,e[2]=o},ft.prototype.concatenate=function(t){var e=this.m,i=t.m,r=e[0]*i[0]+e[3]*i[1]+e[6]*i[2],s=e[1]*i[0]+e[4]*i[1]+e[7]*i[2],n=e[2]*i[0]+e[5]*i[1]+e[8]*i[2],o=e[0]*i[3]+e[3]*i[4]+e[6]*i[5],a=e[1]*i[3]+e[4]*i[4]+e[7]*i[5],l=e[2]*i[3]+e[5]*i[4]+e[8]*i[5],u=e[0]*i[6]+e[3]*i[7]+e[6]*i[8],h=e[1]*i[6]+e[4]*i[7]+e[7]*i[8],c=e[2]*i[6]+e[5]*i[7]+e[8]*i[8];m[0]=r,m[1]=s,m[2]=n,m[3]=o,m[4]=a,m[5]=l,m[6]=u,m[7]=h,m[8]=c},yt.prototype=new rt,yt._$eT=null,yt._$tP=new Object,yt._$2o=function(){return null==yt._$eT&&(yt._$eT=yt.getID("DST_BASE")),yt._$eT},yt._$27=function(){yt._$tP.clear(),yt._$eT=null},yt.getID=function(t){var e=yt._$tP[t];return null==e&&(e=new yt(t),yt._$tP[t]=e),e},yt.prototype._$3s=function(){return new yt},$t.prototype=new w,$t._$9r=function(t){return new Float32Array(t)},$t._$vb=function(t){return new Int16Array(t)},$t._$cr=function(t,e){return null==t||t._$yL()<e.length?((t=$t._$9r(2*e.length)).put(e),t._$oT(0)):(t.clear(),t.put(e),t._$oT(0)),t},$t._$mb=function(t,e){return null==t||t._$yL()<e.length?((t=$t._$vb(2*e.length)).put(e),t._$oT(0)):(t.clear(),t.put(e),t._$oT(0)),t},$t._$Hs=function(){return this._$Gr},$t._$as=function(t){this._$Gr=t},$t.prototype.getGL=function(){return this.gl},$t.prototype.setGL=function(t){this.gl=t},$t.prototype.setTransform=function(t){this.transform=t},$t.prototype._$ZT=function(){var t=this.gl;this.firstDraw&&(this.initShader(),this.firstDraw=!1,this.anisotropyExt=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic"),this.anisotropyExt&&(this.maxAnisotropy=t.getParameter(this.anisotropyExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.DEPTH_TEST),t.frontFace(t.CW),t.enable(t.BLEND),t.colorMask(1,1,1,1),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},$t.prototype._$Uo=function(t,e,i,r,s,n,o,a){if(!(n<.01&&null==this.clipBufPre_clipContextMask)){n>.9&&lt.EXPAND_W;var l=this.gl;if(null==this.gl)throw new Error("gl is null");var u,h,c,_,m=1*this._$C0*n,d=1*this._$tT*n,g=1*this._$WL*n,p=this._$lT*n;if(null!=this.clipBufPre_clipContextMask){l.frontFace(l.CCW),l.useProgram(this.shaderProgram),this._$vS=bt(l,this._$vS,r),this._$no=St(l,this._$no,i),l.enableVertexAttribArray(this.a_position_Loc),l.vertexAttribPointer(this.a_position_Loc,2,l.FLOAT,!1,0,0),this._$NT=bt(l,this._$NT,s),l.activeTexture(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,this.textures[t]),l.uniform1i(this.s_texture0_Loc,1),l.enableVertexAttribArray(this.a_texCoord_Loc),l.vertexAttribPointer(this.a_texCoord_Loc,2,l.FLOAT,!1,0,0),l.uniformMatrix4fv(this.u_matrix_Loc,!1,this.getClipBufPre_clipContextMask().matrixForMask);var f=this.getClipBufPre_clipContextMask().layoutChannelNo,y=this.getChannelFlagAsColor(f);l.uniform4f(this.u_channelFlag,y.r,y.g,y.b,y.a);var $=this.getClipBufPre_clipContextMask().layoutBounds;l.uniform4f(this.u_baseColor_Loc,2*$.x-1,2*$.y-1,2*$._$EL()-1,2*$._$5T()-1),l.uniform1i(this.u_maskFlag_Loc,!0)}else if(null!=this.getClipBufPre_clipContextDraw()){l.useProgram(this.shaderProgramOff),this._$vS=bt(l,this._$vS,r),this._$no=St(l,this._$no,i),l.enableVertexAttribArray(this.a_position_Loc_Off),l.vertexAttribPointer(this.a_position_Loc_Off,2,l.FLOAT,!1,0,0),this._$NT=bt(l,this._$NT,s),l.activeTexture(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,this.textures[t]),l.uniform1i(this.s_texture0_Loc_Off,1),l.enableVertexAttribArray(this.a_texCoord_Loc_Off),l.vertexAttribPointer(this.a_texCoord_Loc_Off,2,l.FLOAT,!1,0,0),l.uniformMatrix4fv(this.u_clipMatrix_Loc_Off,!1,this.getClipBufPre_clipContextDraw().matrixForDraw),l.uniformMatrix4fv(this.u_matrix_Loc_Off,!1,this.matrix4x4),l.activeTexture(l.TEXTURE2),l.bindTexture(l.TEXTURE_2D,lt.fTexture[this.glno]),l.uniform1i(this.s_texture1_Loc_Off,2);f=this.getClipBufPre_clipContextDraw().layoutChannelNo,y=this.getChannelFlagAsColor(f);l.uniform4f(this.u_channelFlag_Loc_Off,y.r,y.g,y.b,y.a),l.uniform4f(this.u_baseColor_Loc_Off,m,d,g,p)}else l.useProgram(this.shaderProgram),this._$vS=bt(l,this._$vS,r),this._$no=St(l,this._$no,i),l.enableVertexAttribArray(this.a_position_Loc),l.vertexAttribPointer(this.a_position_Loc,2,l.FLOAT,!1,0,0),this._$NT=bt(l,this._$NT,s),l.activeTexture(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,this.textures[t]),l.uniform1i(this.s_texture0_Loc,1),l.enableVertexAttribArray(this.a_texCoord_Loc),l.vertexAttribPointer(this.a_texCoord_Loc,2,l.FLOAT,!1,0,0),l.uniformMatrix4fv(this.u_matrix_Loc,!1,this.matrix4x4),l.uniform4f(this.u_baseColor_Loc,m,d,g,p),l.uniform1i(this.u_maskFlag_Loc,!1);if(this.culling?this.gl.enable(l.CULL_FACE):this.gl.disable(l.CULL_FACE),this.gl.enable(l.BLEND),null!=this.clipBufPre_clipContextMask)u=l.ONE,h=l.ONE_MINUS_SRC_ALPHA,c=l.ONE,_=l.ONE_MINUS_SRC_ALPHA;else switch(o){case ct._$ms:u=l.ONE,h=l.ONE_MINUS_SRC_ALPHA,c=l.ONE,_=l.ONE_MINUS_SRC_ALPHA;break;case ct._$ns:u=l.ONE,h=l.ONE,c=l.ZERO,_=l.ONE;break;case ct._$_s:u=l.DST_COLOR,h=l.ONE_MINUS_SRC_ALPHA,c=l.ZERO,_=l.ONE}l.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),l.blendFuncSeparate(u,h,c,_),this.anisotropyExt&&l.texParameteri(l.TEXTURE_2D,this.anisotropyExt.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy);var b=i.length;l.drawElements(l.TRIANGLES,b,l.UNSIGNED_SHORT,0),l.bindTexture(l.TEXTURE_2D,null)}},$t.prototype._$Rs=function(){throw new Error("_$Rs")},$t.prototype._$Ds=function(t){throw new Error("_$Ds")},$t.prototype._$K2=function(){for(var t=0;t<this.textures.length;t++){0!=this.textures[t]&&(this.gl._$K2(1,this.textures,t),this.textures[t]=null)}},$t.prototype.setTexture=function(t,e){this.textures[t]=e},$t.prototype.initShader=function(){var t=this.gl;this.loadShaders2(),this.a_position_Loc=t.getAttribLocation(this.shaderProgram,"a_position"),this.a_texCoord_Loc=t.getAttribLocation(this.shaderProgram,"a_texCoord"),this.u_matrix_Loc=t.getUniformLocation(this.shaderProgram,"u_mvpMatrix"),this.s_texture0_Loc=t.getUniformLocation(this.shaderProgram,"s_texture0"),this.u_channelFlag=t.getUniformLocation(this.shaderProgram,"u_channelFlag"),this.u_baseColor_Loc=t.getUniformLocation(this.shaderProgram,"u_baseColor"),this.u_maskFlag_Loc=t.getUniformLocation(this.shaderProgram,"u_maskFlag"),this.a_position_Loc_Off=t.getAttribLocation(this.shaderProgramOff,"a_position"),this.a_texCoord_Loc_Off=t.getAttribLocation(this.shaderProgramOff,"a_texCoord"),this.u_matrix_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"u_mvpMatrix"),this.u_clipMatrix_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"u_ClipMatrix"),this.s_texture0_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"s_texture0"),this.s_texture1_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"s_texture1"),this.u_channelFlag_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"u_channelFlag"),this.u_baseColor_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"u_baseColor")},$t.prototype.disposeShader=function(){var t=this.gl;this.shaderProgram&&(t.deleteProgram(this.shaderProgram),this.shaderProgram=null),this.shaderProgramOff&&(t.deleteProgram(this.shaderProgramOff),this.shaderProgramOff=null)},$t.prototype.compileShader=function(t,e){var i=this.gl,r=e,s=i.createShader(t);if(null==s)return a._$Ji("_$L0 to create shader"),null;if(i.shaderSource(s,r),i.compileShader(s),!i.getShaderParameter(s,i.COMPILE_STATUS)){var n=i.getShaderInfoLog(s);return a._$Ji("_$L0 to compile shader : "+n),i.deleteShader(s),null}return s},$t.prototype.loadShaders2=function(){var t=this.gl;if(this.shaderProgram=t.createProgram(),!this.shaderProgram)return!1;if(this.shaderProgramOff=t.createProgram(),!this.shaderProgramOff)return!1;if(this.vertShader=this.compileShader(t.VERTEX_SHADER,"attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform mat4       u_mvpMatrix;void main(){    gl_Position = u_mvpMatrix * a_position;    v_ClipPos = u_mvpMatrix * a_position;    v_texCoord = a_texCoord;}"),!this.vertShader)return a._$Ji("Vertex shader compile _$li!"),!1;if(this.vertShaderOff=this.compileShader(t.VERTEX_SHADER,"attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform mat4       u_mvpMatrix;uniform mat4       u_ClipMatrix;void main(){    gl_Position = u_mvpMatrix * a_position;    v_ClipPos = u_ClipMatrix * a_position;    v_texCoord = a_texCoord ;}"),!this.vertShaderOff)return a._$Ji("OffVertex shader compile _$li!"),!1;if(this.fragShader=this.compileShader(t.FRAGMENT_SHADER,"precision mediump float;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform sampler2D  s_texture0;uniform vec4       u_channelFlag;uniform vec4       u_baseColor;uniform bool       u_maskFlag;void main(){    vec4 smpColor;     if(u_maskFlag){        float isInside =             step(u_baseColor.x, v_ClipPos.x/v_ClipPos.w)          * step(u_baseColor.y, v_ClipPos.y/v_ClipPos.w)          * step(v_ClipPos.x/v_ClipPos.w, u_baseColor.z)          * step(v_ClipPos.y/v_ClipPos.w, u_baseColor.w);        smpColor = u_channelFlag * texture2D(s_texture0 , v_texCoord).a * isInside;    }else{        smpColor = texture2D(s_texture0 , v_texCoord) * u_baseColor;    }    gl_FragColor = smpColor;}"),!this.fragShader)return a._$Ji("Fragment shader compile _$li!"),!1;if(this.fragShaderOff=this.compileShader(t.FRAGMENT_SHADER,"precision mediump float ;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_channelFlag;uniform vec4       u_baseColor ;void main(){    vec4 col_formask = texture2D(s_texture0, v_texCoord) * u_baseColor;    vec4 clipMask = texture2D(s_texture1, v_ClipPos.xy / v_ClipPos.w) * u_channelFlag;    float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;    col_formask = col_formask * maskVal;    gl_FragColor = col_formask;}"),!this.fragShaderOff)return a._$Ji("OffFragment shader compile _$li!"),!1;if(t.attachShader(this.shaderProgram,this.vertShader),t.attachShader(this.shaderProgram,this.fragShader),t.attachShader(this.shaderProgramOff,this.vertShaderOff),t.attachShader(this.shaderProgramOff,this.fragShaderOff),t.linkProgram(this.shaderProgram),t.linkProgram(this.shaderProgramOff),!t.getProgramParameter(this.shaderProgram,t.LINK_STATUS)){var e=t.getProgramInfoLog(this.shaderProgram);return a._$Ji("_$L0 to link program: "+e),this.vertShader&&(t.deleteShader(this.vertShader),this.vertShader=0),this.fragShader&&(t.deleteShader(this.fragShader),this.fragShader=0),this.shaderProgram&&(t.deleteProgram(this.shaderProgram),this.shaderProgram=0),this.vertShaderOff&&(t.deleteShader(this.vertShaderOff),this.vertShaderOff=0),this.fragShaderOff&&(t.deleteShader(this.fragShaderOff),this.fragShaderOff=0),this.shaderProgramOff&&(t.deleteProgram(this.shaderProgramOff),this.shaderProgramOff=0),!1}return!0},$t.prototype.createFramebuffer=function(){var t=this.gl,e=lt.clippingMaskBufferSize,i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i);var r=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,e,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,r);var s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,e,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),lt.fTexture[this.glno]=s,{framebuffer:i,renderbuffer:r,texture:lt.fTexture[this.glno]}},vt.prototype._$fP=function(){var t,e,i,r=this._$ST();if(0==(128&r))return 255&r;if(0==(128&(t=this._$ST())))return(127&r)<<7|127&t;if(0==(128&(e=this._$ST())))return(127&r)<<14|(127&t)<<7|255&e;if(0==(128&(i=this._$ST())))return(127&r)<<21|(127&t)<<14|(127&e)<<7|255&i;throw new ht("_$L _$0P  _")},vt.prototype.getFormatVersion=function(){return this._$S2},vt.prototype._$gr=function(t){this._$S2=t},vt.prototype._$3L=function(){return this._$fP()},vt.prototype._$mP=function(){return this._$zT(),this._$F+=8,this._$T.getFloat64(this._$F-8)},vt.prototype._$_T=function(){return this._$zT(),this._$F+=4,this._$T.getFloat32(this._$F-4)},vt.prototype._$6L=function(){return this._$zT(),this._$F+=4,this._$T.getInt32(this._$F-4)},vt.prototype._$ST=function(){return this._$zT(),this._$T.getInt8(this._$F++)},vt.prototype._$9T=function(){return this._$zT(),this._$F+=2,this._$T.getInt16(this._$F-2)},vt.prototype._$2T=function(){throw this._$zT(),this._$F+=8,new ht("_$L _$q read long")},vt.prototype._$po=function(){return this._$zT(),0!=this._$T.getInt8(this._$F++)};var xt=!0;function Pt(){}function Ct(e){t||(this._$e0=null,this._$IP=null,this._$Us=null,this._$7s=null,this._$IS=[!1],this._$VS=null,this._$AT=!0,this.baseOpacity=1,this.clipBufPre_clipContext=null,this._$e0=e)}function wt(){}vt.prototype._$bT=function(){this._$zT();var t=this._$3L(),e=null;if(xt)try{var i=new ArrayBuffer(2*t);e=new Uint16Array(i);for(var r=0;r<t;++r)e[r]=this._$T.getUint8(this._$F++);return String.fromCharCode.apply(null,e)}catch(t){xt=!1}try{var s=new Array;if(null==e)for(r=0;r<t;++r)s[r]=this._$T.getUint8(this._$F++);else for(r=0;r<t;++r)s[r]=e[r];return String.fromCharCode.apply(null,s)}catch(t){console.log("read utf8 / _$rT _$L0 !! : "+t)}},vt.prototype._$cS=function(){this._$zT();for(var t=this._$3L(),e=new Int32Array(t),i=0;i<t;i++)e[i]=this._$T.getInt32(this._$F),this._$F+=4;return e},vt.prototype._$Tb=function(){this._$zT();for(var t=this._$3L(),e=new Float32Array(t),i=0;i<t;i++)e[i]=this._$T.getFloat32(this._$F),this._$F+=4;return e},vt.prototype._$5b=function(){this._$zT();for(var t=this._$3L(),e=new Float64Array(t),i=0;i<t;i++)e[i]=this._$T.getFloat64(this._$F),this._$F+=8;return e},vt.prototype._$nP=function(){return this._$Jb(-1)},vt.prototype._$Jb=function(t){if(this._$zT(),t<0&&(t=this._$3L()),t==N._$7P){var e=this._$6L();if(0<=e&&e<this._$Ko.length)return this._$Ko[e];throw new ht("_$sL _$4i @_$m0")}var i=this._$4b(t);return this._$Ko.push(i),i},vt.prototype._$4b=function(t){if(0==t)return null;if(50==t){var e=this._$bT();return s=A.getID(e)}if(51==t){e=this._$bT();return s=yt.getID(e)}if(134==t){e=this._$bT();return s=h.getID(e)}if(60==t){e=this._$bT();return s=c.getID(e)}if(t>=48){var i=N._$9o(t);return null!=i?(i._$F0(this),i):null}switch(t){case 1:return this._$bT();case 10:return new n(this._$6L(),!0);case 11:return new v(this._$mP(),this._$mP(),this._$mP(),this._$mP());case 12:return new v(this._$_T(),this._$_T(),this._$_T(),this._$_T());case 13:return new P(this._$mP(),this._$mP());case 14:return new P(this._$_T(),this._$_T());case 15:for(var r=this._$3L(),s=new Array(r),o=0;o<r;o++)s[o]=this._$nP();return s;case 17:return s=new D(this._$mP(),this._$mP(),this._$mP(),this._$mP(),this._$mP(),this._$mP());case 21:return new u(this._$6L(),this._$6L(),this._$6L(),this._$6L());case 22:return new mt(this._$6L(),this._$6L());case 23:throw new Error("_$L _$ro ");case 16:case 25:return this._$cS();case 26:return this._$5b();case 27:return this._$Tb();case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 18:case 19:case 20:case 24:case 28:throw new ht("_$6 _$q : _$nP() of 2-9 ,18,19,20,24,28 : "+t);default:throw new ht("_$6 _$q : _$nP() NO _$i : "+t)}},vt.prototype._$8L=function(){return 0==this._$hL?this._$v0=this._$ST():8==this._$hL&&(this._$v0=this._$ST(),this._$hL=0),1==(this._$v0>>7-this._$hL++&1)},vt.prototype._$zT=function(){0!=this._$hL&&(this._$hL=0)},Pt._$2S=Math.PI/180,Pt._$bS=Math.PI/180,Pt._$wS=180/Math.PI,Pt._$NS=180/Math.PI,Pt.PI_F=Math.PI,Pt._$kT=[0,.012368,.024734,.037097,.049454,.061803,.074143,.086471,.098786,.111087,.12337,.135634,.147877,.160098,.172295,.184465,.196606,.208718,.220798,.232844,.244854,.256827,.268761,.280654,.292503,.304308,.316066,.327776,.339436,.351044,.362598,.374097,.385538,.396921,.408243,.419502,.430697,.441826,.452888,.463881,.474802,.485651,.496425,.507124,.517745,.528287,.538748,.549126,.559421,.56963,.579752,.589785,.599728,.609579,.619337,.629,.638567,.648036,.657406,.666676,.675843,.684908,.693867,.70272,.711466,.720103,.72863,.737045,.745348,.753536,.76161,.769566,.777405,.785125,.792725,.800204,.807561,.814793,.821901,.828884,.835739,.842467,.849066,.855535,.861873,.868079,.874153,.880093,.885898,.891567,.897101,.902497,.907754,.912873,.917853,.922692,.92739,.931946,.936359,.940629,.944755,.948737,.952574,.956265,.959809,.963207,.966457,.96956,.972514,.97532,.977976,.980482,.982839,.985045,.987101,.989006,.990759,.992361,.993811,.995109,.996254,.997248,.998088,.998776,.999312,.999694,.999924,1],Pt._$92=function(t,e){var i=Math.atan2(t[1],t[0]),r=Math.atan2(e[1],e[0]);return Pt._$tS(i,r)},Pt._$tS=function(t,e){for(var i=t-e;i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;return i},Pt._$9=function(t){return Math.sin(t)},Pt.fcos=function(t){return Math.cos(t)},Ct.prototype._$u2=function(){return this._$IS[0]},Ct.prototype._$yo=function(){return this._$AT&&!this._$IS[0]},Ct.prototype._$GT=function(){return this._$e0},wt._$W2=0,wt.SYSTEM_INFO=null,wt.USER_AGENT=navigator.userAgent,wt.isIPhone=function(){return wt.SYSTEM_INFO||wt.setup(),wt.SYSTEM_INFO._isIPhone},wt.isIOS=function(){return wt.SYSTEM_INFO||wt.setup(),wt.SYSTEM_INFO._isIPhone||wt.SYSTEM_INFO._isIPad},wt.isAndroid=function(){return wt.SYSTEM_INFO||wt.setup(),wt.SYSTEM_INFO._isAndroid},wt.getOSVersion=function(){return wt.SYSTEM_INFO||wt.setup(),wt.SYSTEM_INFO.version},wt.getOS=function(){return wt.SYSTEM_INFO||wt.setup(),wt.SYSTEM_INFO._isIPhone||wt.SYSTEM_INFO._isIPad?"iOS":wt.SYSTEM_INFO._isAndroid?"Android":"_$Q0 OS"},wt.setup=function(){var t,e=wt.USER_AGENT;function i(t,e){for(var i=t.substring(e).split(/[ _,;\.]/),r=0,s=0;s<=2&&!isNaN(i[s]);s++){var n=parseInt(i[s]);if(n<0||n>999){a._$li("err : "+n+" @UtHtml5.setup()"),r=0;break}r+=n*Math.pow(1e3,2-s)}return r}var r=wt.SYSTEM_INFO={userAgent:e};if((t=e.indexOf("iPhone OS "))>=0)r.os="iPhone",r._isIPhone=!0,r.version=i(e,t+"iPhone OS ".length);else if((t=e.indexOf("iPad"))>=0){if((t=e.indexOf("CPU OS"))<0)return void a._$li(" err : "+e+" @UtHtml5.setup()");r.os="iPad",r._isIPad=!0,r.version=i(e,t+"CPU OS ".length)}else(t=e.indexOf("Android"))>=0?(r.os="Android",r._isAndroid=!0,r.version=i(e,t+"Android ".length)):(r.os="-",r.version=-1)},window.UtSystem=L,window.UtDebug=a,window.LDTransform=ft,window.LDGL=nt,window.Live2D=lt,window.Live2DModelWebGL=dt,window.Live2DModelJS=K,window.Live2DMotion=J,window.MotionQueueManager=gt,window.PhysicsHair=d,window.AMotion=o,window.PartsDataID=h,window.DrawDataID=A,window.BaseDataID=yt,window.ParamID=c,lt.init();t=!1}()},"./src/DbCache.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{ClearDb:()=>n,DbCache:()=>s,db:()=>o});var r=i("./node_modules/dexie/dist/modern/dexie.mjs");class s extends r.default{constructor(){super("Live2D-JWF"),this.version(1).stores({mocJson:"++id, [name+key]"})}}function n(){o.delete()}const o=new s},"./src/Framework/cubismdefaultparameterid.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismDefaultParameterId:()=>s,Live2DCubismFramework:()=>n});var r=i("./src/Framework/cubismdefaultparameterid.ts");const s=Object.freeze({HitAreaPrefix:"HitArea",HitAreaHead:"Head",HitAreaBody:"Body",PartsIdCore:"Parts01Core",PartsArmPrefix:"Parts01Arm_",PartsArmLPrefix:"Parts01ArmL_",PartsArmRPrefix:"Parts01ArmR_",ParamAngleX:"ParamAngleX",ParamAngleY:"ParamAngleY",ParamAngleZ:"ParamAngleZ",ParamEyeLOpen:"ParamEyeLOpen",ParamEyeLSmile:"ParamEyeLSmile",ParamEyeROpen:"ParamEyeROpen",ParamEyeRSmile:"ParamEyeRSmile",ParamEyeBallX:"ParamEyeBallX",ParamEyeBallY:"ParamEyeBallY",ParamEyeBallForm:"ParamEyeBallForm",ParamBrowLY:"ParamBrowLY",ParamBrowRY:"ParamBrowRY",ParamBrowLX:"ParamBrowLX",ParamBrowRX:"ParamBrowRX",ParamBrowLAngle:"ParamBrowLAngle",ParamBrowRAngle:"ParamBrowRAngle",ParamBrowLForm:"ParamBrowLForm",ParamBrowRForm:"ParamBrowRForm",ParamMouthForm:"ParamMouthForm",ParamMouthOpenY:"ParamMouthOpenY",ParamCheek:"ParamCheek",ParamBodyAngleX:"ParamBodyAngleX",ParamBodyAngleY:"ParamBodyAngleY",ParamBodyAngleZ:"ParamBodyAngleZ",ParamBreath:"ParamBreath",ParamArmLA:"ParamArmLA",ParamArmRA:"ParamArmRA",ParamArmLB:"ParamArmLB",ParamArmRB:"ParamArmRB",ParamHandL:"ParamHandL",ParamHandR:"ParamHandR",ParamHairFront:"ParamHairFront",ParamHairSide:"ParamHairSide",ParamHairBack:"ParamHairBack",ParamHairFluffy:"ParamHairFluffy",ParamShoulderY:"ParamShoulderY",ParamBustX:"ParamBustX",ParamBustY:"ParamBustY",ParamBaseX:"ParamBaseX",ParamBaseY:"ParamBaseY",ParamNONE:"NONE:"});var n;!function(t){t.HitAreaBody=r.CubismDefaultParameterId.HitAreaBody,t.HitAreaHead=r.CubismDefaultParameterId.HitAreaHead,t.HitAreaPrefix=r.CubismDefaultParameterId.HitAreaPrefix,t.ParamAngleX=r.CubismDefaultParameterId.ParamAngleX,t.ParamAngleY=r.CubismDefaultParameterId.ParamAngleY,t.ParamAngleZ=r.CubismDefaultParameterId.ParamAngleZ,t.ParamArmLA=r.CubismDefaultParameterId.ParamArmLA,t.ParamArmLB=r.CubismDefaultParameterId.ParamArmLB,t.ParamArmRA=r.CubismDefaultParameterId.ParamArmRA,t.ParamArmRB=r.CubismDefaultParameterId.ParamArmRB,t.ParamBaseX=r.CubismDefaultParameterId.ParamBaseX,t.ParamBaseY=r.CubismDefaultParameterId.ParamBaseY,t.ParamBodyAngleX=r.CubismDefaultParameterId.ParamBodyAngleX,t.ParamBodyAngleY=r.CubismDefaultParameterId.ParamBodyAngleY,t.ParamBodyAngleZ=r.CubismDefaultParameterId.ParamBodyAngleZ,t.ParamBreath=r.CubismDefaultParameterId.ParamBreath,t.ParamBrowLAngle=r.CubismDefaultParameterId.ParamBrowLAngle,t.ParamBrowLForm=r.CubismDefaultParameterId.ParamBrowLForm,t.ParamBrowLX=r.CubismDefaultParameterId.ParamBrowLX,t.ParamBrowLY=r.CubismDefaultParameterId.ParamBrowLY,t.ParamBrowRAngle=r.CubismDefaultParameterId.ParamBrowRAngle,t.ParamBrowRForm=r.CubismDefaultParameterId.ParamBrowRForm,t.ParamBrowRX=r.CubismDefaultParameterId.ParamBrowRX,t.ParamBrowRY=r.CubismDefaultParameterId.ParamBrowRY,t.ParamBustX=r.CubismDefaultParameterId.ParamBustX,t.ParamBustY=r.CubismDefaultParameterId.ParamBustY,t.ParamCheek=r.CubismDefaultParameterId.ParamCheek,t.ParamEyeBallForm=r.CubismDefaultParameterId.ParamEyeBallForm,t.ParamEyeBallX=r.CubismDefaultParameterId.ParamEyeBallX,t.ParamEyeBallY=r.CubismDefaultParameterId.ParamEyeBallY,t.ParamEyeLOpen=r.CubismDefaultParameterId.ParamEyeLOpen,t.ParamEyeLSmile=r.CubismDefaultParameterId.ParamEyeLSmile,t.ParamEyeROpen=r.CubismDefaultParameterId.ParamEyeROpen,t.ParamEyeRSmile=r.CubismDefaultParameterId.ParamEyeRSmile,t.ParamHairBack=r.CubismDefaultParameterId.ParamHairBack,t.ParamHairFluffy=r.CubismDefaultParameterId.ParamHairFluffy,t.ParamHairFront=r.CubismDefaultParameterId.ParamHairFront,t.ParamHairSide=r.CubismDefaultParameterId.ParamHairSide,t.ParamHandL=r.CubismDefaultParameterId.ParamHandL,t.ParamHandR=r.CubismDefaultParameterId.ParamHandR,t.ParamMouthForm=r.CubismDefaultParameterId.ParamMouthForm,t.ParamMouthOpenY=r.CubismDefaultParameterId.ParamMouthOpenY,t.ParamNONE=r.CubismDefaultParameterId.ParamNONE,t.ParamShoulderY=r.CubismDefaultParameterId.ParamShoulderY,t.PartsArmLPrefix=r.CubismDefaultParameterId.PartsArmLPrefix,t.PartsArmPrefix=r.CubismDefaultParameterId.PartsArmPrefix,t.PartsArmRPrefix=r.CubismDefaultParameterId.PartsArmRPrefix,t.PartsIdCore=r.CubismDefaultParameterId.PartsIdCore}(n||(n={}))},"./src/Framework/cubismframeworkconfig.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CSM_LOG_LEVEL:()=>u,CSM_LOG_LEVEL_DEBUG:()=>s,CSM_LOG_LEVEL_ERROR:()=>a,CSM_LOG_LEVEL_INFO:()=>n,CSM_LOG_LEVEL_OFF:()=>l,CSM_LOG_LEVEL_VERBOSE:()=>r,CSM_LOG_LEVEL_WARNING:()=>o});const r=0,s=1,n=2,o=3,a=4,l=5,u=r},"./src/Framework/cubismmodelsettingjson.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismModelSettingJson:()=>b,Live2DCubismFramework:()=>$});var r=i("./src/Framework/icubismmodelsetting.ts"),s=i("./src/Framework/live2dcubismframework.ts"),n=i("./src/Framework/type/csmvector.ts"),o=i("./src/Framework/utils/cubismjson.ts"),a=i("./src/Framework/cubismmodelsettingjson.ts");const l="FileReferences",u="UserData",h="Name",c="File",_="Ids",m="Sound",d="FadeInTime",g="FadeOutTime",p="LipSync",f="EyeBlink";var y,$;!function(t){t[t.FrequestNode_Groups=0]="FrequestNode_Groups",t[t.FrequestNode_Moc=1]="FrequestNode_Moc",t[t.FrequestNode_Motions=2]="FrequestNode_Motions",t[t.FrequestNode_Expressions=3]="FrequestNode_Expressions",t[t.FrequestNode_Textures=4]="FrequestNode_Textures",t[t.FrequestNode_Physics=5]="FrequestNode_Physics",t[t.FrequestNode_Pose=6]="FrequestNode_Pose",t[t.FrequestNode_HitAreas=7]="FrequestNode_HitAreas"}(y||(y={}));class b extends r.ICubismModelSetting{constructor(t,e){super(),this._json=o.CubismJson.create(t,e),this._json&&(this._jsonValue=new n.csmVector,this._jsonValue.pushBack(this._json.getRoot().getValueByString("Groups")),this._jsonValue.pushBack(this._json.getRoot().getValueByString(l).getValueByString("Moc")),this._jsonValue.pushBack(this._json.getRoot().getValueByString(l).getValueByString("Motions")),this._jsonValue.pushBack(this._json.getRoot().getValueByString(l).getValueByString("Expressions")),this._jsonValue.pushBack(this._json.getRoot().getValueByString(l).getValueByString("Textures")),this._jsonValue.pushBack(this._json.getRoot().getValueByString(l).getValueByString("Physics")),this._jsonValue.pushBack(this._json.getRoot().getValueByString(l).getValueByString("Pose")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("HitAreas")))}release(){o.CubismJson.delete(this._json),this._jsonValue=null}GetJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(y.FrequestNode_Moc).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(y.FrequestNode_Textures).getSize():0}getTextureDirectory(){const t=this._jsonValue.at(y.FrequestNode_Textures).getValueByIndex(0).getRawString().split("/"),e=t.length-1;let i="";for(let r=0;r<e;r++)i+=t[r],r<e-1&&(i+="/");return i}getTextureFileName(t){return this._jsonValue.at(y.FrequestNode_Textures).getValueByIndex(t).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(y.FrequestNode_HitAreas).getSize():0}getHitAreaId(t){return s.CubismFramework.getIdManager().getId(this._jsonValue.at(y.FrequestNode_HitAreas).getValueByIndex(t).getValueByString("Id").getRawString())}getHitAreaName(t){return this._jsonValue.at(y.FrequestNode_HitAreas).getValueByIndex(t).getValueByString(h).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(y.FrequestNode_Physics).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(y.FrequestNode_Pose).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(y.FrequestNode_Expressions).getSize():0}getExpressionName(t){return this._jsonValue.at(y.FrequestNode_Expressions).getValueByIndex(t).getValueByString(h).getRawString()}getExpressionFileName(t){return this._jsonValue.at(y.FrequestNode_Expressions).getValueByIndex(t).getValueByString(c).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(y.FrequestNode_Motions).getKeys().getSize():0}getMotionGroupName(t){return this.isExistMotionGroups()?this._jsonValue.at(y.FrequestNode_Motions).getKeys().at(t):null}getMotionCount(t){return this.isExistMotionGroupName(t)?this._jsonValue.at(y.FrequestNode_Motions).getValueByString(t).getSize():0}getMotionFileName(t,e){return this.isExistMotionGroupName(t)?this._jsonValue.at(y.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(c).getRawString():""}getMotionSoundFileName(t,e){return this.isExistMotionSoundFile(t,e)?this._jsonValue.at(y.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(m).getRawString():""}getMotionFadeInTimeValue(t,e){return this.isExistMotionFadeIn(t,e)?this._jsonValue.at(y.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(d).toFloat():-1}getMotionFadeOutTimeValue(t,e){return this.isExistMotionFadeOut(t,e)?this._jsonValue.at(y.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(g).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this._json.getRoot().getValueByString(l).getValueByString(u).getRawString():""}getLayoutMap(t){const e=this._json.getRoot().getValueByString("Layout").getMap();if(null==e)return!1;let i=!1;for(const r=e.begin();r.notEqual(e.end());r.preIncrement())t.setValue(r.ptr().first,r.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(y.FrequestNode_Groups).getSize();e++){const i=this._jsonValue.at(y.FrequestNode_Groups).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&i.getValueByString(h).getRawString()==f){t=i.getValueByString(_).getVector().getSize();break}}return t}getEyeBlinkParameterId(t){if(!this.isExistEyeBlinkParameters())return null;for(let e=0;e<this._jsonValue.at(y.FrequestNode_Groups).getSize();e++){const i=this._jsonValue.at(y.FrequestNode_Groups).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&i.getValueByString(h).getRawString()==f)return s.CubismFramework.getIdManager().getId(i.getValueByString(_).getValueByIndex(t).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(y.FrequestNode_Groups).getSize();e++){const i=this._jsonValue.at(y.FrequestNode_Groups).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&i.getValueByString(h).getRawString()==p){t=i.getValueByString(_).getVector().getSize();break}}return t}getLipSyncParameterId(t){if(!this.isExistLipSyncParameters())return null;for(let e=0;e<this._jsonValue.at(y.FrequestNode_Groups).getSize();e++){const i=this._jsonValue.at(y.FrequestNode_Groups).getValueByIndex(e);if(!i.isNull()&&!i.isError()&&i.getValueByString(h).getRawString()==p)return s.CubismFramework.getIdManager().getId(i.getValueByString(_).getValueByIndex(t).getRawString())}return null}isExistModelFile(){const t=this._jsonValue.at(y.FrequestNode_Moc);return!t.isNull()&&!t.isError()}isExistTextureFiles(){const t=this._jsonValue.at(y.FrequestNode_Textures);return!t.isNull()&&!t.isError()}isExistHitAreas(){const t=this._jsonValue.at(y.FrequestNode_HitAreas);return!t.isNull()&&!t.isError()}isExistPhysicsFile(){const t=this._jsonValue.at(y.FrequestNode_Physics);return!t.isNull()&&!t.isError()}isExistPoseFile(){const t=this._jsonValue.at(y.FrequestNode_Pose);return!t.isNull()&&!t.isError()}isExistExpressionFile(){const t=this._jsonValue.at(y.FrequestNode_Expressions);return!t.isNull()&&!t.isError()}isExistMotionGroups(){const t=this._jsonValue.at(y.FrequestNode_Motions);return!t.isNull()&&!t.isError()}isExistMotionGroupName(t){const e=this._jsonValue.at(y.FrequestNode_Motions).getValueByString(t);return!e.isNull()&&!e.isError()}isExistMotionSoundFile(t,e){const i=this._jsonValue.at(y.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(m);return!i.isNull()&&!i.isError()}isExistMotionFadeIn(t,e){const i=this._jsonValue.at(y.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(d);return!i.isNull()&&!i.isError()}isExistMotionFadeOut(t,e){const i=this._jsonValue.at(y.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString(g);return!i.isNull()&&!i.isError()}isExistUserDataFile(){const t=this._json.getRoot().getValueByString(l).getValueByString(u);return!t.isNull()&&!t.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(y.FrequestNode_Groups).isNull()||this._jsonValue.at(y.FrequestNode_Groups).isError())return!1;for(let t=0;t<this._jsonValue.at(y.FrequestNode_Groups).getSize();++t)if(this._jsonValue.at(y.FrequestNode_Groups).getValueByIndex(t).getValueByString(h).getRawString()==f)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(y.FrequestNode_Groups).isNull()||this._jsonValue.at(y.FrequestNode_Groups).isError())return!1;for(let t=0;t<this._jsonValue.at(y.FrequestNode_Groups).getSize();++t)if(this._jsonValue.at(y.FrequestNode_Groups).getValueByIndex(t).getValueByString(h).getRawString()==p)return!0;return!1}}!function(t){t.CubismModelSettingJson=a.CubismModelSettingJson}($||($={}))},"./src/Framework/effect/cubismbreath.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{BreathParameterData:()=>o,CubismBreath:()=>n,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/effect/cubismbreath.ts");class n{constructor(){this._currentTime=0}static create(){return new n}static delete(t){null!=t&&(t=null)}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=2*this._currentTime*3.14159;for(let e=0;e<this._breathParameters.getSize();++e){const r=this._breathParameters.at(e);t.addParameterValueById(r.parameterId,r.offset+r.peak*Math.sin(i/r.cycle),r.weight)}}}class o{constructor(t,e,i,r,s){this.parameterId=null==t?null:t,this.offset=null==e?0:e,this.peak=null==i?0:i,this.cycle=null==r?0:r,this.weight=null==s?0:s}}!function(t){t.BreathParameterData=s.BreathParameterData,t.CubismBreath=s.CubismBreath}(r||(r={}))},"./src/Framework/effect/cubismeyeblink.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismEyeBlink:()=>a,EyeState:()=>r,Live2DCubismFramework:()=>s});var r,s,n=i("./src/Framework/type/csmvector.ts"),o=i("./src/Framework/effect/cubismeyeblink.ts");class a{constructor(t){if(this._blinkingState=r.EyeState_First,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new n.csmVector,null!=t)for(let e=0;e<t.getEyeBlinkParameterCount();++e)this._parameterIds.pushBack(t.getEyeBlinkParameterId(e))}static create(t=null){return new a(t)}static delete(t){null!=t&&(t=null)}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,e){let i;this._userTimeSeconds+=e;let s=0;switch(this._blinkingState){case r.EyeState_Closing:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,s>=1&&(s=1,this._blinkingState=r.EyeState_Closed,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-s;break;case r.EyeState_Closed:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,s>=1&&(this._blinkingState=r.EyeState_Opening,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case r.EyeState_Opening:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,s>=1&&(s=1,this._blinkingState=r.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=s;break;case r.EyeState_Interval:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=r.EyeState_Closing,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;case r.EyeState_First:default:this._blinkingState=r.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1}a.CloseIfZero||(i=-i);for(let e=0;e<this._parameterIds.getSize();++e)t.setParameterValueById(this._parameterIds.at(e),i)}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}}a.CloseIfZero=!0,function(t){t[t.EyeState_First=0]="EyeState_First",t[t.EyeState_Interval=1]="EyeState_Interval",t[t.EyeState_Closing=2]="EyeState_Closing",t[t.EyeState_Closed=3]="EyeState_Closed",t[t.EyeState_Opening=4]="EyeState_Opening"}(r||(r={})),function(t){t.CubismEyeBlink=o.CubismEyeBlink,t.EyeState=o.EyeState}(s||(s={}))},"./src/Framework/effect/cubismpose.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismPose:()=>u,Live2DCubismFramework:()=>c,PartData:()=>h});var r=i("./src/Framework/live2dcubismframework.ts"),s=i("./src/Framework/type/csmvector.ts"),n=i("./src/Framework/utils/cubismjson.ts"),o=i("./src/Framework/effect/cubismpose.ts");const a="FadeInTime",l="Link";class u{constructor(){this._fadeTimeSeconds=.5,this._lastModel=null,this._partGroups=new s.csmVector,this._partGroupCounts=new s.csmVector}static create(t,e){const i=new u,s=n.CubismJson.create(t,e),o=s.getRoot();o.getValueByString(a).isNull()||(i._fadeTimeSeconds=o.getValueByString(a).toFloat(.5),i._fadeTimeSeconds<=0&&(i._fadeTimeSeconds=.5));const c=o.getValueByString("Groups"),_=c.getSize();for(let t=0;t<_;++t){const e=c.getValueByIndex(t),s=e.getSize();let n=0;for(let t=0;t<s;++t){const s=e.getValueByIndex(t),o=new h,a=r.CubismFramework.getIdManager().getId(s.getValueByString("Id").getRawString());if(o.partId=a,!s.getValueByString(l).isNull()){const t=s.getValueByString(l),e=t.getSize();for(let i=0;i<e;++i){const e=new h,s=r.CubismFramework.getIdManager().getId(t.getValueByIndex(i).getString());e.partId=s,o.link.pushBack(e)}}i._partGroups.pushBack(o.clone()),++n}i._partGroupCounts.pushBack(n)}return n.CubismJson.delete(s),i}static delete(t){null!=t&&(t=null)}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let r=0;r<this._partGroupCounts.getSize();r++){const s=this._partGroupCounts.at(r);this.doFade(t,e,i,s),i+=s}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.getSize();++i){const r=this._partGroupCounts.at(i);for(let i=e;i<e+r;++i){this._partGroups.at(i).initialize(t);const r=this._partGroups.at(i).partIndex,s=this._partGroups.at(i).parameterIndex;if(!(r<0)){t.setPartOpacityByIndex(r,i==e?1:0),t.setParameterValueByIndex(s,i==e?1:0);for(let e=0;e<this._partGroups.at(i).link.getSize();++e)this._partGroups.at(i).link.at(e).initialize(t)}}e+=r}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){const i=this._partGroups.at(e);if(0==i.link.getSize())continue;const r=this._partGroups.at(e).partIndex,s=t.getPartOpacityByIndex(r);for(let e=0;e<i.link.getSize();++e){const r=i.link.at(e).partIndex;r<0||t.setPartOpacityByIndex(r,s)}}}doFade(t,e,i,r){let s=-1,n=1;const o=.5;for(let o=i;o<i+r;++o){const i=this._partGroups.at(o).partIndex,r=this._partGroups.at(o).parameterIndex;if(t.getParameterValueByIndex(r)>.001){if(s>=0)break;s=o,n=t.getPartOpacityByIndex(i),n+=e/this._fadeTimeSeconds,n>1&&(n=1)}}s<0&&(s=0,n=1);for(let e=i;e<i+r;++e){const i=this._partGroups.at(e).partIndex;if(s==e)t.setPartOpacityByIndex(i,n);else{let e,r=t.getPartOpacityByIndex(i);e=n<o?-.5*n/o+1:(1-n)*o/.5;(1-e)*(1-n)>.15&&(e=1-.15/(1-n)),r>e&&(r=e),t.setPartOpacityByIndex(i,r)}}}}class h{constructor(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new s.csmVector,null!=t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new h;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new s.csmVector;for(let e=this.link.begin();e.notEqual(this.link.end());e.increment())t.link.pushBack(e.ptr().clone());return t}}var c;!function(t){t.CubismPose=o.CubismPose,t.PartData=o.PartData}(c||(c={}))},"./src/Framework/icubismmodelsetting.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{ICubismModelSetting:()=>n,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/icubismmodelsetting.ts");class n{}!function(t){t.ICubismModelSetting=s.ICubismModelSetting}(r||(r={}))},"./src/Framework/id/cubismid.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismId:()=>o,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/type/csmstring.ts"),n=i("./src/Framework/id/cubismid.ts");class o{constructor(t){this._id="string"!=typeof t?t:new s.csmString(t)}getString(){return this._id}isEqual(t){return"string"==typeof t?this._id.isEqual(t):t instanceof s.csmString?this._id.isEqual(t.s):t instanceof o&&this._id.isEqual(t._id.s)}isNotEqual(t){return"string"==typeof t?!this._id.isEqual(t):t instanceof s.csmString?!this._id.isEqual(t.s):t instanceof o&&!this._id.isEqual(t._id.s)}}!function(t){t.CubismId=n.CubismId}(r||(r={}))},"./src/Framework/id/cubismidmanager.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismIdManager:()=>a,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/type/csmvector.ts"),n=i("./src/Framework/id/cubismid.ts"),o=i("./src/Framework/id/cubismidmanager.ts");class a{constructor(){this._ids=new s.csmVector}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(t){let e=null;return"string"!=typeof t?this.registerId(t.s):(null!=(e=this.findId(t))||(e=new n.CubismId(t),this._ids.pushBack(e)),e)}getId(t){return this.registerId(t)}isExist(t){return"string"==typeof t?null!=this.findId(t):this.isExist(t.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}}!function(t){t.CubismIdManager=o.CubismIdManager}(r||(r={}))},"./src/Framework/live2dcubismframework.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{Constant:()=>m,CubismFramework:()=>g,Live2DCubismFramework:()=>y,LogLevel:()=>f,Option:()=>p,csmDelete:()=>d,strtod:()=>l});var r=i("./src/Framework/id/cubismidmanager.ts"),s=i("./src/Framework/rendering/cubismrenderer.ts"),n=i("./src/Framework/utils/cubismdebug.ts"),o=i("./src/Framework/utils/cubismjson.ts"),a=i("./src/Framework/live2dcubismframework.ts");function l(t,e){let i=0;for(let e=1;;e++){const r=t.slice(e-1,e);if("e"==r||"-"==r||"E"==r)continue;const s=t.substring(0,e),n=Number(s);if(isNaN(n))break;i=e}let r=parseFloat(t);return isNaN(r)&&(r=NaN),e[0]=t.slice(i),r}let u=!1,h=!1,c=null,_=null;const m=Object.freeze({vertexOffset:0,vertexStep:2});function d(t){t&&(t=void 0)}class g{static startUp(t=null){if(u)return(0,n.CubismLogInfo)("CubismFramework.startUp() is already done."),u;if(c=t,null!=c&&Live2DCubismCore.Logging.csmSetLogFunction(c.logFunction),u=!0,u){const t=Live2DCubismCore.Version.csmGetVersion(),e=(4278190080&t)>>24,i=(16711680&t)>>16,r=65535&t,s=t;(0,n.CubismLogInfo)("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+e).slice(-2),("00"+i).slice(-2),("0000"+r).slice(-4),s)}return(0,n.CubismLogInfo)("CubismFramework.startUp() is complete."),u}static cleanUp(){u=!1,h=!1,c=null,_=null}static initialize(){(0,n.CSM_ASSERT)(u),u?h?(0,n.CubismLogWarning)("CubismFramework.initialize() skipped, already initialized."):(o.Value.staticInitializeNotForClientCall(),_=new r.CubismIdManager,h=!0,(0,n.CubismLogInfo)("CubismFramework.initialize() is complete.")):(0,n.CubismLogWarning)("CubismFramework is not started.")}static dispose(){(0,n.CSM_ASSERT)(u),u?h?(o.Value.staticReleaseNotForClientCall(),_.release(),_=null,s.CubismRenderer.staticRelease(),h=!1,(0,n.CubismLogInfo)("CubismFramework.dispose() is complete.")):(0,n.CubismLogWarning)("CubismFramework.dispose() skipped, not initialized."):(0,n.CubismLogWarning)("CubismFramework is not started.")}static isStarted(){return u}static isInitialized(){return h}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return null!=c?c.loggingLevel:f.LogLevel_Off}static getIdManager(){return _}constructor(){}}class p{}var f,y;!function(t){t[t.LogLevel_Verbose=0]="LogLevel_Verbose",t[t.LogLevel_Debug=1]="LogLevel_Debug",t[t.LogLevel_Info=2]="LogLevel_Info",t[t.LogLevel_Warning=3]="LogLevel_Warning",t[t.LogLevel_Error=4]="LogLevel_Error",t[t.LogLevel_Off=5]="LogLevel_Off"}(f||(f={})),function(t){t.Constant=a.Constant,t.csmDelete=a.csmDelete,t.CubismFramework=a.CubismFramework}(y||(y={}))},"./src/Framework/math/cubismmath.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismMath:()=>o,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/math/cubismvector2.ts"),n=i("./src/Framework/math/cubismmath.ts");class o{constructor(){}static range(t,e,i){return t<e?t=e:t>i&&(t=i),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(0===t)return t;let e=t;const i=e<0;let r;return i&&(e=-e),e===1/0?r=1/0:(r=Math.exp(Math.log(e)/3),r=(e/(r*r)+2*r)/3),i?-r:r}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return 180*t/Math.PI}static directionToRadian(t,e){let i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);for(;i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;return i}static directionToDegrees(t,e){const i=this.directionToRadian(t,e);let r=this.radianToDegrees(i);return e.x-t.x>0&&(r=-r),r}static radianToDirection(t){const e=new s.CubismVector2;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(t,e,i){return this.abs(t)<o.Epsilon?this.abs(e)<o.Epsilon?-i:-i/e:-(e+this.sqrt(e*e-4*t*i))/(2*t)}static cardanoAlgorithmForBezier(t,e,i,r){if(this.sqrt(t)<o.Epsilon)return this.range(this.quadraticEquation(e,i,r),0,1);const s=e/t,n=i/t,a=(3*n-s*s)/3,l=a/3,u=(2*s*s*s-9*s*n+27*(r/t))/27,h=u/2,c=h*h+l*l*l,_=.5,m=.51;if(c<0){const t=-a/3,e=t*t*t,i=this.sqrt(e),r=-u/(2*i),n=this.range(r,-1,1),o=Math.acos(n),l=2*this.cbrt(i),h=l*this.cos(o/3)-s/3;if(this.abs(h-_)<m)return this.range(h,0,1);const c=l*this.cos((o+2*Math.PI)/3)-s/3;if(this.abs(c-_)<m)return this.range(c,0,1);const d=l*this.cos((o+4*Math.PI)/3)-s/3;return this.range(d,0,1)}if(0==c){let t;t=h<0?this.cbrt(-h):-this.cbrt(h);const e=2*t-s/3;if(this.abs(e-_)<m)return this.range(e,0,1);const i=-t-s/3;return this.range(i,0,1)}const d=this.sqrt(c),g=this.cbrt(d-h)-this.cbrt(d+h)-s/3;return this.range(g,0,1)}}o.Epsilon=1e-5,function(t){t.CubismMath=n.CubismMath}(r||(r={}))},"./src/Framework/math/cubismmatrix44.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismMatrix44:()=>n,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/math/cubismmatrix44.ts");class n{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const r=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let i=0;i<4;++i)for(let s=0;s<4;++s)for(let n=0;n<4;++n)r[s+4*i]+=t[n+4*i]*e[s+4*n];for(let t=0;t<16;++t)i[t]=r[t]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);n.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);n.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){n.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new n;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}!function(t){t.CubismMatrix44=s.CubismMatrix44}(r||(r={}))},"./src/Framework/math/cubismmodelmatrix.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismModelMatrix:()=>o,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/math/cubismmatrix44.ts"),n=i("./src/Framework/math/cubismmodelmatrix.ts");class o extends s.CubismMatrix44{constructor(t,e){super(),this._width=void 0!==t?t:0,this._height=void 0!==e?e:0,this.setHeight(2)}setWidth(t){const e=t/this._width,i=e;this.scale(e,i)}setHeight(t){const e=t/this._height,i=e;this.scale(e,i)}setPosition(t,e){this.translate(t,e)}setCenterPosition(t,e){this.centerX(t),this.centerY(e)}top(t){this.setY(t)}bottom(t){const e=this._height*this.getScaleY();this.translateY(t-e)}left(t){this.setX(t)}right(t){const e=this._width*this.getScaleX();this.translateX(t-e)}centerX(t){const e=this._width*this.getScaleX();this.translateX(t-e/2)}setX(t){this.translateX(t)}centerY(t){const e=this._height*this.getScaleY();this.translateY(t-e/2)}setY(t){this.translateY(t)}setupFromLayout(t){for(const e=t.begin();e.notEqual(t.end());e.preIncrement()){const t=e.ptr().first,i=e.ptr().second;"width"==t?this.setWidth(i):"height"==t&&this.setHeight(i)}for(const e=t.begin();e.notEqual(t.end());e.preIncrement()){const t=e.ptr().first,i=e.ptr().second;"x"==t?this.setX(i):"y"==t?this.setY(i):"center_x"==t?this.centerX(i):"center_y"==t?this.centerY(i):"top"==t?this.top(i):"bottom"==t?this.bottom(i):"left"==t?this.left(i):"right"==t&&this.right(i)}}}!function(t){t.CubismModelMatrix=n.CubismModelMatrix}(r||(r={}))},"./src/Framework/math/cubismtargetpoint.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismTargetPoint:()=>n,Live2DCubismFramework:()=>o});var r=i("./src/Framework/math/cubismmath.ts"),s=i("./src/Framework/math/cubismtargetpoint.ts");class n{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;const e=4/30;if(0==this._lastTimeSeconds)return void(this._lastTimeSeconds=this._userTimeSeconds);const i=30*(this._userTimeSeconds-this._lastTimeSeconds);this._lastTimeSeconds=this._userTimeSeconds;const s=i*e/4.5,n=this._faceTargetX-this._faceX,o=this._faceTargetY-this._faceY;if(r.CubismMath.abs(n)<=.01&&r.CubismMath.abs(o)<=.01)return;const a=r.CubismMath.sqrt(n*n+o*o),l=e*o/a;let u=e*n/a-this._faceVX,h=l-this._faceVY;const c=r.CubismMath.sqrt(u*u+h*h);(c<-s||c>s)&&(u*=s/c,h*=s/c),this._faceVX+=u,this._faceVY+=h;{const t=.5*(r.CubismMath.sqrt(s*s+16*s*a-8*s*a)-s),e=r.CubismMath.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);e>t&&(this._faceVX*=t/e,this._faceVY*=t/e)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,e){this._faceTargetX=t,this._faceTargetY=e}}var o;!function(t){t.CubismTargetPoint=s.CubismTargetPoint}(o||(o={}))},"./src/Framework/math/cubismvector2.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismVector2:()=>n,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/math/cubismvector2.ts");class n{constructor(t,e){this.x=t,this.y=e,this.x=null==t?0:t,this.y=null==e?0:e}add(t){const e=new n(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new n(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new n(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new n(t,t))}division(t){const e=new n(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new n(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}!function(t){t.CubismVector2=s.CubismVector2}(r||(r={}))},"./src/Framework/math/cubismviewmatrix.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismViewMatrix:()=>o,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/math/cubismmatrix44.ts"),n=i("./src/Framework/math/cubismviewmatrix.ts");class o extends s.CubismMatrix44{constructor(){super(),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(t,e){this._tr[0]*this._maxLeft+(this._tr[12]+t)>this._screenLeft&&(t=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+t)<this._screenRight&&(t=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+e)<this._screenTop&&(e=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+e)>this._screenBottom&&(e=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);s.CubismMatrix44.multiply(i,this._tr,this._tr)}adjustScale(t,e,i){const r=this.getMaxScale(),n=this.getMinScale(),o=i*this._tr[0];o<n?this._tr[0]>0&&(i=n/this._tr[0]):o>r&&this._tr[0]>0&&(i=r/this._tr[0]);const a=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]),l=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),u=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1]);s.CubismMatrix44.multiply(u,this._tr,this._tr),s.CubismMatrix44.multiply(l,this._tr,this._tr),s.CubismMatrix44.multiply(a,this._tr,this._tr)}setScreenRect(t,e,i,r){this._screenLeft=t,this._screenRight=e,this._screenBottom=i,this._screenTop=r}setMaxScreenRect(t,e,i,r){this._maxLeft=t,this._maxRight=e,this._maxTop=r,this._maxBottom=i}setMaxScale(t){this._maxScale=t}setMinScale(t){this._minScale=t}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}}!function(t){t.CubismViewMatrix=n.CubismViewMatrix}(r||(r={}))},"./src/Framework/model/cubismmoc.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismMoc:()=>a,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/utils/cubismdebug.ts"),n=i("./src/Framework/model/cubismmodel.ts"),o=i("./src/Framework/model/cubismmoc.ts");class a{constructor(t){this._moc=t,this._modelCount=0,this._mocVersion=0}static create(t){let e=null;const i=Live2DCubismCore.Moc.fromArrayBuffer(t);return i&&(e=new a(i),e._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(i,t)),e}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null;const e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&(t=new n.CubismModel(e),t.initialize(),++this._modelCount),t}deleteModel(t){null!=t&&(t.release(),t=null,--this._modelCount)}release(){(0,s.CSM_ASSERT)(0==this._modelCount),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}}!function(t){t.CubismMoc=o.CubismMoc}(r||(r={}))},"./src/Framework/model/cubismmodel.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismModel:()=>c,DrawableColorData:()=>h,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/live2dcubismframework.ts"),n=i("./src/Framework/rendering/cubismrenderer.ts"),o=i("./src/Framework/type/csmmap.ts"),a=i("./src/Framework/type/csmvector.ts"),l=i("./src/Framework/utils/cubismdebug.ts"),u=i("./src/Framework/model/cubismmodel.ts");class h{constructor(){this.isOverwritten=!1,this.Color=new n.CubismTextureColor}}class c{constructor(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new a.csmVector,this._parameterIds=new a.csmVector,this._drawableIds=new a.csmVector,this._partIds=new a.csmVector,this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._userMultiplyColors=null,this._userScreenColors=null,this._notExistPartId=new o.csmMap,this._notExistParameterId=new o.csmMap,this._notExistParameterValues=new o.csmMap,this._notExistPartOpacities=new o.csmMap}update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getCanvasWidth(){return null==this._model?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return null==this._model?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.getSize();for(let i=0;i<t;++i)i<e?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])}getMultiplyColor(t){if(this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(t))return this._userMultiplyColors.at(t).Color;return this.getDrawableMultiplyColor(t)}getScreenColor(t){if(this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(t))return this._userScreenColors.at(t).Color;return this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,e){this.setMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setMultiplyColorByRGBA(t,e,i,r,s=1){this._userMultiplyColors.at(t).Color.R=e,this._userMultiplyColors.at(t).Color.G=i,this._userMultiplyColors.at(t).Color.B=r,this._userMultiplyColors.at(t).Color.A=s}setScreenColorByTextureColor(t,e){this.setScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setScreenColorByRGBA(t,e,i,r,s=1){this._userScreenColors.at(t).Color.R=e,this._userScreenColors.at(t).Color.G=i,this._userScreenColors.at(t).Color.B=r,this._userScreenColors.at(t).Color.A=s}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){this._isOverwrittenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){this._isOverwrittenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return this._userMultiplyColors.at(t).isOverwritten}getOverwriteFlagForDrawableScreenColors(t){return this._userMultiplyColors.at(t).isOverwritten}setOverwriteFlagForDrawableMultiplyColors(t,e){this._userMultiplyColors.at(t).isOverwritten=e}setOverwriteFlagForDrawableScreenColors(t,e){this._userScreenColors.at(t).isOverwritten=e}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.setValue(t,e):((0,l.CSM_ASSERT)(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e)}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):((0,l.CSM_ASSERT)(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):((0,l.CSM_ASSERT)(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){this._notExistParameterValues.isExist(t)?this._notExistParameterValues.setValue(t,1==i?e:this._notExistParameterValues.getValue(t)*(1-i)+e*i):((0,l.CSM_ASSERT)(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=1==i?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i)}setParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.setParameterValueByIndex(r,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.addParameterValueByIndex(r,e,i)}multiplyParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.multiplyParameterValueByIndex(r,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds.at(i)==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){const e=this._model.drawables.ids;return s.CubismFramework.getIdManager().getId(e[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){const e=this._model.drawables.multiplyColors,i=4*t,r=new n.CubismTextureColor;return r.R=e[i],r.G=e[i+1],r.B=e[i+2],r.A=e[i+3],r}getDrawableScreenColor(t){const e=this._model.drawables.screenColors,i=4*t,r=new n.CubismTextureColor;return r.R=e[i],r.G=e[i+1],r.B=e[i+2],r.A=e[i+3],r}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableCulling(t){const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?n.CubismBlendMode.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?n.CubismBlendMode.CubismBlendMode_Multiplicative:n.CubismBlendMode.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}getDrawableDynamicFlagBlendColorDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.getSize();t>e&&(t=e);for(let e=0;e<t;++e)this._parameterValues[e]=this._savedParameters.at(e)}initialize(){(0,l.CSM_ASSERT)(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const t=this._model.parameters.ids,e=this._model.parameters.count;this._parameterIds.prepareCapacity(e);for(let i=0;i<e;++i)this._parameterIds.pushBack(s.CubismFramework.getIdManager().getId(t[i]))}{const t=this._model.parts.ids,e=this._model.parts.count;this._partIds.prepareCapacity(e);for(let i=0;i<e;++i)this._partIds.pushBack(s.CubismFramework.getIdManager().getId(t[i]))}{const t=this._model.drawables.ids,e=this._model.drawables.count;this._userMultiplyColors=new a.csmVector,this._userMultiplyColors.updateSize(e,h,!0),this._userScreenColors=new a.csmVector,this._userScreenColors.updateSize(e,h,!0),this._drawableIds.prepareCapacity(e);for(let i=0;i<e;++i)this._drawableIds.pushBack(s.CubismFramework.getIdManager().getId(t[i])),this.setMultiplyColorByRGBA(i,1,1,1,1),this.setScreenColorByRGBA(i,0,0,0,1)}}release(){this._model.release(),this._model=null}}!function(t){t.CubismModel=u.CubismModel}(r||(r={}))},"./src/Framework/model/cubismmodeluserdata.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismModelUserData:()=>u,CubismModelUserDataNode:()=>l,Live2DCubismFramework:()=>h});var r=i("./src/Framework/live2dcubismframework.ts"),s=i("./src/Framework/type/csmstring.ts"),n=i("./src/Framework/type/csmvector.ts"),o=i("./src/Framework/model/cubismmodeluserdatajson.ts"),a=i("./src/Framework/model/cubismmodeluserdata.ts");class l{}class u{constructor(){this._userDataNodes=new n.csmVector,this._artMeshUserDataNode=new n.csmVector}static create(t,e){const i=new u;return i.parseUserData(t,e),i}static delete(t){null!=t&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,e){let i=new o.CubismModelUserDataJson(t,e);const n=r.CubismFramework.getIdManager().getId("ArtMesh"),a=i.getUserDataCount();for(let t=0;t<a;t++){const e=new l;e.targetId=i.getUserDataId(t),e.targetType=r.CubismFramework.getIdManager().getId(i.getUserDataTargetType(t)),e.value=new s.csmString(i.getUserDataValue(t)),this._userDataNodes.pushBack(e),e.targetType==n&&this._artMeshUserDataNode.pushBack(e)}i.release(),i=void 0}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}}var h;!function(t){t.CubismModelUserData=a.CubismModelUserData,t.CubismModelUserDataNode=a.CubismModelUserDataNode}(h||(h={}))},"./src/Framework/model/cubismmodeluserdatajson.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismModelUserDataJson:()=>l,Live2DCubismFramework:()=>u});var r=i("./src/Framework/live2dcubismframework.ts"),s=i("./src/Framework/utils/cubismjson.ts"),n=i("./src/Framework/model/cubismmodeluserdatajson.ts");const o="Meta",a="UserData";class l{constructor(t,e){this._json=s.CubismJson.create(t,e)}release(){s.CubismJson.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(o).getValueByString("UserDataCount").toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(o).getValueByString("TotalUserDataSize").toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString(a).getValueByIndex(t).getValueByString("Target").getRawString()}getUserDataId(t){return r.CubismFramework.getIdManager().getId(this._json.getRoot().getValueByString(a).getValueByIndex(t).getValueByString("Id").getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString(a).getValueByIndex(t).getValueByString("Value").getRawString()}}var u;!function(t){t.CubismModelUserDataJson=n.CubismModelUserDataJson}(u||(u={}))},"./src/Framework/model/cubismusermodel.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismUserModel:()=>$,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/effect/cubismbreath.ts"),n=i("./src/Framework/effect/cubismeyeblink.ts"),o=i("./src/Framework/effect/cubismpose.ts"),a=i("./src/Framework/live2dcubismframework.ts"),l=i("./src/Framework/math/cubismmodelmatrix.ts"),u=i("./src/Framework/math/cubismtargetpoint.ts"),h=i("./src/Framework/motion/cubismexpressionmotion.ts"),c=i("./src/Framework/motion/cubismmotion.ts"),_=i("./src/Framework/motion/cubismmotionmanager.ts"),m=i("./src/Framework/physics/cubismphysics.ts"),d=i("./src/Framework/rendering/cubismrenderer_webgl.ts"),g=i("./src/Framework/utils/cubismdebug.ts"),p=i("./src/Framework/model/cubismmoc.ts"),f=i("./src/Framework/model/cubismmodeluserdata.ts"),y=i("./src/Framework/model/cubismusermodel.ts");class ${constructor(){this.loadMotion=(t,e,i,r)=>c.CubismMotion.create(t,e,r),this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._debugMode=!1,this._renderer=null,this._motionManager=new _.CubismMotionManager,this._motionManager.setEventCallback($.cubismDefaultMotionEventCallback,this),this._expressionManager=new _.CubismMotionManager,this._dragManager=new u.CubismTargetPoint}isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,e){this._dragManager.set(t,e)}setAcceleration(t,e,i){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t){this._moc=p.CubismMoc.create(t),null!=this._moc?(this._model=this._moc.createModel(),null!=this._model?(this._model.saveParameters(),this._modelMatrix=new l.CubismModelMatrix(this._model.getCanvasWidth(),this._model.getCanvasHeight())):(0,g.CubismLogError)("Failed to CreateModel().")):(0,g.CubismLogError)("Failed to CubismMoc.create().")}loadExpression(t,e,i){return h.CubismExpressionMotion.create(t,e)}loadPose(t,e){this._pose=o.CubismPose.create(t,e)}loadUserData(t,e){this._modelUserData=f.CubismModelUserData.create(t,e)}loadPhysics(t,e){this._physics=m.CubismPhysics.create(t,e)}isHit(t,e,i){const r=this._model.getDrawableIndex(t);if(r<0)return!1;const s=this._model.getDrawableVertexCount(r),n=this._model.getDrawableVertices(r);let o=n[0],l=n[0],u=n[1],h=n[1];for(let t=1;t<s;++t){const e=n[a.Constant.vertexOffset+t*a.Constant.vertexStep],i=n[a.Constant.vertexOffset+t*a.Constant.vertexStep+1];e<o&&(o=e),e>l&&(l=e),i<u&&(u=i),i>h&&(h=i)}const c=this._modelMatrix.invertTransformX(e),_=this._modelMatrix.invertTransformY(i);return o<=c&&c<=l&&u<=_&&_<=h}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(){this._renderer&&this.deleteRenderer(),this._renderer=new d.CubismRenderer_WebGL,this._renderer.initialize(this._model)}deleteRenderer(){null!=this._renderer&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){(0,g.CubismLogInfo)("{0}",t.s)}static cubismDefaultMotionEventCallback(t,e,i){null!=i&&i.motionEventFired(e)}release(){null!=this._motionManager&&(this._motionManager.release(),this._motionManager=null),null!=this._expressionManager&&(this._expressionManager.release(),this._expressionManager=null),null!=this._moc&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,o.CubismPose.delete(this._pose),n.CubismEyeBlink.delete(this._eyeBlink),s.CubismBreath.delete(this._breath),this._dragManager=null,m.CubismPhysics.delete(this._physics),f.CubismModelUserData.delete(this._modelUserData),this.deleteRenderer()}}!function(t){t.CubismUserModel=y.CubismUserModel}(r||(r={}))},"./src/Framework/motion/acubismmotion.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{ACubismMotion:()=>l,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/math/cubismmath.ts"),n=i("./src/Framework/type/csmvector.ts"),o=i("./src/Framework/utils/cubismdebug.ts"),a=i("./src/Framework/motion/acubismmotion.ts");class l{constructor(){this.setFinishedMotionHandler=t=>this._onFinishedMotion=t,this.getFinishedMotionHandler=()=>this._onFinishedMotion,this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new n.csmVector}static delete(t){t.release(),t=null}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(i-this._offsetSeconds),e.setFadeInStartTime(i);const t=this.getDuration();e.getEndTime()<0&&e.setEndTime(t<=0?-1:e.getStartTime()+t)}let r=this._weight;r=r*(0==this._fadeInSeconds?1:s.CubismMath.getEasingSine((i-e.getFadeInStartTime())/this._fadeInSeconds))*(0==this._fadeOutSeconds||e.getEndTime()<0?1:s.CubismMath.getEasingSine((e.getEndTime()-i)/this._fadeOutSeconds)),e.setState(i,r),(0,o.CSM_ASSERT)(0<=r&&r<=1),this.doUpdateParameters(t,i,r,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}}!function(t){t.ACubismMotion=a.ACubismMotion}(r||(r={}))},"./src/Framework/motion/cubismexpressionmotion.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismExpressionMotion:()=>h,ExpressionBlendType:()=>c,ExpressionParameter:()=>m,Live2DCubismFramework:()=>_});var r=i("./src/Framework/live2dcubismframework.ts"),s=i("./src/Framework/type/csmvector.ts"),n=i("./src/Framework/utils/cubismjson.ts"),o=i("./src/Framework/motion/acubismmotion.ts"),a=i("./src/Framework/motion/cubismexpressionmotion.ts");const l="Parameters",u="Blend";class h extends o.ACubismMotion{constructor(){super(),this._parameters=new s.csmVector}static create(t,e){const i=new h,s=n.CubismJson.create(t,e),o=s.getRoot();i.setFadeInTime(o.getValueByString("FadeInTime").toFloat(1)),i.setFadeOutTime(o.getValueByString("FadeOutTime").toFloat(1));const a=o.getValueByString(l).getSize();i._parameters.prepareCapacity(a);for(let t=0;t<a;++t){const e=o.getValueByString(l).getValueByIndex(t),s=r.CubismFramework.getIdManager().getId(e.getValueByString("Id").getRawString()),n=e.getValueByString("Value").toFloat();let a;a=e.getValueByString(u).isNull()||"Add"==e.getValueByString(u).getString()?c.ExpressionBlendType_Add:"Multiply"==e.getValueByString(u).getString()?c.ExpressionBlendType_Multiply:"Overwrite"==e.getValueByString(u).getString()?c.ExpressionBlendType_Overwrite:c.ExpressionBlendType_Add;const h=new m;h.parameterId=s,h.blendType=a,h.value=n,i._parameters.pushBack(h)}return n.CubismJson.delete(s),i}doUpdateParameters(t,e,i,r){for(let e=0;e<this._parameters.getSize();++e){const r=this._parameters.at(e);switch(r.blendType){case c.ExpressionBlendType_Add:t.addParameterValueById(r.parameterId,r.value,i);break;case c.ExpressionBlendType_Multiply:t.multiplyParameterValueById(r.parameterId,r.value,i);break;case c.ExpressionBlendType_Overwrite:t.setParameterValueById(r.parameterId,r.value,i)}}}}var c,_;!function(t){t[t.ExpressionBlendType_Add=0]="ExpressionBlendType_Add",t[t.ExpressionBlendType_Multiply=1]="ExpressionBlendType_Multiply",t[t.ExpressionBlendType_Overwrite=2]="ExpressionBlendType_Overwrite"}(c||(c={}));class m{}!function(t){t.CubismExpressionMotion=a.CubismExpressionMotion,t.ExpressionBlendType=a.ExpressionBlendType,t.ExpressionParameter=a.ExpressionParameter}(_||(_={}))},"./src/Framework/motion/cubismmotion.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismMotion:()=>y,Live2DCubismFramework:()=>$});var r=i("./src/Framework/live2dcubismframework.ts"),s=i("./src/Framework/math/cubismmath.ts"),n=i("./src/Framework/type/csmstring.ts"),o=i("./src/Framework/utils/cubismdebug.ts"),a=i("./src/Framework/motion/acubismmotion.ts"),l=i("./src/Framework/motion/cubismmotioninternal.ts"),u=i("./src/Framework/motion/cubismmotionjson.ts"),h=i("./src/Framework/motion/cubismmotion.ts");function c(t,e,i){const r=new l.CubismMotionPoint;return r.time=t.time+(e.time-t.time)*i,r.value=t.value+(e.value-t.value)*i,r}function _(t,e){let i=(e-t[0].time)/(t[1].time-t[0].time);return i<0&&(i=0),t[0].value+(t[1].value-t[0].value)*i}function m(t,e){let i=(e-t[0].time)/(t[3].time-t[0].time);i<0&&(i=0);const r=c(t[0],t[1],i),s=c(t[1],t[2],i),n=c(t[2],t[3],i),o=c(r,s,i),a=c(s,n,i);return c(o,a,i).value}function d(t,e){const i=e,r=t[0].time,n=t[3].time,o=t[1].time,a=t[2].time,l=n-3*a+3*o-r,u=3*a-6*o+3*r,h=3*o-3*r,_=r-i,m=s.CubismMath.cardanoAlgorithmForBezier(l,u,h,_),d=c(t[0],t[1],m),g=c(t[1],t[2],m),p=c(t[2],t[3],m),f=c(d,g,m),y=c(g,p,m);return c(f,y,m).value}function g(t,e){return t[0].value}function p(t,e){return t[1].value}function f(t,e,i){const r=t.curves.at(e);let s=-1;const n=r.baseSegmentIndex+r.segmentCount;let o=0;for(let e=r.baseSegmentIndex;e<n;++e)if(o=t.segments.at(e).basePointIndex+(t.segments.at(e).segmentType==l.CubismMotionSegmentType.CubismMotionSegmentType_Bezier?3:1),t.points.at(o).time>i){s=e;break}if(-1==s)return t.points.at(o).value;const a=t.segments.at(s);return a.evaluate(t.points.get(a.basePointIndex),i)}class y extends a.ACubismMotion{constructor(){super(),this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null}static create(t,e,i){const r=new y;return r.parse(t,e),r._sourceFrameRate=r._motionData.fps,r._loopDurationSeconds=r._motionData.duration,r._onFinishedMotion=i,r}doUpdateParameters(t,e,i,n){null==this._modelCurveIdEyeBlink&&(this._modelCurveIdEyeBlink=r.CubismFramework.getIdManager().getId("EyeBlink")),null==this._modelCurveIdLipSync&&(this._modelCurveIdLipSync=r.CubismFramework.getIdManager().getId("LipSync"));let a=e-n.getStartTime();a<0&&(a=0);let u=Number.MAX_VALUE,h=Number.MAX_VALUE;const c=64;let _=0,m=0;this._eyeBlinkParameterIds.getSize()>c&&(0,o.CubismLogDebug)("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>c&&(0,o.CubismLogDebug)("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());const d=this._fadeInSeconds<=0?1:s.CubismMath.getEasingSine((e-n.getFadeInStartTime())/this._fadeInSeconds),g=this._fadeOutSeconds<=0||n.getEndTime()<0?1:s.CubismMath.getEasingSine((n.getEndTime()-e)/this._fadeOutSeconds);let p,y,$,b=a;if(this._isLoop)for(;b>this._motionData.duration;)b-=this._motionData.duration;const S=this._motionData.curves;for(y=0;y<this._motionData.curveCount&&S.at(y).type==l.CubismMotionCurveTarget.CubismMotionCurveTarget_Model;++y)p=f(this._motionData,y,b),S.at(y).id==this._modelCurveIdEyeBlink?h=p:S.at(y).id==this._modelCurveIdLipSync&&(u=p);for(;y<this._motionData.curveCount&&S.at(y).type==l.CubismMotionCurveTarget.CubismMotionCurveTarget_Parameter;++y){if($=t.getParameterIndex(S.at(y).id),-1==$)continue;const r=t.getParameterValueByIndex($);if(p=f(this._motionData,y,b),h!=Number.MAX_VALUE)for(let t=0;t<this._eyeBlinkParameterIds.getSize()&&t<c;++t)if(this._eyeBlinkParameterIds.at(t)==S.at(y).id){p*=h,m|=1<<t;break}if(u!=Number.MAX_VALUE)for(let t=0;t<this._lipSyncParameterIds.getSize()&&t<c;++t)if(this._lipSyncParameterIds.at(t)==S.at(y).id){p+=u,_|=1<<t;break}let o;if(S.at(y).fadeInTime<0&&S.at(y).fadeOutTime<0)o=r+(p-r)*i;else{let t,i;t=S.at(y).fadeInTime<0?d:0==S.at(y).fadeInTime?1:s.CubismMath.getEasingSine((e-n.getFadeInStartTime())/S.at(y).fadeInTime),i=S.at(y).fadeOutTime<0?g:0==S.at(y).fadeOutTime||n.getEndTime()<0?1:s.CubismMath.getEasingSine((n.getEndTime()-e)/S.at(y).fadeOutTime);o=r+(p-r)*(this._weight*t*i)}t.setParameterValueByIndex($,o,1)}if(h!=Number.MAX_VALUE)for(let e=0;e<this._eyeBlinkParameterIds.getSize()&&e<c;++e){const r=t.getParameterValueById(this._eyeBlinkParameterIds.at(e));if(m>>e&1)continue;const s=r+(h-r)*i;t.setParameterValueById(this._eyeBlinkParameterIds.at(e),s)}if(u!=Number.MAX_VALUE)for(let e=0;e<this._lipSyncParameterIds.getSize()&&e<c;++e){const r=t.getParameterValueById(this._lipSyncParameterIds.at(e));if(_>>e&1)continue;const s=r+(u-r)*i;t.setParameterValueById(this._lipSyncParameterIds.at(e),s)}for(;y<this._motionData.curveCount&&S.at(y).type==l.CubismMotionCurveTarget.CubismMotionCurveTarget_PartOpacity;++y)$=t.getParameterIndex(S.at(y).id),-1!=$&&(p=f(this._motionData,y,b),t.setParameterValueByIndex($,p));a>=this._motionData.duration&&(this._isLoop?(n.setStartTime(e),this._isLoopFadeIn&&n.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),n.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==i.at(r).id)return void(i.at(r).fadeInTime=e)}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==i.at(r).id)return void(i.at(r).fadeOutTime=e)}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}release(){this._motionData=void 0,this._motionData=null}parse(t,e){this._motionData=new l.CubismMotionData;let i=new u.CubismMotionJson(t,e);this._motionData.duration=i.getMotionDuration(),this._motionData.loop=i.isMotionLoop(),this._motionData.curveCount=i.getMotionCurveCount(),this._motionData.fps=i.getMotionFps(),this._motionData.eventCount=i.getEventCount();const r=i.getEvaluationOptionFlag(u.EvaluationOptionFlag.EvaluationOptionFlag_AreBeziersRistricted);i.isExistMotionFadeInTime()?this._fadeInSeconds=i.getMotionFadeInTime()<0?1:i.getMotionFadeInTime():this._fadeInSeconds=1,i.isExistMotionFadeOutTime()?this._fadeOutSeconds=i.getMotionFadeOutTime()<0?1:i.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,l.CubismMotionCurve,!0),this._motionData.segments.updateSize(i.getMotionTotalSegmentCount(),l.CubismMotionSegment,!0),this._motionData.points.updateSize(i.getMotionTotalPointCount(),l.CubismMotionPoint,!0),this._motionData.events.updateSize(this._motionData.eventCount,l.CubismMotionEvent,!0);let s=0,n=0;for(let t=0;t<this._motionData.curveCount;++t){"Model"==i.getMotionCurveTarget(t)?this._motionData.curves.at(t).type=l.CubismMotionCurveTarget.CubismMotionCurveTarget_Model:"Parameter"==i.getMotionCurveTarget(t)?this._motionData.curves.at(t).type=l.CubismMotionCurveTarget.CubismMotionCurveTarget_Parameter:"PartOpacity"==i.getMotionCurveTarget(t)?this._motionData.curves.at(t).type=l.CubismMotionCurveTarget.CubismMotionCurveTarget_PartOpacity:(0,o.CubismLogWarning)('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!'),this._motionData.curves.at(t).id=i.getMotionCurveId(t),this._motionData.curves.at(t).baseSegmentIndex=n,this._motionData.curves.at(t).fadeInTime=i.isExistMotionCurveFadeInTime(t)?i.getMotionCurveFadeInTime(t):-1,this._motionData.curves.at(t).fadeOutTime=i.isExistMotionCurveFadeOutTime(t)?i.getMotionCurveFadeOutTime(t):-1;for(let e=0;e<i.getMotionCurveSegmentCount(t);){0==e?(this._motionData.segments.at(n).basePointIndex=s,this._motionData.points.at(s).time=i.getMotionCurveSegment(t,e),this._motionData.points.at(s).value=i.getMotionCurveSegment(t,e+1),s+=1,e+=2):this._motionData.segments.at(n).basePointIndex=s-1;switch(i.getMotionCurveSegment(t,e)){case l.CubismMotionSegmentType.CubismMotionSegmentType_Linear:this._motionData.segments.at(n).segmentType=l.CubismMotionSegmentType.CubismMotionSegmentType_Linear,this._motionData.segments.at(n).evaluate=_,this._motionData.points.at(s).time=i.getMotionCurveSegment(t,e+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(t,e+2),s+=1,e+=3;break;case l.CubismMotionSegmentType.CubismMotionSegmentType_Bezier:this._motionData.segments.at(n).segmentType=l.CubismMotionSegmentType.CubismMotionSegmentType_Bezier,this._motionData.segments.at(n).evaluate=r?m:d,this._motionData.points.at(s).time=i.getMotionCurveSegment(t,e+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(t,e+2),this._motionData.points.at(s+1).time=i.getMotionCurveSegment(t,e+3),this._motionData.points.at(s+1).value=i.getMotionCurveSegment(t,e+4),this._motionData.points.at(s+2).time=i.getMotionCurveSegment(t,e+5),this._motionData.points.at(s+2).value=i.getMotionCurveSegment(t,e+6),s+=3,e+=7;break;case l.CubismMotionSegmentType.CubismMotionSegmentType_Stepped:this._motionData.segments.at(n).segmentType=l.CubismMotionSegmentType.CubismMotionSegmentType_Stepped,this._motionData.segments.at(n).evaluate=g,this._motionData.points.at(s).time=i.getMotionCurveSegment(t,e+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(t,e+2),s+=1,e+=3;break;case l.CubismMotionSegmentType.CubismMotionSegmentType_InverseStepped:this._motionData.segments.at(n).segmentType=l.CubismMotionSegmentType.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(n).evaluate=p,this._motionData.points.at(s).time=i.getMotionCurveSegment(t,e+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(t,e+2),s+=1,e+=3;break;default:(0,o.CSM_ASSERT)(0)}++this._motionData.curves.at(t).segmentCount,++n}}for(let t=0;t<i.getEventCount();++t)this._motionData.events.at(t).fireTime=i.getEventTime(t),this._motionData.events.at(t).value=i.getEventValue(t);i.release(),i=void 0,i=null}getFiredEvent(t,e){this._firedEventValues.updateSize(0);for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>t&&this._motionData.events.at(i).fireTime<=e&&this._firedEventValues.pushBack(new n.csmString(this._motionData.events.at(i).value.s));return this._firedEventValues}}var $;!function(t){t.CubismMotion=h.CubismMotion}($||($={}))},"./src/Framework/motion/cubismmotioninternal.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismMotionCurve:()=>h,CubismMotionCurveTarget:()=>r,CubismMotionData:()=>_,CubismMotionEvent:()=>c,CubismMotionPoint:()=>l,CubismMotionSegment:()=>u,CubismMotionSegmentType:()=>s,Live2DCubismFramework:()=>n});var r,s,n,o=i("./src/Framework/type/csmvector.ts"),a=i("./src/Framework/motion/cubismmotioninternal.ts");!function(t){t[t.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",t[t.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",t[t.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity"}(r||(r={})),function(t){t[t.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",t[t.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",t[t.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",t[t.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped"}(s||(s={}));class l{constructor(){this.time=0,this.value=0}}class u{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class h{constructor(){this.type=r.CubismMotionCurveTarget_Model,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class c{constructor(){this.fireTime=0}}class _{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new o.csmVector,this.segments=new o.csmVector,this.points=new o.csmVector,this.events=new o.csmVector}}!function(t){t.CubismMotionCurve=a.CubismMotionCurve,t.CubismMotionCurveTarget=a.CubismMotionCurveTarget,t.CubismMotionData=a.CubismMotionData,t.CubismMotionEvent=a.CubismMotionEvent,t.CubismMotionPoint=a.CubismMotionPoint,t.CubismMotionSegment=a.CubismMotionSegment,t.CubismMotionSegmentType=a.CubismMotionSegmentType}(n||(n={}))},"./src/Framework/motion/cubismmotionjson.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismMotionJson:()=>m,EvaluationOptionFlag:()=>d,Live2DCubismFramework:()=>g});var r=i("./src/Framework/live2dcubismframework.ts"),s=i("./src/Framework/type/csmstring.ts"),n=i("./src/Framework/utils/cubismjson.ts"),o=i("./src/Framework/motion/cubismmotionjson.ts");const a="Meta",l="Curves",u="FadeInTime",h="FadeOutTime",c="Segments",_="UserData";class m{constructor(t,e){this._json=n.CubismJson.create(t,e)}release(){n.CubismJson.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(a).getValueByString("Duration").toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(a).getValueByString("Loop").toBoolean()}getEvaluationOptionFlag(t){return d.EvaluationOptionFlag_AreBeziersRistricted==t&&this._json.getRoot().getValueByString(a).getValueByString("AreBeziersRestricted").toBoolean()}getMotionCurveCount(){return this._json.getRoot().getValueByString(a).getValueByString("CurveCount").toInt()}getMotionFps(){return this._json.getRoot().getValueByString(a).getValueByString("Fps").toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(a).getValueByString("TotalSegmentCount").toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(a).getValueByString("TotalPointCount").toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(a).getValueByString(u).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(a).getValueByString(h).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(a).getValueByString(u).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(a).getValueByString(h).toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString(l).getValueByIndex(t).getValueByString("Target").getRawString()}getMotionCurveId(t){return r.CubismFramework.getIdManager().getId(this._json.getRoot().getValueByString(l).getValueByIndex(t).getValueByString("Id").getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString(l).getValueByIndex(t).getValueByString(u).isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString(l).getValueByIndex(t).getValueByString(h).isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString(l).getValueByIndex(t).getValueByString(u).toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString(l).getValueByIndex(t).getValueByString(h).toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString(l).getValueByIndex(t).getValueByString(c).getVector().getSize()}getMotionCurveSegment(t,e){return this._json.getRoot().getValueByString(l).getValueByIndex(t).getValueByString(c).getValueByIndex(e).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(a).getValueByString("UserDataCount").toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(a).getValueByString("TotalUserDataSize").toInt()}getEventTime(t){return this._json.getRoot().getValueByString(_).getValueByIndex(t).getValueByString("Time").toFloat()}getEventValue(t){return new s.csmString(this._json.getRoot().getValueByString(_).getValueByIndex(t).getValueByString("Value").getRawString())}}var d,g;!function(t){t[t.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted"}(d||(d={})),function(t){t.CubismMotionJson=o.CubismMotionJson}(g||(g={}))},"./src/Framework/motion/cubismmotionmanager.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismMotionManager:()=>o,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/motion/cubismmotionqueuemanager.ts"),n=i("./src/Framework/motion/cubismmotionmanager.ts");class o extends s.CubismMotionQueueManager{constructor(){super(),this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(t,e,this._userTimeSeconds)}updateMotion(t,e){this._userTimeSeconds+=e;const i=super.doUpdateMotion(t,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),i}reserveMotion(t){return!(t<=this._reservePriority||t<=this._currentPriority)&&(this._reservePriority=t,!0)}}!function(t){t.CubismMotionManager=n.CubismMotionManager}(r||(r={}))},"./src/Framework/motion/cubismmotionqueueentry.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismMotionQueueEntry:()=>o,Live2DCubismFramework:()=>r});var r,s=i("./src/Framework/motion/acubismmotion.ts"),n=i("./src/Framework/motion/cubismmotionqueueentry.ts");class o{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&s.ACubismMotion.delete(this._motion)}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}!function(t){t.CubismMotionQueueEntry=n.CubismMotionQueueEntry}(r||(r={}))},"./src/Framework/motion/cubismmotionqueuemanager.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismMotionQueueManager:()=>o,InvalidMotionQueueEntryHandleValue:()=>a,Live2DCubismFramework:()=>l});var r=i("./src/Framework/motion/cubismmotionqueueentry.ts"),s=i("./src/Framework/type/csmvector.ts"),n=i("./src/Framework/motion/cubismmotionqueuemanager.ts");class o{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new s.csmVector}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,null));this._motions=null}startMotion(t,e,i){if(null==t)return a;let s=null;for(let t=0;t<this._motions.getSize();++t)s=this._motions.at(t),null!=s&&s.setFadeOut(s._motion.getFadeOutTime());return s=new r.CubismMotionQueueEntry,s._autoDelete=e,s._motion=t,this._motions.pushBack(s),s._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(null==e){t=this._motions.erase(t);continue}if(null!=e._motion){if(!e.isFinished())return!1;t.preIncrement()}else e.release(),e=null,t=this._motions.erase(t)}return!0}isFinishedByHandle(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){const i=e.ptr();if(null!=i&&(i._motionQueueEntryHandle==t&&!i.isFinished()))return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();null!=e?(e.release(),e=null,t=this._motions.erase(t)):t=this._motions.erase(t)}}getCubismMotionQueueEntry(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){const i=e.ptr();if(null!=i&&i._motionQueueEntryHandle==t)return i}return null}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1;for(let r=this._motions.begin();r.notEqual(this._motions.end());){let s=r.ptr();if(null==s){r=this._motions.erase(r);continue}const n=s._motion;if(null==n){s.release(),s=null,r=this._motions.erase(r);continue}n.updateParameters(t,s,e),i=!0;const o=n.getFiredEvent(s.getLastCheckEventSeconds()-s.getStartTime(),e-s.getStartTime());for(let t=0;t<o.getSize();++t)this._eventCallBack(this,o.at(t),this._eventCustomData);s.setLastCheckEventSeconds(e),s.isFinished()?(s.release(),s=null,r=this._motions.erase(r)):(s.isTriggeredFadeOut()&&s.startFadeOut(s.getFadeOutSeconds(),e),r.preIncrement())}return i}}const a=-1;var l;!function(t){t.CubismMotionQueueManager=n.CubismMotionQueueManager,t.InvalidMotionQueueEntryHandleValue=n.InvalidMotionQueueEntryHandleValue}(l||(l={}))},"./src/Framework/physics/cubismphysics.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismPhysics:()=>h,Live2DCubismFramework:()=>M,Options:()=>c,PhysicsOutput:()=>_});var r=i("./src/Framework/math/cubismmath.ts"),s=i("./src/Framework/math/cubismvector2.ts"),n=i("./src/Framework/type/csmvector.ts"),o=i("./src/Framework/physics/cubismphysicsinternal.ts"),a=i("./src/Framework/physics/cubismphysicsjson.ts"),l=i("./src/Framework/physics/cubismphysics.ts");const u="Angle";class h{constructor(){this._physicsRig=null,this._options=new c,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new n.csmVector,this._previousRigOutputs=new n.csmVector,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}static create(t,e){const i=new h;return i.parse(t,e),i._physicsRig.gravity.y=0,i}static delete(t){null!=t&&(t.release(),t=null)}parse(t,e){this._physicsRig=new o.CubismPhysicsRig;let i=new a.CubismPhysicsJson(t,e);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.fps=i.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,o.CubismPhysicsSubRig,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),o.CubismPhysicsInput,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),o.CubismPhysicsOutput,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),o.CubismPhysicsParticle,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear();let r=0,s=0,n=0;for(let t=0;t<this._physicsRig.settings.getSize();++t){this._physicsRig.settings.at(t).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(t),this._physicsRig.settings.at(t).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(t),this._physicsRig.settings.at(t).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(t),this._physicsRig.settings.at(t).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(t),this._physicsRig.settings.at(t).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(t),this._physicsRig.settings.at(t).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(t),this._physicsRig.settings.at(t).inputCount=i.getInputCount(t),this._physicsRig.settings.at(t).baseInputIndex=r;for(let e=0;e<this._physicsRig.settings.at(t).inputCount;++e)this._physicsRig.inputs.at(r+e).sourceParameterIndex=-1,this._physicsRig.inputs.at(r+e).weight=i.getInputWeight(t,e),this._physicsRig.inputs.at(r+e).reflect=i.getInputReflect(t,e),"X"==i.getInputType(t,e)?(this._physicsRig.inputs.at(r+e).type=o.CubismPhysicsSource.CubismPhysicsSource_X,this._physicsRig.inputs.at(r+e).getNormalizedParameterValue=m):"Y"==i.getInputType(t,e)?(this._physicsRig.inputs.at(r+e).type=o.CubismPhysicsSource.CubismPhysicsSource_Y,this._physicsRig.inputs.at(r+e).getNormalizedParameterValue=d):i.getInputType(t,e)==u&&(this._physicsRig.inputs.at(r+e).type=o.CubismPhysicsSource.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(r+e).getNormalizedParameterValue=g),this._physicsRig.inputs.at(r+e).source.targetType=o.CubismPhysicsTargetType.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(r+e).source.id=i.getInputSourceId(t,e);r+=this._physicsRig.settings.at(t).inputCount,this._physicsRig.settings.at(t).outputCount=i.getOutputCount(t),this._physicsRig.settings.at(t).baseOutputIndex=s;const e=new _;e.outputs.resize(this._physicsRig.settings.at(t).outputCount);const a=new _;a.outputs.resize(this._physicsRig.settings.at(t).outputCount);for(let r=0;r<this._physicsRig.settings.at(t).outputCount;++r)e.outputs[r]=0,a.outputs[r]=0,this._physicsRig.outputs.at(s+r).destinationParameterIndex=-1,this._physicsRig.outputs.at(s+r).vertexIndex=i.getOutputVertexIndex(t,r),this._physicsRig.outputs.at(s+r).angleScale=i.getOutputAngleScale(t,r),this._physicsRig.outputs.at(s+r).weight=i.getOutputWeight(t,r),this._physicsRig.outputs.at(s+r).destination.targetType=o.CubismPhysicsTargetType.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(s+r).destination.id=i.getOutputDestinationId(t,r),"X"==i.getOutputType(t,r)?(this._physicsRig.outputs.at(s+r).type=o.CubismPhysicsSource.CubismPhysicsSource_X,this._physicsRig.outputs.at(s+r).getValue=p,this._physicsRig.outputs.at(s+r).getScale=b):"Y"==i.getOutputType(t,r)?(this._physicsRig.outputs.at(s+r).type=o.CubismPhysicsSource.CubismPhysicsSource_Y,this._physicsRig.outputs.at(s+r).getValue=f,this._physicsRig.outputs.at(s+r).getScale=S):i.getOutputType(t,r)==u&&(this._physicsRig.outputs.at(s+r).type=o.CubismPhysicsSource.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(s+r).getValue=y,this._physicsRig.outputs.at(s+r).getScale=v),this._physicsRig.outputs.at(s+r).reflect=i.getOutputReflect(t,r);this._currentRigOutputs.pushBack(e),this._previousRigOutputs.pushBack(a),s+=this._physicsRig.settings.at(t).outputCount,this._physicsRig.settings.at(t).particleCount=i.getParticleCount(t),this._physicsRig.settings.at(t).baseParticleIndex=n;for(let e=0;e<this._physicsRig.settings.at(t).particleCount;++e)this._physicsRig.particles.at(n+e).mobility=i.getParticleMobility(t,e),this._physicsRig.particles.at(n+e).delay=i.getParticleDelay(t,e),this._physicsRig.particles.at(n+e).acceleration=i.getParticleAcceleration(t,e),this._physicsRig.particles.at(n+e).radius=i.getParticleRadius(t,e),this._physicsRig.particles.at(n+e).position=i.getParticlePosition(t,e);n+=this._physicsRig.settings.at(t).particleCount}this.initialize(),i.release(),i=void 0,i=null}stabilization(t){var e,i,n,o;let a,l,u,h;const c=new s.CubismVector2;let _,m,d,g,p,f,y,$;p=t.getModel().parameters.values,f=t.getModel().parameters.maximumValues,y=t.getModel().parameters.minimumValues,$=t.getModel().parameters.defaultValues,(null!==(i=null===(e=this._parameterCaches)||void 0===e?void 0:e.length)&&void 0!==i?i:0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(null!==(o=null===(n=this._parameterInputCaches)||void 0===n?void 0:n.length)&&void 0!==o?o:0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let e=0;e<t.getParameterCount();++e)this._parameterCaches[e]=p[e],this._parameterInputCaches[e]=p[e];for(let e=0;e<this._physicsRig.subRigCount;++e){a={angle:0},c.x=0,c.y=0,_=this._physicsRig.settings.at(e),m=this._physicsRig.inputs.get(_.baseInputIndex),d=this._physicsRig.outputs.get(_.baseOutputIndex),g=this._physicsRig.particles.get(_.baseParticleIndex);for(let e=0;e<_.inputCount;++e)l=m[e].weight/100,-1==m[e].sourceParameterIndex&&(m[e].sourceParameterIndex=t.getParameterIndex(m[e].source.id)),m[e].getNormalizedParameterValue(c,a,p[m[e].sourceParameterIndex],y[m[e].sourceParameterIndex],f[m[e].sourceParameterIndex],$[m[e].sourceParameterIndex],_.normalizationPosition,_.normalizationAngle,m[e].reflect,l),this._parameterCaches[m[e].sourceParameterIndex]=p[m[e].sourceParameterIndex];u=r.CubismMath.degreesToRadian(-a.angle),c.x=c.x*r.CubismMath.cos(u)-c.y*r.CubismMath.sin(u),c.y=c.x*r.CubismMath.sin(u)+c.y*r.CubismMath.cos(u),P(g,_.particleCount,c,a.angle,this._options.wind,.001*_.normalizationPosition.maximum);for(let i=0;i<_.outputCount;++i){const r=d[i].vertexIndex;if(-1==d[i].destinationParameterIndex&&(d[i].destinationParameterIndex=t.getParameterIndex(d[i].destination.id)),r<1||r>=_.particleCount)continue;let n=new s.CubismVector2;n=g[r].position.substract(g[r-1].position),h=d[i].getValue(n,g,r,d[i].reflect,this._options.gravity),this._currentRigOutputs.at(e).outputs[i]=h,this._previousRigOutputs.at(e).outputs[i]=h;const o=d[i].destinationParameterIndex,a=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(p.subarray(o))):p.slice(o);C(a,y[o],f[o],h,d[i]);for(let t=o,e=0;t<this._parameterCaches.length;t++,e++)p[t]=this._parameterCaches[t]=a[e]}}}evaluate(t,e){var i,n,o,a;let l,u,h,c;const _=new s.CubismVector2;let m,d,g,p,f,y,$,b,S;if(0>=e)return;if(this._currentRemainTime+=e,this._currentRemainTime>5&&(this._currentRemainTime=0),f=t.getModel().parameters.values,y=t.getModel().parameters.maximumValues,$=t.getModel().parameters.minimumValues,b=t.getModel().parameters.defaultValues,(null!==(n=null===(i=this._parameterCaches)||void 0===i?void 0:i.length)&&void 0!==n?n:0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(null!==(a=null===(o=this._parameterInputCaches)||void 0===o?void 0:o.length)&&void 0!==a?a:0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let e=0;e<t.getParameterCount();++e)this._parameterInputCaches[e]=f[e]}for(S=this._physicsRig.fps>0?1/this._physicsRig.fps:e;this._currentRemainTime>=S;){for(let t=0;t<this._physicsRig.subRigCount;++t){m=this._physicsRig.settings.at(t),g=this._physicsRig.outputs.get(m.baseOutputIndex);for(let e=0;e<m.outputCount;++e)this._previousRigOutputs.at(t).outputs[e]=this._currentRigOutputs.at(t).outputs[e]}const e=S/this._currentRemainTime;for(let i=0;i<t.getParameterCount();++i)this._parameterCaches[i]=this._parameterInputCaches[i]*(1-e)+f[i]*e,this._parameterInputCaches[i]=this._parameterCaches[i];for(let e=0;e<this._physicsRig.subRigCount;++e){l={angle:0},_.x=0,_.y=0,m=this._physicsRig.settings.at(e),d=this._physicsRig.inputs.get(m.baseInputIndex),g=this._physicsRig.outputs.get(m.baseOutputIndex),p=this._physicsRig.particles.get(m.baseParticleIndex);for(let e=0;e<m.inputCount;++e)u=d[e].weight/100,-1==d[e].sourceParameterIndex&&(d[e].sourceParameterIndex=t.getParameterIndex(d[e].source.id)),d[e].getNormalizedParameterValue(_,l,this._parameterCaches[d[e].sourceParameterIndex],$[d[e].sourceParameterIndex],y[d[e].sourceParameterIndex],b[d[e].sourceParameterIndex],m.normalizationPosition,m.normalizationAngle,d[e].reflect,u);h=r.CubismMath.degreesToRadian(-l.angle),_.x=_.x*r.CubismMath.cos(h)-_.y*r.CubismMath.sin(h),_.y=_.x*r.CubismMath.sin(h)+_.y*r.CubismMath.cos(h),x(p,m.particleCount,_,l.angle,this._options.wind,.001*m.normalizationPosition.maximum,S,5);for(let i=0;i<m.outputCount;++i){const r=g[i].vertexIndex;if(-1==g[i].destinationParameterIndex&&(g[i].destinationParameterIndex=t.getParameterIndex(g[i].destination.id)),r<1||r>=m.particleCount)continue;const n=new s.CubismVector2;n.x=p[r].position.x-p[r-1].position.x,n.y=p[r].position.y-p[r-1].position.y,c=g[i].getValue(n,p,r,g[i].reflect,this._options.gravity),this._currentRigOutputs.at(e).outputs[i]=c;const o=g[i].destinationParameterIndex,a=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(o))):this._parameterCaches.slice(o);C(a,$[o],y[o],c,g[i]);for(let t=o,e=0;t<this._parameterCaches.length;t++,e++)this._parameterCaches[t]=a[e]}}this._currentRemainTime-=S}const v=this._currentRemainTime/S;this.interpolate(t,v)}interpolate(t,e){let i,r,s,n,o;s=t.getModel().parameters.values,n=t.getModel().parameters.maximumValues,o=t.getModel().parameters.minimumValues;for(let t=0;t<this._physicsRig.subRigCount;++t){r=this._physicsRig.settings.at(t),i=this._physicsRig.outputs.get(r.baseOutputIndex);for(let a=0;a<r.outputCount;++a){if(-1==i[a].destinationParameterIndex)continue;const r=i[a].destinationParameterIndex,l=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(s.subarray(r))):s.slice(r);C(l,o[r],n[r],this._previousRigOutputs.at(t).outputs[a]*(1-e)+this._currentRigOutputs.at(t).outputs[a]*e,i[a]);for(let t=r,e=0;t<s.length;t++,e++)s[t]=l[e]}}}setOptions(t){this._options=t}getOption(){return this._options}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){let t,e,i;for(let r=0;r<this._physicsRig.subRigCount;++r){e=this._physicsRig.settings.at(r),t=this._physicsRig.particles.get(e.baseParticleIndex),t[0].initialPosition=new s.CubismVector2(0,0),t[0].lastPosition=new s.CubismVector2(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new s.CubismVector2(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new s.CubismVector2(0,0),t[0].force=new s.CubismVector2(0,0);for(let r=1;r<e.particleCount;++r)i=new s.CubismVector2(0,0),i.y=t[r].radius,t[r].initialPosition=new s.CubismVector2(t[r-1].initialPosition.x+i.x,t[r-1].initialPosition.y+i.y),t[r].position=new s.CubismVector2(t[r].initialPosition.x,t[r].initialPosition.y),t[r].lastPosition=new s.CubismVector2(t[r].initialPosition.x,t[r].initialPosition.y),t[r].lastGravity=new s.CubismVector2(0,-1),t[r].lastGravity.y*=-1,t[r].velocity=new s.CubismVector2(0,0),t[r].force=new s.CubismVector2(0,0)}}}class c{constructor(){this.gravity=new s.CubismVector2(0,0),this.wind=new s.CubismVector2(0,0)}}class _{constructor(){this.outputs=new n.csmVector(0)}}function m(t,e,i,r,s,n,o,a,l,u){t.x+=w(i,r,s,n,o.minimum,o.maximum,o.defalut,l)*u}function d(t,e,i,r,s,n,o,a,l,u){t.y+=w(i,r,s,n,o.minimum,o.maximum,o.defalut,l)*u}function g(t,e,i,r,s,n,o,a,l,u){e.angle+=w(i,r,s,n,a.minimum,a.maximum,a.defalut,l)*u}function p(t,e,i,r,s){let n=t.x;return r&&(n*=-1),n}function f(t,e,i,r,s){let n=t.y;return r&&(n*=-1),n}function y(t,e,i,s,n){let o;return n=i>=2?e[i-1].position.substract(e[i-2].position):n.multiplyByScaler(-1),o=r.CubismMath.directionToRadian(n,t),s&&(o*=-1),o}function $(t,e){return r.CubismMath.min(t,e)+function(t,e){const i=r.CubismMath.max(t,e),s=r.CubismMath.min(t,e);return r.CubismMath.abs(i-s)}(t,e)/2}function b(t,e){return JSON.parse(JSON.stringify(t.x))}function S(t,e){return JSON.parse(JSON.stringify(t.y))}function v(t,e){return JSON.parse(JSON.stringify(e))}function x(t,e,i,n,o,a,l,u){let h,c,_,m,d=new s.CubismVector2(0,0),g=new s.CubismVector2(0,0),p=new s.CubismVector2(0,0),f=new s.CubismVector2(0,0);t[0].position=new s.CubismVector2(i.x,i.y),h=r.CubismMath.degreesToRadian(n),m=r.CubismMath.radianToDirection(h),m.normalize();for(let i=1;i<e;++i)t[i].force=m.multiplyByScaler(t[i].acceleration).add(o),t[i].lastPosition=new s.CubismVector2(t[i].position.x,t[i].position.y),c=t[i].delay*l*30,d=t[i].position.substract(t[i-1].position),_=r.CubismMath.directionToRadian(t[i].lastGravity,m)/u,d.x=r.CubismMath.cos(_)*d.x-d.y*r.CubismMath.sin(_),d.y=r.CubismMath.sin(_)*d.x+d.y*r.CubismMath.cos(_),t[i].position=t[i-1].position.add(d),g=t[i].velocity.multiplyByScaler(c),p=t[i].force.multiplyByScaler(c).multiplyByScaler(c),t[i].position=t[i].position.add(g).add(p),f=t[i].position.substract(t[i-1].position),f.normalize(),t[i].position=t[i-1].position.add(f.multiplyByScaler(t[i].radius)),r.CubismMath.abs(t[i].position.x)<a&&(t[i].position.x=0),0!=c&&(t[i].velocity=t[i].position.substract(t[i].lastPosition),t[i].velocity=t[i].velocity.divisionByScalar(c),t[i].velocity=t[i].velocity.multiplyByScaler(t[i].mobility)),t[i].force=new s.CubismVector2(0,0),t[i].lastGravity=new s.CubismVector2(m.x,m.y)}function P(t,e,i,n,o,a){let l,u,h=new s.CubismVector2(0,0);t[0].position=new s.CubismVector2(i.x,i.y),l=r.CubismMath.degreesToRadian(n),u=r.CubismMath.radianToDirection(l),u.normalize();for(let i=1;i<e;++i)t[i].force=u.multiplyByScaler(t[i].acceleration).add(o),t[i].lastPosition=new s.CubismVector2(t[i].position.x,t[i].position.y),t[i].velocity=new s.CubismVector2(0,0),h=t[i].force,h.normalize(),h=h.multiplyByScaler(t[i].radius),t[i].position=t[i-1].position.add(h),r.CubismMath.abs(t[i].position.x)<a&&(t[i].position.x=0),t[i].force=new s.CubismVector2(0,0),t[i].lastGravity=new s.CubismVector2(u.x,u.y)}function C(t,e,i,r,s){let n,o,a;n=s.getScale(s.translationScale,s.angleScale),o=r*n,o<e?(o<s.valueBelowMinimum&&(s.valueBelowMinimum=o),o=e):o>i&&(o>s.valueExceededMaximum&&(s.valueExceededMaximum=o),o=i),a=s.weight/100,a>=1||(o=t[0]*(1-a)+o*a),t[0]=o}function w(t,e,i,s,n,o,a,l){let u=0;const h=r.CubismMath.max(i,e);h<t&&(t=h);const c=r.CubismMath.min(i,e);c>t&&(t=c);const _=r.CubismMath.min(n,o),m=r.CubismMath.max(n,o),d=a,g=$(c,h),p=t-g;switch(function(t){let e=0;return t>0?e=1:t<0&&(e=-1),e}(p)){case 1:{const t=m-d,e=h-g;0!=e&&(u=p*(t/e),u+=d);break}case-1:{const t=_-d,e=c-g;0!=e&&(u=p*(t/e),u+=d);break}case 0:u=d}return l?u:-1*u}var M;!function(t){t.CubismPhysics=l.CubismPhysics,t.Options=l.Options}(M||(M={}))},"./src/Framework/physics/cubismphysicsinternal.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismPhysicsInput:()=>d,CubismPhysicsNormalization:()=>c,CubismPhysicsOutput:()=>g,CubismPhysicsParameter:()=>h,CubismPhysicsParticle:()=>_,CubismPhysicsRig:()=>p,CubismPhysicsSource:()=>s,CubismPhysicsSubRig:()=>m,CubismPhysicsTargetType:()=>r,Live2DCubismFramework:()=>n,PhysicsJsonEffectiveForces:()=>u});var r,s,n,o=i("./src/Framework/math/cubismvector2.ts"),a=i("./src/Framework/type/csmvector.ts"),l=i("./src/Framework/physics/cubismphysicsinternal.ts");!function(t){t[t.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter"}(r||(r={})),function(t){t[t.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",t[t.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",t[t.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle"}(s||(s={}));class u{constructor(){this.gravity=new o.CubismVector2(0,0),this.wind=new o.CubismVector2(0,0)}}class h{}class c{}class _{constructor(){this.initialPosition=new o.CubismVector2(0,0),this.position=new o.CubismVector2(0,0),this.lastPosition=new o.CubismVector2(0,0),this.lastGravity=new o.CubismVector2(0,0),this.force=new o.CubismVector2(0,0),this.velocity=new o.CubismVector2(0,0)}}class m{constructor(){this.normalizationPosition=new c,this.normalizationAngle=new c}}class d{constructor(){this.source=new h}}class g{constructor(){this.destination=new h,this.translationScale=new o.CubismVector2(0,0)}}class p{constructor(){this.settings=new a.csmVector,this.inputs=new a.csmVector,this.outputs=new a.csmVector,this.particles=new a.csmVector,this.gravity=new o.CubismVector2(0,0),this.wind=new o.CubismVector2(0,0),this.fps=0}}!function(t){t.CubismPhysicsInput=l.CubismPhysicsInput,t.CubismPhysicsNormalization=l.CubismPhysicsNormalization,t.CubismPhysicsOutput=l.CubismPhysicsOutput,t.CubismPhysicsParameter=l.CubismPhysicsParameter,t.CubismPhysicsParticle=l.CubismPhysicsParticle,t.CubismPhysicsRig=l.CubismPhysicsRig,t.CubismPhysicsSource=l.CubismPhysicsSource,t.CubismPhysicsSubRig=l.CubismPhysicsSubRig,t.CubismPhysicsTargetType=l.CubismPhysicsTargetType,t.PhysicsJsonEffectiveForces=l.PhysicsJsonEffectiveForces}(n||(n={}))},"./src/Framework/physics/cubismphysicsjson.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismPhysicsJson:()=>P,Live2DCubismFramework:()=>C});var r=i("./src/Framework/live2dcubismframework.ts"),s=i("./src/Framework/math/cubismvector2.ts"),n=i("./src/Framework/utils/cubismjson.ts"),o=i("./src/Framework/physics/cubismphysicsjson.ts");const a="Position",l="Angle",u="Type",h="Meta",c="EffectiveForces",_="Gravity",m="Wind",d="PhysicsSettings",g="Normalization",p="Minimum",f="Maximum",y="Default",$="Reflect",b="Weight",S="Input",v="Output",x="Vertices";class P{constructor(t,e){this._json=n.CubismJson.create(t,e)}release(){n.CubismJson.delete(this._json)}getGravity(){const t=new s.CubismVector2(0,0);return t.x=this._json.getRoot().getValueByString(h).getValueByString(c).getValueByString(_).getValueByString("X").toFloat(),t.y=this._json.getRoot().getValueByString(h).getValueByString(c).getValueByString(_).getValueByString("Y").toFloat(),t}getWind(){const t=new s.CubismVector2(0,0);return t.x=this._json.getRoot().getValueByString(h).getValueByString(c).getValueByString(m).getValueByString("X").toFloat(),t.y=this._json.getRoot().getValueByString(h).getValueByString(c).getValueByString(m).getValueByString("Y").toFloat(),t}getFps(){return this._json.getRoot().getValueByString(h).getValueByString("Fps").toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(h).getValueByString("PhysicsSettingCount").toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(h).getValueByString("TotalInputCount").toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(h).getValueByString("TotalOutputCount").toInt()}getVertexCount(){return this._json.getRoot().getValueByString(h).getValueByString("VertexCount").toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(g).getValueByString(a).getValueByString(p).toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(g).getValueByString(a).getValueByString(f).toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(g).getValueByString(a).getValueByString(y).toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(g).getValueByString(l).getValueByString(p).toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(g).getValueByString(l).getValueByString(f).toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(g).getValueByString(l).getValueByString(y).toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(S).getVector().getSize()}getInputWeight(t,e){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(S).getValueByIndex(e).getValueByString(b).toFloat()}getInputReflect(t,e){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(S).getValueByIndex(e).getValueByString($).toBoolean()}getInputType(t,e){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(S).getValueByIndex(e).getValueByString(u).getRawString()}getInputSourceId(t,e){return r.CubismFramework.getIdManager().getId(this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(S).getValueByIndex(e).getValueByString("Source").getValueByString("Id").getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(v).getVector().getSize()}getOutputVertexIndex(t,e){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(v).getValueByIndex(e).getValueByString("VertexIndex").toInt()}getOutputAngleScale(t,e){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(v).getValueByIndex(e).getValueByString("Scale").toFloat()}getOutputWeight(t,e){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(v).getValueByIndex(e).getValueByString(b).toFloat()}getOutputDestinationId(t,e){return r.CubismFramework.getIdManager().getId(this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(v).getValueByIndex(e).getValueByString("Destination").getValueByString("Id").getRawString())}getOutputType(t,e){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(v).getValueByIndex(e).getValueByString(u).getRawString()}getOutputReflect(t,e){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(v).getValueByIndex(e).getValueByString($).toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(x).getVector().getSize()}getParticleMobility(t,e){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(x).getValueByIndex(e).getValueByString("Mobility").toFloat()}getParticleDelay(t,e){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(x).getValueByIndex(e).getValueByString("Delay").toFloat()}getParticleAcceleration(t,e){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(x).getValueByIndex(e).getValueByString("Acceleration").toFloat()}getParticleRadius(t,e){return this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(x).getValueByIndex(e).getValueByString("Radius").toFloat()}getParticlePosition(t,e){const i=new s.CubismVector2(0,0);return i.x=this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(x).getValueByIndex(e).getValueByString(a).getValueByString("X").toFloat(),i.y=this._json.getRoot().getValueByString(d).getValueByIndex(t).getValueByString(x).getValueByIndex(e).getValueByString(a).getValueByString("Y").toFloat(),i}}var C;!function(t){t.CubismPhysicsJson=o.CubismPhysicsJson}(C||(C={}))},"./src/Framework/rendering/cubismrenderer.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismBlendMode:()=>r,CubismRenderer:()=>a,CubismTextureColor:()=>l,Live2DCubismFramework:()=>s});var r,s,n=i("./src/Framework/math/cubismmatrix44.ts"),o=i("./src/Framework/rendering/cubismrenderer.ts");class a{constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new l,this._mvpMatrix4x4=new n.CubismMatrix44,this._mvpMatrix4x4.loadIdentity()}static create(){return null}static delete(t){null}initialize(t){this._model=t}drawModel(){null!=this.getModel()&&this.doDrawModel()}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,r){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),r<0?r=0:r>1&&(r=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=i,this._modelColor.A=r}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}}!function(t){t[t.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",t[t.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",t[t.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative"}(r||(r={}));class l{constructor(){this.R=1,this.G=1,this.B=1,this.A=1}}!function(t){t.CubismBlendMode=o.CubismBlendMode,t.CubismRenderer=o.CubismRenderer,t.CubismTextureColor=o.CubismTextureColor}(s||(s={}))},"./src/Framework/rendering/cubismrenderer_webgl.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismClippingContext:()=>p,CubismClippingManager_WebGL:()=>d,CubismRenderTextureResource:()=>g,CubismRenderer_WebGL:()=>M,CubismShaderSet:()=>y,CubismShader_WebGL:()=>f,Live2DCubismFramework:()=>T,ShaderNames:()=>$,fragmentShaderSrcMaskInvertedPremultipliedAlpha:()=>w,fragmentShaderSrcMaskPremultipliedAlpha:()=>C,fragmentShaderSrcPremultipliedAlpha:()=>P,fragmentShaderSrcsetupMask:()=>S,vertexShaderSrc:()=>v,vertexShaderSrcMasked:()=>x,vertexShaderSrcSetupMask:()=>b});var r=i("./src/Framework/live2dcubismframework.ts"),s=i("./src/Framework/math/cubismmatrix44.ts"),n=i("./src/Framework/type/csmmap.ts"),o=i("./src/Framework/type/csmrectf.ts"),a=i("./src/Framework/type/csmvector.ts"),l=i("./src/Framework/utils/cubismdebug.ts"),u=i("./src/Framework/rendering/cubismrenderer.ts"),h=i("./src/Framework/rendering/cubismrenderer_webgl.ts");let c,_,m;class d{constructor(){this._maskRenderTexture=null,this._colorBuffer=null,this._currentFrameNo=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new a.csmVector,this._clippingContextListForDraw=new a.csmVector,this._channelColors=new a.csmVector,this._tmpBoundsOnModel=new o.csmRect,this._tmpMatrix=new s.CubismMatrix44,this._tmpMatrixForMask=new s.CubismMatrix44,this._tmpMatrixForDraw=new s.CubismMatrix44,this._maskTexture=null;let t=new u.CubismTextureColor;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new u.CubismTextureColor,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new u.CubismTextureColor,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.pushBack(t),t=new u.CubismTextureColor,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.pushBack(t)}getChannelFlagAsColor(t){return this._channelColors.at(t)}getMaskRenderTexture(){let t=0;if(this._maskTexture&&0!=this._maskTexture.texture&&(this._maskTexture.frameNo=this._currentFrameNo,t=this._maskTexture.texture),0==t){const e=this._clippingMaskBufferSize;this._colorBuffer=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this._colorBuffer),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),t=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._colorBuffer,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,m),this._maskTexture=new g(this._currentFrameNo,t)}return t}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,s=Number.MAX_VALUE,n=Number.MIN_VALUE,o=Number.MIN_VALUE;const a=e._clippedDrawableIndexList.length;for(let l=0;l<a;l++){const a=e._clippedDrawableIndexList[l],u=t.getDrawableVertexCount(a),h=t.getDrawableVertices(a);let c=Number.MAX_VALUE,_=Number.MAX_VALUE,m=Number.MIN_VALUE,d=Number.MIN_VALUE;const g=u*r.Constant.vertexStep;for(let t=r.Constant.vertexOffset;t<g;t+=r.Constant.vertexStep){const e=h[t],i=h[t+1];e<c&&(c=e),e>m&&(m=e),i<_&&(_=i),i>d&&(d=i)}if(c!=Number.MAX_VALUE)if(c<i&&(i=c),_<s&&(s=_),m>n&&(n=m),d>o&&(o=d),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const t=n-i,r=o-s;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=s,e._allClippedDrawRect.width=t,e._allClippedDrawRect.height=r}}}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);this._clippingContextListForDraw=null,this._maskTexture&&(this.gl.deleteFramebuffer(this._maskTexture.texture),this._maskTexture=null);for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);this._channelColors=null,this.gl.deleteTexture(this._colorBuffer),this._colorBuffer=null}initialize(t,e,i,r){for(let t=0;t<e;t++){if(r[t]<=0){this._clippingContextListForDraw.pushBack(null);continue}let e=this.findSameClip(i[t],r[t]);null==e&&(e=new p(this,i[t],r[t]),this._clippingContextListForMask.pushBack(e)),e.addClippedDrawable(t),this._clippingContextListForDraw.pushBack(e)}}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let e=0;e<this._clippingContextListForMask.getSize();e++){const r=this._clippingContextListForMask.at(e);this.calcClippedDrawTotalBounds(t,r),r._isUsing&&i++}if(i>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._maskRenderTexture=this.getMaskRenderTexture();e.getMvpMatrix();e.preDraw(),this.setupLayoutBounds(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTexture),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(let i=0;i<this._clippingContextListForMask.getSize();i++){const r=this._clippingContextListForMask.at(i),s=r._allClippedDrawRect,n=r._layoutBounds,o=.05;this._tmpBoundsOnModel.setRect(s),this._tmpBoundsOnModel.expand(s.width*o,s.height*o);const a=n.width/this._tmpBoundsOnModel.width,l=n.height/this._tmpBoundsOnModel.height;this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(a,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(a,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),r._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),r._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());const h=r._clippingIdCount;for(let i=0;i<h;i++){const s=r._clippingIdList[i];t.getDrawableDynamicFlagVertexPositionsDidChange(s)&&(e.setIsCulling(0!=t.getDrawableCulling(s)),e.setClippingContextBufferForMask(r),e.drawMesh(t.getDrawableTextureIndex(s),t.getDrawableVertexIndexCount(s),t.getDrawableVertexCount(s),t.getDrawableVertexIndices(s),t.getDrawableVertices(s),t.getDrawableVertexUvs(s),t.getMultiplyColor(s),t.getScreenColor(s),t.getDrawableOpacity(s),u.CubismBlendMode.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,m),e.setClippingContextBufferForMask(null),this.gl.viewport(_[0],_[1],_[2],_[3])}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.getSize();i++){const r=this._clippingContextListForMask.at(i),s=r._clippingIdCount;if(s!=e)continue;let n=0;for(let e=0;e<s;e++){const i=r._clippingIdList[e];for(let e=0;e<s;e++)if(t[e]==i){n++;break}}if(n==s)return r}return null}setupLayoutBounds(t){let e=t/4,i=t%4;e=~~e,i=~~i;let r=0;for(let t=0;t<4;t++){const s=e+(t<i?1:0);if(0==s);else if(1==s){const e=this._clippingContextListForMask.at(r++);e._layoutChannelNo=t,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1}else if(2==s)for(let e=0;e<s;e++){let i=e%2;i=~~i;const s=this._clippingContextListForMask.at(r++);s._layoutChannelNo=t,s._layoutBounds.x=.5*i,s._layoutBounds.y=0,s._layoutBounds.width=.5,s._layoutBounds.height=1}else if(s<=4)for(let e=0;e<s;e++){let i=e%2,s=e/2;i=~~i,s=~~s;const n=this._clippingContextListForMask.at(r++);n._layoutChannelNo=t,n._layoutBounds.x=.5*i,n._layoutBounds.y=.5*s,n._layoutBounds.width=.5,n._layoutBounds.height=.5}else if(s<=9)for(let e=0;e<s;e++){let i=e%3,s=e/3;i=~~i,s=~~s;const n=this._clippingContextListForMask.at(r++);n._layoutChannelNo=t,n._layoutBounds.x=i/3,n._layoutBounds.y=s/3,n._layoutBounds.width=1/3,n._layoutBounds.height=1/3}else{(0,l.CubismLogError)("not supported mask count : {0}",s);for(let t=0;t<s;t++){const t=this._clippingContextListForMask.at(r++);t._layoutChannelNo=0,t._layoutBounds.x=0,t._layoutBounds.y=0,t._layoutBounds.width=1,t._layoutBounds.height=1}}}}getColorBuffer(){return this._colorBuffer}getClippingContextListForDraw(){return this._clippingContextListForDraw}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}}class g{constructor(t,e){this.frameNo=t,this.texture=e}}class p{constructor(t,e,i){this._owner=t,this._clippingIdList=e,this._clippingIdCount=i,this._allClippedDrawRect=new o.csmRect,this._layoutBounds=new o.csmRect,this._clippedDrawableIndexList=[],this._matrixForMask=new s.CubismMatrix44,this._matrixForDraw=new s.CubismMatrix44}release(){null!=this._layoutBounds&&(this._layoutBounds=null),null!=this._allClippedDrawRect&&(this._allClippedDrawRect=null),null!=this._clippedDrawableIndexList&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class f{constructor(){this._shaderSets=new a.csmVector}static getInstance(){return null==c?(c=new f,c):c}static deleteInstance(){c&&(c.release(),c=null)}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,i,r,s,n,o,a,h,c,_,m,d,g,p){let f,b,S,v;if(d||(0,l.CubismLogError)("NoPremultipliedAlpha is not allowed"),0==this._shaderSets.getSize()&&this.generateShaders(),null!=t.getClippingContextBufferForMask()){const i=this._shaderSets.at($.ShaderNames_SetupMask);this.gl.useProgram(i.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(i.samplerTexture0Location,0),null==o.vertex&&(o.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(i.attributePositionLocation),this.gl.vertexAttribPointer(i.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==o.uv&&(o.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(i.attributeTexCoordLocation),this.gl.vertexAttribPointer(i.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const s=t.getClippingContextBufferForMask()._layoutChannelNo,a=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(s);this.gl.uniform4f(i.uniformChannelFlagLocation,a.R,a.G,a.B,a.A),this.gl.uniformMatrix4fv(i.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());const l=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(i.uniformBaseColorLocation,2*l.x-1,2*l.y-1,2*l.getRight()-1,2*l.getBottom()-1),this.gl.uniform4f(i.uniformMultiplyColorLocation,_.R,_.G,_.B,_.A),this.gl.uniform4f(i.uniformScreenColorLocation,m.R,m.G,m.B,m.A),f=this.gl.ZERO,b=this.gl.ONE_MINUS_SRC_COLOR,S=this.gl.ZERO,v=this.gl.ONE_MINUS_SRC_ALPHA}else{const i=null!=t.getClippingContextBufferForDraw(),s=i?p?2:1:0;let a=new y;switch(h){case u.CubismBlendMode.CubismBlendMode_Normal:default:a=this._shaderSets.at($.ShaderNames_NormalPremultipliedAlpha+s),f=this.gl.ONE,b=this.gl.ONE_MINUS_SRC_ALPHA,S=this.gl.ONE,v=this.gl.ONE_MINUS_SRC_ALPHA;break;case u.CubismBlendMode.CubismBlendMode_Additive:a=this._shaderSets.at($.ShaderNames_AddPremultipliedAlpha+s),f=this.gl.ONE,b=this.gl.ONE,S=this.gl.ZERO,v=this.gl.ONE;break;case u.CubismBlendMode.CubismBlendMode_Multiplicative:a=this._shaderSets.at($.ShaderNames_MultPremultipliedAlpha+s),f=this.gl.DST_COLOR,b=this.gl.ONE_MINUS_SRC_ALPHA,S=this.gl.ZERO,v=this.gl.ONE}if(this.gl.useProgram(a.shaderProgram),null==o.vertex&&(o.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(a.attributePositionLocation),this.gl.vertexAttribPointer(a.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==o.uv&&(o.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(a.attributeTexCoordLocation),this.gl.vertexAttribPointer(a.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),i){this.gl.activeTexture(this.gl.TEXTURE1);const e=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer();this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(a.samplerTexture1Location,1),this.gl.uniformMatrix4fv(a.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());const i=t.getClippingContextBufferForDraw()._layoutChannelNo,r=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(i);this.gl.uniform4f(a.uniformChannelFlagLocation,r.R,r.G,r.B,r.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(a.samplerTexture0Location,0),this.gl.uniformMatrix4fv(a.uniformMatrixLocation,!1,g.getArray()),this.gl.uniform4f(a.uniformBaseColorLocation,c.R,c.G,c.B,c.A),this.gl.uniform4f(a.uniformMultiplyColorLocation,_.R,_.G,_.B,_.A),this.gl.uniform4f(a.uniformScreenColorLocation,m.R,m.G,m.B,m.A)}null==o.index&&(o.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,o.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(f,b,S,v)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<10;t++)this._shaderSets.pushBack(new y);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(b,S),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(v,P),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(x,C),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(x,w),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(t,e){let i=this.gl.createProgram(),r=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!r)return(0,l.CubismLogError)("Vertex shader compile error!"),0;let s=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);if(!s)return(0,l.CubismLogError)("Vertex shader compile error!"),0;this.gl.attachShader(i,r),this.gl.attachShader(i,s),this.gl.linkProgram(i);return this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(r),this.gl.deleteShader(s),i):((0,l.CubismLogError)("Failed to link program: {0}",i),this.gl.deleteShader(r),r=0,this.gl.deleteShader(s),s=0,i&&(this.gl.deleteProgram(i),i=0),0)}compileShaderSource(t,e){const i=e,r=this.gl.createShader(t);if(this.gl.shaderSource(r,i),this.gl.compileShader(r),!r){const t=this.gl.getShaderInfoLog(r);(0,l.CubismLogError)("Shader compile log: {0} ",t)}return this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:(this.gl.deleteShader(r),null)}setGl(t){this.gl=t}}class y{}var $;!function(t){t[t.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",t[t.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",t[t.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",t[t.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",t[t.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",t[t.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",t[t.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",t[t.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",t[t.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",t[t.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted"}($||($={}));const b="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",S="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",v="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",x="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",P="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",C="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",w="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";class M extends u.CubismRenderer{constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._clippingManager=new d,this.firstDraw=!0,this._textures=new n.csmMap,this._sortedDrawableIndexList=new a.csmVector,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}initialize(t){t.isUsingMasking()&&(this._clippingManager=new d,this._clippingManager.initialize(t,t.getDrawableCount(),t.getDrawableMasks(),t.getDrawableMaskCounts())),this._sortedDrawableIndexList.resize(t.getDrawableCount(),0),super.initialize(t)}bindTexture(t,e){this._textures.setValue(t,e)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new d,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts())}getClippingMaskBufferSize(){return this._clippingManager.getClippingMaskBufferSize()}release(){this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null}doDrawModel(){null!=this._clippingManager&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const t=e[i];this._sortedDrawableIndexList.set(t,i)}for(let e=0;e<t;++e){const t=this._sortedDrawableIndexList.at(e);this.getModel().getDrawableDynamicFlagIsVisible(t)&&(this.setClippingContextBufferForDraw(null!=this._clippingManager?this._clippingManager.getClippingContextListForDraw().at(t):null),this.setIsCulling(this.getModel().getDrawableCulling(t)),this.drawMesh(this.getModel().getDrawableTextureIndex(t),this.getModel().getDrawableVertexIndexCount(t),this.getModel().getDrawableVertexCount(t),this.getModel().getDrawableVertexIndices(t),this.getModel().getDrawableVertices(t),this.getModel().getDrawableVertexUvs(t),this.getModel().getMultiplyColor(t),this.getModel().getScreenColor(t),this.getModel().getDrawableOpacity(t),this.getModel().getDrawableBlendMode(t),this.getModel().getDrawableInvertedMaskBit(t)))}}drawMesh(t,e,i,r,s,n,o,a,l,u,h){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const c=this.getModelColor();let _;null==this.getClippingContextBufferForMask()&&(c.A*=l,this.isPremultipliedAlpha()&&(c.R*=c.A,c.G*=c.A,c.B*=c.A)),_=null!=this._textures.getValue(t)?this._textures.getValue(t):null,f.getInstance().setupShaderProgram(this,_,i,s,r,n,this._bufferData,l,u,c,o,a,this.isPremultipliedAlpha(),this.getMvpMatrix(),h),this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}static doStaticRelease(){f.deleteInstance()}setRenderState(t,e){m=t,_=e}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(let t=0;t<this._textures.getSize();++t)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(t)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(t){this.gl=t,this._clippingManager.setGL(t),f.getInstance().setGl(t),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}var T;u.CubismRenderer.staticRelease=()=>{M.doStaticRelease()},function(t){t.CubismClippingContext=h.CubismClippingContext,t.CubismClippingManager_WebGL=h.CubismClippingManager_WebGL,t.CubismRenderTextureResource=h.CubismRenderTextureResource,t.CubismRenderer_WebGL=h.CubismRenderer_WebGL,t.CubismShaderSet=h.CubismShaderSet,t.CubismShader_WebGL=h.CubismShader_WebGL,t.ShaderNames=h.ShaderNames}(T||(T={}))},"./src/Framework/type/csmmap.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{Live2DCubismFramework:()=>r,csmMap:()=>a,csmPair:()=>o,iterator:()=>l});var r,s=i("./src/Framework/utils/cubismdebug.ts"),n=i("./src/Framework/type/csmmap.ts");class o{constructor(t,e){this.first=null==t?null:t,this.second=null==e?null:e}}class a{constructor(t){null!=t?t<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(t){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new o(t),this._size+=1}getValue(t){let e=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t){e=i;break}return e>=0?this._keyValues[e].second:(this.appendKey(t),this._keyValues[this._size-1].second)}setValue(t,e){let i=-1;for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t){i=e;break}i>=0?this._keyValues[i].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)}isExist(t){for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(t,e){t>this._keyValues.length&&(0==this._keyValues.length?(!e&&t<a.DefaultSize&&(t=a.DefaultSize),this._keyValues.length=t):(!e&&t<2*this._keyValues.length&&(t=2*this._keyValues.length),this._keyValues.length=t))}begin(){return new l(this,0)}end(){return new l(this,this._size)}erase(t){const e=t._index;if(e<0||this._size<=e)return t;this._keyValues.splice(e,1),--this._size;return new l(this,e)}dumpAsInt(){for(let t=0;t<this._size;t++)(0,s.CubismLogDebug)("{0} ,",this._keyValues[t]),(0,s.CubismLogDebug)("\n")}}a.DefaultSize=10;class l{constructor(t,e){this._map=null!=t?t:new a,this._index=null!=e?e:0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new l(this._map,this._index++)}decrement(){const t=new l(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}}!function(t){t.csmMap=n.csmMap,t.csmPair=n.csmPair,t.iterator=n.iterator}(r||(r={}))},"./src/Framework/type/csmrectf.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{Live2DCubismFramework:()=>r,csmRect:()=>n});var r,s=i("./src/Framework/type/csmrectf.ts");class n{constructor(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e}}!function(t){t.csmRect=s.csmRect}(r||(r={}))},"./src/Framework/type/csmstring.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{Live2DCubismFramework:()=>r,csmString:()=>n});var r,s=i("./src/Framework/type/csmstring.ts");class n{constructor(t){this.s=t}append(t,e){return this.s+=void 0!==e?t.substr(0,e):t,this}expansion(t,e){for(let i=0;i<t;i++)this.append(e);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return 0==this.s.length}}!function(t){t.csmString=s.csmString}(r||(r={}))},"./src/Framework/type/csmvector.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{Live2DCubismFramework:()=>r,csmVector:()=>n,iterator:()=>o});var r,s=i("./src/Framework/type/csmvector.ts");class n{constructor(t=0){t<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}at(t){return this._ptr[t]}set(t,e){this._ptr[t]=e}get(t=0){const e=new Array;for(let i=t;i<this._size;i++)e.push(this._ptr[i]);return e}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(0==this._capacity?n.s_defaultSize:2*this._capacity),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,e){this._size<t&&this.prepareCapacity(t);for(let i=0;i<t;i++)this._ptr[i]=e;this._size=t}resize(t,e=null){this.updateSize(t,e,!0)}updateSize(t,e=null,i=!0){if(this._size<t)if(this.prepareCapacity(t),i)for(let i=this._size;i<t;i++)this._ptr[i]="function"==typeof e?JSON.parse(JSON.stringify(new e)):e;else for(let i=this._size;i<t;i++)this._ptr[i]=e;else{const e=this._size-t;this._ptr.splice(this._size-e,e)}this._size=t}insert(t,e,i){let r=t._index;const s=e._index,n=i._index,o=n-s;this.prepareCapacity(this._size+o);const a=this._size-r;if(a>0)for(let t=0;t<a;t++)this._ptr.splice(r+t,0,null);for(let t=s;t<n;t++,r++)this._ptr[r]=e._vector._ptr[t];this._size=this._size+o}remove(t){return!(t<0||this._size<=t)&&(this._ptr.splice(t,1),--this._size,!0)}erase(t){const e=t._index;if(e<0||this._size<=e)return t;this._ptr.splice(e,1),--this._size;return new o(this,e)}prepareCapacity(t){t>this._capacity&&(0==this._capacity?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))}begin(){return 0==this._size?this.end():new o(this,0)}end(){return new o(this,this._size)}getOffset(t){const e=new n;return e._ptr=this.get(t),e._size=this.get(t).length,e._capacity=this.get(t).length,e}}n.s_defaultSize=10;class o{constructor(t,e){this._vector=null!=t?t:null,this._index=null!=e?e:0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new o(this._vector,this._index++)}decrement(){return new o(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}}!function(t){t.csmVector=s.csmVector,t.iterator=s.iterator}(r||(r={}))},"./src/Framework/utils/cubismdebug.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CSM_ASSERT:()=>l,CubismDebug:()=>d,CubismLogDebug:()=>h,CubismLogError:()=>m,CubismLogInfo:()=>c,CubismLogPrint:()=>o,CubismLogPrintIn:()=>a,CubismLogVerbose:()=>u,CubismLogWarning:()=>_,Live2DCubismFramework:()=>g});var r=i("./src/Framework/cubismframeworkconfig.ts"),s=i("./src/Framework/live2dcubismframework.ts"),n=i("./src/Framework/utils/cubismdebug.ts");const o=(t,e,i)=>{d.print(t,"[CSM]"+e,i)},a=(t,e,i)=>{o(t,e+"\n",i)},l=t=>{console.assert(t)};let u,h,c,_,m;r.CSM_LOG_LEVEL<=r.CSM_LOG_LEVEL_VERBOSE?(u=(t,...e)=>{a(s.LogLevel.LogLevel_Verbose,"[V]"+t,e)},h=(t,...e)=>{a(s.LogLevel.LogLevel_Debug,"[D]"+t,e)},c=(t,...e)=>{a(s.LogLevel.LogLevel_Info,"[I]"+t,e)},_=(t,...e)=>{a(s.LogLevel.LogLevel_Warning,"[W]"+t,e)},m=(t,...e)=>{a(s.LogLevel.LogLevel_Error,"[E]"+t,e)}):r.CSM_LOG_LEVEL==r.CSM_LOG_LEVEL_DEBUG?(h=(t,...e)=>{a(s.LogLevel.LogLevel_Debug,"[D]"+t,e)},c=(t,...e)=>{a(s.LogLevel.LogLevel_Info,"[I]"+t,e)},_=(t,...e)=>{a(s.LogLevel.LogLevel_Warning,"[W]"+t,e)},m=(t,...e)=>{a(s.LogLevel.LogLevel_Error,"[E]"+t,e)}):r.CSM_LOG_LEVEL==r.CSM_LOG_LEVEL_INFO?(c=(t,...e)=>{a(s.LogLevel.LogLevel_Info,"[I]"+t,e)},_=(t,...e)=>{a(s.LogLevel.LogLevel_Warning,"[W]"+t,e)},m=(t,...e)=>{a(s.LogLevel.LogLevel_Error,"[E]"+t,e)}):r.CSM_LOG_LEVEL==r.CSM_LOG_LEVEL_WARNING?(_=(t,...e)=>{a(s.LogLevel.LogLevel_Warning,"[W]"+t,e)},m=(t,...e)=>{a(s.LogLevel.LogLevel_Error,"[E]"+t,e)}):r.CSM_LOG_LEVEL==r.CSM_LOG_LEVEL_ERROR&&(m=(t,...e)=>{a(s.LogLevel.LogLevel_Error,"[E]"+t,e)});class d{static print(t,e,i){if(t<s.CubismFramework.getLoggingLevel())return;const r=s.CubismFramework.coreLogFunction;if(!r)return;r(e.replace(/\{(\d+)\}/g,((t,e)=>i[e])))}static dumpBytes(t,e,i){for(let r=0;r<i;r++)r%16==0&&r>0?this.print(t,"\n"):r%8==0&&r>0&&this.print(t,"  "),this.print(t,"{0} ",[255&e[r]]);this.print(t,"\n")}constructor(){}}var g;!function(t){t.CubismDebug=n.CubismDebug}(g||(g={}))},"./src/Framework/utils/cubismjson.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismJson:()=>_,JsonArray:()=>y,JsonBoolean:()=>d,JsonError:()=>p,JsonFloat:()=>m,JsonMap:()=>$,JsonNullvalue:()=>f,JsonString:()=>g,Live2DCubismFramework:()=>b,Value:()=>c});var r=i("./src/Framework/live2dcubismframework.ts"),s=i("./src/Framework/type/csmmap.ts"),n=i("./src/Framework/type/csmstring.ts"),o=i("./src/Framework/type/csmvector.ts"),a=i("./src/Framework/utils/cubismdebug.ts"),l=i("./src/Framework/utils/cubismjson.ts"),u=i("./src/Framework/utils/cubismjsonextension.ts");const h="Error: type mismatch";class c{constructor(){}getRawString(t,e){return this.getString(t,e)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t=new o.csmVector){return t}getMap(t){return t}getValueByIndex(t){return c.errorValue.setErrorNotForClientCall(h)}getValueByString(t){return c.nullValue.setErrorNotForClientCall(h)}getKeys(){return c.s_dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return p.errorValue}static staticInitializeNotForClientCall(){d.trueValue=new d(!0),d.falseValue=new d(!1),c.errorValue=new p("ERROR",!0),c.nullValue=new f,c.s_dummyKeys=new o.csmVector}static staticReleaseNotForClientCall(){d.trueValue=null,d.falseValue=null,c.errorValue=null,c.nullValue=null,c.s_dummyKeys=null}}class _{constructor(t,e){this._parseCallback=u.CubismJsonExtension.parseJsonObject,this._error=null,this._lineCount=0,this._root=null,null!=t&&this.parseBytes(t,e,this._parseCallback)}static create(t,e){const i=new _;return i.parseBytes(t,e,i._parseCallback)?i:(_.delete(i),null)}static delete(t){null}getRoot(){return this._root}static arrayBufferToString(t){const e=new Uint8Array(t);let i="";for(let t=0,r=e.length;t<r;++t)i+="%"+this.pad(e[t].toString(16));return i=decodeURIComponent(i),i}static pad(t){return t.length<2?"0"+t:t}parseBytes(t,e,i){const r=new Array(1),s=_.arrayBufferToString(t);if(this._root=null==i?this.parseValue(s,e,0,r):i(JSON.parse(s),new $),this._error){let t="\0";return t="Json parse error : @line "+(this._lineCount+1)+"\n",this._root=new g(t),(0,a.CubismLogInfo)("{0}",this._root.getRawString()),!1}return null!=this._root||(this._root=new p(new n.csmString(this._error),!1),!1)}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,e,i,s){if(this._error)return null;let n,o=null,a=i;for(;a<e;a++){switch(t[a]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const e=new Array(1);return n=(0,r.strtod)(t.slice(a),e),s[0]=t.indexOf(e[0]),new m(n)}case'"':return new g(this.parseString(t,e,a+1,s));case"[":return o=this.parseArray(t,e,a+1,s),o;case"{":return o=this.parseObject(t,e,a+1,s),o;case"n":return a+3<e?(o=new f,s[0]=a+4):this._error="parse null",o;case"t":return a+3<e?(o=d.trueValue,s[0]=a+4):this._error="parse true",o;case"f":return a+4<e?(o=d.falseValue,s[0]=a+5):this._error="illegal ',' position",o;case",":return this._error="illegal ',' position",null;case"]":return s[0]=a,null;case"\n":this._lineCount++}}return this._error="illegal end of value",null}parseString(t,e,i,r){if(this._error)return null;let s,o,a=i;const l=new n.csmString("");let u=i;for(;a<e;a++)switch(s=t[a],s){case'"':return r[0]=a+1,l.append(t.slice(u),a-u),l.s;case"//":if(a++,a-1>u&&l.append(t.slice(u),a-u),u=a+1,a<e)switch(o=t[a],o){case"\\":l.expansion(1,"\\");break;case'"':l.expansion(1,'"');break;case"/":l.expansion(1,"/");break;case"b":l.expansion(1,"\b");break;case"f":l.expansion(1,"\f");break;case"n":l.expansion(1,"\n");break;case"r":l.expansion(1,"\r");break;case"t":l.expansion(1,"\t");break;case"u":this._error="parse string/unicord escape not supported"}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(t,e,i,r){if(this._error)return null;const s=new $;let n="",o=i,a="";const l=Array(1);let u=!1;for(;o<e;o++){t:for(;o<e;o++)switch(a=t[o],a){case'"':if(n=this.parseString(t,e,o+1,l),this._error)return null;o=l[0],u=!0;break t;case"}":return r[0]=o+1,s;case":":this._error="illegal ':' position";break;case"\n":this._lineCount++}if(!u)return this._error="key not found",null;u=!1;t:for(;o<e;o++)switch(a=t[o],a){case":":u=!0,o++;break t;case"}":this._error="illegal '}' position";break;case"\n":this._lineCount++}if(!u)return this._error="':' not found",null;const i=this.parseValue(t,e,o,l);if(this._error)return null;o=l[0],s.put(n,i);t:for(;o<e;o++)switch(a=t[o],a){case",":break t;case"}":return r[0]=o+1,s;case"\n":this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(t,e,i,r){if(this._error)return null;let s,n=new y,o=i;const a=new Array(1);for(;o<e;o++){const i=this.parseValue(t,e,o,a);if(this._error)return null;o=a[0],i&&n.add(i);t:for(;o<e;o++)switch(s=t[o],s){case",":break t;case"]":return r[0]=o+1,n;case"\n":++this._lineCount}}return n=void 0,this._error="illegal end of parseObject",null}}class m extends c{constructor(t){super(),this._value=t}isFloat(){return!0}getString(t,e){return this._value=parseFloat("\0"),this._stringBuffer="\0",this._stringBuffer}toInt(t=0){return parseInt(this._value.toString())}toFloat(t=0){return this._value}equals(t){return"number"==typeof t&&(!Math.round(t)&&t==this._value)}}class d extends c{constructor(t){super(),this._boolValue=t}isBool(){return!0}toBoolean(t=!1){return this._boolValue}getString(t,e){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(t){return"boolean"==typeof t&&t==this._boolValue}isStatic(){return!0}}class g extends c{constructor(t){super(),"string"==typeof t&&(this._stringBuffer=t),t instanceof n.csmString&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,e){return this._stringBuffer}equals(t){return"string"==typeof t?this._stringBuffer==t:t instanceof n.csmString&&this._stringBuffer==t.s}}class p extends g{constructor(t,e){super(t),this._isStatic=e}isStatic(){return this._isStatic}setErrorNotForClientCall(t){return this._stringBuffer=t,this}isError(){return!0}}class f extends c{isNull(){return!0}getString(t,e){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(t){return this._stringBuffer=t,p.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class y extends c{constructor(){super(),this._array=new o.csmVector}release(){for(let t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){let e=t.ptr();e&&!e.isStatic()&&(e=void 0,e=null)}}isArray(){return!0}getValueByIndex(t){if(t<0||this._array.getSize()<=t)return c.errorValue.setErrorNotForClientCall("Error: index out of bounds");const e=this._array.at(t);return null==e?c.nullValue:e}getValueByString(t){return c.errorValue.setErrorNotForClientCall(h)}getString(t,e){const i=e+"[\n";for(let t=this._array.begin();t.notEqual(this._array.end());t.increment()){const i=t.ptr();this._stringBuffer+=e+""+i.getString(e+" ")+"\n"}return this._stringBuffer=i+e+"]\n",this._stringBuffer}add(t){this._array.pushBack(t)}getVector(t=null){return this._array}getSize(){return this._array.getSize()}}class $ extends c{constructor(){super(),this._map=new s.csmMap}release(){const t=this._map.begin();for(;t.notEqual(this._map.end());){let e=t.ptr().second;e&&!e.isStatic()&&(e=void 0,e=null),t.preIncrement()}}isMap(){return!0}getValueByString(t){if(t instanceof n.csmString){const e=this._map.getValue(t.s);return null==e?c.nullValue:e}for(let e=this._map.begin();e.notEqual(this._map.end());e.preIncrement())if(e.ptr().first==t)return null==e.ptr().second?c.nullValue:e.ptr().second;return c.nullValue}getValueByIndex(t){return c.errorValue.setErrorNotForClientCall(h)}getString(t,e){this._stringBuffer=e+"{\n";const i=this._map.begin();for(;i.notEqual(this._map.end());){const t=i.ptr().first,r=i.ptr().second;this._stringBuffer+=e+" "+t+" : "+r.getString(e+"   ")+" \n",i.preIncrement()}return this._stringBuffer+=e+"}\n",this._stringBuffer}getMap(t){return this._map}put(t,e){this._map.setValue(t,e)}getKeys(){if(!this._keys){this._keys=new o.csmVector;const t=this._map.begin();for(;t.notEqual(this._map.end());){const e=t.ptr().first;this._keys.pushBack(e),t.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}var b;!function(t){t.CubismJson=l.CubismJson,t.JsonArray=l.JsonArray,t.JsonBoolean=l.JsonBoolean,t.JsonError=l.JsonError,t.JsonFloat=l.JsonFloat,t.JsonMap=l.JsonMap,t.JsonNullvalue=l.JsonNullvalue,t.JsonString=l.JsonString,t.Value=l.Value}(b||(b={}))},"./src/Framework/utils/cubismjsonextension.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismJsonExtension:()=>s});var r=i("./src/Framework/utils/cubismjson.ts");class s{static parseJsonObject(t,e){return Object.keys(t).forEach((i=>{"boolean"==typeof t[i]?e.put(i,new r.JsonBoolean(t[i])):"string"==typeof t[i]?e.put(i,new r.JsonString(t[i])):"number"==typeof t[i]?e.put(i,new r.JsonFloat(t[i])):t[i]instanceof Array?e.put(i,s.parseJsonArray(t[i])):t[i]instanceof Object?e.put(i,s.parseJsonObject(t[i],new r.JsonMap)):null==t[i]?e.put(i,new r.JsonNullvalue):e.put(i,t[i])})),e}static parseJsonArray(t){const e=new r.JsonArray;return Object.keys(t).forEach((i=>{const s=Number(i);if("number"==typeof s)"boolean"==typeof t[s]?e.add(new r.JsonBoolean(t[s])):"string"==typeof t[s]?e.add(new r.JsonString(t[s])):"number"==typeof t[s]?e.add(new r.JsonFloat(t[s])):t[i]instanceof Array?e.add(this.parseJsonArray(t[i])):t[i]instanceof Object?e.add(this.parseJsonObject(t[i],new r.JsonMap)):null==t[i]?e.add(new r.JsonNullvalue):e.add(t[i]);else if(t[i]instanceof Array)e.add(this.parseJsonArray(t[i]));else if(t[i]instanceof Object)e.add(this.parseJsonObject(t[i],new r.JsonMap));else if(null==t[i])e.add(new r.JsonNullvalue);else for(let r=0;r<t[i].length;r++)e.add(t[i][r])})),e}}},"./src/LAppLive2DManager_v2.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{LAppLive2DManager:()=>a});var r=i("./src/lib/Live2DFramework.js"),s=i("./src/PlatformManager.ts"),n=i("./src/LAppModel_v2.ts"),o=i("./src/lappdefine.ts");class a{constructor(){this.models=[],this.count=-1,this.reloadFlg=!1,window.Live2D.init(),r.Live2DFramework.setPlatformManager(new s.PlatformManager)}createModel(){var t=new n.LAppModel;return this.models.push(t),t}changeModel(t,e){this.reloadFlg&&(console.log(this.models),this.reloadFlg=!1,this.releaseModel(0,t),this.createModel(),this.models[0].load(t,e,(()=>{console.log("changeModel完成")})))}getModel(t){return t>=this.models.length?null:this.models[t]}releaseModel(t,e){this.models.length<=t||(this.models[t].release(e),delete this.models[t],this.models.splice(t,1))}numModels(){return this.models.length}setDrag(t,e){for(var i=0;i<this.models.length;i++)this.models[i].setDrag(t,e)}maxScaleEvent(){o.DebugLogEnable&&console.log("Max scale event.");for(var t=0;t<this.models.length;t++)this.models[t].startRandomMotion(o.MotionGroupPinchIn,o.PriorityNormal)}minScaleEvent(){o.DebugLogEnable&&console.log("Min scale event.");for(var t=0;t<this.models.length;t++)this.models[t].startRandomMotion(o.MotionGroupPinchOut,o.PriorityNormal)}tapEvent(t,e){o.DebugLogEnable&&console.log("tapEvent view x:"+t+" y:"+e);for(var i=0;i<this.models.length;i++)this.models[i].hitTest(o.HitAreaNameHead.toLowerCase(),t,e)?(o.DebugLogEnable&&console.log("Tap face."),this.models[i].setRandomExpression()):this.models[i].hitTest(o.HitAreaNameBody.toLowerCase(),t,e)?(o.DebugLogEnable&&console.log("Tap body. models["+i+"]"),this.models[i].startRandomMotion(o.MOTION_GROUP_TAP_BODY,o.PriorityNormal)):this.models[i].hitTestCustom("head",t,e)?(o.DebugLogEnable&&console.log("Tap face."),this.models[i].startRandomMotion(o.MotionGroupFlickHead,o.PriorityNormal)):this.models[i].hitTestCustom("body",t,e)&&(o.DebugLogEnable&&console.log("Tap body. models["+i+"]"),this.models[i].startRandomMotion(o.MOTION_GROUP_TAP_BODY,o.PriorityNormal));return!0}}},"./src/LAppModel_v2.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{LAppModel:()=>o});var r=i("./src/lib/Live2DFramework.js"),s=i("./src/lib/ModelSettingJson.ts"),n=i("./src/lappdefine.ts");class o extends r.L2DBaseModel{constructor(){super(),r.L2DBaseModel.prototype.constructor.call(this),this.modelHomeDir="",this.modelSetting=null,this.tmpMatrix=[]}load(t,e,i){this.setUpdating(!0),this.setInitialized(!1),this.modelHomeDir=e.substring(0,e.lastIndexOf("/")+1),this.modelSetting=new s.ModelSettingJson;var r=this;this.modelSetting.loadModelSetting(e,(function(){var t=r.modelHomeDir+r.modelSetting.getModelFile();r.loadModelData(t,(function(t){for(var e=0;e<r.modelSetting.getTextureNum();e++){let t="";t=/^https?:\/\/|^\/\//i.test(r.modelSetting.getTextureFile(e))?r.modelSetting.getTextureFile(e):r.modelHomeDir+r.modelSetting.getTextureFile(e),r.loadTexture(e,t,(function(){if(r.isTexLoaded){if(r.modelSetting.getExpressionNum()>0){r.expressions={};for(var t=0;t<r.modelSetting.getExpressionNum();t++){var e=r.modelSetting.getExpressionName(t),s=r.modelHomeDir+r.modelSetting.getExpressionFile(t);r.loadExpression(e,s,null)}}else r.expressionManager=null,r.expressions={};if(r.eyeBlink,null!=r.modelSetting.getPhysicsFile()?r.loadPhysics(r.modelHomeDir+r.modelSetting.getPhysicsFile()):r.physics=null,null!=r.modelSetting.getPoseFile()?r.loadPose(r.modelHomeDir+r.modelSetting.getPoseFile(),(function(){r.pose.updateParam(r.live2DModel)})):r.pose=null,null!=r.modelSetting.getLayout()){var o=r.modelSetting.getLayout();null!=o.width&&r.modelMatrix.setWidth(o.width),null!=o.height&&r.modelMatrix.setHeight(o.height),null!=o.x&&r.modelMatrix.setX(o.x),null!=o.y&&r.modelMatrix.setY(o.y),null!=o.center_x&&r.modelMatrix.centerX(o.center_x),null!=o.center_y&&r.modelMatrix.centerY(o.center_y),null!=o.top&&r.modelMatrix.top(o.top),null!=o.bottom&&r.modelMatrix.bottom(o.bottom),null!=o.left&&r.modelMatrix.left(o.left),null!=o.right&&r.modelMatrix.right(o.right)}if(null!=r.modelSetting.getHitAreasCustom()){var a=r.modelSetting.getHitAreasCustom();null!=a.head_x&&n.setHitAreasCustomHead_x(a.head_x),null!=a.head_y&&n.setHitAreasCustomHead_y(a.head_y),null!=a.body_x&&n.setHitAreasCustomBody_x(a.body_x),null!=a.body_y&&n.setHitAreasCustomBody_y(a.body_y)}for(t=0;t<r.modelSetting.getInitParamNum();t++)r.live2DModel.setParamFloat(r.modelSetting.getInitParamID(t),r.modelSetting.getInitParamValue(t));for(t=0;t<r.modelSetting.getInitPartsVisibleNum();t++)r.live2DModel.setPartsOpacity(r.modelSetting.getInitPartsVisibleID(t),r.modelSetting.getInitPartsVisibleValue(t));r.live2DModel.saveParam(),r.preloadMotionGroup(n.MotionGroupIdle.toLowerCase()),r.preloadMotionGroup(n.MotionGroupSleepy),r.mainMotionManager.stopAllMotions(),r.setUpdating(!1),r.setInitialized(!0),"function"==typeof i&&i()}}))}}))}))}release(t){let e=r.Live2DFramework.getPlatformManager();t.deleteTexture(e.texture)}preloadMotionGroup(t){for(var e=this,i=0;i<this.modelSetting.getMotionNum(t);i++){var r=this.modelSetting.getMotionFile(t,i);this.loadMotion(r,this.modelHomeDir+r,(function(r){r.setFadeIn(e.modelSetting.getMotionFadeIn(t,i)),r.setFadeOut(e.modelSetting.getMotionFadeOut(t,i))}))}}update(){if(null!=this.live2DModel){var t=2*((window.UtSystem.getUserTimeMSec()-this.startTimeMSec)/1e3)*Math.PI;if(this.mainMotionManager.isFinished())"1"===sessionStorage.getItem("Sleepy")?this.startRandomMotion(n.MotionGroupSleepy,n.PrioritySleepy):this.startRandomMotion(n.MotionGroupIdle.toLowerCase(),n.PriorityIdle);this.live2DModel.loadParam(),this.mainMotionManager.updateParam(this.live2DModel)||null!=this.eyeBlink&&this.eyeBlink.updateParam(this.live2DModel),this.live2DModel.saveParam(),null==this.expressionManager||null==this.expressions||this.expressionManager.isFinished()||this.expressionManager.updateParam(this.live2DModel),this.live2DModel.addToParamFloat("PARAM_ANGLE_X",30*this.dragX,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_Y",30*this.dragY,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_Z",this.dragX*this.dragY*-30,1),this.live2DModel.addToParamFloat("PARAM_BODY_ANGLE_X",10*this.dragX,1),this.live2DModel.addToParamFloat("PARAM_EYE_BALL_X",this.dragX,1),this.live2DModel.addToParamFloat("PARAM_EYE_BALL_Y",this.dragY,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_X",Number(15*Math.sin(t/6.5345)),.5),this.live2DModel.addToParamFloat("PARAM_ANGLE_Y",Number(8*Math.sin(t/3.5345)),.5),this.live2DModel.addToParamFloat("PARAM_ANGLE_Z",Number(10*Math.sin(t/5.5345)),.5),this.live2DModel.addToParamFloat("PARAM_BODY_ANGLE_X",Number(4*Math.sin(t/15.5345)),.5),this.live2DModel.setParamFloat("PARAM_BREATH",Number(.5+.5*Math.sin(t/3.2345)),1),null!=this.physics&&this.physics.updateParam(this.live2DModel),null==this.lipSync&&this.live2DModel.setParamFloat("PARAM_MOUTH_OPEN_Y",this.lipSyncValue),null!=this.pose&&this.pose.updateParam(this.live2DModel),this.live2DModel.update()}else n.DebugLogEnable&&console.error("Failed to update.")}setRandomExpression(){var t=[];for(var e in this.expressions)t.push(e);var i=parseInt((Math.random()*t.length).toString());this.setExpression(t[i])}startRandomMotion(t,e){var i=this.modelSetting.getMotionNum(t),r=parseInt((Math.random()*i).toString());this.startMotion(t,r,e)}startMotion(t,e,i){var r=this.modelSetting.getMotionFile(t,e);if(null!=r&&""!=r){if(i==n.PriorityForce)this.mainMotionManager.setReservePriority(i);else if(!this.mainMotionManager.reserveMotion(i))return void(n.DebugLogEnable&&console.log("Motion is running."));var s,o=this;null==this.motions[t]?this.loadMotion(null,this.modelHomeDir+r,(function(r){s=r,o.setFadeInFadeOut(t,e,i,s)})):(s=this.motions[t],o.setFadeInFadeOut(t,e,i,s))}else n.DebugLogEnable&&console.error("Failed to motion.")}setFadeInFadeOut(t,e,i,r){var s=this.modelSetting.getMotionFile(t,e);if(r.setFadeIn(this.modelSetting.getMotionFadeIn(t,e)),r.setFadeOut(this.modelSetting.getMotionFadeOut(t,e)),n.DebugLogEnable&&console.log("Start motion : "+s),null==this.modelSetting.getMotionSound(t,e))this.mainMotionManager.startMotionPrio(r,i);else{var o=this.modelSetting.getMotionSound(t,e),a=document.createElement("audio");a.src=this.modelHomeDir+o,n.DebugLogEnable&&console.log("Start sound : "+o),a.play(),this.mainMotionManager.startMotionPrio(r,i)}}setExpression(t){var e=this.expressions[t];n.DebugLogEnable&&console.log("Expression : "+t),this.expressionManager.startMotion(e,!1)}draw(t){t.multMatrix(this.modelMatrix.getArray()),this.tmpMatrix=t.getMatrix(),this.live2DModel.setMatrix(this.tmpMatrix),this.live2DModel.draw()}hitTest(t,e,i){for(var r=this.modelSetting.getHitAreaNum(),s=0;s<r;s++)if(t==this.modelSetting.getHitAreaName(s)){var n=this.modelSetting.getHitAreaID(s);return this.hitTestSimple(n,e,i)}return!1}hitTestCustom(t,e,i){return"head"==t?this.hitTestSimpleCustom(n.getHitAreasCustomHead_x(),n.getHitAreasCustomHead_y(),e,i):"body"==t&&this.hitTestSimpleCustom(n.getHitAreasCustomBody_x(),n.getHitAreasCustomBody_y(),e,i)}}},"./src/PlatformManager.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{PlatformManager:()=>a});var r=i("./src/lappdefine.ts"),s=i("./src/Framework/utils/cubismjson.ts"),n=i("./src/DbCache.ts"),o=function(t,e,i,r){return new(i||(i=Promise))((function(s,n){function o(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))};class a{loadBytes(t){return o(this,void 0,void 0,(function*(){let e=(0,r.path2FileName)(t),i=(0,r.path2DirName)(t);console.log("正在加载",i);let s=yield n.db.mocJson.where({key:e,name:i}).first();if(s)return s.value;{let r=yield fetch(t),s=yield r.arrayBuffer();return 200===r.status?(n.db.mocJson.put({key:e,name:i,value:s}),s):(console.error("Failed to load ("+r.status+") : "+t),null)}}))}loadString(t){return o(this,void 0,void 0,(function*(){let e=yield this.loadBytes(t);return s.CubismJson.arrayBufferToString(e)}))}loadLive2DModel(t,e){this.loadBytes(t).then((t=>{var i=window.Live2DModelWebGL.loadModel(t);e(i)}))}loadTexture(t,e,i,s){var n=new Image;n.crossOrigin="Anonymous",n.src=i;n.onload=function(){var i=(0,r.getContext)(),o=i.createTexture();if(!o)return console.error("Failed to generate gl texture name."),-1;0==t.isPremultipliedAlpha()&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,1),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_NEAREST),i.generateMipmap(i.TEXTURE_2D),t.setTexture(e,o),o=null,"function"==typeof s&&s()},n.onerror=function(){console.error("Failed to load image : "+i)}}jsonParseFromBytes(t){var e,i=new Uint8Array(t,0,3);return e=239==i[0]&&187==i[1]&&191==i[2]?String.fromCharCode.apply(null,new Uint8Array(t,3)):String.fromCharCode.apply(null,new Uint8Array(t)),JSON.parse(e)}log(t){}}},"./src/lappdefine.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{CubismLoggingLevel:()=>E,DebugDrawAlphaModel:()=>I,DebugDrawHitArea:()=>L,DebugLogEnable:()=>M,DebugTouchLogEnable:()=>T,HitAreaNameBody:()=>S,HitAreaNameHead:()=>b,MOTION_GROUP_TAP_BODY:()=>p,MotionGroupFlickHead:()=>g,MotionGroupIdle:()=>_,MotionGroupPinchIn:()=>f,MotionGroupPinchOut:()=>y,MotionGroupShake:()=>$,MotionGroupSleepy:()=>d,MotionGroupTapBody:()=>m,PriorityForce:()=>w,PriorityIdle:()=>x,PriorityNone:()=>v,PriorityNormal:()=>C,PrioritySleepy:()=>P,ViewLogicalLeft:()=>o,ViewLogicalMaxBottom:()=>h,ViewLogicalMaxLeft:()=>l,ViewLogicalMaxRight:()=>u,ViewLogicalMaxTop:()=>c,ViewLogicalRight:()=>a,ViewMaxScale:()=>s,ViewMinScale:()=>n,getContext:()=>V,getHitAreasCustomBody_x:()=>j,getHitAreasCustomBody_y:()=>X,getHitAreasCustomHead_x:()=>N,getHitAreasCustomHead_y:()=>z,path2DirName:()=>K,path2FileName:()=>W,path2ModelName:()=>q,pathName:()=>H,setContext:()=>k,setHitAreasCustomBody_x:()=>Y,setHitAreasCustomBody_y:()=>G,setHitAreasCustomHead_x:()=>O,setHitAreasCustomHead_y:()=>U});var r=i("./src/Framework/live2dcubismframework.ts");const s=2,n=.8,o=-1,a=1,l=-2,u=2,h=-2,c=2,_="Idle",m="TapBody",d="sleepy",g="flick_head",p="tap_body",f="pinch_in",y="pinch_out",$="shake",b="Head",S="Body",v=0,x=1,P=2,C=2,w=3,M=!1,T=!1,L=!1,I=!1,E=r.LogLevel.LogLevel_Verbose;let F,B,A,D,R;function k(t){F=t}function V(){return F}function O(t){B=t}function N(){return B}function U(t){A=t}function z(){return A}function Y(t){D=t}function j(){return D}function G(t){R=t}function X(){return R}function q(t){let e=W(t);return e.substring(0,e.indexOf("."))}function H(t){return t.substring(0,t.lastIndexOf("/")+1)}function W(t){return t.substring(t.lastIndexOf("/")+1)}function K(t){var e=t.substring(t.indexOf("//")+2);if(t.indexOf("model3.json")>0){let t=e.split("/");return`${t[t.length-2]}.moc3`}{let t=e.split("/");return e.indexOf(".mtn")>0?t[t.length-3]:e.indexOf(".moc")>0?t[t.length-2]:t[t.length-1]}}},"./src/lappdelegate.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{LAppDelegate:()=>b,canvas:()=>m,frameBuffer:()=>p,gl:()=>g,jsonPath:()=>f,modelDir:()=>$,modelName:()=>y,modelX:()=>c,modelY:()=>_,s_instance:()=>d,zoom:()=>h});var r=i("./src/Framework/live2dcubismframework.ts"),s=i("./src/lappview.ts"),n=i("./src/lapppal.ts"),o=i("./src/lapptexturemanager.ts"),a=i("./src/lapplive2dmanager.ts"),l=i("./src/lappdefine.ts"),u=r.Live2DCubismFramework.CubismFramework;let h,c,_,m=null,d=null,g=null,p=null,f=null,y=null,$=null;class b{constructor(){this._captured=!1,this._captureFrame=!1,this._mouseX=0,this._mouseY=0,this._modelX=0,this._modelY=0,this._isEnd=!1,this._cubismOption=new r.Option,this._view=new s.LAppView,this._textureManager=new o.LAppTextureManager,this._zoom=1,this._head_pos=.5}static getInstance(){return null==d&&(d=new b),d}static releaseInstance(){null!=d&&d.release(),d=null}initialize(t,e){m=document.getElementById(t),f=e,y=l.path2ModelName(e),$=l.pathName(e),h=this._zoom,c=this._modelX,_=this._modelY;return"ontouchend"in m?(m.ontouchstart=P,window.ontouchmove=C,m.ontouchend=w,m.ontouchcancel=M):(m.onmousedown=S,window.onmousemove=v,m.onmouseup=x,document.onmouseleave=T),g=function(t){for(var e=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=0;i<e.length;i++)try{var r=t.getContext(e[i],{premultipliedAlpha:!0});if(r)return r}catch(t){}return null}(m),g?(p||(p=g.getParameter(g.FRAMEBUFFER_BINDING)),g.enable(g.BLEND),g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),this._view.initialize(),this.initializeCubism(),!0):(alert("Cannot initialize WebGL. This browser does not support."),g=null,document.body.innerHTML="This browser does not support the <code>&lt;canvas&gt;</code> element.",!1)}release(){this._textureManager.release(),this._textureManager=null,this._view.release(),this._view=null,a.LAppLive2DManager.releaseInstance(),u.dispose()}run(){const t=()=>{if(null!=d){if(n.LAppPal.updateTime(),g.clearColor(0,0,0,0),g.enable(g.DEPTH_TEST),g.depthFunc(g.LEQUAL),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT),g.clearDepth(1),g.enable(g.BLEND),g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),this._view._head_pos=this._head_pos,this._view._hitAreaList=this._hitAreaList,this._view.render(),this._captureFrame){this._captureFrame=!1;var e=document.createElement("a");document.body.appendChild(e),e.setAttribute("type","hidden"),e.href=m.toDataURL(),e.download=this._captureName||"live2d.png",e.click()}requestAnimationFrame(t)}};t()}createShader(){const t=g.createShader(g.VERTEX_SHADER);if(null==t)return n.LAppPal.printMessage("failed to create vertexShader"),null;g.shaderSource(t,"precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}"),g.compileShader(t);const e=g.createShader(g.FRAGMENT_SHADER);if(null==e)return n.LAppPal.printMessage("failed to create fragmentShader"),null;g.shaderSource(e,"precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}"),g.compileShader(e);const i=g.createProgram();return g.attachShader(i,t),g.attachShader(i,e),g.deleteShader(t),g.deleteShader(e),g.linkProgram(i),g.useProgram(i),i}getView(){return this._view}getTextureManager(){return this._textureManager}initializeCubism(){this._cubismOption.logFunction=n.LAppPal.printMessage,this._cubismOption.loggingLevel=l.CubismLoggingLevel,u.startUp(this._cubismOption),u.initialize(),a.LAppLive2DManager.getInstance(),n.LAppPal.updateTime(),this._view.initializeSprite()}}function S(t){if(!b.getInstance()._view)return void n.LAppPal.printMessage("view notfound");b.getInstance()._captured=!0;const e=t.pageX,i=t.pageY;b.getInstance()._view.onTouchesBegan(e,i)}function v(t){if(!b.getInstance()._view)return void n.LAppPal.printMessage("view notfound");const e=m.getBoundingClientRect();b.getInstance()._view.onTouchesMoved(t.clientX,t.clientY,e)}function x(t){if(b.getInstance()._captured=!1,!b.getInstance()._view)return void n.LAppPal.printMessage("view notfound");const e=t.target.getBoundingClientRect(),i=t.clientX-e.left,r=t.clientY-e.top;b.getInstance()._view.onTouchesEnded(i,r)}function P(t){if(!b.getInstance()._view)return void n.LAppPal.printMessage("view notfound");b.getInstance()._captured=!0;const e=t.changedTouches[0].pageX,i=t.changedTouches[0].pageY;b.getInstance()._view.onTouchesBegan(e,i)}function C(t){if(!b.getInstance()._captured)return;if(!b.getInstance()._view)return void n.LAppPal.printMessage("view notfound");const e=t.target.getBoundingClientRect(),i=t.changedTouches[0].clientX,r=t.changedTouches[0].clientY;b.getInstance()._view.onTouchesMoved(i,r,e)}function w(t){if(b.getInstance()._captured=!1,!b.getInstance()._view)return void n.LAppPal.printMessage("view notfound");const e=t.target.getBoundingClientRect(),i=t.changedTouches[0].clientX-e.left,r=t.changedTouches[0].clientY-e.top;b.getInstance()._view.onTouchesEnded(i,r)}function M(t){if(b.getInstance()._captured=!1,!b.getInstance()._view)return void n.LAppPal.printMessage("view notfound");const e=t.target.getBoundingClientRect(),i=t.changedTouches[0].clientX-e.left,r=t.changedTouches[0].clientY-e.top;b.getInstance()._view.onTouchesEnded(i,r)}function T(t){b.getInstance()._captured=!1,b.getInstance()._view?b.getInstance()._view.onTouchesEnded(0,0):n.LAppPal.printMessage("view notfound")}},"./src/lapplive2dmanager.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{LAppLive2DManager:()=>h,s_instance:()=>u});var r=i("./src/Framework/math/cubismmatrix44.ts"),s=i("./src/lappdelegate.ts"),n=i("./src/lappmodel.ts"),o=i("./src/lapppal.ts"),a=i("./src/lappdefine.ts"),l=r.Live2DCubismFramework.CubismMatrix44;let u=null;class h{constructor(){this._finishedMotion=t=>{a.DebugLogEnable&&(o.LAppPal.printMessage("Motion Finished:"),console.log(t))};const t=s.modelDir;this._viewMatrix=new l,this._model=new n.LAppModel;const e=`${s.modelName}.model3.json`;this._model.loadAssets(t,e)}static getInstance(){return null==u&&(u=new h),u}static releaseInstance(){null!=u&&(u=void 0),u=null}releaseAllModel(){this._model.release()}onDrag(t,e){this._model&&this._model.setDragging(t,e)}onTap(t,e,i){if(a.DebugLogEnable&&o.LAppPal.printMessage(`[APP]tap point: {x: ${t.toFixed(2)} y: ${e.toFixed(2)}}`),this._model.hitTest(a.HitAreaNameHead,t,e))a.DebugLogEnable&&o.LAppPal.printMessage(`[APP]hit area: [${a.HitAreaNameHead}]`),this._model.setRandomExpression();else if(this._model.hitTest(a.HitAreaNameBody,t,e))a.DebugLogEnable&&o.LAppPal.printMessage(`[APP]hit area: [${a.HitAreaNameBody}]`),this._model.startRandomMotion(a.MotionGroupTapBody,a.PriorityNormal,this._finishedMotion);else for(let r=0;r<i.length;r++)this._model.hitTestDefine(i[r],t,e)&&(a.DebugLogEnable&&o.LAppPal.printMessage(`[APP]hit area: [${name}]`),this._model.startMotionFile(i[r],a.PriorityNormal,this._finishedMotion))}onUpdate(){let t=new l;const{width:e,height:i}=s.canvas;t.translate(s.modelX/100,s.modelY/100),t.scale(s.zoom,s.zoom*e/i),null!=this._viewMatrix&&t.multiplyByMatrix(this._viewMatrix);const r=t.clone(),n=this._model;t=r.clone(),n.update(),n.draw(t)}}},"./src/lappmodel.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{LAppModel:()=>I});var r,s=i("./src/Framework/live2dcubismframework.ts"),n=i("./src/Framework/model/cubismusermodel.ts"),o=i("./src/Framework/cubismmodelsettingjson.ts"),a=i("./src/Framework/cubismdefaultparameterid.ts"),l=i("./src/Framework/motion/acubismmotion.ts"),u=i("./src/Framework/effect/cubismeyeblink.ts"),h=i("./src/Framework/effect/cubismbreath.ts"),c=i("./src/Framework/type/csmvector.ts"),_=i("./src/Framework/type/csmmap.ts"),m=i("./src/Framework/motion/cubismmotionqueuemanager.ts"),d=i("./src/lapppal.ts"),g=i("./src/lappdelegate.ts"),p=i("./src/lappdefine.ts"),f=i("./src/DbCache.ts"),y=function(t,e,i,r){return new(i||(i=Promise))((function(s,n){function o(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))},$=m.Live2DCubismFramework.InvalidMotionQueueEntryHandleValue,b=_.Live2DCubismFramework.csmMap,S=c.Live2DCubismFramework.csmVector,v=h.Live2DCubismFramework.CubismBreath,x=h.Live2DCubismFramework.BreathParameterData,P=u.Live2DCubismFramework.CubismEyeBlink,C=l.Live2DCubismFramework.ACubismMotion,w=s.Live2DCubismFramework.CubismFramework,M=n.Live2DCubismFramework.CubismUserModel,T=o.Live2DCubismFramework.CubismModelSettingJson,L=a.Live2DCubismFramework;!function(t){t[t.LoadAssets=0]="LoadAssets",t[t.LoadModel=1]="LoadModel",t[t.WaitLoadModel=2]="WaitLoadModel",t[t.LoadExpression=3]="LoadExpression",t[t.WaitLoadExpression=4]="WaitLoadExpression",t[t.LoadPhysics=5]="LoadPhysics",t[t.WaitLoadPhysics=6]="WaitLoadPhysics",t[t.LoadPose=7]="LoadPose",t[t.WaitLoadPose=8]="WaitLoadPose",t[t.SetupEyeBlink=9]="SetupEyeBlink",t[t.SetupBreath=10]="SetupBreath",t[t.LoadUserData=11]="LoadUserData",t[t.WaitLoadUserData=12]="WaitLoadUserData",t[t.SetupEyeBlinkIds=13]="SetupEyeBlinkIds",t[t.SetupLipSyncIds=14]="SetupLipSyncIds",t[t.SetupLayout=15]="SetupLayout",t[t.LoadMotion=16]="LoadMotion",t[t.WaitLoadMotion=17]="WaitLoadMotion",t[t.CompleteInitialize=18]="CompleteInitialize",t[t.CompleteSetupModel=19]="CompleteSetupModel",t[t.LoadTexture=20]="LoadTexture",t[t.WaitLoadTexture=21]="WaitLoadTexture",t[t.CompleteSetup=22]="CompleteSetup"}(r||(r={}));class I extends M{constructor(){super(),this._motionFileName=new Map,this._modelSetting=null,this._modelHomeDir=null,this._userTimeSeconds=0,this._eyeBlinkIds=new S,this._lipSyncIds=new S,this._motions=new b,this._expressions=new b,this._hitArea=new S,this._userArea=new S,this._idParamAngleX=w.getIdManager().getId(L.ParamAngleX),this._idParamAngleY=w.getIdManager().getId(L.ParamAngleY),this._idParamAngleZ=w.getIdManager().getId(L.ParamAngleZ),this._idParamEyeBallX=w.getIdManager().getId(L.ParamEyeBallX),this._idParamEyeBallY=w.getIdManager().getId(L.ParamEyeBallY),this._idParamBodyAngleX=w.getIdManager().getId(L.ParamBodyAngleX),this._state=r.LoadAssets,this._expressionCount=0,this._textureCount=0,this._motionCount=0,this._allMotionCount=0}loadAssets(t,e){return y(this,void 0,void 0,(function*(){this._modelHomeDir=t;let i,s=`${this._modelHomeDir}${e}`,n=p.path2DirName(s),o=yield f.db.mocJson.where({name:n,key:e}).first();o?i=o.value:(i=yield fetch(s).then((t=>t.arrayBuffer())),f.db.mocJson.put({key:e,name:n,value:i}));const a=new T(i,i.byteLength);this._state=r.LoadModel,this.setupModel(a)}))}setupModel(t){this._updating=!0,this._initialized=!1,this._modelSetting=t;var e=t.getModelFileName();if(""!=this._modelSetting.getModelFileName()){const t=this._modelSetting.getModelFileName();f.db.mocJson.where({key:t,name:e}).first().then((s=>{s?(this.loadModel(s.value),this._state=r.LoadExpression,i()):fetch(`${this._modelHomeDir}/${t}`).then((t=>t.arrayBuffer())).then((s=>{this.loadModel(s),f.db.mocJson.put({key:t,name:e,value:s}),this._state=r.LoadExpression,i()}))})),this._state=r.WaitLoadModel}else d.LAppPal.printMessage("Model data does not exist.");const i=()=>{if(this._modelSetting.getExpressionCount()>0){const t=this._modelSetting.getExpressionCount();console.log("加载表情(Expression)");for(let i=0;i<t;i++){const n=this._modelSetting.getExpressionName(i),o=this._modelSetting.getExpressionFileName(i);f.db.mocJson.where({key:n,name:e}).first().then((i=>{if(i){const e=this.loadExpression(i.value,i.value.byteLength,n);null!=this._expressions.getValue(n)&&(C.delete(this._expressions.getValue(n)),this._expressions.setValue(n,null)),this._expressions.setValue(n,e),this._expressionCount++,this._expressionCount>=t&&(this._state=r.LoadPhysics,s())}else fetch(`${this._modelHomeDir}/${o}`).then((t=>t.arrayBuffer())).then((i=>{f.db.mocJson.put({key:n,name:e,value:i});const o=this.loadExpression(i,i.byteLength,n);null!=this._expressions.getValue(n)&&(C.delete(this._expressions.getValue(n)),this._expressions.setValue(n,null)),this._expressions.setValue(n,o),this._expressionCount++,this._expressionCount>=t&&(this._state=r.LoadPhysics,s())}))}))}this._state=r.WaitLoadExpression}else this._state=r.LoadPhysics,s()},s=()=>{if(""!=this._modelSetting.getPhysicsFileName()){const t=this._modelSetting.getPhysicsFileName();console.log("加载physics"),f.db.mocJson.where({key:t,name:e}).first().then((i=>{i?(this.loadPhysics(i.value,i.value.byteLength),this._state=r.LoadPose,n()):fetch(`${this._modelHomeDir}/${t}`).then((t=>t.arrayBuffer())).then((i=>{f.db.mocJson.put({key:t,name:e,value:i}),this.loadPhysics(i,i.byteLength),this._state=r.LoadPose,n()}))})),this._state=r.WaitLoadPhysics}else this._state=r.LoadPose,n()},n=()=>{if(""!=this._modelSetting.getPoseFileName()){const t=this._modelSetting.getPoseFileName();console.log("加载pose动作"),f.db.mocJson.where({key:t,name:e}).first().then((i=>{i?(this.loadPose(i.value,i.value.byteLength),this._state=r.SetupEyeBlink,o()):fetch(`${this._modelHomeDir}/${t}`).then((t=>t.arrayBuffer())).then((i=>{f.db.mocJson.put({key:t,name:e,value:i}),this.loadPose(i,i.byteLength),this._state=r.SetupEyeBlink,o()}))})),this._state=r.WaitLoadPose}else this._state=r.SetupEyeBlink,o()},o=()=>{this._modelSetting.getEyeBlinkParameterCount()>0&&(console.log("EyeBlink参数大于0"),this._eyeBlink=P.create(this._modelSetting),this._state=r.SetupBreath),console.log("EyeBlink已加载"),a()},a=()=>{this._breath=v.create();const t=new S;t.pushBack(new x(this._idParamAngleX,0,15,6.5345,.5)),t.pushBack(new x(this._idParamAngleY,0,8,3.5345,.5)),t.pushBack(new x(this._idParamAngleZ,0,10,5.5345,.5)),t.pushBack(new x(this._idParamBodyAngleX,0,4,15.5345,.5)),t.pushBack(new x(w.getIdManager().getId(L.ParamBreath),0,.5,3.2345,.5)),console.log("setupBreath"),this._breath.setParameters(t),this._state=r.LoadUserData,l()},l=()=>{if(""!=this._modelSetting.getUserDataFile()){const t=this._modelSetting.getUserDataFile();console.log("加载UserData"),f.db.mocJson.where({key:t,name:e}).first().then((i=>{i?(this.loadUserData(i.value,i.value.byteLength),this._state=r.SetupEyeBlinkIds,u()):fetch(`${this._modelHomeDir}/${t}`).then((t=>t.arrayBuffer())).then((i=>{f.db.mocJson.put({key:t,name:e,value:i}),this.loadUserData(i,i.byteLength),this._state=r.SetupEyeBlinkIds,u()}))})),this._state=r.WaitLoadUserData}else this._state=r.SetupEyeBlinkIds,u()},u=()=>{const t=this._modelSetting.getEyeBlinkParameterCount();for(let e=0;e<t;++e)this._eyeBlinkIds.pushBack(this._modelSetting.getEyeBlinkParameterId(e));this._state=r.SetupLipSyncIds,h()},h=()=>{const t=this._modelSetting.getLipSyncParameterCount();for(let e=0;e<t;++e)this._lipSyncIds.pushBack(this._modelSetting.getLipSyncParameterId(e));this._state=r.SetupLayout,c()},c=()=>{const t=new b;this._modelSetting.getLayoutMap(t),this._modelMatrix.setupFromLayout(t),this._state=r.LoadMotion,_()},_=()=>{this._state=r.WaitLoadMotion,this._model.saveParameters(),this._allMotionCount=0,this._motionCount=0;const t=[],e=this._modelSetting.getMotionGroupCount();for(let i=0;i<e;i++)t[i]=this._modelSetting.getMotionGroupName(i),this._allMotionCount+=this._modelSetting.getMotionCount(t[i]);for(let i=0;i<e;i++)this.preLoadMotionGroup(t[i]);0==e&&this.restartMotion()}}setupTextures(){if(this._state==r.LoadTexture){const t=this._modelSetting.getTextureCount();for(let e=0;e<t;e++){if(""==this._modelSetting.getTextureFileName(e)){console.log("getTextureFileName null");continue}let i=this._modelSetting.getTextureFileName(e);i=this._modelHomeDir+i;const s=i=>{this.getRenderer().bindTexture(e,i.id),this._textureCount++,this._textureCount>=t&&(this._state=r.CompleteSetup)};g.LAppDelegate.getInstance().getTextureManager().createTextureFromPngFile(i,true,s),this.getRenderer().setIsPremultipliedAlpha(true)}this._state=r.WaitLoadTexture}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}update(){if(this._state!=r.CompleteSetup)return;const t=d.LAppPal.getDeltaTime();this._userTimeSeconds+=t,this._dragManager.update(t),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY();let e=!1;if(this._model.loadParameters(),this._motionManager.isFinished()?this.startRandomMotion(p.MotionGroupIdle,p.PriorityIdle):e=this._motionManager.updateMotion(this._model,t),this._model.saveParameters(),e||null!=this._eyeBlink&&this._eyeBlink.updateParameters(this._model,t),null!=this._expressionManager&&this._expressionManager.updateMotion(this._model,t),this._model.addParameterValueById(this._idParamAngleX,30*this._dragX),this._model.addParameterValueById(this._idParamAngleY,30*this._dragY),this._model.addParameterValueById(this._idParamAngleZ,this._dragX*this._dragY*-30),this._model.addParameterValueById(this._idParamBodyAngleX,10*this._dragX),this._model.addParameterValueById(this._idParamEyeBallX,this._dragX),this._model.addParameterValueById(this._idParamEyeBallY,this._dragY),null!=this._breath&&this._breath.updateParameters(this._model,t),null!=this._physics&&this._physics.evaluate(this._model,t),this._lipsync){const t=0;for(let e=0;e<this._lipSyncIds.getSize();++e)this._model.addParameterValueById(this._lipSyncIds.at(e),t,.8)}null!=this._pose&&this._pose.updateParameters(this._model,t),this._model.update()}startMotion(t,e,i,r){return y(this,void 0,void 0,(function*(){if(i==p.PriorityForce)this._motionManager.setReservePriority(i);else if(!this._motionManager.reserveMotion(i))return this._debugMode&&d.LAppPal.printMessage("[APP]can't start motion."),$;const s=this._modelSetting.getModelFileName(),n=this._modelSetting.getMotionFileName(t,e),o=`${t}_${e}`;let a=this._motions.getValue(o),l=!1;if(null==a){var u,h=yield f.db.mocJson.where({key:n,name:s}).first();console.log("加载motion"),h?u=h.value:(u=yield fetch(`${this._modelHomeDir}/${n}`).then((t=>t.arrayBuffer())),yield f.db.mocJson.put({key:n,name:s,value:u})),a=this.loadMotion(u,u.byteLength,null,r);let i=this._modelSetting.getMotionFadeInTimeValue(t,e);i>=0&&a.setFadeInTime(i),i=this._modelSetting.getMotionFadeOutTimeValue(t,e),i>=0&&a.setFadeOutTime(i),a.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),l=!0}else a.setFinishedMotionHandler(r);return this._debugMode&&d.LAppPal.printMessage(`[APP]start motion: [${t}_${e}`),this._motionManager.startMotionPriority(a,l,i)}))}startMotionFile(t,e,i){return y(this,void 0,void 0,(function*(){if(e==p.PriorityForce)this._motionManager.setReservePriority(e);else if(!this._motionManager.reserveMotion(e))return this._debugMode&&d.LAppPal.printMessage("[APP]can't start motion."),$;const r=this._motionFileName.get(t),s=this._modelSetting.getModelFileName();let n=!1;var o;console.log("读取动作文件:"),console.log(`${this._modelHomeDir}/${r}`);var a=yield f.db.mocJson.where({key:r,name:s}).first();a?o=a.value:(o=yield fetch(`${this._modelHomeDir}/${r}`).then((t=>t.arrayBuffer())),f.db.mocJson.put({key:r,name:s,value:o}));const l=this.loadMotion(o,o.byteLength,t,i);return l.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),n=!0,this._debugMode&&d.LAppPal.printMessage(`[APP]start motion in File: [${r}`),this._motionManager.startMotionPriority(l,true,e)}))}startRandomMotion(t,e,i){return y(this,void 0,void 0,(function*(){if(0==this._modelSetting.getMotionCount(t))return $;const r=Math.floor(Math.random()*this._modelSetting.getMotionCount(t));return yield this.startMotion(t,r,e,i)}))}setExpression(t){const e=this._expressions.getValue(t);this._debugMode&&d.LAppPal.printMessage(`[APP]expression: [${t}]`),null!=e?this._expressionManager.startMotionPriority(e,!1,p.PriorityForce):this._debugMode&&d.LAppPal.printMessage(`[APP]expression[${t}] is null`)}setRandomExpression(){if(0==this._expressions.getSize())return;const t=Math.floor(Math.random()*this._expressions.getSize());for(let e=0;e<this._expressions.getSize();e++)if(e==t){const t=this._expressions._keyValues[e].first;return void this.setExpression(t)}}motionEventFired(t){}hitTest(t,e,i){if(this._opacity<1)return!1;try{const r=this._modelSetting.getHitAreasCount();for(let s=0;s<r;s++)if(this._modelSetting.getHitAreaName(s)==t){const t=this._modelSetting.getHitAreaId(s);return this.isHit(t,e,i)}}catch(t){console.log("数据可能还没有准备好"+t)}return!1}hitTestDefine(t,e,i){if(this._opacity<1)return!1;let r=t.split("_");for(let t=0;t<r.length;t++)r[t]=r[t].charAt(0).toUpperCase()+r[t].slice(1);let s=r.join("");const n=w.getIdManager().getId(s);return this.isHit(n,e,i)}preLoadMotionGroup(t){return y(this,void 0,void 0,(function*(){const e=this._modelSetting.getModelFileName();for(let n=0;n<this._modelSetting.getMotionCount(t);n++){const o=this._modelSetting.getMotionFileName(t,n),a=`${t}_${n}`;var i;this._debugMode&&d.LAppPal.printMessage(`[APP]load motion: ${o} => [${a}]`);var s=yield f.db.mocJson.where({key:o,name:e}).first();s?i=s.value:(i=yield fetch(`${this._modelHomeDir}${o}`).then((t=>t.arrayBuffer())),f.db.mocJson.put({key:o,name:e,value:i}));const l=this.loadMotion(i,i.byteLength,a);let u=this._modelSetting.getMotionFadeInTimeValue(t,n);u>=0&&l.setFadeInTime(u),u=this._modelSetting.getMotionFadeOutTimeValue(t,n),u>=0&&l.setFadeOutTime(u),l.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),null!=this._motions.getValue(a)&&C.delete(this._motions.getValue(a)),this._motions.setValue(a,l),this._motionCount++,this._motionCount>=this._allMotionCount&&(this._state=r.LoadTexture,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(g.gl))}}))}restartMotion(){this._state=r.LoadTexture,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(g.gl)}releaseMotions(){this._motions.clear()}releaseExpressions(){this._expressions.clear()}doDraw(){if(null==this._model)return;const t=[0,0,g.canvas.width,g.canvas.height];this.getRenderer().setRenderState(g.frameBuffer,t),this.getRenderer().drawModel()}draw(t){null!=this._model&&this._state==r.CompleteSetup&&(t.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(t),this.doDraw())}}},"./src/lapppal.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{LAppPal:()=>r});class r{static loadFileAsBytes(t,e){fetch(t).then((t=>t.arrayBuffer())).then((t=>e(t,t.byteLength)))}static getDeltaTime(){return this.s_deltaTime}static updateTime(){this.s_currentFrame=Date.now(),this.s_deltaTime=(this.s_currentFrame-this.s_lastFrame)/1e3,this.s_lastFrame=this.s_currentFrame}static printMessage(t){console.log(t)}static modelUrlVersion(t){let e=null;fetch(t,{mode:"cors",method:"GET"}).then((function(t){200===t.status&&(e=t.arrayBuffer)}));JSON.stringify(e);return 2}}r.lastUpdate=Date.now(),r.s_currentFrame=0,r.s_lastFrame=0,r.s_deltaTime=0},"./src/lapptexturemanager.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{LAppTextureManager:()=>o,TextureInfo:()=>a});var r=i("./src/Framework/type/csmvector.ts"),s=i("./src/lappdelegate.ts"),n=r.Live2DCubismFramework.csmVector;class o{constructor(){this._textures=new n}release(){for(let t=this._textures.begin();t.notEqual(this._textures.end());t.preIncrement())s.gl.deleteTexture(t.ptr().id);this._textures=null}createTextureFromPngFile(t,e,i){for(let r=this._textures.begin();r.notEqual(this._textures.end());r.preIncrement())if(r.ptr().fileName==t&&r.ptr().usePremultply==e)return r.ptr().img=new Image,r.ptr().img.crossOrigin="Anonymous",r.ptr().img.onload=()=>i(r.ptr()),void(r.ptr().img.src=t);const r=new Image;r.crossOrigin="Anonymous",r.onload=()=>{const n=s.gl.createTexture();s.gl.bindTexture(s.gl.TEXTURE_2D,n),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_MIN_FILTER,s.gl.LINEAR_MIPMAP_LINEAR),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_MAG_FILTER,s.gl.LINEAR),e&&s.gl.pixelStorei(s.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),s.gl.texImage2D(s.gl.TEXTURE_2D,0,s.gl.RGBA,s.gl.RGBA,s.gl.UNSIGNED_BYTE,r),s.gl.generateMipmap(s.gl.TEXTURE_2D),s.gl.bindTexture(s.gl.TEXTURE_2D,null);const o=new a;null!=o&&(o.fileName=t,o.width=r.width,o.height=r.height,o.id=n,o.img=r,o.usePremultply=e,this._textures.pushBack(o)),i(o)},r.src=t}releaseTextures(){for(let t=0;t<this._textures.getSize();t++)this._textures.set(t,null);this._textures.clear()}releaseTextureByTexture(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).id==t){this._textures.set(e,null),this._textures.remove(e);break}}releaseTextureByFilePath(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).fileName==t){this._textures.set(e,null),this._textures.remove(e);break}}}class a{constructor(){this.id=null,this.width=0,this.height=0}}},"./src/lappview.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{LAppView:()=>_});var r=i("./src/Framework/math/cubismmatrix44.ts"),s=i("./src/Framework/math/cubismviewmatrix.ts"),n=i("./src/touchmanager.ts"),o=i("./src/lapplive2dmanager.ts"),a=i("./src/lappdelegate.ts"),l=i("./src/lapppal.ts"),u=i("./src/lappdefine.ts"),h=s.Live2DCubismFramework.CubismViewMatrix,c=r.Live2DCubismFramework.CubismMatrix44;class _{constructor(){this._programId=null,this._back=null,this._gear=null,this._hitAreaList=null,this._touchManager=new n.TouchManager,this._deviceToScreen=new c,this._viewMatrix=new h,this._head_pos=.5}initialize(){const{width:t,height:e}=a.canvas,i=e/t,r=u.ViewLogicalLeft,s=u.ViewLogicalRight,n=-i,o=i;this._viewMatrix.setScreenRect(r,s,n,o);const l=Math.abs(r-s);this._deviceToScreen.scaleRelative(l/t,-l/t),this._deviceToScreen.translateRelative(.5*-t,.5*-e),this._viewMatrix.setMaxScale(u.ViewMaxScale),this._viewMatrix.setMinScale(u.ViewMinScale),this._viewMatrix.setMaxScreenRect(u.ViewLogicalMaxLeft,u.ViewLogicalMaxRight,u.ViewLogicalMaxBottom,u.ViewLogicalMaxTop)}release(){this._viewMatrix=null,this._touchManager=null,this._deviceToScreen=null,this._gear&&(this._gear.release(),this._gear=null),this._back&&(this._back.release(),this._back=null),a.gl.deleteProgram(this._programId),this._programId=null}render(){a.gl.useProgram(this._programId),this._back&&this._back.render(this._programId),this._gear&&this._gear.render(this._programId),a.gl.flush();o.LAppLive2DManager.getInstance().onUpdate()}initializeSprite(){null==this._programId&&(this._programId=a.LAppDelegate.getInstance().createShader())}onTouchesBegan(t,e){this._touchManager.touchesBegan(t,e)}onTouchesMoved(t,e,i){const r=this.transformScreenX(t-i.left),s=this.transformScreenY(e-i.top),n=this.transformRect({x:i.left+i.width/2,y:i.top+i.height*this._head_pos},{x:t,y:e},i),a=this.transformViewX(n.x-i.left),l=this.transformViewY(n.y-i.top);this._touchManager.touchesMoved(r,s);o.LAppLive2DManager.getInstance().onDrag(a,l)}onTouchesEnded(t,e){const i=o.LAppLive2DManager.getInstance();i.onDrag(0,0);{const r=this._deviceToScreen.transformX(t),s=this._deviceToScreen.transformY(e);u.DebugTouchLogEnable&&l.LAppPal.printMessage(`[APP]touchesEnded x: ${r} y: ${s}`),i.onTap(r,s,this._hitAreaList)}}transformViewX(t){const e=this._deviceToScreen.transformX(t);return this._viewMatrix.invertTransformX(e)}transformViewY(t){const e=this._deviceToScreen.transformY(t);return this._viewMatrix.invertTransformY(e)}transformScreenX(t){return this._deviceToScreen.transformX(t)}transformScreenY(t){return this._deviceToScreen.transformY(t)}transformRect(t,e,i){if(e.x<i.left+i.width&&e.y<i.top+i.height&&e.x>i.left&&e.y>i.top)return e;let r=t.x-e.x,s=t.y-e.y;function n(t,e){return 180*Math.acos(_.dot({x:0,y:1},_.normalize(t,e)))/Math.PI}let o=n(r,s);e.x<t.x&&(o=360-o);let a=360-n(i.left-t.x,-1*(i.top-t.y)),l=360-n(i.left-t.x,-1*(i.top+i.height-t.y)),u=n(i.left+i.width-t.x,-1*(i.top-t.y)),h=n(i.left+i.width-t.x,-1*(i.top+i.height-t.y)),c=s/r,m={};if(o<u){let e=i.top-t.y,r=e/c;m={y:t.y+e,x:t.x+r}}else if(o<h){let e=i.left+i.width-t.x,r=e*c;m={y:t.y+r,x:t.x+e}}else if(o<l){let e=i.top+i.height-t.y,r=e/c;m={y:t.y+e,x:t.x+r}}else if(o<a){let e=t.x-i.left,r=e*c;m={y:t.y-r,x:t.x-e}}else{let e=i.top-t.y,r=e/c;m={y:t.y+e,x:t.x+r}}return m}transformRange(t,e,i){let r={x:e.x-t.x,y:e.y-t.y},s=Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2));return s>i?(r={x:r.x/s*i+t.x,y:r.y/s*i+t.y},r):e}static dot(t,e){return t.x*e.x+t.y*e.y}static normalize(t,e){let i=Math.sqrt(t*t+e*e);return{x:t/i,y:e/i}}}},"./src/lib/MatrixStack.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{MatrixStack:()=>r});class r{constructor(){this.depth=0,this.matrixStack=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.currentMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.tmp=new Array(16)}reset(){this.depth=0}loadIdentity(){for(var t=0;t<16;t++)this.currentMatrix[t]=t%5==0?1:0}push(){this.depth;let t=16*(this.depth+1);this.matrixStack.length<t+16&&(this.matrixStack.length=t+16);for(let e=0;e<16;e++)this.matrixStack[t+e]=this.currentMatrix[e];this.depth++}pop(){this.depth--,this.depth<0&&(console.log("Invalid matrix stack. 无效的矩阵堆栈"),this.depth=0);let t=16*this.depth;for(let e=0;e<16;e++)this.currentMatrix[e]=this.matrixStack[t+e]}getMatrix(){return this.currentMatrix}multMatrix(t){let e,i,r;for(e=0;e<16;e++)this.tmp[e]=0;for(e=0;e<4;e++)for(i=0;i<4;i++)for(r=0;r<4;r++)this.tmp[e+4*i]+=this.currentMatrix[e+4*r]*t[r+4*i];for(e=0;e<16;e++)this.currentMatrix[e]=this.tmp[e]}}},"./src/lib/ModelSettingJson.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{ModelSettingJson:()=>s});var r=i("./src/lib/Live2DFramework.js");class s{constructor(){this.NAME="name",this.ID="id",this.MODEL="model",this.TEXTURES="textures",this.HIT_AREAS="hit_areas",this.PHYSICS="physics",this.POSE="pose",this.EXPRESSIONS="expressions",this.MOTION_GROUPS="motions",this.SOUND="sound",this.FADE_IN="fade_in",this.FADE_OUT="fade_out",this.LAYOUT="layout",this.HIT_AREAS_CUSTOM="hit_areas_custom",this.INIT_PARAM="init_param",this.INIT_PARTS_VISIBLE="init_parts_visible",this.VALUE="val",this.FILE="file",this.json={}}loadModelSetting(t,e){var i=this;r.Live2DFramework.getPlatformManager().loadBytes(t).then((t=>{var r=String.fromCharCode.apply(null,new Uint8Array(t));i.json=JSON.parse(r),e()}))}getTextureFile(t){return null==this.json[this.TEXTURES]||null==this.json[this.TEXTURES][t]?null:this.json[this.TEXTURES][t]}getModelFile(){return this.json[this.MODEL]}getTextureNum(){return null==this.json[this.TEXTURES]?0:this.json[this.TEXTURES].length}getHitAreaNum(){return null==this.json[this.HIT_AREAS]?0:this.json[this.HIT_AREAS].length}getHitAreaID(t){return null==this.json[this.HIT_AREAS]||null==this.json[this.HIT_AREAS][t]?null:this.json[this.HIT_AREAS][t][this.ID]}getHitAreaName(t){return null==this.json[this.HIT_AREAS]||null==this.json[this.HIT_AREAS][t]?null:this.json[this.HIT_AREAS][t][this.NAME]}getPhysicsFile(){return this.json[this.PHYSICS]}getPoseFile(){return this.json[this.POSE]}getExpressionNum(){return null==this.json[this.EXPRESSIONS]?0:this.json[this.EXPRESSIONS].length}getExpressionFile(t){return null==this.json[this.EXPRESSIONS]?null:this.json[this.EXPRESSIONS][t][this.FILE]}getExpressionName(t){return null==this.json[this.EXPRESSIONS]?null:this.json[this.EXPRESSIONS][t][this.NAME]}getLayout(){return this.json[this.LAYOUT]}getHitAreasCustom(){return this.json[this.HIT_AREAS_CUSTOM]}getInitParamNum(){return null==this.json[this.INIT_PARAM]?0:this.json[this.INIT_PARAM].length}getMotionNum(t){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]?0:this.json[this.MOTION_GROUPS][t].length}getMotionFile(t,e){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][e]?null:this.json[this.MOTION_GROUPS][t][e][this.FILE]}getMotionSound(t,e){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][e]||null==this.json[this.MOTION_GROUPS][t][e][this.SOUND]?null:this.json[this.MOTION_GROUPS][t][e][this.SOUND]}getMotionFadeIn(t,e){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][e]||null==this.json[this.MOTION_GROUPS][t][e][this.FADE_IN]?1e3:this.json[this.MOTION_GROUPS][t][e][this.FADE_IN]}getMotionFadeOut(t,e){return null==this.json[this.MOTION_GROUPS]||null==this.json[this.MOTION_GROUPS][t]||null==this.json[this.MOTION_GROUPS][t][e]||null==this.json[this.MOTION_GROUPS][t][e][this.FADE_OUT]?1e3:this.json[this.MOTION_GROUPS][t][e][this.FADE_OUT]}getInitParamID(t){return null==this.json[this.INIT_PARAM]||null==this.json[this.INIT_PARAM][t]?null:this.json[this.INIT_PARAM][t][this.ID]}getInitParamValue(t){return null==this.json[this.INIT_PARAM]||null==this.json[this.INIT_PARAM][t]?NaN:this.json[this.INIT_PARAM][t][this.VALUE]}getInitPartsVisibleNum(){return null==this.json[this.INIT_PARTS_VISIBLE]?0:this.json[this.INIT_PARTS_VISIBLE].length}getInitPartsVisibleID(t){return null==this.json[this.INIT_PARTS_VISIBLE]||null==this.json[this.INIT_PARTS_VISIBLE][t]?null:this.json[this.INIT_PARTS_VISIBLE][t][this.ID]}getInitPartsVisibleValue(t){return null==this.json[this.INIT_PARTS_VISIBLE]||null==this.json[this.INIT_PARTS_VISIBLE][t]?NaN:this.json[this.INIT_PARTS_VISIBLE][t][this.VALUE]}}},"./src/touchmanager.ts":(t,e,i)=>{"use strict";i.r(e),i.d(e,{TouchManager:()=>r});class r{constructor(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}getCenterX(){return this._lastX}getCenterY(){return this._lastY}getDeltaX(){return this._deltaX}getDeltaY(){return this._deltaY}getStartX(){return this._startX}getStartY(){return this._startY}getScale(){return this._scale}getX(){return this._lastX}getY(){return this._lastY}getX1(){return this._lastX1}getY1(){return this._lastY1}getX2(){return this._lastX2}getY2(){return this._lastY2}isSingleTouch(){return this._touchSingle}isFlickAvailable(){return this._flipAvailable}disableFlick(){this._flipAvailable=!1}touchesBegan(t,e){this._lastX=t,this._lastY=e,this._startX=t,this._startY=e,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0}touchesMoved(t,e){this._lastX=t,this._lastY=e,this._lastTouchDistance=-1,this._touchSingle=!0}getFlickDistance(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)}calculateDistance(t,e,i,r){return Math.sqrt((t-i)*(t-i)+(e-r)*(e-r))}calculateMovingAmount(t,e){if(t>0!=e>0)return 0;const i=t>0?1:-1,r=Math.abs(t),s=Math.abs(e);return i*(r<s?r:s)}}},"./node_modules/dexie/dist/modern/dexie.mjs":(t,e,i)=>{"use strict";i.r(e),i.d(e,{Dexie:()=>Qi,RangeSet:()=>ji,default:()=>Qi,liveQuery:()=>ir,mergeRanges:()=>Xi,rangesOverlap:()=>qi});const r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,s=Object.keys,n=Array.isArray;function o(t,e){return"object"!=typeof e||s(e).forEach((function(i){t[i]=e[i]})),t}"undefined"==typeof Promise||r.Promise||(r.Promise=Promise);const a=Object.getPrototypeOf,l={}.hasOwnProperty;function u(t,e){return l.call(t,e)}function h(t,e){"function"==typeof e&&(e=e(a(t))),("undefined"==typeof Reflect?s:Reflect.ownKeys)(e).forEach((i=>{_(t,i,e[i])}))}const c=Object.defineProperty;function _(t,e,i,r){c(t,e,o(i&&u(i,"get")&&"function"==typeof i.get?{get:i.get,set:i.set,configurable:!0}:{value:i,configurable:!0,writable:!0},r))}function m(t){return{from:function(e){return t.prototype=Object.create(e.prototype),_(t.prototype,"constructor",t),{extend:h.bind(null,t.prototype)}}}}const d=Object.getOwnPropertyDescriptor;function g(t,e){let i;return d(t,e)||(i=a(t))&&g(i,e)}const p=[].slice;function f(t,e,i){return p.call(t,e,i)}function y(t,e){return e(t)}function $(t){if(!t)throw new Error("Assertion Failed")}function b(t){r.setImmediate?setImmediate(t):setTimeout(t,0)}function S(t,e){return t.reduce(((t,i,r)=>{var s=e(i,r);return s&&(t[s[0]]=s[1]),t}),{})}function v(t,e){if(u(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var i=[],r=0,s=e.length;r<s;++r){var n=v(t,e[r]);i.push(n)}return i}var o=e.indexOf(".");if(-1!==o){var a=t[e.substr(0,o)];return void 0===a?void 0:v(a,e.substr(o+1))}}function x(t,e,i){if(t&&void 0!==e&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){$("string"!=typeof i&&"length"in i);for(var r=0,s=e.length;r<s;++r)x(t,e[r],i[r])}else{var o=e.indexOf(".");if(-1!==o){var a=e.substr(0,o),l=e.substr(o+1);if(""===l)void 0===i?n(t)&&!isNaN(parseInt(a))?t.splice(a,1):delete t[a]:t[a]=i;else{var h=t[a];h&&u(t,a)||(h=t[a]={}),x(h,l,i)}}else void 0===i?n(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=i}}function P(t){var e={};for(var i in t)u(t,i)&&(e[i]=t[i]);return e}const C=[].concat;function w(t){return C.apply([],t)}const M="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(w([8,16,32,64].map((t=>["Int","Uint","Float"].map((e=>e+t+"Array")))))).filter((t=>r[t])),T=M.map((t=>r[t]));S(M,(t=>[t,!0]));let L=null;function I(t){L="undefined"!=typeof WeakMap&&new WeakMap;const e=E(t);return L=null,e}function E(t){if(!t||"object"!=typeof t)return t;let e=L&&L.get(t);if(e)return e;if(n(t)){e=[],L&&L.set(t,e);for(var i=0,r=t.length;i<r;++i)e.push(E(t[i]))}else if(T.indexOf(t.constructor)>=0)e=t;else{const i=a(t);for(var s in e=i===Object.prototype?{}:Object.create(i),L&&L.set(t,e),t)u(t,s)&&(e[s]=E(t[s]))}return e}const{toString:F}={};function B(t){return F.call(t).slice(8,-1)}const A="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",D="symbol"==typeof A?function(t){var e;return null!=t&&(e=t[A])&&e.apply(t)}:function(){return null},R={};function k(t){var e,i,r,s;if(1===arguments.length){if(n(t))return t.slice();if(this===R&&"string"==typeof t)return[t];if(s=D(t)){for(i=[];!(r=s.next()).done;)i.push(r.value);return i}if(null==t)return[t];if("number"==typeof(e=t.length)){for(i=new Array(e);e--;)i[e]=t[e];return i}return[t]}for(e=arguments.length,i=new Array(e);e--;)i[e]=arguments[e];return i}const V="undefined"!=typeof Symbol?t=>"AsyncFunction"===t[Symbol.toStringTag]:()=>!1;var O="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function N(t,e){O=t,U=e}var U=()=>!0;const z=!new Error("").stack;function Y(){if(z)try{throw Y.arguments,new Error}catch(t){return t}return new Error}function j(t,e){var i=t.stack;return i?(e=e||0,0===i.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),i.split("\n").slice(e).filter(U).map((t=>"\n"+t)).join("")):""}var G=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],X=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(G),q={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function H(t,e){this._e=Y(),this.name=t,this.message=e}function W(t,e){return t+". Errors: "+Object.keys(e).map((t=>e[t].toString())).filter(((t,e,i)=>i.indexOf(t)===e)).join("\n")}function K(t,e,i,r){this._e=Y(),this.failures=e,this.failedKeys=r,this.successCount=i,this.message=W(t,e)}function J(t,e){this._e=Y(),this.name="BulkError",this.failures=Object.keys(e).map((t=>e[t])),this.failuresByPos=e,this.message=W(t,e)}m(H).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+j(this._e,2))}},toString:function(){return this.name+": "+this.message}}),m(K).from(H),m(J).from(H);var Q=X.reduce(((t,e)=>(t[e]=e+"Error",t)),{});const Z=H;var tt=X.reduce(((t,e)=>{var i=e+"Error";function r(t,r){this._e=Y(),this.name=i,t?"string"==typeof t?(this.message=`${t}${r?"\n "+r:""}`,this.inner=r||null):"object"==typeof t&&(this.message=`${t.name} ${t.message}`,this.inner=t):(this.message=q[e]||i,this.inner=null)}return m(r).from(Z),t[e]=r,t}),{});tt.Syntax=SyntaxError,tt.Type=TypeError,tt.Range=RangeError;var et=G.reduce(((t,e)=>(t[e+"Error"]=tt[e],t)),{});var it=X.reduce(((t,e)=>(-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=tt[e]),t)),{});function rt(){}function st(t){return t}function nt(t,e){return null==t||t===st?e:function(i){return e(t(i))}}function ot(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function at(t,e){return t===rt?e:function(){var i=t.apply(this,arguments);void 0!==i&&(arguments[0]=i);var r=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var n=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ot(r,this.onsuccess):r),s&&(this.onerror=this.onerror?ot(s,this.onerror):s),void 0!==n?n:i}}function lt(t,e){return t===rt?e:function(){t.apply(this,arguments);var i=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?ot(i,this.onsuccess):i),r&&(this.onerror=this.onerror?ot(r,this.onerror):r)}}function ut(t,e){return t===rt?e:function(i){var r=t.apply(this,arguments);o(i,r);var s=this.onsuccess,n=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?ot(s,this.onsuccess):s),n&&(this.onerror=this.onerror?ot(n,this.onerror):n),void 0===r?void 0===a?void 0:a:o(r,a)}}function ht(t,e){return t===rt?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function ct(t,e){return t===rt?e:function(){var i=t.apply(this,arguments);if(i&&"function"==typeof i.then){for(var r=this,s=arguments.length,n=new Array(s);s--;)n[s]=arguments[s];return i.then((function(){return e.apply(r,n)}))}return e.apply(this,arguments)}}it.ModifyError=K,it.DexieError=H,it.BulkError=J;var _t={};const[mt,dt,gt]="undefined"==typeof Promise?[]:(()=>{let t=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[t,a(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,a(e),t]})(),pt=dt&&dt.then,ft=mt&&mt.constructor,yt=!!gt;var $t=!1,bt=gt?()=>{gt.then(Yt)}:r.setImmediate?setImmediate.bind(null,Yt):r.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver((()=>{Yt(),t=null})).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Yt,0)},St=function(t,e){It.push([t,e]),xt&&(bt(),xt=!1)},vt=!0,xt=!0,Pt=[],Ct=[],wt=null,Mt=st,Tt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:de,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((t=>{try{de(t[0],t[1])}catch(t){}}))}},Lt=Tt,It=[],Et=0,Ft=[];function Bt(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=rt,this._lib=!1;var e=this._PSD=Lt;if(O&&(this._stackHolder=Y(),this._prev=null,this._numPrev=0),"function"!=typeof t){if(t!==_t)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&kt(this,this._value))}this._state=null,this._value=null,++e.ref,Rt(this,t)}const At={get:function(){var t=Lt,e=Zt;function i(i,r){var s=!t.global&&(t!==Lt||e!==Zt);const n=s&&!re();var o=new Bt(((e,o)=>{Ot(this,new Dt(ce(i,t,s,n),ce(r,t,s,n),e,o,t))}));return O&&zt(o,this),o}return i.prototype=_t,i},set:function(t){_(this,"then",t&&t.prototype===_t?At:{get:function(){return t},set:At.set})}};function Dt(t,e,i,r,s){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=i,this.reject=r,this.psd=s}function Rt(t,e){try{e((e=>{if(null===t._state){if(e===t)throw new TypeError("A promise cannot be resolved with itself.");var i=t._lib&&jt();e&&"function"==typeof e.then?Rt(t,((t,i)=>{e instanceof Bt?e._then(t,i):e.then(t,i)})):(t._state=!0,t._value=e,Vt(t)),i&&Gt()}}),kt.bind(null,t))}catch(e){kt(t,e)}}function kt(t,e){if(Ct.push(e),null===t._state){var i=t._lib&&jt();e=Mt(e),t._state=!1,t._value=e,O&&null!==e&&"object"==typeof e&&!e._promise&&function(t,e,i){try{t.apply(null,i)}catch(t){e&&e(t)}}((()=>{var i=g(e,"stack");e._promise=t,_(e,"stack",{get:()=>$t?i&&(i.get?i.get.apply(e):i.value):t.stack})})),function(t){Pt.some((e=>e._value===t._value))||Pt.push(t)}(t),Vt(t),i&&Gt()}}function Vt(t){var e=t._listeners;t._listeners=[];for(var i=0,r=e.length;i<r;++i)Ot(t,e[i]);var s=t._PSD;--s.ref||s.finalize(),0===Et&&(++Et,St((()=>{0==--Et&&Xt()}),[]))}function Ot(t,e){if(null!==t._state){var i=t._state?e.onFulfilled:e.onRejected;if(null===i)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Et,St(Nt,[i,t,e])}else t._listeners.push(e)}function Nt(t,e,i){try{wt=e;var r,s=e._value;e._state?r=t(s):(Ct.length&&(Ct=[]),r=t(s),-1===Ct.indexOf(s)&&function(t){var e=Pt.length;for(;e;)if(Pt[--e]._value===t._value)return void Pt.splice(e,1)}(e)),i.resolve(r)}catch(t){i.reject(t)}finally{wt=null,0==--Et&&Xt(),--i.psd.ref||i.psd.finalize()}}function Ut(t,e,i){if(e.length===i)return e;var r="";if(!1===t._state){var s,n,o=t._value;null!=o?(s=o.name||"Error",n=o.message||o,r=j(o,0)):(s=o,n=""),e.push(s+(n?": "+n:"")+r)}return O&&((r=j(t._stackHolder,2))&&-1===e.indexOf(r)&&e.push(r),t._prev&&Ut(t._prev,e,i)),e}function zt(t,e){var i=e?e._numPrev+1:0;i<100&&(t._prev=e,t._numPrev=i)}function Yt(){jt()&&Gt()}function jt(){var t=vt;return vt=!1,xt=!1,t}function Gt(){var t,e,i;do{for(;It.length>0;)for(t=It,It=[],i=t.length,e=0;e<i;++e){var r=t[e];r[0].apply(null,r[1])}}while(It.length>0);vt=!0,xt=!0}function Xt(){var t=Pt;Pt=[],t.forEach((t=>{t._PSD.onunhandled.call(null,t._value,t)}));for(var e=Ft.slice(0),i=e.length;i;)e[--i]()}function qt(t){return new Bt(_t,!1,t)}function Ht(t,e){var i=Lt;return function(){var r=jt(),s=Lt;try{return ae(i,!0),t.apply(this,arguments)}catch(t){e&&e(t)}finally{ae(s,!1),r&&Gt()}}}h(Bt.prototype,{then:At,_then:function(t,e){Ot(this,new Dt(null,null,t,e,Lt))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=arguments[0],i=arguments[1];return"function"==typeof e?this.then(null,(t=>t instanceof e?i(t):qt(t))):this.then(null,(t=>t&&t.name===e?i(t):qt(t)))},finally:function(t){return this.then((e=>(t(),e)),(e=>(t(),qt(e))))},stack:{get:function(){if(this._stack)return this._stack;try{$t=!0;var t=Ut(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{$t=!1}}},timeout:function(t,e){return t<1/0?new Bt(((i,r)=>{var s=setTimeout((()=>r(new tt.Timeout(e))),t);this.then(i,r).finally(clearTimeout.bind(null,s))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&_(Bt.prototype,Symbol.toStringTag,"Dexie.Promise"),Tt.env=le(),h(Bt,{all:function(){var t=k.apply(null,arguments).map(se);return new Bt((function(e,i){0===t.length&&e([]);var r=t.length;t.forEach(((s,n)=>Bt.resolve(s).then((i=>{t[n]=i,--r||e(t)}),i)))}))},resolve:t=>{if(t instanceof Bt)return t;if(t&&"function"==typeof t.then)return new Bt(((e,i)=>{t.then(e,i)}));var e=new Bt(_t,!0,t);return zt(e,wt),e},reject:qt,race:function(){var t=k.apply(null,arguments).map(se);return new Bt(((e,i)=>{t.map((t=>Bt.resolve(t).then(e,i)))}))},PSD:{get:()=>Lt,set:t=>Lt=t},totalEchoes:{get:()=>Zt},newPSD:ee,usePSD:ue,scheduler:{get:()=>St,set:t=>{St=t}},rejectionMapper:{get:()=>Mt,set:t=>{Mt=t}},follow:(t,e)=>new Bt(((i,r)=>ee(((e,i)=>{var r=Lt;r.unhandleds=[],r.onunhandled=i,r.finalize=ot((function(){!function(t){function e(){t(),Ft.splice(Ft.indexOf(e),1)}Ft.push(e),++Et,St((()=>{0==--Et&&Xt()}),[])}((()=>{0===this.unhandleds.length?e():i(this.unhandleds[0])}))}),r.finalize),t()}),e,i,r)))}),ft&&(ft.allSettled&&_(Bt,"allSettled",(function(){const t=k.apply(null,arguments).map(se);return new Bt((e=>{0===t.length&&e([]);let i=t.length;const r=new Array(i);t.forEach(((t,s)=>Bt.resolve(t).then((t=>r[s]={status:"fulfilled",value:t}),(t=>r[s]={status:"rejected",reason:t})).then((()=>--i||e(r)))))}))})),ft.any&&"undefined"!=typeof AggregateError&&_(Bt,"any",(function(){const t=k.apply(null,arguments).map(se);return new Bt(((e,i)=>{0===t.length&&i(new AggregateError([]));let r=t.length;const s=new Array(r);t.forEach(((t,n)=>Bt.resolve(t).then((t=>e(t)),(t=>{s[n]=t,--r||i(new AggregateError(s))}))))}))})));const Wt={awaits:0,echoes:0,id:0};var Kt=0,Jt=[],Qt=0,Zt=0,te=0;function ee(t,e,i,r){var s=Lt,n=Object.create(s);n.parent=s,n.ref=0,n.global=!1,n.id=++te;var a=Tt.env;n.env=yt?{Promise:Bt,PromiseProp:{value:Bt,configurable:!0,writable:!0},all:Bt.all,race:Bt.race,allSettled:Bt.allSettled,any:Bt.any,resolve:Bt.resolve,reject:Bt.reject,nthen:_e(a.nthen,n),gthen:_e(a.gthen,n)}:{},e&&o(n,e),++s.ref,n.finalize=function(){--this.parent.ref||this.parent.finalize()};var l=ue(n,t,i,r);return 0===n.ref&&n.finalize(),l}function ie(){return Wt.id||(Wt.id=++Kt),++Wt.awaits,Wt.echoes+=100,Wt.id}function re(){return!!Wt.awaits&&(0==--Wt.awaits&&(Wt.id=0),Wt.echoes=100*Wt.awaits,!0)}function se(t){return Wt.echoes&&t&&t.constructor===ft?(ie(),t.then((t=>(re(),t)),(t=>(re(),ge(t))))):t}function ne(t){++Zt,Wt.echoes&&0!=--Wt.echoes||(Wt.echoes=Wt.id=0),Jt.push(Lt),ae(t,!0)}function oe(){var t=Jt[Jt.length-1];Jt.pop(),ae(t,!1)}function ae(t,e){var i=Lt;if((e?!Wt.echoes||Qt++&&t===Lt:!Qt||--Qt&&t===Lt)||he(e?ne.bind(null,t):oe),t!==Lt&&(Lt=t,i===Tt&&(Tt.env=le()),yt)){var s=Tt.env.Promise,n=t.env;dt.then=n.nthen,s.prototype.then=n.gthen,(i.global||t.global)&&(Object.defineProperty(r,"Promise",n.PromiseProp),s.all=n.all,s.race=n.race,s.resolve=n.resolve,s.reject=n.reject,n.allSettled&&(s.allSettled=n.allSettled),n.any&&(s.any=n.any))}}function le(){var t=r.Promise;return yt?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(r,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:dt.then,gthen:t.prototype.then}:{}}function ue(t,e,i,r,s){var n=Lt;try{return ae(t,!0),e(i,r,s)}finally{ae(n,!1)}}function he(t){pt.call(mt,t)}function ce(t,e,i,r){return"function"!=typeof t?t:function(){var s=Lt;i&&ie(),ae(e,!0);try{return t.apply(this,arguments)}finally{ae(s,!1),r&&he(re)}}}function _e(t,e){return function(i,r){return t.call(this,ce(i,e),ce(r,e))}}-1===(""+pt).indexOf("[native code]")&&(ie=re=rt);const me="unhandledrejection";function de(t,e){var i;try{i=e.onuncatched(t)}catch(t){}if(!1!==i)try{var s,n={promise:e,reason:t};if(r.document&&document.createEvent?((s=document.createEvent("Event")).initEvent(me,!0,!0),o(s,n)):r.CustomEvent&&o(s=new CustomEvent(me,{detail:n}),n),s&&r.dispatchEvent&&(dispatchEvent(s),!r.PromiseRejectionEvent&&r.onunhandledrejection))try{r.onunhandledrejection(s)}catch(t){}O&&s&&!s.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch(t){}}var ge=Bt.reject;function pe(t,e,i,r){if(t.idbdb&&(t._state.openComplete||Lt.letThrough||t._vip)){var s=t._createTransaction(e,i,t._dbSchema);try{s.create(),t._state.PR1398_maxLoop=3}catch(s){return s.name===Q.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then((()=>pe(t,e,i,r)))):ge(s)}return s._promise(e,((t,e)=>ee((()=>(Lt.trans=s,r(t,e,s)))))).then((t=>s._completion.then((()=>t))))}if(t._state.openComplete)return ge(new tt.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return ge(new tt.DatabaseClosed);t.open().catch(rt)}return t._state.dbReadyPromise.then((()=>pe(t,e,i,r)))}const fe="3.2.2",ye=String.fromCharCode(65535),$e=-1/0,be="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Se="String expected.",ve=[],xe="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Pe=xe,Ce=xe,we=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),Me="__dbnames",Te="readonly",Le="readwrite";function Ie(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const Ee={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Fe(t){return"string"!=typeof t||/\./.test(t)?t=>t:e=>(void 0===e[t]&&t in e&&delete(e=I(e))[t],e)}class Be{_trans(t,e,i){const r=this._tx||Lt.trans,s=this.name;function n(t,i,r){if(!r.schema[s])throw new tt.NotFound("Table "+s+" not part of transaction");return e(r.idbtrans,r)}const o=jt();try{return r&&r.db===this.db?r===Lt.trans?r._promise(t,n,i):ee((()=>r._promise(t,n,i)),{trans:r,transless:Lt.transless||Lt}):pe(this.db,t,[this.name],n)}finally{o&&Gt()}}get(t,e){return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",(e=>this.core.get({trans:e,key:t}).then((t=>this.hook.reading.fire(t))))).then(e)}where(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(n(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const e=s(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);const i=this.schema.indexes.concat(this.schema.primKey).filter((t=>t.compound&&e.every((e=>t.keyPath.indexOf(e)>=0))&&t.keyPath.every((t=>e.indexOf(t)>=0))))[0];if(i&&this.db._maxKey!==ye)return this.where(i.name).equals(i.keyPath.map((e=>t[e])));!i&&O&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${e.join("+")}]`);const{idxByName:r}=this.schema,o=this.db._deps.indexedDB;function a(t,e){try{return 0===o.cmp(t,e)}catch(t){return!1}}const[l,u]=e.reduce((([e,i],s)=>{const o=r[s],l=t[s];return[e||o,e||!o?Ie(i,o&&o.multi?t=>{const e=v(t,s);return n(e)&&e.some((t=>a(l,t)))}:t=>a(l,v(t,s))):i]}),[null,null]);return l?this.where(l.name).equals(t[l.keyPath]).filter(u):i?this.filter(u):this.where(e).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,n(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const e=e=>{if(!e)return e;const i=Object.create(t.prototype);for(var r in e)if(u(e,r))try{i[r]=e[r]}catch(t){}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),t}defineClass(){return this.mapToClass((function(t){o(this,t)}))}add(t,e){const{auto:i,keyPath:r}=this.schema.primKey;let s=t;return r&&i&&(s=Fe(r)(t)),this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"add",keys:null!=e?[e]:null,values:[s]}))).then((t=>t.numFailures?Bt.reject(t.failures[0]):t.lastResult)).then((e=>{if(r)try{x(t,r,e)}catch(t){}return e}))}update(t,e){if("object"!=typeof t||n(t))return this.where(":id").equals(t).modify(e);{const i=v(t,this.schema.primKey.keyPath);if(void 0===i)return ge(new tt.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof e?s(e).forEach((i=>{x(t,i,e[i])})):e(t,{value:t,primKey:i})}catch(t){}return this.where(":id").equals(i).modify(e)}}put(t,e){const{auto:i,keyPath:r}=this.schema.primKey;let s=t;return r&&i&&(s=Fe(r)(t)),this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"put",values:[s],keys:null!=e?[e]:null}))).then((t=>t.numFailures?Bt.reject(t.failures[0]):t.lastResult)).then((e=>{if(r)try{x(t,r,e)}catch(t){}return e}))}delete(t){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"delete",keys:[t]}))).then((t=>t.numFailures?Bt.reject(t.failures[0]):void 0))}clear(){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"deleteRange",range:Ee}))).then((t=>t.numFailures?Bt.reject(t.failures[0]):void 0))}bulkGet(t){return this._trans("readonly",(e=>this.core.getMany({keys:t,trans:e}).then((t=>t.map((t=>this.hook.reading.fire(t)))))))}bulkAdd(t,e,i){const r=Array.isArray(e)?e:void 0,s=(i=i||(r?void 0:e))?i.allKeys:void 0;return this._trans("readwrite",(e=>{const{auto:i,keyPath:n}=this.schema.primKey;if(n&&r)throw new tt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==t.length)throw new tt.InvalidArgument("Arguments objects and keys must have the same length");const o=t.length;let a=n&&i?t.map(Fe(n)):t;return this.core.mutate({trans:e,type:"add",keys:r,values:a,wantResults:s}).then((({numFailures:t,results:e,lastResult:i,failures:r})=>{if(0===t)return s?e:i;throw new J(`${this.name}.bulkAdd(): ${t} of ${o} operations failed`,r)}))}))}bulkPut(t,e,i){const r=Array.isArray(e)?e:void 0,s=(i=i||(r?void 0:e))?i.allKeys:void 0;return this._trans("readwrite",(e=>{const{auto:i,keyPath:n}=this.schema.primKey;if(n&&r)throw new tt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==t.length)throw new tt.InvalidArgument("Arguments objects and keys must have the same length");const o=t.length;let a=n&&i?t.map(Fe(n)):t;return this.core.mutate({trans:e,type:"put",keys:r,values:a,wantResults:s}).then((({numFailures:t,results:e,lastResult:i,failures:r})=>{if(0===t)return s?e:i;throw new J(`${this.name}.bulkPut(): ${t} of ${o} operations failed`,r)}))}))}bulkDelete(t){const e=t.length;return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"delete",keys:t}))).then((({numFailures:t,lastResult:i,failures:r})=>{if(0===t)return i;throw new J(`${this.name}.bulkDelete(): ${t} of ${e} operations failed`,r)}))}}function Ae(t){var e={},i=function(i,r){if(r){for(var s=arguments.length,n=new Array(s-1);--s;)n[s-1]=arguments[s];return e[i].subscribe.apply(null,n),t}if("string"==typeof i)return e[i]};i.addEventType=a;for(var r=1,o=arguments.length;r<o;++r)a(arguments[r]);return i;function a(t,r,s){if("object"==typeof t)return l(t);r||(r=ht),s||(s=rt);var n={subscribers:[],fire:s,subscribe:function(t){-1===n.subscribers.indexOf(t)&&(n.subscribers.push(t),n.fire=r(n.fire,t))},unsubscribe:function(t){n.subscribers=n.subscribers.filter((function(e){return e!==t})),n.fire=n.subscribers.reduce(r,s)}};return e[t]=i[t]=n,n}function l(t){s(t).forEach((function(e){var i=t[e];if(n(i))a(e,t[e][0],t[e][1]);else{if("asap"!==i)throw new tt.InvalidArgument("Invalid event config");var r=a(e,st,(function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];r.subscribers.forEach((function(t){b((function(){t.apply(null,e)}))}))}))}}))}}function De(t,e){return m(e).from({prototype:t}),e}function Re(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function ke(t,e){t.filter=Ie(t.filter,e)}function Ve(t,e,i){var r=t.replayFilter;t.replayFilter=r?()=>Ie(r(),e()):e,t.justLimit=i&&!r}function Oe(t,e){if(t.isPrimKey)return e.primaryKey;const i=e.getIndexByKeyPath(t.index);if(!i)throw new tt.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return i}function Ne(t,e,i){const r=Oe(t,e.schema);return e.openCursor({trans:i,values:!t.keysOnly,reverse:"prev"===t.dir,unique:!!t.unique,query:{index:r,range:t.range}})}function Ue(t,e,i,r){const s=t.replayFilter?Ie(t.filter,t.replayFilter()):t.filter;if(t.or){const n={},o=(t,i,r)=>{if(!s||s(i,r,(t=>i.stop(t)),(t=>i.fail(t)))){var o=i.primaryKey,a=""+o;"[object ArrayBuffer]"===a&&(a=""+new Uint8Array(o)),u(n,a)||(n[a]=!0,e(t,i,r))}};return Promise.all([t.or._iterate(o,i),ze(Ne(t,r,i),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}return ze(Ne(t,r,i),Ie(t.algorithm,s),e,!t.keysOnly&&t.valueMapper)}function ze(t,e,i,r){var s=Ht(r?(t,e,s)=>i(r(t),e,s):i);return t.then((t=>{if(t)return t.start((()=>{var i=()=>t.continue();e&&!e(t,(t=>i=t),(e=>{t.stop(e),i=rt}),(e=>{t.fail(e),i=rt}))||s(t.value,t,(t=>i=t)),i()}))}))}function Ye(t,e){try{const i=je(t),r=je(e);if(i!==r)return"Array"===i?1:"Array"===r?-1:"binary"===i?1:"binary"===r?-1:"string"===i?1:"string"===r?-1:"Date"===i?1:"Date"!==r?NaN:-1;switch(i){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(t,e){const i=t.length,r=e.length,s=i<r?i:r;for(let i=0;i<s;++i)if(t[i]!==e[i])return t[i]<e[i]?-1:1;return i===r?0:i<r?-1:1}(Ge(t),Ge(e));case"Array":return function(t,e){const i=t.length,r=e.length,s=i<r?i:r;for(let i=0;i<s;++i){const r=Ye(t[i],e[i]);if(0!==r)return r}return i===r?0:i<r?-1:1}(t,e)}}catch(t){}return NaN}function je(t){const e=typeof t;if("object"!==e)return e;if(ArrayBuffer.isView(t))return"binary";const i=B(t);return"ArrayBuffer"===i?"binary":i}function Ge(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class Xe{_read(t,e){var i=this._ctx;return i.error?i.table._trans(null,ge.bind(null,i.error)):i.table._trans("readonly",t).then(e)}_write(t){var e=this._ctx;return e.error?e.table._trans(null,ge.bind(null,e.error)):e.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var e=this._ctx;e.algorithm=Ie(e.algorithm,t)}_iterate(t,e){return Ue(this._ctx,t,e,this._ctx.table.core)}clone(t){var e=Object.create(this.constructor.prototype),i=Object.create(this._ctx);return t&&o(i,t),e._ctx=i,e}raw(){return this._ctx.valueMapper=null,this}each(t){var e=this._ctx;return this._read((i=>Ue(e,t,i,e.table.core)))}count(t){return this._read((t=>{const e=this._ctx,i=e.table.core;if(Re(e,!0))return i.count({trans:t,query:{index:Oe(e,i.schema),range:e.range}}).then((t=>Math.min(t,e.limit)));var r=0;return Ue(e,(()=>(++r,!1)),t,i).then((()=>r))})).then(t)}sortBy(t,e){const i=t.split(".").reverse(),r=i[0],s=i.length-1;function n(t,e){return e?n(t[i[e]],e-1):t[r]}var o="next"===this._ctx.dir?1:-1;function a(t,e){var i=n(t,s),r=n(e,s);return i<r?-o:i>r?o:0}return this.toArray((function(t){return t.sort(a)})).then(e)}toArray(t){return this._read((t=>{var e=this._ctx;if("next"===e.dir&&Re(e,!0)&&e.limit>0){const{valueMapper:i}=e,r=Oe(e,e.table.core.schema);return e.table.core.query({trans:t,limit:e.limit,values:!0,query:{index:r,range:e.range}}).then((({result:t})=>i?t.map(i):t))}{const i=[];return Ue(e,(t=>i.push(t)),t,e.table.core).then((()=>i))}}),t)}offset(t){var e=this._ctx;return t<=0||(e.offset+=t,Re(e)?Ve(e,(()=>{var e=t;return(t,i)=>0===e||(1===e?(--e,!1):(i((()=>{t.advance(e),e=0})),!1))})):Ve(e,(()=>{var e=t;return()=>--e<0}))),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),Ve(this._ctx,(()=>{var e=t;return function(t,i,r){return--e<=0&&i(r),e>=0}}),!0),this}until(t,e){return ke(this._ctx,(function(i,r,s){return!t(i.value)||(r(s),e)})),this}first(t){return this.limit(1).toArray((function(t){return t[0]})).then(t)}last(t){return this.reverse().first(t)}filter(t){var e,i;return ke(this._ctx,(function(e){return t(e.value)})),e=this._ctx,i=t,e.isMatch=Ie(e.isMatch,i),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,i){t(i.key,i)}))}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,i){t(i.primaryKey,i)}))}keys(t){var e=this._ctx;e.keysOnly=!e.isMatch;var i=[];return this.each((function(t,e){i.push(e.key)})).then((function(){return i})).then(t)}primaryKeys(t){var e=this._ctx;if("next"===e.dir&&Re(e,!0)&&e.limit>0)return this._read((t=>{var i=Oe(e,e.table.core.schema);return e.table.core.query({trans:t,values:!1,limit:e.limit,query:{index:i,range:e.range}})})).then((({result:t})=>t)).then(t);e.keysOnly=!e.isMatch;var i=[];return this.each((function(t,e){i.push(e.primaryKey)})).then((function(){return i})).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys((function(t){return t[0]})).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var i={};return ke(this._ctx,(function(t){var e=t.primaryKey.toString(),r=u(i,e);return i[e]=!0,!r})),this}modify(t){var e=this._ctx;return this._write((i=>{var r;if("function"==typeof t)r=t;else{var n=s(t),o=n.length;r=function(e){for(var i=!1,r=0;r<o;++r){var s=n[r],a=t[s];v(e,s)!==a&&(x(e,s,a),i=!0)}return i}}const a=e.table.core,{outbound:l,extractKey:u}=a.schema.primaryKey,h=this.db._options.modifyChunkSize||200,c=[];let _=0;const m=[],d=(t,e)=>{const{failures:i,numFailures:r}=e;_+=t-r;for(let t of s(i))c.push(i[t])};return this.clone().primaryKeys().then((s=>{const n=o=>{const c=Math.min(h,s.length-o);return a.getMany({trans:i,keys:s.slice(o,o+c),cache:"immutable"}).then((_=>{const m=[],g=[],p=l?[]:null,f=[];for(let t=0;t<c;++t){const e=_[t],i={value:I(e),primKey:s[o+t]};!1!==r.call(i,i.value,i)&&(null==i.value?f.push(s[o+t]):l||0===Ye(u(e),u(i.value))?(g.push(i.value),l&&p.push(s[o+t])):(f.push(s[o+t]),m.push(i.value)))}const y=Re(e)&&e.limit===1/0&&("function"!=typeof t||t===qe)&&{index:e.index,range:e.range};return Promise.resolve(m.length>0&&a.mutate({trans:i,type:"add",values:m}).then((t=>{for(let e in t.failures)f.splice(parseInt(e),1);d(m.length,t)}))).then((()=>(g.length>0||y&&"object"==typeof t)&&a.mutate({trans:i,type:"put",keys:p,values:g,criteria:y,changeSpec:"function"!=typeof t&&t}).then((t=>d(g.length,t))))).then((()=>(f.length>0||y&&t===qe)&&a.mutate({trans:i,type:"delete",keys:f,criteria:y}).then((t=>d(f.length,t))))).then((()=>s.length>o+c&&n(o+h)))}))};return n(0).then((()=>{if(c.length>0)throw new K("Error modifying one or more objects",c,_,m);return s.length}))}))}))}delete(){var t=this._ctx,e=t.range;return Re(t)&&(t.isPrimKey&&!Ce||3===e.type)?this._write((i=>{const{primaryKey:r}=t.table.core.schema,s=e;return t.table.core.count({trans:i,query:{index:r,range:s}}).then((e=>t.table.core.mutate({trans:i,type:"deleteRange",range:s}).then((({failures:t,lastResult:i,results:r,numFailures:s})=>{if(s)throw new K("Could not delete some values",Object.keys(t).map((e=>t[e])),e-s);return e-s}))))})):this.modify(qe)}}const qe=(t,e)=>e.value=null;function He(t,e){return t<e?-1:t===e?0:1}function We(t,e){return t>e?-1:t===e?0:1}function Ke(t,e,i){var r=t instanceof ii?new t.Collection(t):t;return r._ctx.error=i?new i(e):new TypeError(e),r}function Je(t){return new t.Collection(t,(()=>ei(""))).limit(0)}function Qe(t,e,i,r,s,n){for(var o=Math.min(t.length,r.length),a=-1,l=0;l<o;++l){var u=e[l];if(u!==r[l])return s(t[l],i[l])<0?t.substr(0,l)+i[l]+i.substr(l+1):s(t[l],r[l])<0?t.substr(0,l)+r[l]+i.substr(l+1):a>=0?t.substr(0,a)+e[a]+i.substr(a+1):null;s(t[l],u)<0&&(a=l)}return o<r.length&&"next"===n?t+i.substr(t.length):o<t.length&&"prev"===n?t.substr(0,i.length):a<0?null:t.substr(0,a)+r[a]+i.substr(a+1)}function Ze(t,e,i,r){var s,n,o,a,l,u,h,c=i.length;if(!i.every((t=>"string"==typeof t)))return Ke(t,Se);function _(t){s=function(t){return"next"===t?t=>t.toUpperCase():t=>t.toLowerCase()}(t),n=function(t){return"next"===t?t=>t.toLowerCase():t=>t.toUpperCase()}(t),o="next"===t?He:We;var e=i.map((function(t){return{lower:n(t),upper:s(t)}})).sort((function(t,e){return o(t.lower,e.lower)}));a=e.map((function(t){return t.upper})),l=e.map((function(t){return t.lower})),u=t,h="next"===t?"":r}_("next");var m=new t.Collection(t,(()=>ti(a[0],l[c-1]+r)));m._ondirectionchange=function(t){_(t)};var d=0;return m._addAlgorithm((function(t,i,r){var s=t.key;if("string"!=typeof s)return!1;var _=n(s);if(e(_,l,d))return!0;for(var m=null,g=d;g<c;++g){var p=Qe(s,_,a[g],l[g],o,u);null===p&&null===m?d=g+1:(null===m||o(m,p)>0)&&(m=p)}return i(null!==m?function(){t.continue(m+h)}:r),!1})),m}function ti(t,e,i,r){return{type:2,lower:t,upper:e,lowerOpen:i,upperOpen:r}}function ei(t){return{type:1,lower:t,upper:t}}class ii{get Collection(){return this._ctx.table.db.Collection}between(t,e,i,r){i=!1!==i,r=!0===r;try{return this._cmp(t,e)>0||0===this._cmp(t,e)&&(i||r)&&(!i||!r)?Je(this):new this.Collection(this,(()=>ti(t,e,!i,!r)))}catch(t){return Ke(this,be)}}equals(t){return null==t?Ke(this,be):new this.Collection(this,(()=>ei(t)))}above(t){return null==t?Ke(this,be):new this.Collection(this,(()=>ti(t,void 0,!0)))}aboveOrEqual(t){return null==t?Ke(this,be):new this.Collection(this,(()=>ti(t,void 0,!1)))}below(t){return null==t?Ke(this,be):new this.Collection(this,(()=>ti(void 0,t,!1,!0)))}belowOrEqual(t){return null==t?Ke(this,be):new this.Collection(this,(()=>ti(void 0,t)))}startsWith(t){return"string"!=typeof t?Ke(this,Se):this.between(t,t+ye,!0,!0)}startsWithIgnoreCase(t){return""===t?this.startsWith(t):Ze(this,((t,e)=>0===t.indexOf(e[0])),[t],ye)}equalsIgnoreCase(t){return Ze(this,((t,e)=>t===e[0]),[t],"")}anyOfIgnoreCase(){var t=k.apply(R,arguments);return 0===t.length?Je(this):Ze(this,((t,e)=>-1!==e.indexOf(t)),t,"")}startsWithAnyOfIgnoreCase(){var t=k.apply(R,arguments);return 0===t.length?Je(this):Ze(this,((t,e)=>e.some((e=>0===t.indexOf(e)))),t,ye)}anyOf(){const t=k.apply(R,arguments);let e=this._cmp;try{t.sort(e)}catch(t){return Ke(this,be)}if(0===t.length)return Je(this);const i=new this.Collection(this,(()=>ti(t[0],t[t.length-1])));i._ondirectionchange=i=>{e="next"===i?this._ascending:this._descending,t.sort(e)};let r=0;return i._addAlgorithm(((i,s,n)=>{const o=i.key;for(;e(o,t[r])>0;)if(++r,r===t.length)return s(n),!1;return 0===e(o,t[r])||(s((()=>{i.continue(t[r])})),!1)})),i}notEqual(t){return this.inAnyRange([[$e,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=k.apply(R,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch(t){return Ke(this,be)}const e=t.reduce(((t,e)=>t?t.concat([[t[t.length-1][1],e]]):[[$e,e]]),null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,e){const i=this._cmp,r=this._ascending,s=this._descending,n=this._min,o=this._max;if(0===t.length)return Je(this);if(!t.every((t=>void 0!==t[0]&&void 0!==t[1]&&r(t[0],t[1])<=0)))return Ke(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",tt.InvalidArgument);const a=!e||!1!==e.includeLowers,l=e&&!0===e.includeUppers;let u,h=r;function c(t,e){return h(t[0],e[0])}try{u=t.reduce((function(t,e){let r=0,s=t.length;for(;r<s;++r){const s=t[r];if(i(e[0],s[1])<0&&i(e[1],s[0])>0){s[0]=n(s[0],e[0]),s[1]=o(s[1],e[1]);break}}return r===s&&t.push(e),t}),[]),u.sort(c)}catch(t){return Ke(this,be)}let _=0;const m=l?t=>r(t,u[_][1])>0:t=>r(t,u[_][1])>=0,d=a?t=>s(t,u[_][0])>0:t=>s(t,u[_][0])>=0;let g=m;const p=new this.Collection(this,(()=>ti(u[0][0],u[u.length-1][1],!a,!l)));return p._ondirectionchange=t=>{"next"===t?(g=m,h=r):(g=d,h=s),u.sort(c)},p._addAlgorithm(((t,e,i)=>{for(var s=t.key;g(s);)if(++_,_===u.length)return e(i),!1;return!!function(t){return!m(t)&&!d(t)}(s)||(0===this._cmp(s,u[_][1])||0===this._cmp(s,u[_][0])||e((()=>{h===r?t.continue(u[_][0]):t.continue(u[_][1])})),!1)})),p}startsWithAnyOf(){const t=k.apply(R,arguments);return t.every((t=>"string"==typeof t))?0===t.length?Je(this):this.inAnyRange(t.map((t=>[t,t+ye]))):Ke(this,"startsWithAnyOf() only works with strings")}}function ri(t){return Ht((function(e){return si(e),t(e.target.error),!1}))}function si(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const ni="storagemutated",oi="x-storagemutated-1",ai=Ae(null,ni);class li{_lock(){return $(!Lt.global),++this._reculock,1!==this._reculock||Lt.global||(Lt.lockOwnerFor=this),this}_unlock(){if($(!Lt.global),0==--this._reculock)for(Lt.global||(Lt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{ue(t[1],t[0])}catch(t){}}return this}_locked(){return this._reculock&&Lt.lockOwnerFor!==this}create(t){if(!this.mode)return this;const e=this.db.idbdb,i=this.db._state.dbOpenError;if($(!this.idbtrans),!t&&!e)switch(i&&i.name){case"DatabaseClosedError":throw new tt.DatabaseClosed(i);case"MissingAPIError":throw new tt.MissingAPI(i.message,i);default:throw new tt.OpenFailed(i)}if(!this.active)throw new tt.TransactionInactive;return $(null===this._completion._state),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):e.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Ht((e=>{si(e),this._reject(t.error)})),t.onabort=Ht((e=>{si(e),this.active&&this._reject(new tt.Abort(t.error)),this.active=!1,this.on("abort").fire(e)})),t.oncomplete=Ht((()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&ai.storagemutated.fire(t.mutatedParts)})),this}_promise(t,e,i){if("readwrite"===t&&"readwrite"!==this.mode)return ge(new tt.ReadOnly("Transaction is readonly"));if(!this.active)return ge(new tt.TransactionInactive);if(this._locked())return new Bt(((r,s)=>{this._blockedFuncs.push([()=>{this._promise(t,e,i).then(r,s)},Lt])}));if(i)return ee((()=>{var t=new Bt(((t,i)=>{this._lock();const r=e(t,i,this);r&&r.then&&r.then(t,i)}));return t.finally((()=>this._unlock())),t._lib=!0,t}));var r=new Bt(((t,i)=>{var r=e(t,i,this);r&&r.then&&r.then(t,i)}));return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(t){var e=this._root();const i=Bt.resolve(t);if(e._waitingFor)e._waitingFor=e._waitingFor.then((()=>i));else{e._waitingFor=i,e._waitingQueue=[];var r=e.idbtrans.objectStore(e.storeNames[0]);!function t(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(r.get(-1/0).onsuccess=t)}()}var s=e._waitingFor;return new Bt(((t,r)=>{i.then((i=>e._waitingQueue.push(Ht(t.bind(null,i)))),(t=>e._waitingQueue.push(Ht(r.bind(null,t))))).finally((()=>{e._waitingFor===s&&(e._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new tt.Abort))}table(t){const e=this._memoizedTables||(this._memoizedTables={});if(u(e,t))return e[t];const i=this.schema[t];if(!i)throw new tt.NotFound("Table "+t+" not part of transaction");const r=new this.db.Table(t,i,this);return r.core=this.db.core.table(t),e[t]=r,r}}function ui(t,e,i,r,s,n,o){return{name:t,keyPath:e,unique:i,multi:r,auto:s,compound:n,src:(i&&!o?"&":"")+(r?"*":"")+(s?"++":"")+hi(e)}}function hi(t){return"string"==typeof t?t:t?"["+[].join.call(t,"+")+"]":""}function ci(t,e,i){return{name:t,primKey:e,indexes:i,mappedClass:null,idxByName:S(i,(t=>[t.name,t]))}}let _i=t=>{try{return t.only([[]]),_i=()=>[[]],[[]]}catch(t){return _i=()=>ye,ye}};function mi(t){return null==t?()=>{}:"string"==typeof t?function(t){return 1===t.split(".").length?e=>e[t]:e=>v(e,t)}(t):e=>v(e,t)}function di(t){return[].slice.call(t)}let gi=0;function pi(t){return null==t?":id":"string"==typeof t?t:`[${t.join("+")}]`}function fi(t,e,i){function r(t){if(3===t.type)return null;if(4===t.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:i,upper:r,lowerOpen:s,upperOpen:n}=t;return void 0===i?void 0===r?null:e.upperBound(r,!!n):void 0===r?e.lowerBound(i,!!s):e.bound(i,r,!!s,!!n)}const{schema:s,hasGetAll:o}=function(t,e){const i=di(t.objectStoreNames);return{schema:{name:t.name,tables:i.map((t=>e.objectStore(t))).map((t=>{const{keyPath:e,autoIncrement:i}=t,r=n(e),s=null==e,o={},a={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:s,compound:r,keyPath:e,autoIncrement:i,unique:!0,extractKey:mi(e)},indexes:di(t.indexNames).map((e=>t.index(e))).map((t=>{const{name:e,unique:i,multiEntry:r,keyPath:s}=t,a={name:e,compound:n(s),keyPath:s,unique:i,multiEntry:r,extractKey:mi(s)};return o[pi(s)]=a,a})),getIndexByKeyPath:t=>o[pi(t)]};return o[":id"]=a.primaryKey,null!=e&&(o[pi(e)]=a.primaryKey),a}))},hasGetAll:i.length>0&&"getAll"in e.objectStore(i[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,i),a=s.tables.map((t=>function(t){const e=t.name;return{name:e,schema:t,mutate:function({trans:t,type:i,keys:s,values:n,range:o}){return new Promise(((a,l)=>{a=Ht(a);const u=t.objectStore(e),h=null==u.keyPath,c="put"===i||"add"===i;if(!c&&"delete"!==i&&"deleteRange"!==i)throw new Error("Invalid operation type: "+i);const{length:_}=s||n||{length:1};if(s&&n&&s.length!==n.length)throw new Error("Given keys array must have same length as given values array.");if(0===_)return a({numFailures:0,failures:{},results:[],lastResult:void 0});let m;const d=[],g=[];let p=0;const f=t=>{++p,si(t)};if("deleteRange"===i){if(4===o.type)return a({numFailures:p,failures:g,results:[],lastResult:void 0});3===o.type?d.push(m=u.clear()):d.push(m=u.delete(r(o)))}else{const[t,e]=c?h?[n,s]:[n,null]:[s,null];if(c)for(let r=0;r<_;++r)d.push(m=e&&void 0!==e[r]?u[i](t[r],e[r]):u[i](t[r])),m.onerror=f;else for(let e=0;e<_;++e)d.push(m=u[i](t[e])),m.onerror=f}const y=t=>{const e=t.target.result;d.forEach(((t,e)=>null!=t.error&&(g[e]=t.error))),a({numFailures:p,failures:g,results:"delete"===i?s:d.map((t=>t.result)),lastResult:e})};m.onerror=t=>{f(t),y(t)},m.onsuccess=y}))},getMany:({trans:t,keys:i})=>new Promise(((r,s)=>{r=Ht(r);const n=t.objectStore(e),o=i.length,a=new Array(o);let l,u=0,h=0;const c=t=>{const e=t.target;a[e._pos]=e.result,++h===u&&r(a)},_=ri(s);for(let t=0;t<o;++t)null!=i[t]&&(l=n.get(i[t]),l._pos=t,l.onsuccess=c,l.onerror=_,++u);0===u&&r(a)})),get:({trans:t,key:i})=>new Promise(((r,s)=>{r=Ht(r);const n=t.objectStore(e).get(i);n.onsuccess=t=>r(t.target.result),n.onerror=ri(s)})),query:function(t){return i=>new Promise(((s,n)=>{s=Ht(s);const{trans:o,values:a,limit:l,query:u}=i,h=l===1/0?void 0:l,{index:c,range:_}=u,m=o.objectStore(e),d=c.isPrimaryKey?m:m.index(c.name),g=r(_);if(0===l)return s({result:[]});if(t){const t=a?d.getAll(g,h):d.getAllKeys(g,h);t.onsuccess=t=>s({result:t.target.result}),t.onerror=ri(n)}else{let t=0;const e=a||!("openKeyCursor"in d)?d.openCursor(g):d.openKeyCursor(g),i=[];e.onsuccess=r=>{const n=e.result;return n?(i.push(a?n.value:n.primaryKey),++t===l?s({result:i}):void n.continue()):s({result:i})},e.onerror=ri(n)}}))}(o),openCursor:function({trans:t,values:i,query:s,reverse:n,unique:o}){return new Promise(((a,l)=>{a=Ht(a);const{index:u,range:h}=s,c=t.objectStore(e),_=u.isPrimaryKey?c:c.index(u.name),m=n?o?"prevunique":"prev":o?"nextunique":"next",d=i||!("openKeyCursor"in _)?_.openCursor(r(h),m):_.openKeyCursor(r(h),m);d.onerror=ri(l),d.onsuccess=Ht((e=>{const i=d.result;if(!i)return void a(null);i.___id=++gi,i.done=!1;const r=i.continue.bind(i);let s=i.continuePrimaryKey;s&&(s=s.bind(i));const n=i.advance.bind(i),o=()=>{throw new Error("Cursor not stopped")};i.trans=t,i.stop=i.continue=i.continuePrimaryKey=i.advance=()=>{throw new Error("Cursor not started")},i.fail=Ht(l),i.next=function(){let t=1;return this.start((()=>t--?this.continue():this.stop())).then((()=>this))},i.start=t=>{const e=new Promise(((t,e)=>{t=Ht(t),d.onerror=ri(e),i.fail=e,i.stop=e=>{i.stop=i.continue=i.continuePrimaryKey=i.advance=o,t(e)}})),a=()=>{if(d.result)try{t()}catch(t){i.fail(t)}else i.done=!0,i.start=()=>{throw new Error("Cursor behind last entry")},i.stop()};return d.onsuccess=Ht((t=>{d.onsuccess=a,a()})),i.continue=r,i.continuePrimaryKey=s,i.advance=n,a(),e},a(i)}),l)}))},count({query:t,trans:i}){const{index:s,range:n}=t;return new Promise(((t,o)=>{const a=i.objectStore(e),l=s.isPrimaryKey?a:a.index(s.name),u=r(n),h=u?l.count(u):l.count();h.onsuccess=Ht((e=>t(e.target.result))),h.onerror=ri(o)}))}}}(t))),l={};return a.forEach((t=>l[t.name]=t)),{stack:"dbcore",transaction:t.transaction.bind(t),table(t){if(!l[t])throw new Error(`Table '${t}' not found`);return l[t]},MIN_KEY:-1/0,MAX_KEY:_i(e),schema:s}}function yi({_novip:t},e){const i=e.db,r=function(t,e,{IDBKeyRange:i,indexedDB:r},s){const n=function(t,e){return e.reduce(((t,{create:e})=>({...t,...e(t)})),t)}(fi(e,i,s),t.dbcore);return{dbcore:n}}(t._middlewares,i,t._deps,e);t.core=r.dbcore,t.tables.forEach((e=>{const i=e.name;t.core.schema.tables.some((t=>t.name===i))&&(e.core=t.core.table(i),t[i]instanceof t.Table&&(t[i].core=e.core))}))}function $i({_novip:t},e,i,r){i.forEach((i=>{const s=r[i];e.forEach((e=>{const r=g(e,i);(!r||"value"in r&&void 0===r.value)&&(e===t.Transaction.prototype||e instanceof t.Transaction?_(e,i,{get(){return this.table(i)},set(t){c(this,i,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):e[i]=new t.Table(i,s))}))}))}function bi({_novip:t},e){e.forEach((e=>{for(let i in e)e[i]instanceof t.Table&&delete e[i]}))}function Si(t,e){return t._cfg.version-e._cfg.version}function vi(t,e,i,r){const n=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,n);o.create(i),o._completion.catch(r);const a=o._reject.bind(o),l=Lt.transless||Lt;ee((()=>{Lt.trans=o,Lt.transless=l,0===e?(s(n).forEach((t=>{Pi(i,t,n[t].primKey,n[t].indexes)})),yi(t,i),Bt.follow((()=>t.on.populate.fire(o))).catch(a)):function({_novip:t},e,i,r){const n=[],o=t._versions;let a=t._dbSchema=wi(t,t.idbdb,r),l=!1;function u(){return n.length?Bt.resolve(n.shift()(i.idbtrans)).then(u):Bt.resolve()}return o.filter((t=>t._cfg.version>=e)).forEach((o=>{n.push((()=>{const n=a,u=o._cfg.dbschema;Mi(t,n,r),Mi(t,u,r),a=t._dbSchema=u;const h=xi(n,u);h.add.forEach((t=>{Pi(r,t[0],t[1].primKey,t[1].indexes)})),h.change.forEach((t=>{if(t.recreate)throw new tt.Upgrade("Not yet support for changing primary key");{const e=r.objectStore(t.name);t.add.forEach((t=>Ci(e,t))),t.change.forEach((t=>{e.deleteIndex(t.name),Ci(e,t)})),t.del.forEach((t=>e.deleteIndex(t)))}}));const c=o._cfg.contentUpgrade;if(c&&o._cfg.version>e){yi(t,r),i._memoizedTables={},l=!0;let e=P(u);h.del.forEach((t=>{e[t]=n[t]})),bi(t,[t.Transaction.prototype]),$i(t,[t.Transaction.prototype],s(e),e),i.schema=e;const o=V(c);let a;o&&ie();const _=Bt.follow((()=>{if(a=c(i),a&&o){var t=re.bind(null,null);a.then(t,t)}}));return a&&"function"==typeof a.then?Bt.resolve(a):_.then((()=>a))}})),n.push((e=>{if(!l||!Pe){!function(t,e){[].slice.call(e.db.objectStoreNames).forEach((i=>null==t[i]&&e.db.deleteObjectStore(i)))}(o._cfg.dbschema,e)}bi(t,[t.Transaction.prototype]),$i(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),i.schema=t._dbSchema}))})),u().then((()=>{var t,e;e=r,s(t=a).forEach((i=>{e.db.objectStoreNames.contains(i)||Pi(e,i,t[i].primKey,t[i].indexes)}))}))}(t,e,o,i).catch(a)}))}function xi(t,e){const i={del:[],add:[],change:[]};let r;for(r in t)e[r]||i.del.push(r);for(r in e){const s=t[r],n=e[r];if(s){const t={name:r,def:n,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(n.primKey.keyPath||"")||s.primKey.auto!==n.primKey.auto&&!xe)t.recreate=!0,i.change.push(t);else{const e=s.idxByName,r=n.idxByName;let o;for(o in e)r[o]||t.del.push(o);for(o in r){const i=e[o],s=r[o];i?i.src!==s.src&&t.change.push(s):t.add.push(s)}(t.del.length>0||t.add.length>0||t.change.length>0)&&i.change.push(t)}}else i.add.push([r,n])}return i}function Pi(t,e,i,r){const s=t.db.createObjectStore(e,i.keyPath?{keyPath:i.keyPath,autoIncrement:i.auto}:{autoIncrement:i.auto});return r.forEach((t=>Ci(s,t))),s}function Ci(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function wi(t,e,i){const r={};return f(e.objectStoreNames,0).forEach((t=>{const e=i.objectStore(t);let s=e.keyPath;const n=ui(hi(s),s||"",!1,!1,!!e.autoIncrement,s&&"string"!=typeof s,!0),o=[];for(let t=0;t<e.indexNames.length;++t){const i=e.index(e.indexNames[t]);s=i.keyPath;var a=ui(i.name,s,!!i.unique,!!i.multiEntry,!1,s&&"string"!=typeof s,!1);o.push(a)}r[t]=ci(t,n,o)})),r}function Mi({_novip:t},e,i){const s=i.db.objectStoreNames;for(let r=0;r<s.length;++r){const n=s[r],o=i.objectStore(n);t._hasGetAll="getAll"in o;for(let t=0;t<o.indexNames.length;++t){const i=o.indexNames[t],r=o.index(i).keyPath,s="string"==typeof r?r:"["+f(r).join("+")+"]";if(e[n]){const t=e[n].idxByName[s];t&&(t.name=i,delete e[n].idxByName[s],e[n].idxByName[i]=t)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class Ti{_parseStoresSpec(t,e){s(t).forEach((i=>{if(null!==t[i]){var r=t[i].split(",").map(((t,e)=>{const i=(t=t.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(i)?i.match(/^\[(.*)\]$/)[1].split("+"):i;return ui(i,r||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),n(r),0===e)})),s=r.shift();if(s.multi)throw new tt.Schema("Primary key cannot be multi-valued");r.forEach((t=>{if(t.auto)throw new tt.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new tt.Schema("Index must have a name and cannot be an empty string")})),e[i]=ci(i,s,r)}}))}stores(t){const e=this.db;this._cfg.storesSource=this._cfg.storesSource?o(this._cfg.storesSource,t):t;const i=e._versions,r={};let n={};return i.forEach((t=>{o(r,t._cfg.storesSource),n=t._cfg.dbschema={},t._parseStoresSpec(r,n)})),e._dbSchema=n,bi(e,[e._allTables,e,e.Transaction.prototype]),$i(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],s(n),n),e._storeNames=s(n),this}upgrade(t){return this._cfg.contentUpgrade=ct(this._cfg.contentUpgrade||rt,t),this}}function Li(t,e){let i=t._dbNamesDB;return i||(i=t._dbNamesDB=new Qi(Me,{addons:[],indexedDB:t,IDBKeyRange:e}),i.version(1).stores({dbnames:"name"})),i.table("dbnames")}function Ii(t){return t&&"function"==typeof t.databases}function Ei(t){return ee((function(){return Lt.letThrough=!0,t()}))}function Fi(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(e){var i=function(){return indexedDB.databases().finally(e)};t=setInterval(i,100),i()})).finally((function(){return clearInterval(t)})):Promise.resolve()}function Bi(t){const e=t._state,{indexedDB:i}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then((()=>e.dbOpenError?ge(e.dbOpenError):t));O&&(e.openCanceller._stackHolder=Y()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function n(){if(e.openCanceller!==r)throw new tt.DatabaseClosed("db.open() was cancelled")}let o=e.dbReadyResolve,a=null,l=!1;return Bt.race([r,("undefined"==typeof navigator?Bt.resolve():Fi()).then((()=>new Bt(((r,o)=>{if(n(),!i)throw new tt.MissingAPI;const u=t.name,h=e.autoSchema?i.open(u):i.open(u,Math.round(10*t.verno));if(!h)throw new tt.MissingAPI;h.onerror=ri(o),h.onblocked=Ht(t._fireOnBlocked),h.onupgradeneeded=Ht((r=>{if(a=h.transaction,e.autoSchema&&!t._options.allowEmptyDB){h.onerror=si,a.abort(),h.result.close();const t=i.deleteDatabase(u);t.onsuccess=t.onerror=Ht((()=>{o(new tt.NoSuchDatabase(`Database ${u} doesnt exist`))}))}else{a.onerror=ri(o);var s=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;l=s<1,t._novip.idbdb=h.result,vi(t,s/10,a,o)}}),o),h.onsuccess=Ht((()=>{a=null;const i=t._novip.idbdb=h.result,n=f(i.objectStoreNames);if(n.length>0)try{const r=i.transaction(1===(o=n).length?o[0]:o,"readonly");e.autoSchema?function({_novip:t},e,i){t.verno=e.version/10;const r=t._dbSchema=wi(0,e,i);t._storeNames=f(e.objectStoreNames,0),$i(t,[t._allTables],s(r),r)}(t,i,r):(Mi(t,t._dbSchema,r),function(t,e){const i=xi(wi(0,t.idbdb,e),t._dbSchema);return!(i.add.length||i.change.some((t=>t.add.length||t.change.length)))}(t,r)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),yi(t,r)}catch(t){}var o;ve.push(t),i.onversionchange=Ht((i=>{e.vcFired=!0,t.on("versionchange").fire(i)})),i.onclose=Ht((e=>{t.on("close").fire(e)})),l&&function({indexedDB:t,IDBKeyRange:e},i){!Ii(t)&&i!==Me&&Li(t,e).put({name:i}).catch(rt)}(t._deps,u),r()}),o)}))))]).then((()=>(n(),e.onReadyBeingFired=[],Bt.resolve(Ei((()=>t.on.ready.fire(t.vip)))).then((function i(){if(e.onReadyBeingFired.length>0){let r=e.onReadyBeingFired.reduce(ct,rt);return e.onReadyBeingFired=[],Bt.resolve(Ei((()=>r(t.vip)))).then(i)}}))))).finally((()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1})).then((()=>t)).catch((i=>{e.dbOpenError=i;try{a&&a.abort()}catch(t){}return r===e.openCanceller&&t._close(),ge(i)})).finally((()=>{e.openComplete=!0,o()}))}function Ai(t){var e=e=>t.next(e),i=s(e),r=s((e=>t.throw(e)));function s(t){return e=>{var s=t(e),o=s.value;return s.done?o:o&&"function"==typeof o.then?o.then(i,r):n(o)?Promise.all(o).then(i,r):i(o)}}return s(e)()}function Di(t,e,i){var r=arguments.length;if(r<2)throw new tt.InvalidArgument("Too few arguments");for(var s=new Array(r-1);--r;)s[r-1]=arguments[r];i=s.pop();var n=w(s);return[t,n,i]}function Ri(t,e,i,r,s){return Bt.resolve().then((()=>{const n=Lt.transless||Lt,o=t._createTransaction(e,i,t._dbSchema,r),a={trans:o,transless:n};if(r)o.idbtrans=r.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(r){return r.name===Q.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then((()=>Ri(t,e,i,null,s)))):ge(r)}const l=V(s);let u;l&&ie();const h=Bt.follow((()=>{if(u=s.call(o,o),u)if(l){var t=re.bind(null,null);u.then(t,t)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=Ai(u))}),a);return(u&&"function"==typeof u.then?Bt.resolve(u).then((t=>o.active?t:ge(new tt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):h.then((()=>u))).then((t=>(r&&o._resolve(),o._completion.then((()=>t))))).catch((t=>(o._reject(t),ge(t))))}))}function ki(t,e,i){const r=n(t)?t.slice():[t];for(let t=0;t<i;++t)r.push(e);return r}const Vi={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const i=t.table(e),{schema:r}=i,s={},n=[];function o(t,e,i){const r=pi(t),a=s[r]=s[r]||[],l=null==t?0:"string"==typeof t?1:t.length,u=e>0,h={...i,isVirtual:u,keyTail:e,keyLength:l,extractKey:mi(t),unique:!u&&i.unique};if(a.push(h),h.isPrimaryKey||n.push(h),l>1){o(2===l?t[0]:t.slice(0,l-1),e+1,i)}return a.sort(((t,e)=>t.keyTail-e.keyTail)),h}const a=o(r.primaryKey.keyPath,0,r.primaryKey);s[":id"]=[a];for(const t of r.indexes)o(t.keyPath,0,t);function l(e){const i=e.query.index;return i.isVirtual?{...e,query:{index:i,range:(r=e.query.range,s=i.keyTail,{type:1===r.type?2:r.type,lower:ki(r.lower,r.lowerOpen?t.MAX_KEY:t.MIN_KEY,s),lowerOpen:!0,upper:ki(r.upper,r.upperOpen?t.MIN_KEY:t.MAX_KEY,s),upperOpen:!0})}}:e;var r,s}const u={...i,schema:{...r,primaryKey:a,indexes:n,getIndexByKeyPath:function(t){const e=s[pi(t)];return e&&e[0]}},count:t=>i.count(l(t)),query:t=>i.query(l(t)),openCursor(e){const{keyTail:r,isVirtual:s,keyLength:n}=e.query.index;if(!s)return i.openCursor(e);return i.openCursor(l(e)).then((i=>i&&function(i){const s=Object.create(i,{continue:{value:function(s){null!=s?i.continue(ki(s,e.reverse?t.MAX_KEY:t.MIN_KEY,r)):e.unique?i.continue(i.key.slice(0,n).concat(e.reverse?t.MIN_KEY:t.MAX_KEY,r)):i.continue()}},continuePrimaryKey:{value(e,s){i.continuePrimaryKey(ki(e,t.MAX_KEY,r),s)}},primaryKey:{get:()=>i.primaryKey},key:{get(){const t=i.key;return 1===n?t[0]:t.slice(0,n)}},value:{get:()=>i.value}});return s}(i)))}};return u}}}};function Oi(t,e,i,r){return i=i||{},r=r||"",s(t).forEach((s=>{if(u(e,s)){var n=t[s],o=e[s];if("object"==typeof n&&"object"==typeof o&&n&&o){const t=B(n);t!==B(o)?i[r+s]=e[s]:"Object"===t?Oi(n,o,i,r+s+"."):n!==o&&(i[r+s]=e[s])}else n!==o&&(i[r+s]=e[s])}else i[r+s]=void 0})),s(e).forEach((s=>{u(t,s)||(i[r+s]=e[s])})),i}const Ni={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const i=t.table(e),{primaryKey:r}=i.schema,s={...i,mutate(t){const s=Lt.trans,{deleting:n,creating:o,updating:a}=s.table(e).hook;switch(t.type){case"add":if(o.fire===rt)break;return s._promise("readwrite",(()=>l(t)),!0);case"put":if(o.fire===rt&&a.fire===rt)break;return s._promise("readwrite",(()=>l(t)),!0);case"delete":if(n.fire===rt)break;return s._promise("readwrite",(()=>l(t)),!0);case"deleteRange":if(n.fire===rt)break;return s._promise("readwrite",(()=>function(t){return h(t.trans,t.range,1e4)}(t)),!0)}return i.mutate(t);function l(t){const e=Lt.trans,s=t.keys||function(t,e){return"delete"===e.type?e.keys:e.keys||e.values.map(t.extractKey)}(r,t);if(!s)throw new Error("Keys missing");return"delete"!==(t="add"===t.type||"put"===t.type?{...t,keys:s}:{...t}).type&&(t.values=[...t.values]),t.keys&&(t.keys=[...t.keys]),function(t,e,i){return"add"===e.type?Promise.resolve([]):t.getMany({trans:e.trans,keys:i,cache:"immutable"})}(i,t,s).then((l=>{const h=s.map(((i,s)=>{const h=l[s],c={onerror:null,onsuccess:null};if("delete"===t.type)n.fire.call(c,i,h,e);else if("add"===t.type||void 0===h){const n=o.fire.call(c,i,t.values[s],e);null==i&&null!=n&&(i=n,t.keys[s]=i,r.outbound||x(t.values[s],r.keyPath,i))}else{const r=Oi(h,t.values[s]),n=a.fire.call(c,r,i,h,e);if(n){const e=t.values[s];Object.keys(n).forEach((t=>{u(e,t)?e[t]=n[t]:x(e,t,n[t])}))}}return c}));return i.mutate(t).then((({failures:e,results:i,numFailures:r,lastResult:n})=>{for(let r=0;r<s.length;++r){const n=i?i[r]:s[r],o=h[r];null==n?o.onerror&&o.onerror(e[r]):o.onsuccess&&o.onsuccess("put"===t.type&&l[r]?t.values[r]:n)}return{failures:e,results:i,numFailures:r,lastResult:n}})).catch((t=>(h.forEach((e=>e.onerror&&e.onerror(t))),Promise.reject(t))))}))}function h(t,e,s){return i.query({trans:t,values:!1,query:{index:r,range:e},limit:s}).then((({result:i})=>l({type:"delete",keys:i,trans:t}).then((r=>r.numFailures>0?Promise.reject(r.failures[0]):i.length<s?{failures:[],numFailures:0,lastResult:void 0}:h(t,{...e,lower:i[i.length-1],lowerOpen:!0},s)))))}}};return s}})};function Ui(t,e,i){try{if(!e)return null;if(e.keys.length<t.length)return null;const r=[];for(let s=0,n=0;s<e.keys.length&&n<t.length;++s)0===Ye(e.keys[s],t[n])&&(r.push(i?I(e.values[s]):e.values[s]),++n);return r.length===t.length?r:null}catch(t){return null}}const zi={stack:"dbcore",level:-1,create:t=>({table:e=>{const i=t.table(e);return{...i,getMany:t=>{if(!t.cache)return i.getMany(t);const e=Ui(t.keys,t.trans._cache,"clone"===t.cache);return e?Bt.resolve(e):i.getMany(t).then((e=>(t.trans._cache={keys:t.keys,values:"clone"===t.cache?I(e):e},e)))},mutate:t=>("add"!==t.type&&(t.trans._cache=null),i.mutate(t))}}})};function Yi(t){return!("from"in t)}const ji=function(t,e){if(!this){const e=new ji;return t&&"d"in t&&o(e,t),e}o(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function Gi(t,e,i){const r=Ye(e,i);if(isNaN(r))return;if(r>0)throw RangeError();if(Yi(t))return o(t,{from:e,to:i,d:1});const s=t.l,n=t.r;if(Ye(i,t.from)<0)return s?Gi(s,e,i):t.l={from:e,to:i,d:1,l:null,r:null},Wi(t);if(Ye(e,t.to)>0)return n?Gi(n,e,i):t.r={from:e,to:i,d:1,l:null,r:null},Wi(t);Ye(e,t.from)<0&&(t.from=e,t.l=null,t.d=n?n.d+1:1),Ye(i,t.to)>0&&(t.to=i,t.r=null,t.d=t.l?t.l.d+1:1);const a=!t.r;s&&!t.l&&Xi(t,s),n&&a&&Xi(t,n)}function Xi(t,e){Yi(e)||function t(e,{from:i,to:r,l:s,r:n}){Gi(e,i,r),s&&t(e,s),n&&t(e,n)}(t,e)}function qi(t,e){const i=Hi(e);let r=i.next();if(r.done)return!1;let s=r.value;const n=Hi(t);let o=n.next(s.from),a=o.value;for(;!r.done&&!o.done;){if(Ye(a.from,s.to)<=0&&Ye(a.to,s.from)>=0)return!0;Ye(s.from,a.from)<0?s=(r=i.next(a.from)).value:a=(o=n.next(s.from)).value}return!1}function Hi(t){let e=Yi(t)?null:{s:0,n:t};return{next(t){const i=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,i)for(;e.n.l&&Ye(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!i||Ye(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Wi(t){var e,i;const r=((null===(e=t.r)||void 0===e?void 0:e.d)||0)-((null===(i=t.l)||void 0===i?void 0:i.d)||0),s=r>1?"r":r<-1?"l":"";if(s){const e="r"===s?"l":"r",i={...t},r=t[s];t.from=r.from,t.to=r.to,t[s]=r[s],i[s]=r[e],t[e]=i,i.d=Ki(i)}t.d=Ki(t)}function Ki({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}h(ji.prototype,{add(t){return Xi(this,t),this},addKey(t){return Gi(this,t,t),this},addKeys(t){return t.forEach((t=>Gi(this,t,t))),this},[A](){return Hi(this)}});const Ji={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,i=new ji(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{const o=t.table(r),{schema:a}=o,{primaryKey:l}=a,{extractKey:u,outbound:h}=l,c={...o,mutate:t=>{const s=t.trans,l=s.mutatedParts||(s.mutatedParts={}),u=t=>{const i=`idb://${e}/${r}/${t}`;return l[i]||(l[i]=new ji)},h=u(""),c=u(":dels"),{type:_}=t;let[m,d]="deleteRange"===t.type?[t.range]:"delete"===t.type?[t.keys]:t.values.length<50?[[],t.values]:[];const g=t.trans._cache;return o.mutate(t).then((t=>{if(n(m)){"delete"!==_&&(m=t.results),h.addKeys(m);const e=Ui(m,g);e||"add"===_||c.addKeys(m),(e||d)&&function(t,e,i,r){function s(e){const s=t(e.name||"");function o(t){return null!=t?e.extractKey(t):null}const a=t=>e.multiEntry&&n(t)?t.forEach((t=>s.addKey(t))):s.addKey(t);(i||r).forEach(((t,e)=>{const s=i&&o(i[e]),n=r&&o(r[e]);0!==Ye(s,n)&&(null!=s&&a(s),null!=n&&a(n))}))}e.indexes.forEach(s)}(u,a,e,d)}else if(m){const t={from:m.lower,to:m.upper};c.add(t),h.add(t)}else h.add(i),c.add(i),a.indexes.forEach((t=>u(t.name).add(i)));return t}))}},_=({query:{index:e,range:i}})=>{var r,s;return[e,new ji(null!==(r=i.lower)&&void 0!==r?r:t.MIN_KEY,null!==(s=i.upper)&&void 0!==s?s:t.MAX_KEY)]},m={get:t=>[l,new ji(t.key)],getMany:t=>[l,(new ji).addKeys(t.keys)],count:_,query:_,openCursor:_};return s(m).forEach((t=>{c[t]=function(s){const{subscr:n}=Lt;if(n){const a=t=>{const i=`idb://${e}/${r}/${t}`;return n[i]||(n[i]=new ji)},l=a(""),c=a(":dels"),[_,d]=m[t](s);if(a(_.name||"").add(d),!_.isPrimaryKey){if("count"!==t){const e="query"===t&&h&&s.values&&o.query({...s,values:!1});return o[t].apply(this,arguments).then((i=>{if("query"===t){if(h&&s.values)return e.then((({result:t})=>(l.addKeys(t),i)));const t=s.values?i.result.map(u):i.result;s.values?l.addKeys(t):c.addKeys(t)}else if("openCursor"===t){const t=i,e=s.values;return t&&Object.create(t,{key:{get:()=>(c.addKey(t.primaryKey),t.key)},primaryKey:{get(){const e=t.primaryKey;return c.addKey(e),e}},value:{get:()=>(e&&l.addKey(t.primaryKey),t.value)}})}return i}))}c.add(i)}}return o[t].apply(this,arguments)}})),c}}}};class Qi{constructor(t,e){this._middlewares={},this.verno=0;const i=Qi.dependencies;this._options=e={addons:Qi.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,...e},this._deps={indexedDB:e.indexedDB,IDBKeyRange:e.IDBKeyRange};const{addons:r}=e;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:rt,dbReadyPromise:null,cancelOpen:rt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var n;s.dbReadyPromise=new Bt((t=>{s.dbReadyResolve=t})),s.openCanceller=new Bt(((t,e)=>{s.cancelOpen=e})),this._state=s,this.name=t,this.on=Ae(this,"populate","blocked","versionchange","close",{ready:[ct,rt]}),this.on.ready.subscribe=y(this.on.ready.subscribe,(t=>(e,i)=>{Qi.vip((()=>{const r=this._state;if(r.openComplete)r.dbOpenError||Bt.resolve().then(e),i&&t(e);else if(r.onReadyBeingFired)r.onReadyBeingFired.push(e),i&&t(e);else{t(e);const r=this;i||t((function t(){r.on.ready.unsubscribe(e),r.on.ready.unsubscribe(t)}))}}))})),this.Collection=(n=this,De(Xe.prototype,(function(t,e){this.db=n;let i=Ee,r=null;if(e)try{i=e()}catch(t){r=t}const s=t._ctx,o=s.table,a=o.hook.reading.fire;this._ctx={table:o,index:s.index,isPrimKey:!s.index||o.schema.primKey.keyPath&&s.index===o.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:s.or,valueMapper:a!==st?a:null}}))),this.Table=function(t){return De(Be.prototype,(function(e,i,r){this.db=t,this._tx=r,this.name=e,this.schema=i,this.hook=t._allTables[e]?t._allTables[e].hook:Ae(null,{creating:[at,rt],reading:[nt,st],updating:[ut,rt],deleting:[lt,rt]})}))}(this),this.Transaction=function(t){return De(li.prototype,(function(e,i,r,s,n){this.db=t,this.mode=e,this.storeNames=i,this.schema=r,this.chromeTransactionDurability=s,this.idbtrans=null,this.on=Ae(this,"complete","error","abort"),this.parent=n||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Bt(((t,e)=>{this._resolve=t,this._reject=e})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(t=>{var e=this.active;return this.active=!1,this.on.error.fire(t),this.parent?this.parent._reject(t):e&&this.idbtrans&&this.idbtrans.abort(),ge(t)}))}))}(this),this.Version=function(t){return De(Ti.prototype,(function(e){this.db=t,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(t){return De(ii.prototype,(function(e,i,r){this.db=t,this._ctx={table:e,index:":id"===i?null:i,or:r};const s=t._deps.indexedDB;if(!s)throw new tt.MissingAPI;this._cmp=this._ascending=s.cmp.bind(s),this._descending=(t,e)=>s.cmp(e,t),this._max=(t,e)=>s.cmp(t,e)>0?t:e,this._min=(t,e)=>s.cmp(t,e)<0?t:e,this._IDBKeyRange=t._deps.IDBKeyRange}))}(this),this.on("versionchange",(t=>{t.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(t=>{!t.newVersion||t.newVersion<t.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${t.oldVersion/10}`)})),this._maxKey=_i(e.IDBKeyRange),this._createTransaction=(t,e,i,r)=>new this.Transaction(t,e,i,this._options.chromeTransactionDurability,r),this._fireOnBlocked=t=>{this.on("blocked").fire(t),ve.filter((t=>t.name===this.name&&t!==this&&!t._state.vcFired)).map((e=>e.on("versionchange").fire(t)))},this.use(Vi),this.use(Ni),this.use(Ji),this.use(zi),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach((t=>t(this)))}version(t){if(isNaN(t)||t<.1)throw new tt.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new tt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const e=this._versions;var i=e.filter((e=>e._cfg.version===t))[0];return i||(i=new this.Version(t),e.push(i),e.sort(Si),i.stores({}),this._state.autoSchema=!1,i)}_whenReady(t){return this.idbdb&&(this._state.openComplete||Lt.letThrough||this._vip)?t():new Bt(((t,e)=>{if(this._state.openComplete)return e(new tt.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void e(new tt.DatabaseClosed);this.open().catch(rt)}this._state.dbReadyPromise.then(t,e)})).then(t)}use({stack:t,create:e,level:i,name:r}){r&&this.unuse({stack:t,name:r});const s=this._middlewares[t]||(this._middlewares[t]=[]);return s.push({stack:t,create:e,level:null==i?10:i,name:r}),s.sort(((t,e)=>t.level-e.level)),this}unuse({stack:t,name:e,create:i}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((t=>i?t.create!==i:!!e&&t.name!==e))),this}open(){return Bi(this)}_close(){const t=this._state,e=ve.indexOf(this);if(e>=0&&ve.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(t){}this._novip.idbdb=null}t.dbReadyPromise=new Bt((e=>{t.dbReadyResolve=e})),t.openCanceller=new Bt(((e,i)=>{t.cancelOpen=i}))}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new tt.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,e=this._state;return new Bt(((i,r)=>{const s=()=>{this.close();var t=this._deps.indexedDB.deleteDatabase(this.name);t.onsuccess=Ht((()=>{!function({indexedDB:t,IDBKeyRange:e},i){!Ii(t)&&i!==Me&&Li(t,e).delete(i).catch(rt)}(this._deps,this.name),i()})),t.onerror=ri(r),t.onblocked=this._fireOnBlocked};if(t)throw new tt.InvalidArgument("Arguments not allowed in db.delete()");e.isBeingOpened?e.dbReadyPromise.then(s):s()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return s(this._allTables).map((t=>this._allTables[t]))}transaction(){const t=Di.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,e,i){let r=Lt.trans;r&&r.db===this&&-1===t.indexOf("!")||(r=null);const s=-1!==t.indexOf("?");let n,o;t=t.replace("!","").replace("?","");try{if(o=e.map((t=>{var e=t instanceof this.Table?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e})),"r"==t||t===Te)n=Te;else{if("rw"!=t&&t!=Le)throw new tt.InvalidArgument("Invalid transaction mode: "+t);n=Le}if(r){if(r.mode===Te&&n===Le){if(!s)throw new tt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&o.forEach((t=>{if(r&&-1===r.storeNames.indexOf(t)){if(!s)throw new tt.SubTransaction("Table "+t+" not included in parent transaction.");r=null}})),s&&r&&!r.active&&(r=null)}}catch(t){return r?r._promise(null,((e,i)=>{i(t)})):ge(t)}const a=Ri.bind(null,this,n,o,r,i);return r?r._promise(n,a,"lock"):Lt.trans?ue(Lt.transless,(()=>this._whenReady(a))):this._whenReady(a)}table(t){if(!u(this._allTables,t))throw new tt.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const Zi="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class tr{constructor(t){this._subscribe=t}subscribe(t,e,i){return this._subscribe(t&&"function"!=typeof t?t:{next:t,error:e,complete:i})}[Zi](){return this}}function er(t,e){return s(e).forEach((i=>{Xi(t[i]||(t[i]=new ji),e[i])})),t}function ir(t){return new tr((e=>{const i=V(t);let r=!1,n={},o={};const a={get closed(){return r},unsubscribe:()=>{r=!0,ai.storagemutated.unsubscribe(c)}};e.start&&e.start(a);let l=!1,u=!1;function h(){return s(o).some((t=>n[t]&&qi(n[t],o[t])))}const c=t=>{er(n,t),h()&&_()},_=()=>{if(l||r)return;n={};const s={},m=function(e){i&&ie();const r=()=>ee(t,{subscr:e,trans:null}),s=Lt.trans?ue(Lt.transless,r):r();return i&&s.then(re,re),s}(s);u||(ai(ni,c),u=!0),l=!0,Promise.resolve(m).then((t=>{l=!1,r||(h()?_():(n={},o=s,e.next&&e.next(t)))}),(t=>{l=!1,e.error&&e.error(t),a.unsubscribe()}))};return _(),a}))}let rr;try{rr={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch(t){rr={indexedDB:null,IDBKeyRange:null}}const sr=Qi;function nr(t){let e=or;try{or=!0,ai.storagemutated.fire(t)}finally{or=e}}h(sr,{...it,delete:t=>new sr(t,{addons:[]}).delete(),exists:t=>new sr(t,{addons:[]}).open().then((t=>(t.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(t){try{return function({indexedDB:t,IDBKeyRange:e}){return Ii(t)?Promise.resolve(t.databases()).then((t=>t.map((t=>t.name)).filter((t=>t!==Me)))):Li(t,e).toCollection().primaryKeys()}(sr.dependencies).then(t)}catch(t){return ge(new tt.MissingAPI)}},defineClass:()=>function(t){o(this,t)},ignoreTransaction:t=>Lt.trans?ue(Lt.transless,t):t(),vip:Ei,async:function(t){return function(){try{var e=Ai(t.apply(this,arguments));return e&&"function"==typeof e.then?e:Bt.resolve(e)}catch(t){return ge(t)}}},spawn:function(t,e,i){try{var r=Ai(t.apply(i,e||[]));return r&&"function"==typeof r.then?r:Bt.resolve(r)}catch(t){return ge(t)}},currentTransaction:{get:()=>Lt.trans||null},waitFor:function(t,e){const i=Bt.resolve("function"==typeof t?sr.ignoreTransaction(t):t).timeout(e||6e4);return Lt.trans?Lt.trans.waitFor(i):i},Promise:Bt,debug:{get:()=>O,set:t=>{N(t,"dexie"===t?()=>!0:we)}},derive:m,extend:o,props:h,override:y,Events:Ae,on:ai,liveQuery:ir,extendObservabilitySet:er,getByKeyPath:v,setByKeyPath:x,delByKeyPath:function(t,e){"string"==typeof e?x(t,e,void 0):"length"in e&&[].map.call(e,(function(e){x(t,e,void 0)}))},shallowClone:P,deepClone:I,getObjectDiff:Oi,cmp:Ye,asap:b,minKey:$e,addons:[],connections:ve,errnames:Q,dependencies:rr,semVer:fe,version:fe.split(".").map((t=>parseInt(t))).reduce(((t,e,i)=>t+e/Math.pow(10,2*i)))}),sr.maxKey=_i(sr.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(ai(ni,(t=>{if(!or){let e;xe?(e=document.createEvent("CustomEvent"),e.initCustomEvent(oi,!0,!0,t)):e=new CustomEvent(oi,{detail:t}),or=!0,dispatchEvent(e),or=!1}})),addEventListener(oi,(({detail:t})=>{or||nr(t)})));let or=!1;if("undefined"!=typeof BroadcastChannel){const t=new BroadcastChannel(oi);ai(ni,(e=>{or||t.postMessage(e)})),t.onmessage=t=>{t.data&&nr(t.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){ai(ni,(t=>{try{or||("undefined"!=typeof localStorage&&localStorage.setItem(oi,JSON.stringify({trig:Math.random(),changedParts:t})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((e=>e.postMessage({type:oi,changedParts:t}))))}catch(t){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(t=>{if(t.key===oi){const e=JSON.parse(t.newValue);e&&nr(e.changedParts)}}));const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",(function({data:t}){t&&t.type===oi&&nr(t.changedParts)}))}Bt.rejectionMapper=function(t,e){if(!t||t instanceof H||t instanceof TypeError||t instanceof SyntaxError||!t.name||!et[t.name])return t;var i=new et[t.name](e||t.message,t);return"stack"in t&&_(i,"stack",{get:function(){return this.inner.stack}}),i},N(O,we)}},e={};function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};(()=>{"use strict";i.r(r),i.d(r,{clearCache:()=>V,loadlive2dv3:()=>R,screenshot:()=>k});i("./src/lib/live2d.min.js");var t=i("./src/lib/Live2DFramework.js"),e=i("./src/LAppLive2DManager_v2.ts"),s=i("./src/lappdefine.ts"),n=i("./src/lib/MatrixStack.ts"),o=i("./src/lappdelegate.ts"),a=i("./src/PlatformManager.ts"),l=i("./src/DbCache.ts");window.navigator.platform.toLowerCase();const u=new e.LAppLive2DManager;let h=!1,c=null,_=null,m=null,d=null,g=null,p=null,f=0,y=0,$=!1,b=.5,S=1,v=0,x=0,P={};function C(e){let i=_.width,r=_.height;m=new t.L2DTargetPoint;let o=r/i,a=s.ViewLogicalLeft,l=s.ViewLogicalRight,f=-o,y=o;if(window.Live2D.captureFrame=!1,d=new t.L2DViewMatrix,d.setScreenRect(a,l,f,y),d.setMaxScreenRect(s.ViewLogicalMaxLeft,s.ViewLogicalMaxRight,s.ViewLogicalMaxBottom,s.ViewLogicalMaxTop),d.setMaxScale(s.ViewMaxScale),d.setMinScale(s.ViewMinScale),g=new t.L2DMatrix44,g.translate(v/100,x/100),g.multScale(S,S*i/r),p=new t.L2DMatrix44,p.multTranslate(-i/2,-r/2),p.multScale(2/i,-2/i),c=function(){for(var t=["webgl","experimental-webgl","webkit-3d","moz-webgl"],e=0;e<t.length;e++)try{var i=_.getContext(t[e],{premultipliedAlpha:!0});if(i)return i}catch(t){}return null}(),s.setContext(c),!c)return console.error("Failed to create WebGL context."),void(window.WebGLRenderingContext&&console.error("Your browser don't support WebGL, check https://get.webgl.org/ for futher information."));window.Live2D.setGL(c),c.clearColor(0,0,0,0),function(t){u.reloadFlg=!0,u.count++,u.changeModel(c,t)}(e),h||(h=!0,function t(){!function(){let t=new n.MatrixStack;t.reset(),t.loadIdentity(),m.update(),u.setDrag(m.getX(),m.getY()),c.clear(c.COLOR_BUFFER_BIT),t.multMatrix(g.getArray()),t.multMatrix(d.getArray()),t.push();for(let e=0;e<u.numModels();e++){let i=u.getModel(e);if(null==i)return;i.initialized&&!i.updating&&(i.update(),i.draw(t))}t.pop()}();let e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;if(window.Live2D.captureFrame){window.Live2D.captureFrame=!1;var i=document.createElement("a");document.body.appendChild(i),i.setAttribute("type","hidden"),i.href=_.toDataURL(),i.download=window.Live2D.captureName||"live2d.png",i.click()}e(t,_)}())}function w(t,e,i){if(e.x<i.left+i.width&&e.y<i.top+i.height&&e.x>i.left&&e.y>i.top)return e;let r=t.x-e.x,s=t.y-e.y;function n(t,e){return 180*Math.acos((i={x:0,y:1},r=function(t,e){let i=Math.sqrt(t*t+e*e);return{x:t/i,y:e/i}}(t,e),i.x*r.x+i.y*r.y))/Math.PI;var i,r}let o=n(r,s);e.x<t.x&&(o=360-o);let a=360-n(i.left-t.x,-1*(i.top-t.y)),l=360-n(i.left-t.x,-1*(i.top+i.height-t.y)),u=n(i.left+i.width-t.x,-1*(i.top-t.y)),h=n(i.left+i.width-t.x,-1*(i.top+i.height-t.y)),c=s/r,_={};if(o<u){let e=i.top-t.y,r=e/c;_={y:t.y+e,x:t.x+r}}else if(o<h){let e=i.left+i.width-t.x,r=e*c;_={y:t.y+r,x:t.x+e}}else if(o<l){let e=i.top+i.height-t.y,r=e/c;_={y:t.y+e,x:t.x+r}}else if(o<a){let e=t.x-i.left,r=e*c;_={y:t.y-r,x:t.x-e}}else{let e=i.top-t.y,r=e/c;_={y:t.y+e,x:t.x+r}}return _}function M(t){$=!0;let e=_.getBoundingClientRect(),i=A(t.clientX-e.left),r=D(t.clientY-e.top),n=w({x:e.left+e.width/2,y:e.top+e.height*b},{x:t.clientX,y:t.clientY},e),o=F(n.x-e.left),a=B(n.y-e.top);s.DebugTouchLogEnable&&console.log("onMouseMove device( x:"+t.clientX+" y:"+t.clientY+" ) view( x:"+o+" y:"+a+")"),f=i,y=r,m.setPoint(o,a)}function T(){$&&($=!1),m.setPoint(0,0)}function L(){s.DebugLogEnable&&console.log("Set Session Storage."),sessionStorage.setItem("Sleepy","1")}function I(t){if("mousewheel"==t.type);else if("mousedown"==t.type)!function(t){$=!0;let e=_.getBoundingClientRect(),i=A(t.clientX-e.left),r=D(t.clientY-e.top),n=w({x:e.left+e.width/2,y:e.top+e.height*b},{x:t.clientX,y:t.clientY},e),o=F(n.x-e.left),a=B(n.y-e.top);s.DebugTouchLogEnable&&console.log("onMouseDown device( x:"+t.clientX+" y:"+t.clientY+" ) view( x:"+o+" y:"+a+")"),f=i,y=r,u.tapEvent(o,a)}(t);else if("mousemove"==t.type){"1"===sessionStorage.getItem("Sleepy")&&sessionStorage.setItem("Sleepy","0"),M(t)}else if("mouseup"==t.type){if("button"in t&&0!=t.button)return}else if("mouseout"==t.type){s.DebugLogEnable&&console.log("Mouse out Window."),T();var e=sessionStorage.getItem("SleepyTimer");window.clearTimeout(e),e=window.setTimeout(L,5e4),sessionStorage.setItem("SleepyTimer",e)}}function E(t){var e=t.touches[0];"touchstart"==t.type?1==t.touches.length&&M(e):"touchmove"==t.type?function(t){let e=_.getBoundingClientRect(),i=A(t.clientX-e.left),r=D(t.clientY-e.top),n=w({x:e.left+e.width/2,y:e.top+e.height*b},{x:t.clientX,y:t.clientY},e),o=F(n.x-e.left),a=B(n.y-e.top);s.DebugTouchLogEnable&&console.log("onMouseMove device( x:"+t.clientX+" y:"+t.clientY+" ) view( x:"+o+" y:"+a+")"),$&&(f=i,y=r,m.setPoint(o,a))}(e):"touchend"==t.type&&T()}function F(t){var e=p.transformX(t);return d.invertTransformX(e)}function B(t){var e=p.transformY(t);return d.invertTransformY(e)}function A(t){return p.transformX(t)}function D(t){return p.transformY(t)}function R(t,e,i){jQuery.ajax({url:i.sdkUrl,dataType:"script",cache:!0}).done((function(){o.LAppDelegate.getInstance()._hitAreaList=i.defineHitAreaName,o.LAppDelegate.getInstance()._zoom=i.modelPoint.zoom,o.LAppDelegate.getInstance()._head_pos=b,o.LAppDelegate.getInstance()._modelX=i.modelPoint.x,o.LAppDelegate.getInstance()._modelY=i.modelPoint.y,o.LAppDelegate.getInstance().initialize(t,e)&&o.LAppDelegate.getInstance().run()}))}function k(t,e){o.LAppDelegate.getInstance()._captureName=t,o.LAppDelegate.getInstance()._captureFrame=e,window.Live2D.captureFrame=e,window.Live2D.captureName=t}function V(){(0,l.ClearDb)()}window.screenshot=k,window.loadlive2d=function(t,e,i){b=void 0===i.headPos?.5:i.headPos,P=i.defineHitAreaName,(new a.PlatformManager).loadString(e).then((r=>{let s=JSON.parse(r),n=Number(s.Version|s.version);console.log(n),3===n?R(t,e,i):function(t,e,i){S=i.modelPoint.zoom,v=i.modelPoint.x,x=i.modelPoint.y,function(t){_=document.getElementById(t),_.addEventListener&&(window.addEventListener("click",I),window.addEventListener("mousedown",I),window.addEventListener("mousemove",I),window.addEventListener("mouseup",I),document.addEventListener("mouseout",I),window.addEventListener("touchstart",E),window.addEventListener("touchend",E),window.addEventListener("touchmove",E))}(t),C(e)}(t,e,i)}))},window.loadlive2dv3=R,window.clearCache=V})()})();
//# sourceMappingURL=live2d.js.map